"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["5696"],{423719:function(e,t,i){i.d(t,{dI:function(){return r},sh:function(){return n}});var a=i(876826);function r(e,t,i){return o.apply(this,arguments)}function o(){return(o=(0,a._)(function*(e,t,i){var a,o,n,s,d,c,l,u,v,m,h,_=[];if((null===(a=t.common_attr)||void 0===a?void 0:a.cover_url)&&_.push(e(t.common_attr.cover_url,i).then(e=>{t.common_attr.cover_url=e})),null===(o=t.common_attr)||void 0===o?void 0:o.cover_url_map){var p=function(a,r){_.push(e(r,i).then(e=>{t.common_attr.cover_url_map[a]=e}))};for(var[f,g]of Object.entries(t.common_attr.cover_url_map))p(f,g)}if(null===(s=t.common_attr)||void 0===s?void 0:null===(n=s.item_urls)||void 0===n?void 0:n.length){var y=function(a,r){if(!r)return"continue";_.push(e(r,i).then(e=>{t.common_attr.item_urls[a]=e}))};for(var[I,b]of Object.entries(t.common_attr.item_urls))y(I,b)}if(null===(d=t.image)||void 0===d?void 0:d.large_images){var w=function(t){_.push(e(t.image_url,i).then(e=>{t.image_url=e}))};for(var k of t.image.large_images)w(k)}if((null===(l=t.video)||void 0===l?void 0:null===(c=l.origin_video)||void 0===c?void 0:c.video_url)&&_.push(e(null===(h=t.video)||void 0===h?void 0:h.origin_video.video_url,i).then(e=>{t.video.origin_video.video_url=e})),null===(u=t.video)||void 0===u?void 0:u.transcoded_video){var T=function(t,a){_.push(e(a.video_url,i).then(e=>{a.video_url=e})),_.push(e(a.cover_url,i).then(e=>{a.cover_url=e}))};for(var[L,D]of Object.entries(t.video.transcoded_video))T(L,D)}if((null===(v=t.video)||void 0===v?void 0:v.cover_url)&&_.push(e(t.video.cover_url,i).then(e=>{t.video.cover_url=e})),null===(m=t.collection)||void 0===m?void 0:m.item_list)for(var S of t.collection.item_list)_.push(r(e,S,i));yield Promise.all(_)})).apply(this,arguments)}function n(e,t,i){return s.apply(this,arguments)}function s(){return(s=(0,a._)(function*(e,t,i){if(!!i){var a=[];for(var o of t)a.push(r(e,o,i));yield Promise.all(a)}})).apply(this,arguments)}},793723:function(e,t,i){function a(e,t,i){var r,o,n,s,d,c,l;if(!!i){if(null===(o=t.common_attr)||void 0===o?void 0:null===(r=o.item_urls)||void 0===r?void 0:r.length)for(var[u,v]of Object.entries(t.common_attr.item_urls))t.common_attr.item_urls[u]=e(v,i);if((null===(s=t.video)||void 0===s?void 0:null===(n=s.origin_video)||void 0===n?void 0:n.video_url)&&(t.video.origin_video.video_url=e(null===(l=t.video)||void 0===l?void 0:l.origin_video.video_url,i)),null===(d=t.video)||void 0===d?void 0:d.transcoded_video)for(var[m,h]of Object.entries(t.video.transcoded_video))h.video_url=e(h.video_url,i),h.cover_url=e(h.cover_url,i);if(null===(c=t.collection)||void 0===c?void 0:c.item_list)for(var _ of t.collection.item_list)a(e,_,i)}}function r(e,t,i){if(!!i)for(var r of t)a(e,r,i)}i.d(t,{$U:function(){return r},kh:function(){return a}})},720979:function(e,t,i){i.d(t,{i:function(){return r}});var a,r=((a={}).activeTab="activeTab",a.category="category",a)},6080:function(e,t,i){function a(e){var t={ratioWidth:1,ratioHeight:1.33},i={ratioWidth:1,ratioHeight:1};switch(e){case 2:return{ratioWidth:1,ratioHeight:.66};case 3:return{ratioWidth:1,ratioHeight:1.16};case 4:default:return i;case 5:case 6:case 7:case 8:case 9:return t}}function r(e,t,i){return t&&i?1===e?{ratioWidth:1,ratioHeight:i/t}:a(e):{ratioWidth:1,ratioHeight:1}}i.d(t,{q:function(){return r},y:function(){return a}})},863896:function(e,t,i){i.d(t,{G:function(){return a},Q:function(){return r}});var a=300,r=6e4},94012:function(e,t,i){i.d(t,{S:function(){return a}});class a{static getInstance(){return!this._instance&&(this._instance=new a),this._instance}static makeExploreFavorite(e,t){var i;null===(i=this._instance)||void 0===i||i.makeExploreItemFavorite(e,t)}init(e){this._searchService=e}setSearchFeedService(e){this._searchFeedService=e}makeExploreItemFavorite(e,t){var i,a;null===(i=this._searchService)||void 0===i||i.setExploreItemFavorite(e,t),null===(a=this._searchFeedService)||void 0===a||a.updateVideoLikeStatus(e,t)}}},917730:function(e,t,i){i.d(t,{Dh:function(){return n},Hx:function(){return d},KT:function(){return s}});var a,r,o,n=((a={}).Pending="pending",a.InProgress="in_progress",a.InEvaluation="in_evaluation",a.Awarded="awarded",a);var s=((r={}).Video="video",r.Image="image",r.ShortVideo="short_video",r.External="external",r);var d=((o={}).POINT="point",o.OTHER="other",o)},980598:function(e,t,i){i.d(t,{u:function(){return a}});var a=(0,i(971245).yh)("mWeb-activity-service")},965058:function(e,t,i){i.d(t,{$:function(){return o}});var a=i(591586),r=i(168179);class o{convert(){var e=this._getDraft(),t=e.findRootComponent();return{submitId:this._submitId,metricsExtra:this._metricsExtra,draftContent:e.toJSONString(),extend:{templateId:this._templateId,root_model:this._getRootModel(t)}}}_getDraft(){var e=new r.DADraft;if(this._sourceDraftContent){for(var t=function(e){var t=i.componentList.find(t=>t.id===e);if(!t)return"break";a.unshift(t),o=t.parentId},i=new r.DADraft({JSONString:this._sourceDraftContent}),a=[],o=i.mainComponentId,n=o;n&&"break"!==t(n);n=o);this._isReplaceMain&&a.pop(),a.forEach(t=>{e.setMainComponent(t)})}return e.setMainComponent(this._mainComponent),e}_getRootModel(e){if(e instanceof r.DAImageBaseComponent){var t,i,a,o,n,s,d;return null!==(d=null===(a=e.abilities)||void 0===a?void 0:null===(i=a.generate)||void 0===i?void 0:null===(t=i.coreParam)||void 0===t?void 0:t.model)&&void 0!==d?d:null===(s=e.abilities)||void 0===s?void 0:null===(n=s.blend)||void 0===n?void 0:null===(o=n.coreParam)||void 0===o?void 0:o.model}}constructor(e){if(this._submitId=e.submitId,this._templateId=e.templateId,this._sourceDraftContent=e.draftContent,this._isReplaceMain=e.isRegenerate,e.reportParam)try{this._metricsExtra=JSON.stringify(e.reportParam)}catch(e){a.t.error("ParamsConverter: ".concat(this.constructor.name," JSON.stringify error"),e)}this._mainComponent=this.getComponent(e)}}},645968:function(e,t,i){i.d(t,{d:()=>P,n:()=>M});var a=i("789786"),r=i("971245"),o=i("876826"),n=i("85728"),s=i("929753"),d=i("836413"),c=i("5564"),l=i("940140"),u={getFeedList:{hostNameType:l.b_.Default,url:"/mweb/v1/feed"},geExplorList:{hostNameType:l.b_.Default,url:"/mweb/v1/get_explore"},getFeedPanel:{hostNameType:l.b_.Default,url:"/mweb/v1/get_panel_info"}},v=i("643590"),m=i("416105"),h=i("804274"),_=i("875649"),p=i("879976"),f=i("820266"),g=i("280166"),y=i("712942"),I=i("242089"),b=i("100470"),w=i("929544"),k=i("757330"),T=i("423719"),L=i("793723"),D=i("530989"),S=i("265587");function F(){return(F=(0,o._)(function*(e){var t=(0,f.b)(e,h.D1),i=e.__cacheSyncToken,a=e.__logId;if(i&&a&&t.item_list){var r=yield D.Li.decryptIV(i,a);yield(0,T.sh)(D.Li.decrypt.bind(D.Li),t.item_list,r)}var o=yield D.sn.getSignOptions();if((0,L.$U)(D.sn.sign.bind(D.sn),t.item_list,o),t.item_list)for(var n=0;n<t.item_list.length;n++)t.item_list[n].video&&(t.item_list[n]=(0,S.Q)(t.item_list[n],t.item_list[n].video.origin_video)),t.item_list[n].request_id=t.request_id,t.item_list[n].impression_id=t.request_id;return(0,f.b)(t,h.zW,!1)})).apply(this,arguments)}class C{getFeedList(e){var t=this;return(0,o._)(function*(){try{var i="".concat((0,y.H4)()).concat(u.getFeedList.url),a="".concat(i,"_").concat((0,c.SZ)(e)),r=yield(0,I.O)(a,()=>t._networkClient.post(i,{category_id:e.categoryId,count:e.count,image_info:e.imageInfo,offset:e.offset,pack_item_opt:{need_data_integrity:!0}},{params:{aid:t._environmentService.appId}})),o=yield t._formateRes(r);return(0,d.oW)((0,k.s)(o))}catch(e){var{ret:n,errmsg:s}=e||{},l=n?Number(n):b.b.ErrCommon;return(0,d.wf)(l,null!=s?s:"unknown error")}})()}getFeedListForRecommend(e){var t=this;return(0,o._)(function*(){try{var i="".concat((0,y.H4)()).concat(u.geExplorList.url),a="".concat(i,"_").concat((0,c.SZ)(e)),r=yield(0,I.O)(a,()=>t._networkClient.post(i,(0,f.X)((0,s._)((0,n._)({},e),{packItemOpt:{needDataIntegrity:!0}})),{params:{aigc_flow_version:w.currentDreaminaAgreementVersion}})),o=yield t._formateRes(r);return(0,d.oW)((0,k.s)(o))}catch(e){var{ret:l,errmsg:v}=e||{},m=l?Number(l):b.b.ErrCommon;return(0,d.wf)(m,null!=v?v:"unknown error")}})()}getFeedPanel(e){var t=this;return(0,o._)(function*(){try{var i="".concat((0,y.H4)()).concat(u.getFeedPanel.url),a=yield(0,I.O)(i,()=>t._networkClient.post("".concat((0,y.H4)()).concat(u.getFeedPanel.url),(0,n._)({},e)));return(0,d.oW)(a)}catch(e){var{ret:r,errmsg:o}=e||{},s=r?Number(r):b.b.ErrCommon;return(0,d.wf)(s,null!=o?o:"unknown error")}})()}_formateRes(e){return function(e){return F.apply(this,arguments)}(e)}constructor(e){var t,i;this._environmentService=e,this._networkClient=(t={ch:"online"},i=new v.y().build({headers:(0,n._)({"Content-Type":"application/json"},t),withCredentials:!0}),(0,p.V)(i),(0,m.mH)(i),(0,h.xP)(i),(0,_.e_)(i),i)}}C=(0,a.gn)([(0,a.fM)(0,g.Y),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===g.Y?Object:g.Y])],C);var A=i("434712"),P=(0,r.yh)("mWeb-feed-service");class M{get feedRepository(){return this._feedRepository}constructor(e){this._containerService=e,this._feedRepository=this._containerService.createInstance(C)}}M=(0,a.gn)([(0,a.fM)(0,A.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===A.t?Object:A.t])],M)},757330:function(e,t,i){i.d(t,{s:function(){return n}});var a=i(85728),r=i(929753),o=i(247465);function n(e){var t=e.itemList.map(e=>(0,o.q)(e));return(0,r._)((0,a._)({},e),{itemList:t})}},247465:function(e,t,i){i.d(t,{q:()=>k});var a=i("433965"),r=i("85728"),o=i("929753"),n=i("295834"),s=i("936690"),d=i("601191"),c=i("128468"),l=i("168179"),u=i("716467"),v=i("216475"),m=i("476928"),h=i("595743"),_=i("501385"),p=i("464369"),f=i("650078"),g=i("375516"),y=i("727280"),I=i("997166");class b{convert(){var e,t,i,a,l=this._blendParams();if(!l)return(0,r._)({},this._item);var{originPrompt:u}=l,v=(0,n._)(l,["originPrompt"]),m=(0,o._)((0,r._)({},this._item.aigcImageParams),{blendParams:v});void 0!==u&&(0,s.V8)(m,u);var h=(0,s.qv)(this._item),_=(0,s.Uq)(v),p=(0,d.Mu)(h,v,c.JU.Workbench),f=(0,s.DI)(this._item,p),g=null!==(a=null===(i=this._item)||void 0===i?void 0:null===(t=i.commonAttr)||void 0===t?void 0:null===(e=t.itemUrls)||void 0===e?void 0:e[0])&&void 0!==a?a:"";return(0,o._)((0,r._)({},this._item),{aigcImageParams:m,blendParams:{blendAttributes:_,imagePromptList:p,promptPlaceholderInfoList:f,imagePromptZipUrl:g}})}_blendParams(){var e,t,i,a,o,n,s,d,c,y,I,b=this._item.aigcImageParams.blendParams;if(!!b){if(!this._mainComponent)return b;var{abilities:w}=null!==(n=this._mainComponent)&&void 0!==n?n:{},k=null===(e=this._draft)||void 0===e?void 0:e.findRootComponent(),T=k instanceof l.DAImageBaseComponent?k:void 0,L=null!==(s=null==w?void 0:w.blend)&&void 0!==s?s:null==T?void 0:null===(t=T.abilities)||void 0===t?void 0:t.blend;if(!L)return b;var D={promptPlaceholderInfoList:null!==(d=null===(i=L.promptPlaceholderInfoList)||void 0===i?void 0:i.map(v.B))&&void 0!==d?d:null==b?void 0:b.promptPlaceholderInfoList,abilityList:(null!==(c=null===(a=L.abilityList)||void 0===a?void 0:a.map(e=>{var t,i,a,r,o=e.name&&u.uC[e.name];if(!!o){var n=this._item.aigcDraftResources,s=e.styleReference?(0,m.t)(e.styleReference,n):void 0,d=null===(t=e.faceRecognizeList)||void 0===t?void 0:t.map(e=>e.map(h.b)),c=null===(i=e.ipKeepList)||void 0===i?void 0:i.map(_.J).filter(Boolean),l=null===(a=e.controlNetList)||void 0===a?void 0:a.map(p.F).filter(Boolean),v=null===(r=e.imageList)||void 0===r?void 0:r.map(e=>(0,f.M)(e,n)).filter(Boolean),y=e.commonAsset?(0,g.J)(e.commonAsset,n):void 0;return{name:o,extra:e.extra,strength:e.strength,largeImageList:v,coverImageList:v,imageList:[],controlNetList:l,ipKeepList:c,styleReference:s,faceRecognizeList:d,commonAsset:y}}}))&&void 0!==c?c:[]).filter(Boolean),hasItemUrls:b.hasItemUrls,model:b.model,sampleStrength:b.sampleStrength,styleReference:b.styleReference},S=this._resolveStyleCodeBlendAbilityParams(null!==(y=null===(o=L.coreParam)||void 0===o?void 0:o.prompt)&&void 0!==y?y:"",D.abilityList,null!==(I=D.promptPlaceholderInfoList)&&void 0!==I?I:[]);return(0,r._)({originPrompt:S.prompt},D,S)}}_resolveStyleCodeBlendAbilityParams(e,t,i){var a,r=(0,y.DH)({prompt:e,imagePromptList:t.filter(e=>void 0!==e),commonAssetList:null!==(a=this._item.aigcImageParams.publishAssetList)&&void 0!==a?a:[],promptPlaceholderInfoList:i});return r?r:{prompt:(0,I.IA)(this._item.aigcImageParams),abilityList:t,promptPlaceholderInfoList:i}}constructor(e){this._item=e;var{aigcDraft:t}=e;if(null==t?void 0:t.content){var i=new l.DADraft({JSONString:t.content});this._draft=i;var a=i.componentList.find(e=>e.id===i.mainComponentId);a instanceof l.DAImageBaseComponent&&(this._mainComponent=a)}}}class w{convert(){var e,t,i=(null!==(t=null===(e=this._item.collection)||void 0===e?void 0:e.itemList)&&void 0!==t?t:[]).map(e=>new b(e).convert());return(0,o._)((0,r._)({},this._item),{collection:{itemList:i}})}constructor(e){this._item=e}}function k(e){return(0,a.DF)(e)?new b(e).convert():(0,a.Rb)(e)?new w(e).convert():e}},884569:function(e,t,i){i.d(t,{o:()=>C,M:()=>A});var a=i("789786"),r=i("971245"),o=i("876826"),n=i("85728"),s=i("929753"),d=i("643590"),c=i("416105"),l=i("875649"),u=i("879976"),v=i("940140"),m={getHomePage:{hostNameType:v.b_.Default,url:"/mweb/v1/get_homepage"},getLikeList:{hostNameType:v.b_.Default,url:"/mweb/v1/get_favorite_list"},doFollowUser:{hostNameType:v.b_.Default,url:"/mweb/v1/follow"}},h=i("836413"),_=i("820266"),p=i("423719"),f=i("793723"),g=i("530989"),y=i("712942"),I=i("242089"),b=i("265587"),w=i("100470"),k=i("433965"),T=i("247465");function L(e){var t=e.itemList.map(e=>(0,k.jD)(e)||(0,k.Rb)(e)||(0,k.DF)(e)?(0,T.q)(e):e);return(0,s._)((0,n._)({},e),{itemList:t})}function D(e){return e?e.replace(/_([a-z])/g,(e,t)=>t.toUpperCase()):""}class S{getDataList(e){var t=this;return(0,o._)(function*(){try{var i,a="".concat((0,y.H4)()).concat(m.getHomePage.url),r="".concat(a,"_").concat(null!==(i=e.imageType)&&void 0!==i?i:e.imageTypeList);e.packItemOpt=(0,s._)((0,n._)({},e.packItemOpt),{needDataIntegrity:!0});var o=yield(0,I.O)(r,()=>t._networkClient.post(a,(0,_.X)(e)),!0),d=o.__cacheSyncToken,c=o.__logId;if(d){var l=yield g.Li.decryptIV(d,c);yield(0,p.sh)(g.Li.decrypt.bind(g.Li),o.item_list,l)}var u=yield g.sn.getSignOptions();(0,f.$U)(g.sn.sign.bind(g.sn),o.item_list,u);for(var v=0;v<o.item_list.length;v++)o.item_list[v].video&&(o.item_list[v]=(0,b.Q)(o.item_list[v]));var k=(0,_.b)(o,D),T=L(k);return(0,h.oW)(T)}catch(e){var{ret:S,errmsg:F}=e||{},C=S?Number(S):w.b.ErrCommon;return(0,h.wf)(C,null!=F?F:"unknown error")}})()}getLikeDataList(e){var t=this;return(0,o._)(function*(){try{for(var i,a="".concat((0,y.H4)()).concat(m.getLikeList.url),r="".concat(a,"_").concat(null!==(i=e.imageType)&&void 0!==i?i:e.imageTypeList),o=yield(0,I.O)(r,()=>t._networkClient.post(a,(0,n._)({},(0,_.X)(e))),!0),s=0;s<o.item_list.length;s++)o.item_list[s].video&&(o.item_list[s]=(0,b.Q)(o.item_list[s]));var d=(0,_.b)(o,D),c=L(d);return(0,h.oW)(c)}catch(e){var{ret:l,errmsg:u}=e||{},v=l?Number(l):w.b.ErrCommon;return(0,h.wf)(v,null!=u?u:"unknown error")}})()}doFollowUser(e){var t=this;return(0,o._)(function*(){try{var i="".concat((0,y.H4)()).concat(m.doFollowUser.url),a="".concat(i,"_").concat(e.op,"_").concat(e.secUid),r=yield(0,I.O)(a,()=>t._networkClient.post(i,(0,n._)({},(0,_.X)(e))));return(0,h.oW)(r)}catch(e){var{ret:o,errmsg:s}=e||{},d=o?Number(o):w.b.ErrCommon;return(0,h.wf)(d,null!=s?s:"unknown error")}})()}constructor(){var e;this._networkClient=(e=new d.y().build({headers:{"Content-Type":"application/json"},withCredentials:!0}),(0,u.V)(e),(0,c.mH)(e),(0,l.e_)(e),e)}}var F=i("434712"),C=(0,r.yh)("mWeb-home-page-service");class A{get homePageRepository(){return this._homePageRepository}constructor(e){this._containerService=e,this._homePageRepository=this._containerService.createInstance(S)}}A=(0,a.gn)([(0,a.fM)(0,F.t),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===F.t?Object:F.t])],A)},222721:function(e,t,i){i.d(t,{e:function(){return a}});var a=(0,i(971245).yh)("feed-prefetch-service")},493969:function(e,t,i){i.d(t,{U:()=>B});var a=i("876826"),r=i("85728"),o=i("929753"),n=i("789786"),s=i("260963"),d=i("773820"),c=i("216342"),l=i("247170"),u=i("836413"),v=i("56935"),m=i("588735"),h=i("733787"),_=i("869919"),p=i("76212"),f=i("434487"),g=i("224671"),y=i("434712"),I=i("675601"),b=i("77922"),w=i("474956"),k=i("799108"),T=i("292180"),L=i("566291"),D=i("584531"),S=i("331480"),F=i("99123"),C=i("70137"),A=i("484702"),P=i("899229"),M=i("652660"),O=i("608358"),R=i("740242"),U=i("645421"),E=i("351066"),x=i("182688"),N=i("208540"),j=i("76931"),V=i("168179"),q=i("965058"),H=i("716467"),G=i("128468");class z{convert(){var e,t=new V.DAVideoGenerateAbilities,i=new V.DAGenVideoAbility,a=new V.DAText2VideoParams,r=new V.DAVideoGenInput,o=new V.DAVideoGenV2V,n=new V.DAVideoGenVideoTemplate,s=new V.DAVideoRefParam;s.generateType=V.DAAIGCGenerateType.videoTemplate,i.videoRefParams=s;var d=null===(e=this._params.input.videoGenInputs.v2vOpt)||void 0===e?void 0:e.videoTemplate;if(d){n.enable=!0;var c=new V.DAImageResource;if(c.sourceFrom=V.DAResourceSourceFrom.upload,c.platformType=V.DAImageResourcePlatformType.imageX,c.uri=d.imageInfo.imageUri,d.imageInfo.aigcImage){var l=new V.DAAIGCImage;l.itemId=d.imageInfo.aigcImage.itemId,c.aigcImage=l}n.imageInfo=c,n.videoTemplate=d.videoTemplateItemId,n.videoInfo=function(e){if(!!e){var t=new V.DAVideoResource;return t.sourceFrom=V.DAResourceSourceFrom.upload,t.vid=e.videoId,t}}(d.videoInfo)}o.videoTemplate=n,r.v2vOpt=o,a.videoGenInputs=[r],a.seed=this._params.input.seed,a.videoAspectRatio=this._params.input.videoAspectRatio,i.text2VideoParams=a,i.scene=this._params.scene;var{taskExtra:u}=this._params.taskPayload;return u&&"object"==typeof u&&(i.videoTaskExtra=JSON.stringify(this._params.taskPayload.taskExtra)),t.genVideo=i,t}constructor(e){this._params=e}}class W extends q.${getComponent(e){var t,i,a=new V.DAVideoBaseComponent;return a.generateType=V.DAVideoGenerateType.videoTemplate,a.aigcMode=null!==(i=H.sc[null!==(t=e.mode)&&void 0!==t?t:G.JU.Workbench])&&void 0!==i?i:V.DAAIGCMode.workbench,a.abilities=new z(e).convert(),a}convert(){var e=super.convert();return(0,o._)((0,r._)({},e),{extend:(0,o._)((0,r._)({},e.extend),{mVideoCommerceInfo:this._commerceInfo})})}constructor(e){super(e),this._commerceInfo=e.commerceInfo}}class B{get submitId(){var e,t;return null!==(t=this._submitId)&&void 0!==t?t:null===(e=this.taskData)||void 0===e?void 0:e.submitId}get taskData(){return this.observableData.data}get status(){return this.taskData.status}forceUpdateTask(){var e=this;return(0,a._)(function*(){if(!!e.taskData.taskId)try{var t,i=yield e._queryTask();if(!i.ok){e._logger.error("generate task query fail, history id ".concat(e.taskData.id," task id ").concat(e.taskData.taskId,", logId ").concat(null===(t=i.errorInfo)||void 0===t?void 0:t.logId));return}var a=i.value.taskResult;a.createdTime=0===a.createdTime?e.observableData.data.createdTime:a.createdTime;var r=e._formateServerData(a,!0);return e.observableData.data=r,r}catch(t){e._logger.error("generate task query fail, history id ".concat(e.taskData.id," task id ").concat(e.taskData.taskId));return}})()}startTask(){var e=this;return(0,a._)(function*(){return yield e._startTask()})()}startTaskFromOuterPromise(e){var t=this;return(0,a._)(function*(){return yield t._startTask(e)})()}_startTask(e){var t=this;return(0,a._)(function*(){try{if(t.observableData.data.status!==E.C.INIT)return(0,u.wf)(-1,"task can not start");t.observableData.data.errorCode=m.sb.Pending,t._logger.info("generate task start, submitId ".concat(t.observableData.data.id)),(0,F.lt)(t.observableData.data.id,t.observableData.data.inputParams,t._option.mode,t.observableData.data.generateType);var i,a,r,o=(0,U.T)({submitId:t.observableData.data.id,scene:t.observableData.data.scene,needCredits:t.observableData.data.needCredits,commercialStrategyService:t._commercialStrategyService}),n=t._commercialCreditService.addLocalCreditHistory(o),d=t._formatTaskDataToParams(),c=yield t._submitTask(d,e);if(t.observableData.data.errorCode=void 0,(0,F.hw)(t._containerService,t.observableData.data.id,c),c.code&&(t.observableData.data.errorCode=c.code),!c.ok)return[m.sb.NoCredit,m.sb.NotInvited,m.sb.RateLimit,m.sb.TnsNotPass,m.sb.ErrPunishLimitAIGenerate,m.sb.ErrSharkNotPass].includes(c.code)?(0,s.z)(()=>{t.observableData.data.status=E.C.FAIL,t.observableData.data.taskDetail=c.errorInfo.data.task}):(0,s.z)(()=>{t.observableData.data.status=E.C.RETRYABLE_FAIL,t.observableData.data.taskDetail=c.errorInfo.data.task}),t._logger.error("generate task fail, submitId ".concat(t.id,", logId ").concat(null===(r=c.errorInfo)||void 0===r?void 0:r.logId)),(0,L.Y)(c),n.dispose(),t._commercialCreditService.syncRemoteCreditHistory(),c;return(null===(i=c.value.firstFrameImage)||void 0===i?void 0:i.imageUrl)&&(t.observableData.data.firstFrameImage=c.value.firstFrameImage),(null===(a=c.value.lastFrameImage)||void 0===a?void 0:a.imageUrl)&&(t.observableData.data.lastFrameImage=c.value.lastFrameImage),(0,s.z)(()=>{t.observableData.data.taskId=c.value.task.taskId,t.id=c.value.historyRecordId,t.observableData.data.id=c.value.historyRecordId,t.observableData.data.taskDetail=c.value.task,t.observableData.data.videoDetail=c.value.videoDreamina,t.observableData.data.status=(0,x.KZ)(c.value.task.status),t.observableData.data.forecastGenerateCost=c.value.forecastGenerateCost,t.observableData.data.forecastQueueCost=c.value.forecastQueueCost,t.observableData.data.failCode=c.value.failCode,t.observableData.data.generateId=c.value.generateId}),t._logger.info("generate task success, task id ".concat(c.value.task.taskId,", commercialScene is ").concat(t.observableData.data.scene," creditPatch is ").concat(JSON.stringify(o)," currentCredit is ").concat(t._commercialCreditService.localCredit,", params is ").concat(JSON.stringify(d))),N.BW.includes(c.value.task.status)&&c.value.task.priority!==h.T8.Relax&&t._createAndExecuteWebsocketPollingManager(),(0,u.oW)(t.taskData)}catch(e){return(0,u.wf)(-1,"submit Task fail",e)}})()}_getIsDraftGen(){var e=[_.eA.VideoTemplate],{scene:t}=this.taskData.inputParams;return t&&e.includes(t)}_submitTask(e,t){var i="lip_sync"===e.scene?"to_video-lipsync":e.input.videoGenInputs.firstFrameImage||e.input.videoGenInputs.endFrameImage?"image_to_video":"text_to_video";if(this._getIsDraftGen())return this._dataService.submitTaskByDraft(this._formatGenerateVideoRequestParams(e),{babi_param:JSON.stringify({scenario:"image_video_generation",feature_key:i,feature_entrance:(0,p.b2)(),feature_entrance_detail:"".concat((0,p.b2)(),"-").concat("to_video-lipsync"===i?"lipsync":i)})});var a=this._dataService.submitTask.bind(this);return(null!=t?t:a)(e,{babi_param:JSON.stringify({scenario:"image_video_generation",feature_key:i,feature_entrance:(0,p.b2)(),feature_entrance_detail:"".concat((0,p.b2)(),"-").concat("to_video-lipsync"===i?"lipsync":i)})})}retryTask(){var e=this;return(0,a._)(function*(){return e.observableData.data.status!==E.C.RETRYABLE_FAIL?(0,u.wf)(-1,"task can not Retry"):(e.observableData.data.status=E.C.INIT,e.observableData.data.inputParams.createdTime=Date.now(),yield e.startTask())})()}updateHistoryGroupKeyMd5(e){(0,s.z)(()=>{this.observableData.data.historyGroupKeyMd5=e})}markFavorite(e){this.observableData.data.hasFavorited=e}markPublished(e){this.observableData.data.videoDetail&&(this.observableData.data.videoDetail=(0,o._)((0,r._)({},this.observableData.data.videoDetail),{publishedItemId:e}))}_queryTask(){var e=this;return(0,a._)(function*(){if(e._getIsDraftGen()){var t=e.taskData.id,i=yield e._dataService.queryTaskByDraft({historyIds:[t]});return i.ok?(0,u.oW)({logId:i.value.logId,taskResult:i.value.taskMap[t]}):i}var a="".concat(e.taskData.taskId),r=yield e._dataService.queryTask({taskIdList:[a]});return r.ok?(0,u.oW)({logId:r.value.logId,taskResult:r.value.taskMap[a]}):r})()}_pollProgress(){var e=this;return(0,a._)(function*(){if(!!e.taskData.taskId)try{var t,i=yield e._queryTask();if(!i.ok){e._logger.error("generate task query fail, task id ".concat(e.taskData.taskId,", logId ").concat(null===(t=i.errorInfo)||void 0===t?void 0:t.logId)),e._pollErrorCount+=1,e._pollErrorCount<N.nf&&setTimeout(()=>{e._pollProgress()},N.cr);return}var{taskResult:a}=i.value;e._pollErrorCount=0,e._logger.info("generate task query success, task historyId ".concat(e.taskData.id,"  task id ").concat(e.taskData.taskId,", status ").concat(a.task.status,", logId ").concat(i.value.logId)),N.BW.includes(a.task.status)&&setTimeout(()=>{e._pollProgress()},N.cr),a.createdTime=0===a.createdTime?e.observableData.data.createdTime:a.createdTime,(0,F.FT)(e._containerService,a,e._option.mode,i.value.logId,e.observableData.data.inputParams);var n=e._formateServerData(a);!e.observableData.data.firstFrameImage&&n.firstFrameImage&&(e.observableData.data.firstFrameImage=n.firstFrameImage);var d=(0,x.KZ)(a.task.status);if(d===e.observableData.data.status)return;if((0,s.z)(()=>{e.observableData.data=(0,o._)((0,r._)({},e.observableData.data,n),{status:d,taskDetail:n.taskDetail,videoDetail:n.videoDetail,createdTime:n.createdTime})}),[E.C.FAIL,E.C.SUCCESS].includes(d)){var c=(0,D.Y)(a);e.observableData.data.inputParams=c,e._commercialCreditService.syncRemoteCreditHistory()}d===E.C.SUCCESS&&(e.observableData.data.videoResource=e._getResource(a))}catch(t){e._pollErrorCount+=1,e._pollErrorCount<N.nf&&setTimeout(()=>{e._pollProgress()},N.cr)}})()}_formatTaskDataToParams(){var e,t,i,a,n,c,{inputParams:l,scene:u}=this.taskData;return{submitId:this.observableData.data.submitId,input:{videoGenInputs:(0,r._)({firstFrameImage:null===(e=l.inputImages)||void 0===e?void 0:e.find(e=>e.type===d.z.FirstFrame),endFrameImage:null===(t=l.inputImages)||void 0===t?void 0:t.find(e=>e.type===d.z.LastFrame),lensMotionType:l.motionType,motionSpeed:l.motionSpeed,prompt:l.textPrompt,vid:l.vid,audioVid:l.audioVid,v2vOpt:(0,s.ZN)(l.v2vOpt),i2vOpt:(0,s.ZN)(l.i2vOpt),originDurationMs:l.originDurationMs,originFps:l.originFps,videoMode:l.videoMode,motionIntensity:l.motionIntensity,batchNumber:l.batchNumber,templateId:l.templateId},l.boximator?{boximator:(0,r._)({enable:!0},l.boximator)}:{}),seed:l.seed,videoAspectRatio:l.videoRatio,priority:l.priority,modelReqKey:l.modelReqKey},taskPayload:{taskExtra:(0,o._)((0,r._)({},null!==(a=l.extra)&&void 0!==a?a:{}),{originTemplateId:l.templateId,impressionId:null!==(n=l.impressionId)&&void 0!==n?n:(0,j.ww)(l.templateId),imageNameMapping:null===(i=l.inputImages)||void 0===i?void 0:i.reduce((e,t)=>(t.name&&(e[t.imageUri]=t.name),e),{})})},commerceInfo:{resourceId:k.Zw,resourceIdType:"str",resourceSubType:"aigc",benefitType:(0,T.Z)((0,P.cq)({scene:u,sceneOptions:(0,P.S9)(u)?{version:P.dt.V2CharVideo,characterMode:l.videoMode}:{version:P.dt.V2,mode:(0,P.xc)(l.originFps),containerService:this._containerService,modelReqKey:l.modelReqKey}}))},scene:l.scene,aiGenInfo:l.aiGenInfo,preTaskId:l.preTaskId,mode:this._option.mode,historyOption:{storyId:this._option.storyId},clientTraceData:{impressionId:null!==(c=l.impressionId)&&void 0!==c?c:(0,j.ww)(l.templateId)}}}_formatGenerateVideoRequestParams(e){return new W(e).convert()}_formateServerData(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=(0,D.o)(e);return[E.C.SUCCESS,E.C.FAIL].includes(i.status)&&(i.videoResource=this._getResource(e,t)),i}_getResource(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!!e.videoDreamina){var i=String(e.videoDreamina.key);t&&this._resourceService.delete(i,w._g.VideoDreamina);var a=(0,f.nQ)(this._resourceService,w._g.VideoDreamina,e.videoDreamina);return null==a||a.getCoverResourceToken().startImmediately(),a}}_createPollingManager(e){var{websocketMessageHandler:t,onFallbackToPolling:i}=e;return this._getIsDraftGen()?this._containerService.createInstance(M.Q,{methodId:S.Te.GenerateTaskStatusMessage,websocketMessageHandler:(e,i)=>t({submitId:i.submitId,status:i.status}),onFallbackToPolling:i,pollingHandler:this._pollProgress.bind(this),timeout:6e4}):this._containerService.createInstance(M.Q,{methodId:S.Te.AigcVideoTask,websocketMessageHandler:(e,i)=>t({submitId:i.submitId,status:i.taskStatus}),onFallbackToPolling:i,pollingHandler:this._pollProgress.bind(this),timeout:3e5})}_createAndExecuteWebsocketPollingManager(){var e=Date.now(),t=this._createPollingManager({websocketMessageHandler:t=>this.observableData.data.submitId===t.submitId&&t.status!==g.j0.Init&&t.status!==g.j0.SubmitOk?((0,F.q)(t.submitId),(0,R.bY)(this._containerService,{taskName:"aigc-video",taskId:this.observableData.data.taskId,submitId:this.observableData.data.submitId,taskStatus:t.status,duration:Date.now()-e}),this._pollProgress(),{accepted:!0,done:!0}):{accepted:!1,done:!1},onFallbackToPolling:e=>{(0,R.dz)(this._containerService,{taskName:"aigc-video",taskId:this.observableData.data.taskId,submitId:this.observableData.data.submitId,reason:e})}});(0,O.ko)(this._containerService,S.Dx).registerEventHandler(S.Te.AigcVideoFirstFrame,e=>{this.observableData.data.taskId===e.taskId&&(0,s.z)(()=>{var{width:t,height:i,format:a,imageUrl:r}=e.imageInfo;this.observableData.data.firstFrameImage={width:t,height:i,format:a,imageUrl:r}})}),(0,c.Rr)(e=>t.startListening(e),{contextType:l.zO.Task,processName:"AigcVideoTask"})}constructor({logger:e,data:t,serviceData:i,option:a},r,o,n,d,c){if(this._containerService=r,this._dataService=o,this._resourceService=n,this._commercialCreditService=d,this._commercialStrategyService=c,this._pollErrorCount=0,this._logger=e,this._option=a,(0,v.Y2)(t||i),t)this.id=t.id,this._submitId=t.id,this.observableData=(0,s.LO)({data:t});else if(i){var l=this._formateServerData(i);this.id=l.id,this.observableData=(0,s.LO)({data:l})}else throw Error("init imformation loss");[E.C.LOADING,E.C.INIT].includes(this.observableData.data.status)&&this.observableData.data.inputParams.priority!==h.T8.Relax&&this._createAndExecuteWebsocketPollingManager(),i&&[E.C.SUCCESS,E.C.FAIL].includes(this.observableData.data.status)&&(this.observableData.data.videoResource=this._getResource(i))}}B=(0,n.gn)([(0,n.fM)(1,y.t),(0,n.fM)(2,I.g),(0,n.fM)(3,b.c),(0,n.fM)(4,C.aG),(0,n.fM)(5,A.N),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof AigcVideoTaskParams?Object:AigcVideoTaskParams,void 0===y.t?Object:y.t,void 0===I.g?Object:I.g,void 0===b.c?Object:b.c,void 0===C.aG?Object:C.aG,void 0===A.N?Object:A.N])],B)},208540:function(e,t,i){i.d(t,{BW:function(){return n},cr:function(){return r},nf:function(){return o}});var a=i(243302),r=2e4,o=5,n=[a.Pd.Init,a.Pd.SubmitOk]},200294:function(e,t,i){i.d(t,{d:function(){return a}});var a=(0,i(971245).yh)("prefetch-request-service")},993308:function(e,t,i){i.d(t,{_:function(){return f},s:function(){return p}});var a=i(876826),r=i(85728),o=i(929753),n=i(789786),s=i(843698),d=i(874800),c=i(836413),l=i(241047),u=i(875488),v=i(863896),m=i(902519),h=i(884569),_={offset:0,count:l.iV.count,imageTypeList:[...l.fk[m.Ym.Template]]},p="homepage";class f extends d.JT{get secUid(){return this._params.secUid}get expiredAt(){return this._expiredAt}isMatchByParams(e){return this._params.secUid===e.secUid}isMatchByRequestParams(e){return!(!this._paramsHomepage||e.secUid!==this._paramsHomepage.secUid||e.count!==this._paramsHomepage.count||e.offset!==this._paramsHomepage.offset||void 0!==e.imageType&&void 0!==this._paramsHomepage.imageType&&e.imageType!==this._paramsHomepage.imageType||Array.isArray(e.imageTypeList)&&Array.isArray(this._paramsHomepage.imageTypeList)&&e.imageTypeList.join("_")!==this._paramsHomepage.imageTypeList.join("_"))&&(void 0===e.imageInfo||void 0===this._paramsHomepage.imageInfo||e.imageInfo.format===this._paramsHomepage.imageInfo.format)&&!0}_fetchHomepage(){var e=this;return(0,a._)(function*(){return e._paramsHomepage=(0,o._)((0,r._)({},_),{secUid:e._params.secUid}),e._paramsHomepage.imageInfo=yield(0,u.FI)(),e._homePageService.homePageRepository.getDataList((0,o._)((0,r._)({},e._paramsHomepage),{imageTypeList:[...e._paramsHomepage.imageTypeList],imageInfo:(0,r._)({},e._paramsHomepage.imageInfo)}))})()}_clearHomepage(){if(!this._paramsHomepage)return}dispose(){this._clearHomepage(),super.dispose()}constructor(e,t){super(),this._params=e,this._homePageService=t,this.displayName=p,this._onSuccess=this._store.add(new s.Q),this.onSuccess=this._onSuccess.event,this._onFailed=this._store.add(new s.Q),this.onFailed=this._onFailed.event,this._onDidDone=this._store.add(new s.Q),this.onDidDone=this._onDidDone.event,this.pRequest=this._fetchHomepage(),this.pRequest.then(e=>{this._expiredAt=Date.now()+v.Q,e.ok?this._onSuccess.fire({value:e,expiredAt:this._expiredAt}):this._onFailed.fire({value:e,expiredAt:this._expiredAt}),this._onDidDone.fire({value:e,expiredAt:this._expiredAt})},e=>{this._onFailed.fire({value:(0,c.Mx)(-1,"prefetech failed",e),expiredAt:-1}),this._onDidDone.fire({value:(0,c.Mx)(-1,"prefetech failed",e),expiredAt:-1})})}}f=(0,n.gn)([(0,n.fM)(1,h.o),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IHomepagePrefetchTaskParams?Object:IHomepagePrefetchTaskParams,void 0===h.o?Object:h.o])],f)},161041:function(e,t,i){i.d(t,{Z:function(){return u},s:function(){return l}});var a=i(85728),r=i(789786),o=i(843698),n=i(874800),s=i(836413),d=i(758261),c=i(863896),l="user-info";class u extends n.JT{get secUid(){return this._params.secUid}get expiredAt(){return this._expiredAt}isMatchByParams(e){return this._params.secUid===e.secUid}isMatchByRequestParams(e){return!!this._requestParams&&e.secUid===this._requestParams.secUid}_fetchUserInfo(){return this._requestParams={secUid:this._params.secUid},this._userService.repository.getUserInfo((0,a._)({},this._requestParams))}_clearUserInfo(){if(!this._requestParams)return}dispose(){this._clearUserInfo(),super.dispose()}constructor(e,t){super(),this._params=e,this._userService=t,this.displayName=l,this._onSuccess=this._store.add(new o.Q),this.onSuccess=this._onSuccess.event,this._onFailed=this._store.add(new o.Q),this.onFailed=this._onFailed.event,this._onDidDone=this._store.add(new o.Q),this.onDidDone=this._onDidDone.event,this.pRequest=this._fetchUserInfo(),this.pRequest.then(e=>{this._expiredAt=Date.now()+c.Q,e.ok?this._onSuccess.fire({value:e,expiredAt:this._expiredAt}):this._onFailed.fire({value:e,expiredAt:-1}),this._onDidDone.fire({value:e,expiredAt:this._expiredAt})},e=>{this._onFailed.fire({value:(0,s.Mx)(-1,"prefetech failed",e),expiredAt:-1}),this._onDidDone.fire({value:(0,s.Mx)(-1,"prefetech failed",e),expiredAt:-1})})}}u=(0,r.gn)([(0,r.fM)(1,d.h),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IUserInfoPrefetchTaskParams?Object:IUserInfoPrefetchTaskParams,void 0===d.h?Object:d.h])],u)},214090:function(e,t,i){i.d(t,{p:function(){return a}});var a=(0,i(971245).yh)("dreamina-request-cache-service")},970419:function(e,t,i){i.d(t,{G:function(){return a}});var a=(0,i(971245).yh)("server-injected-data-service")},532185:function(e,t,i){i.d(t,{G:()=>E});var a=i("876826"),r=i("789786"),o=i("2910"),n=i("41723"),s=i.n(n),d=i("260963"),c=i("947259"),l=i("538638"),u=i("166320"),v=i("882644"),m=i("434712"),h=i("77922"),_=i("257843"),p=i("675601"),f=i("657600"),g=i("474956"),y=i("761615"),I=i("150615"),b=i("369617"),w=i("869409"),k=i("243302"),T=i("283349"),L=i("128468"),D=i("243494"),S=i("434487"),F=i("493969"),C=i("738210"),A=i("104818"),P=i("114527"),M=i("651531");class O{get listData(){return this._listData}get ready(){return this._ready}get loading(){return this._loading}get hasMore(){return this._queryToken.hasMore}get isError(){return this._isError}get _onlyFavorited(){return this._type===l.F.Favor}init(){return this.ready?Promise.resolve():this.loadMore()}reInit(){return(0,d.z)(()=>{this._ready=!1,this._loading=!1,this._isError=!1,this._resetQueryToken(),this._listData=this._listData.slice(0,50)}),this.init()}loadMore(){var e=this;return(0,a._)(function*(){if(e.loading||!e.hasMore)return(0,d.gx)(()=>!e.loading);e._loading=!0,e._isError=!1;try{var t=Date.now(),i=yield e._historyService.getAssetList({assetType:w.d.Video,offset:e._queryToken.offset,count:e._queryToken.config.limit,direction:e._queryToken.config.direction,option:{orderBy:e._queryToken.config.orderBy,onlyFavorited:e._queryToken.config.onlyFavorited,withTaskStatus:[k.Pd.FinalSuccess]},assetTypeList:[w.d.VideoBGM,w.d.VideoAudioEffect]});(0,P.K)(e._containerService,{cost:Date.now()-t,assetType:w.d.Video}),i.ok?(e._queryToken=(0,D.ib)(e._queryToken.config,i.value.list.filter(e=>{var t;return(0,T.w)(e.generateType)&&!!(null===(t=e.itemList)||void 0===t?void 0:t.length)}),{hasMore:i.value.hasMore,offset:i.value.offset}),e._addResource(e._queryToken.value),e._setListData(e._queryToken.value)):e._isError=!0}catch(t){e._isError=!0}finally{e._loading=!1,e._ready=!0}})()}markFavorite(e,t){var i={},a=()=>{(0,d.z)(()=>{this.listData.forEach(e=>{void 0!==i[e.historyRecordId]&&(e.assetOption={hasFavorited:i[e.historyRecordId]})})})},r=new Set(e);return this.listData.forEach(e=>{if(r.has(e.historyRecordId)){var a;i[e.historyRecordId]=!!(null===(a=e.assetOption)||void 0===a?void 0:a.hasFavorited),e.assetOption={hasFavorited:t}}}),{onError:()=>a(),onSuccess:e=>{e.forEach(e=>delete i[e]),a()}}}markPublished(e,t){var i=this.listData.findIndex(t=>t.aigcItemId===e);this.listData[i]&&(this.listData[i].itemList[0].commonAttr.publishedItemId=t,this.listData[i].videoDreamina&&(this.listData[i].videoDreamina.publishedItemId=t))}addAssets(e){if(e){var t=new Set(this.listData.map(e=>e.historyRecordId)),i=e.filter(e=>!t.has(e.historyRecordId));this._setListData(this.listData.concat(i))}}deleteAssets(e){this._listData=this._listData.filter(t=>{var{historyRecordId:i}=t;return!e.includes(i)})}getRecord(e){return this._listData.find(t=>t.historyRecordId===e)}_resetQueryToken(){return this._queryToken=(0,D.ib)({limit:50,onlyFavorited:this._onlyFavorited,orderBy:w.Q.CreateAt,direction:k.KB.PageUp},[],{hasMore:!0,offset:void 0}),this._queryToken}_setListData(e){if(!this._ready&&this.listData.length){var t=this.listData.filter(t=>!e.some(e=>e.historyRecordId===t.historyRecordId)).map(e=>e.historyRecordId);this.deleteAssets(t)}e.filter(e=>{var{task:t}=e;return t.status===k.Pd.FinalSuccess}).forEach(e=>{var t=this.listData.findIndex(t=>t.historyRecordId===e.historyRecordId);-1!==t?this.listData[t]=e:this.listData.push(e),this._registerRecordOrTaskToStore(e)}),this.listData.sort((e,t)=>t.createdTime-e.createdTime)}_addResource(e){e.forEach(e=>{(0,S.U3)(this._resourceService,g._g.VideoDreamina,e.videoDreamina)})}_registerRecordOrTaskToStore(e){try{var t=this._containerService.createInstance(F.U,{logger:this._logger,serviceData:e,option:{mode:L.JU.Workbench}});this._recordStoreService.setVideoTaskById(t.taskData.submitId,t)}catch(t){this._logger.error("generate task instance fail, taskId: ".concat(e.id))}}constructor(e,t,i,a,r,o){this._type=e,this._resourceService=t,this._containerService=i,this._loggerService=a,this._recordStoreService=r,this._historyService=o,this._listData=[],this._ready=!1,this._loading=!1,this._isError=!1,(0,d.rC)(this),this._logger=this._loggerService.createLogger("video-asset-list"),this._queryToken=this._resetQueryToken()}}(0,r.gn)([d.LO,(0,r.w6)("design:type",Array)],O.prototype,"_listData",void 0),(0,r.gn)([d.LO],O.prototype,"_ready",void 0),(0,r.gn)([d.LO],O.prototype,"_loading",void 0),(0,r.gn)([d.LO],O.prototype,"_isError",void 0),(0,r.gn)([d.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[]),(0,r.w6)("design:returntype",Promise)],O.prototype,"loadMore",null),(0,r.gn)([d.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Array,Boolean]),(0,r.w6)("design:returntype",void 0)],O.prototype,"markFavorite",null),(0,r.gn)([d.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String,String]),(0,r.w6)("design:returntype",void 0)],O.prototype,"markPublished",null),(0,r.gn)([d.aD,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Array]),(0,r.w6)("design:returntype",void 0)],O.prototype,"_setListData",null),(0,r.gn)([d.aD.bound,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof IDreaminaGenerateVideoRecord?Object:IDreaminaGenerateVideoRecord]),(0,r.w6)("design:returntype",void 0)],O.prototype,"_registerRecordOrTaskToStore",null),O=(0,r.gn)([(0,r.fM)(1,h.c),(0,r.fM)(2,m.t),(0,r.fM)(3,M.VZ),(0,r.fM)(4,C.u),(0,r.fM)(5,A.P),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===l.F?Object:l.F,void 0===h.c?Object:h.c,void 0===m.t?Object:m.t,void 0===M.VZ?Object:M.VZ,void 0===C.u?Object:C.u,void 0===A.P?Object:A.P])],O);var R=i("561658"),U=i("719494");class E{static markPublished(e,t){if(!!this._instance)this._instance.markPublished(e,t)}preloadWithCheck(e,t){return t.reInit?this.reInit():this._allInstance.ready&&this._favorInstance.ready?Promise.all([Promise.resolve(),Promise.resolve()]):this.init()}init(){return Promise.all([this._allInstance.init(),this._favorInstance.init()])}reInit(){return Promise.all([this._allInstance.reInit(),this._favorInstance.reInit()])}getInstance(e){return({[l.F.ALL]:this._allInstance,[l.F.Favor]:this._favorInstance})[e]}changeActiveInstance(e){this.activeType=e;var t={[l.F.ALL]:this._allInstance,[l.F.Favor]:this._favorInstance};return(0,d.z)(()=>{this.activeInstance=t[e]}),this.activeInstance}markPublished(e,t){this._allInstance.markPublished(e,t),this._favorInstance.markPublished(e,t)}markFavorite(e,t){var i=[this._allInstance.markFavorite(e,t),this._favorInstance.markFavorite(e,t)],{activeInstance:r}=this;return new Promise((o,n)=>{var s,d=this;(0,y.uz)({containerService:this._containerService,service:this._assetService,ids:e.map(e=>({id:e,type:u.Eu.Video})),hasFavorited:t,onSuccess:(s=(0,a._)(function*(e){var a=yield d._lazyContentGenerationService.getInstance();if(t){var n=r.listData.filter(t=>e.includes(t.historyRecordId));d._favorInstance.addAssets(n)}else d._favorInstance.deleteAssets(e);i.forEach(t=>null==t?void 0:t.onSuccess(e)),a.feedManager.markFavorite(e,t,!1),o(e)}),function(e){return s.apply(this,arguments)}),onError:()=>{i.forEach(e=>null==e?void 0:e.onError()),n()}})})}downloadAssets(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dreamina_".concat(s()().format("YYYYMMDDHHmmss")),i=this;return(0,a._)(function*(){var a=yield i._createExportTask(t,e.map(e=>{var t;return{type:v.z.AIGCHistory,packFileName:"".concat((0,U.Lr)(null!==(t=e.task.originalInput.videoGenInputs[0].prompt)&&void 0!==t?t:"",100),"_").concat(e.historyRecordId),aigcHistoryItem:{historyId:e.historyRecordId,itemId:e.videoDreamina.aigcItemId}}}));a&&(yield i._getCreateTaskPolling(a,t))})()}deleteAssets(e){var t=this;return(0,a._)(function*(){return(yield t._videoService.deleteTask({idList:e})).ok?(e.forEach(e=>t._recordStoreService.deleteUnifiedRecordById(e)),yield t._clearAssetsInListManager(e),b.s.success(I.ZP.t("video_deleted_toast",{},"Deleted")),!0):(b.s.error(I.ZP.t("video_no_internet_connection",{},"No Internet Connection")),!1)})()}_clearAssetsInListManager(e){var t=this;return(0,a._)(function*(){var i=yield t._lazyContentGenerationService.getInstance();t._allInstance.deleteAssets(e),t._favorInstance.deleteAssets(e),e.forEach(e=>{i.feedManager.deleteData(e,!1)})})()}getResourceInstance(e){return this._resourceService.get(e,g._g.VideoDreamina)}_createExportTask(e,t){var i=this;return(0,a._)(function*(){var[a,r]=(yield i._dreaminaStoryExportMaterialsDataService.createTask({packFileName:e,materialList:t})).pair();if(a){b.s.warning(I.ZP.t("result_toast_saved_fail_retry",{},"Couldn\u2019t download. Try again."));return}return r.taskId})()}_getCreateTaskPolling(e,t){var i=this;return(0,a._)(function*(){var[a,r]=(yield i._dreaminaStoryExportMaterialsDataService.getTask({taskIdList:[e]})).pair();if(a){b.s.warning(I.ZP.t("result_toast_saved_fail_retry",{},"Couldn\u2019t download. Try again."));return}var{taskMap:o}=r,[{status:n,payload:s}]=Object.values(o);if(n===v.w.FinalSuccess){i._download(s.result.downloadUrl,t),b.s.success(I.ZP.t("video_downloaded_toast",{},"Downloaded"));return}if(n===v.w.Fail){b.s.warning(I.ZP.t("result_toast_saved_fail_retry",{},"Couldn\u2019t download. Try again."));return}yield(0,c._)(1e3),yield i._getCreateTaskPolling(e,t)})()}_download(e,t){var i=document.createElement("a");i.href=(0,o.C)(e,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_dreamina",region:"cn",urlLimit:"-1",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1,escapeRule:"escape-report"}),i.setAttribute("download",t),document.body.appendChild(i),i.click(),document.body.removeChild(i)}constructor(e,t,i,a,r,o,n){this._containerService=e,this._resourceService=t,this._assetService=i,this._videoService=a,this._dreaminaStoryExportMaterialsDataService=r,this._lazyContentGenerationService=o,this._recordStoreService=n,this.activeType=l.F.ALL,this._allInstance=this._containerService.createInstance(O,l.F.ALL),this._favorInstance=this._containerService.createInstance(O,l.F.Favor),this.activeInstance=this._allInstance,(0,d.rC)(this,{activeType:d.LO,activeInstance:d.LO,changeActiveInstance:d.aD}),E._instance=this}}E._instance=void 0,E=(0,r.gn)([(0,r.fM)(0,m.t),(0,r.fM)(1,h.c),(0,r.fM)(2,_.K),(0,r.fM)(3,p.g),(0,r.fM)(4,f._),(0,r.fM)(5,R.r),(0,r.fM)(6,C.u),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===m.t?Object:m.t,void 0===h.c?Object:h.c,void 0===_.K?Object:_.K,void 0===p.g?Object:p.g,void 0===f._?Object:f._,void 0===R.r?Object:R.r,void 0===C.u?Object:C.u])],E)},648326:function(e,t,i){i.d(t,{p:()=>W});var a=i("876826"),r=i("789786"),o=i("241047"),n=i("645968"),s=i("214090"),d=i("417699"),c=i("222721"),l=i("970419"),u=i("19658"),v=i("85728"),m=i("929753"),h=i("260963"),_=i("875488"),p=i("791628"),f=i("836413"),g=i("927457"),y=i("7197"),I=i("757330"),b={params:"__get_explore_params",result:"__get_explore_result"},w={params:"__get_feed_params",result:"__get_feed_result"};function k(){return(k=(0,a._)(function*(e){var t,i,{params:a,result:r}=F.includes(e.categoryId)?b:w,o=window[a];if((null==o?void 0:o.category_id)!==e.categoryId||(null==o?void 0:o.offset)!==e.offset||(null==o?void 0:null===(t=o.image_info)||void 0===t?void 0:t.format)!==(null===(i=e.imageInfo)||void 0===i?void 0:i.format))return Promise.resolve((0,f.wf)(-1,"request params mismatched"));if(window[a]=void 0,!window[r])try{yield window.pExploreFeedList}catch(e){(0,g.P)(e)}var n=window[r];if(window[r]=void 0,!n)return Promise.resolve((0,f.wf)(-1,"failed to retrieve jsonp result"));if("0"!==n.ret)return Promise.resolve((0,f.wf)(Number(n.ret),n.msg));var s=yield(0,y.G)(n.data,n.logid,n.cache_sync_token),d=(0,I.s)(s);return Promise.resolve((0,f.oW)(d))})).apply(this,arguments)}var T=i("5564"),L=i("433965"),D=i("826717"),S=i("76931"),F=[11222,11190];class C{triggerRecommendType(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];F.includes(e)&&!this._envService.isOversea?this._setRecommendType(!0):this._setRecommendType(!1),this._setDisableCache(t)}_setRecommendType(e){this._useRecommendApi=e}_setDisableCache(e){this._disableCache=e}get _fetchFeedList(){var e=!!new URLSearchParams(location.search).get("isDebug");return this._requestCacheService.wrapperFetchFuncWithCache({fetchFunc:this._feedService.feedRepository.getFeedList.bind(this._feedService.feedRepository),calcRequestCacheKey:e=>{var t=(0,T.SZ)(e);return"dreamina_inspairation_getFeedList_".concat(this._envService.region,"_").concat(this._envService.appEnv,"_").concat(t)},shouldDisableCache:()=>!0,onOriginRequestDone:e=>{if(!!e.ok){var t,i,{itemList:a}=e.value,r=new Map;for(var o of a||[])r.set(null!==(i=null===(t=o.commonAttr)||void 0===t?void 0:t.id)&&void 0!==i?i:o.key,o);this.itemList.some(e=>{var t=(0,L.w3)(e)?e.key:e.commonAttr.id,i=r.get(t);return(null==i?!!void 0:!!i.statistic)&&(e.statistic.usageNum!==i.statistic.usageNum||e.statistic.favoriteNum!==i.statistic.favoriteNum||e.statistic.hasFavorited!==i.statistic.hasFavorited)})&&(0,h.z)(()=>{this.itemList=this.itemList.map(e=>{var t,i=(0,L.w3)(e)?e.key:e.commonAttr.id,a=r.get(i);return a?(0,m._)((0,v._)({},e),{statistic:null!==(t=null==a?void 0:a.statistic)&&void 0!==t?t:e.statistic}):(0,v._)({},e)})})}},cacheExpirationDuration:432e5,minUseCacheThresholdTime:0,shouldLogDebugInfo:e})}get _fetchRecommendFeedList(){var e=!!new URLSearchParams(location.search).get("isDebug");return this._requestCacheService.wrapperFetchFuncWithCache({fetchFunc:this._feedService.feedRepository.getFeedListForRecommend.bind(this._feedService.feedRepository),calcRequestCacheKey:e=>{var t=(0,T.SZ)(e);return"dreamina_inspairation_recommennd_feedList_".concat(this._envService.region,"_").concat(this._envService.appEnv,"_").concat(t)},shouldDisableCache:()=>!0,onOriginRequestDone:e=>{if(!!e.ok){var t,i,{itemList:a}=e.value,r=new Map;for(var o of a||[])r.set(null!==(i=null===(t=o.commonAttr)||void 0===t?void 0:t.id)&&void 0!==i?i:o.key,o);this.itemList.some(e=>{var t=(0,L.w3)(e)?e.key:e.commonAttr.id,i=r.get(t);return(null==i?!!void 0:!!i.statistic)&&(e.statistic.usageNum!==i.statistic.usageNum||e.statistic.favoriteNum!==i.statistic.favoriteNum||e.statistic.hasFavorited!==i.statistic.hasFavorited)})&&(0,h.z)(()=>{this.itemList=this.itemList.map(e=>{var t,i=(0,L.w3)(e)?e.key:e.commonAttr.id,a=r.get(i);return a?(0,m._)((0,v._)({},e),{statistic:null!==(t=null==a?void 0:a.statistic)&&void 0!==t?t:e.statistic}):(0,v._)({},e)})})}},cacheExpirationDuration:432e5,minUseCacheThresholdTime:0,shouldLogDebugInfo:e})}getDataList(e){var t=this;return(0,a._)(function*(){t.hasInitialized=!0;var i,a=yield(0,_.FI)(),{count:r,offset:n,imageInfo:s,feedRefer:d}=e,c=0===n?o.Zc.firstTimeFetchCount:o.Zc.count,l={offset:null!=n?n:t.offset,count:null!=r?r:c,imageInfo:null!=s?s:a,categoryId:t.categoryId};if(!((i=yield function(e){return k.apply(this,arguments)}(l)).ok&&i.value)&&(i=t._useRecommendApi?yield t._fetchRecommendFeedList((0,m._)((0,v._)({},l),{feedRefer:null!=d?d:t.feedRefer,filter:{work_type_list:[D.X.Video,D.X.Image,D.X.Canvas]}})):yield t._fetchFeedList(l)),(0,h.z)(()=>{t.hadFetch=!0}),i.ok){var u=i.value,{itemList:f}=u,g=f.map(e=>{var t=(0,v._)({},e);if((0,L.DF)(e)||(0,L.jD)(e)){var i,a,{width:r,height:o}=null!==(a=null===(i=e.image.largeImages)||void 0===i?void 0:i[0])&&void 0!==a?a:{};t.width=r,t.height=o}return(0,L.w3)(e)&&(t.width=e.video.originVideo.width,t.height=e.video.originVideo.height),t});g.forEach(e=>{var t,i,a,r;(0,L.DF)(e)||(0,L.jD)(e)?(0,S.WK)(null===(t=e.commonAttr)||void 0===t?void 0:t.publishedItemId,e.impressionId):(0,L.w3)(e)?(0,S.WK)(e.publishedItemId,e.impressionId):(0,L.Rb)(e)&&((0,S.WK)(null===(i=e.commonAttr)||void 0===i?void 0:i.publishedItemId,e.impressionId),null===(r=e.collection)||void 0===r||null===(a=r.itemList)||void 0===a||a.forEach(t=>{var i;(0,S.WK)(null===(i=t.commonAttr)||void 0===i?void 0:i.publishedItemId,e.impressionId)}))}),0!==n&&t._feedPrefetchService.dispatchEvent({name:"get-data-list-done",data:g}),(0,h.z)(()=>{0===n?t.itemList=g:t.itemList=(0,p.Ck)(t.itemList,g),t.hasMore=u.hasMore,(t._useRecommendApi||0===u.nextOffset&&g.length)&&(t.feedRefer=D.p.FeedLoadmore),t.offset=u.nextOffset})}return i})()}constructor(e,t,i,a,r){this._feedService=t,this._requestCacheService=i,this._envService=a,this._feedPrefetchService=r,this.categoryId=0,this.hadFetch=!1,this.hasMore=!0,this.itemList=[],this.offset=0,this.hasInitialized=!1,this.feedRefer=D.p.FeedEnterauto,this._useRecommendApi=!1,this._disableCache=!1,this.categoryId=e,(0,h.rC)(this)}}(0,r.gn)([h.LO],C.prototype,"hadFetch",void 0),(0,r.gn)([h.LO],C.prototype,"hasMore",void 0),(0,r.gn)([h.LO,(0,r.w6)("design:type",Array)],C.prototype,"itemList",void 0),(0,r.gn)([h.LO],C.prototype,"offset",void 0),(0,r.gn)([h.LO],C.prototype,"hasInitialized",void 0),(0,r.gn)([h.LO],C.prototype,"feedRefer",void 0),C=(0,r.gn)([(0,r.fM)(1,n.d),(0,r.fM)(2,s.p),(0,r.fM)(3,d.e),(0,r.fM)(4,c.e),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Number,void 0===n.d?Object:n.d,void 0===s.p?Object:s.p,void 0===d.e?Object:d.e,void 0===c.e?Object:c.e])],C);var A=i("422600"),P=i("867713"),M=i("460029"),O=i("519927"),R=i("252805"),U=i("503006"),E=i("917730"),x=i("980598"),N={result:"__get_weekly_challenge_list_result"};function j(){return(j=(0,a._)(function*(){var e,{result:t}=N;if(!(null===(e=window)||void 0===e?void 0:e[t]))try{yield window.pWeeklyList}catch(e){(0,g.P)(e)}var i=window[t];return i?"0"!==i.ret?Promise.resolve((0,f.wf)(Number(i.ret),i.msg)):Promise.resolve((0,f.oW)((yield(0,y.G)(i.data)))):Promise.resolve((0,f.wf)(-1,"failed to retrieve jsonp result"))})).apply(this,arguments)}class V{getActList(){var e=this;return(0,a._)(function*(){if(e.hadFetchAct)return;var t=yield function(){return j.apply(this,arguments)}();if(!(t.ok&&t.value)&&(t=yield e._mwebActivityService.getWeeklyChallengeList()),(0,h.z)(()=>{e.hadFetchAct=!0}),!!t.ok){var i=t.value.actInfoList.filter(e=>e.actStatus===E.Dh.InProgress);(0,h.z)(()=>{e.carouselActList=i})}})()}constructor(e){this._mwebActivityService=e,this.hadFetchAct=!1,this.carouselActList=[],(0,h.rC)(this)}}(0,r.gn)([h.LO],V.prototype,"hadFetchAct",void 0),(0,r.gn)([h.LO,(0,r.w6)("design:type",Array)],V.prototype,"carouselActList",void 0),V=(0,r.gn)([(0,r.fM)(0,x.u),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===x.u?Object:x.u])],V);var q=i("409625"),H=i("720979"),G=i("150615"),z="DREAMINA_DEFAULT_COMMUNITY_CATEGORY_ID";class W{static getCommunityStoreInstance(e){return!this._instance&&(this._instance=null==e?void 0:e.createInstance(W,e)),this._instance}static makeItemFavoriteByInstance(e,t,i){if(!!i){var a=i.itemList.findIndex(t=>((0,L.w3)(t)?t.key:t.commonAttr.id)===e);if(a>-1){var r=i.itemList[a];(0,h.z)(()=>{r.statistic&&(r.statistic.favoriteNum+=t?1:-1,r.statistic.hasFavorited=t)})}}}static makeItemFavorite(e,t){var i,a;if(!!(null===(i=this._instance)||void 0===i?void 0:i._instanceMap))for(var r of null===(a=this._instance)||void 0===a?void 0:a._instanceMap.values())W.makeItemFavoriteByInstance(e,t,r)}get _fetchPanel(){var e=!!new URLSearchParams(location.search).get("isDebug");return this._requestCacheService.wrapperFetchFuncWithCache({fetchFunc:this._feedService.feedRepository.getFeedPanel.bind(this._feedService.feedRepository),calcRequestCacheKey:e=>{var t="".concat(this._envService.region,"_").concat(this._envService.appEnv,"_").concat(e.panel,"_").concat(G.ZP.language);return"dreamina_inspairation_fetch_panel_".concat(t)},minUseCacheThresholdTime:0,shouldLogDebugInfo:e})}_getOrCreateCategoryInstance(e,t){var i=this._instanceMap.get(t);return i?i:null==e?void 0:e.createInstance(C,t)}_preloadDefaultInstance(e,t){(0,M.Ie)(q.iE);try{if(!e)return"";var i,a=t.keyValue.query(z);if(!a.ok||!a.value)return"";var r=Number.parseInt(a.value,10);if(r){var o=null==e?void 0:e.createInstance(C,r);null==o||o.triggerRecommendType(r,this._isAbTestForRecommend),this._instanceMap.set(r,o),null==o||o.getDataList({offset:0}).then(e=>{e.ok&&(this._feedPrefetchService.dispatchEvent({name:"get-data-list-done",data:e.value.itemList}),this._feedPrefetchService.dispatchEvent({name:"fetch-recommends",data:{offset:0}}))})}return!this._envService.isOversea&&(null===(i=this.activityInstance)||void 0===i||i.getActList()),r}finally{(0,M.oe)(q.iE),(0,M.XH)(q.iE)}}getCategories(){var e=this;return(0,a._)(function*(){try{(0,M.Ie)(q.i_);var t=(0,A.b)({panel:o.Zc.panel},e._serverInjectedDataService);if(t)return(0,h.z)(()=>e.categories=t.categoryList),t.categoryList;var i=!!new URLSearchParams(location.search).get("use_test_pannel"),{panel:a}=o.Zc;e._envService.isOversea&&i&&(a=o.JI.panel);var r=yield e._fetchPanel({panel:a});if(!r.ok)return[];var n=r.value.categoryList;return(0,h.z)(()=>e.categories=n),n}catch(e){return[]}finally{(0,M.oe)(q.i_),(0,M.XH)(q.i_)}})()}changeActiveInstance(e){var t=this.categories[e].id,i=this._instanceMap.get(t);!(null==i?void 0:i.hadFetch)&&(null==i||i.getDataList({offset:0})),(0,h.z)(()=>{this.activeInstance=i,this.activeCategoryIndex=e})}getStoreInstanceByCategoryId(e){return this._instanceMap.get(e)}_start(){var e=this;return(0,a._)(function*(){e._isAbTestForRecommend=yield e.configurationService.abTestManager.getBooleanRecommendTestValue(),e._preloadDefaultInstance(e.containerService,e._storageService),e.getCategories().then(()=>{var t=function(e){var t=new URLSearchParams(globalThis.location.search).get(H.i.category);if(t){var i=e.findIndex(e=>e.id===Number(t));return -1!==i?i:0}return 0}(e.categories);e.categories.forEach((i,a)=>{var r=e._getOrCreateCategoryInstance(e.containerService,i.id);if(null==r||r.triggerRecommendType(i.id,e._isAbTestForRecommend),a===t){if((0,M.Ie)(q.U7),null==r?void 0:r.hasInitialized)(0,h.gx)(()=>null==r?void 0:r.hadFetch,()=>{(0,M.oe)(q.U7),(0,M.XH)(q.U7)});else{var o,n=null==r?void 0:r.getDataList({offset:0});Promise.all([e._envService.isOversea?Promise.resolve():null===(o=e.activityInstance)||void 0===o?void 0:o.getActList(),n]).finally(()=>{(0,M.oe)(q.U7),(0,M.XH)(q.U7)}),null==n||n.then(t=>{t.ok&&(e._feedPrefetchService.dispatchEvent({name:"get-data-list-done",data:t.value.itemList}),e._feedPrefetchService.dispatchEvent({name:"fetch-recommends",data:{offset:0}}))})}e._storageService.keyValue.set(z,"".concat(i.id)),(0,h.z)(()=>{e.activeInstance=r,e.activeCategoryIndex=t})}else e._preloadService.addPreloadTask({signal:O.l.PAGE_IDLE,runTask:()=>null==r?void 0:r.getDataList({offset:0}),priorityLevel:P.q.LowPriority});e._instanceMap.set(i.id,r)})})})()}constructor(e,t,i,a,r,o,n,s,d){this.containerService=e,this._feedService=t,this._requestCacheService=i,this._envService=a,this._preloadService=r,this._feedPrefetchService=o,this._storageService=n,this._serverInjectedDataService=s,this.configurationService=d,this._instanceMap=new Map,this.categories=[],this.activeInstance=void 0,this.activeCategoryIndex=0,this._isAbTestForRecommend=!1,this.activityInstance=null==e?void 0:e.createInstance(V),(0,h.rC)(this),this._start()}}(0,r.gn)([h.LO,(0,r.w6)("design:type",Array)],W.prototype,"categories",void 0),(0,r.gn)([h.LO,(0,r.w6)("design:type",Object)],W.prototype,"activeInstance",void 0),(0,r.gn)([h.LO,(0,r.w6)("design:type",Number)],W.prototype,"activeCategoryIndex",void 0),W=(0,r.gn)([(0,r.fM)(1,n.d),(0,r.fM)(2,s.p),(0,r.fM)(3,d.e),(0,r.fM)(4,R.f),(0,r.fM)(5,c.e),(0,r.fM)(6,U.U),(0,r.fM)(7,l.G),(0,r.fM)(8,u.S),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Object,void 0===n.d?Object:n.d,void 0===s.p?Object:s.p,void 0===d.e?Object:d.e,void 0===R.f?Object:R.f,void 0===c.e?Object:c.e,void 0===U.U?Object:U.U,void 0===l.G?Object:l.G,void 0===u.S?Object:u.S])],W)},498973:function(e,t,i){i.d(t,{e:()=>L});var a=i("85728"),r=i("929753"),o=i("789786"),n=i("433965"),s=i("260963"),d=i("902519"),c=i("200294"),l=i("876826"),u=i("241047"),v=i("875488"),m=i("936690");function h(e,t){var i,a=new Map;for(var r of[...t,...e])a.set((0,n.w3)(r)||(0,n.sQ)(r)?r.key:null===(i=r.commonAttr)||void 0===i?void 0:i.id,r);return Array.from(a.values()).sort((e,t)=>((0,n.w3)(t)||(0,n.sQ)(t)?t.createTime:t.commonAttr.createTime)-((0,n.w3)(e)||(0,n.sQ)(e)?e.createTime:e.commonAttr.createTime))}function _(e,t){var i,a,r=new Map,o=[];for(var s of[...e,...t]){if(!r.has((0,n.w3)(s)||(0,n.sQ)(s)?s.key:null===(i=s.commonAttr)||void 0===i?void 0:i.id))r.set((0,n.w3)(s)||(0,n.sQ)(s)?s.key:null===(a=s.commonAttr)||void 0===a?void 0:a.id,s),o.push(s)}return o}var p=i("836413"),f=i("927457"),g=i("7197");function y(){return(y=(0,l._)(function*(e){var t,i,a,r,o,n,{secUid:s,imageTypeList:d}=e;if(!(null===(t=window)||void 0===t?void 0:t._personalFeedSecUid)||(null===(i=window)||void 0===i?void 0:i._personalFeedSecUid)!==s)return Promise.resolve((0,p.wf)(-1,"secUid mismatch"));if(!(null===(a=window)||void 0===a?void 0:a._personalFeedImageTypeList)||Array.isArray(null===(r=window)||void 0===r?void 0:r._personalFeedImageTypeList)){var c=new Set(d),l=new Set(window._personalFeedImageTypeList);if(0!==c.difference(l).size||0!==l.difference(c).size)return Promise.resolve((0,p.wf)(-1,"subTab mismatch"))}if(!(null===(o=window)||void 0===o?void 0:o.__get_homepage_info_result))try{yield window.pPersonalFeedList}catch(e){(0,f.P)(e)}var u=null===(n=window)||void 0===n?void 0:n.__get_homepage_info_result;return u?"0"!==u.ret?Promise.resolve((0,p.wf)(Number(u.ret),u.errmsg)):(window.__get_homepage_info_result=void 0,window._personalFeedSecUid=void 0,window._personalFeedImageTypeList=void 0,Promise.resolve((0,p.oW)((yield(0,g.G)(u.data,u.logid,u.cache_sync_token))))):Promise.resolve((0,p.ly)())})).apply(this,arguments)}var I=i("884569"),b=i("993308");class w{get author(){var e;return null===(e=this.itemList[0])||void 0===e?void 0:e.author}reset(){this.hasMore=!0,this.itemList=[],this.offset=0,this.hadFetch=!1}getDataList(e){var t=this;return(0,l._)(function*(){var i,r=yield(0,v.FI)(),{count:o,secUid:c,offset:l,imageInfo:p}=e,f={offset:null!=l?l:t.offset,count:null!=o?o:u.iV.count,imageTypeList:t.imageTypeList,secUid:null!=c?c:"",imageInfo:null!=p?p:r};if(t.tabType===d.lX.Post){if(!(i=yield function(e){return y.apply(this,arguments)}({secUid:f.secUid,imageTypeList:t.imageTypeList}))||!(i.ok&&i.value)){var g=t._prefetchRequestService.findReusableConnectByRequestParams({displayName:b.s,requestParams:{secUid:f.secUid,offset:0,count:u.iV.count,imageTypeList:t.imageTypeList}});g?(t._prefetchRequestService.burnLater(g),i=yield g.pRequest):i=yield t._homePageService.homePageRepository.getDataList(f)}}else i=yield t._homePageService.homePageRepository.getLikeDataList(f);if((0,s.z)(()=>{t.hadFetch=!0}),i.ok){var I=i.value,w=I.itemList.filter(e=>{var t;return!((0,n.Rb)(e)&&!(null===(t=e.collection)||void 0===t?void 0:t.itemList))&&!((0,n.w3)(e)&&!e.video)}).map(e=>{var t,i,r=(0,a._)({},e);if((0,n.DF)(r)){var o,s,{width:d,height:c}=null!==(s=null===(o=r.image.largeImages)||void 0===o?void 0:o[0])&&void 0!==s?s:{};r.width=d,r.height=c,r.blendParams=(0,m.tA)(r)}else if((0,n.jD)(r)){var l,u,{width:v,height:h}=null!==(u=null===(l=r.image.largeImages)||void 0===l?void 0:l[0])&&void 0!==u?u:{};r.width=v,r.height=h}else(0,n.Rb)(r)&&(null===(i=r.collection)||void 0===i||null===(t=i.itemList)||void 0===t||t.forEach(e=>{e.author=r.author,e.blendParams=(0,m.tA)(e)}));return r});(0,s.z)(()=>{if(0===l)t.itemList=w;else{var e=t.tabType===d.lX.Post?h:_;t.itemList=e(t.itemList,w)}t.hasMore=I.hasMore,t.totalCount=I.totalCount,t.offset=I.nextOffset})}return i})()}constructor(e,t,i,a){this._homePageService=i,this._prefetchRequestService=a,this.tabType=d.lX.Post,this.imageTypeList=[d.PK.SINGLE_AND_COLLECTION],this.hadFetch=!1,this.totalCount=0,this.hasMore=!0,this.itemList=[],this.offset=0,this.tabType=e,this.imageTypeList=t,(0,s.rC)(this)}}(0,o.gn)([s.LO],w.prototype,"hadFetch",void 0),(0,o.gn)([s.LO],w.prototype,"totalCount",void 0),(0,o.gn)([s.LO],w.prototype,"hasMore",void 0),(0,o.gn)([s.LO,(0,o.w6)("design:type",Array)],w.prototype,"itemList",void 0),(0,o.gn)([s.LO],w.prototype,"offset",void 0),(0,o.gn)([s.Fl,(0,o.w6)("design:type",Object),(0,o.w6)("design:paramtypes",[])],w.prototype,"author",null),w=(0,o.gn)([(0,o.fM)(2,I.o),(0,o.fM)(3,c.d),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[void 0===d.lX?Object:d.lX,Array,void 0===I.o?Object:I.o,void 0===c.d?Object:c.d])],w);var k=i("56935");class T{resetFeedListIfNeed(){if(this.hasLikeStateChanged){var e;this.hasLikeStateChanged=!1,null===(e=this._instanceAll)||void 0===e||e.reset()}}refetchData(e){var t,i,a;null===(t=this._instanceAllAndVideo)||void 0===t||t.getDataList({secUid:e,offset:0}),null===(i=this._instanceMasterpiece)||void 0===i||i.getDataList({secUid:e,offset:0}),null===(a=this._instanceAll)||void 0===a||a.getDataList({secUid:e,offset:0})}removeTargetItem(e){this.removeTargetItemByInstance(e,this._instanceAllAndVideo),this.removeTargetItemByInstance(e,this._instanceMasterpiece),this.removeTargetItemByInstance(e,this.instanceAll)}makeItemFavorite(e,t){this.makeItemFavoriteByInstance(e,t,this._instanceAllAndVideo),this.makeItemFavoriteByInstance(e,t,this._instanceMasterpiece),this.makeItemFavoriteByInstance(e,t,this._instanceAll),this.hasLikeStateChanged=!0}removeTargetItemByInstance(e,t){if(!!t){var i=t.itemList.findIndex(t=>((0,n.w3)(t)||(0,n.sQ)(t)?t.publishedItemId:t.commonAttr.id)===e);i>-1&&(0,s.z)(()=>{t.itemList=t.itemList.filter((e,t)=>t!==i),t.totalCount&&(t.totalCount-=1)})}}updateHasLikeReady(e){this.hasLikeReady=e}makeItemFavoriteByInstance(e,t,i){if(!!i){var a=i.itemList.findIndex(t=>((0,n.w3)(t)||(0,n.sQ)(t)?t.key:t.commonAttr.id)===e);if(a>-1){var r=i.itemList[a];(0,s.z)(()=>{r.statistic&&(r.statistic.favoriteNum+=t?1:-1,r.statistic.hasFavorited=t)})}(0,s.z)(()=>{i.tabType===d.lX.Like&&(i.totalCount+=t?1:-1)})}}get instanceAll(){return this._instanceAll}get activeImageType(){var e,t,i;return(null===(e=this.activeInstance)||void 0===e?void 0:e.imageTypeList.length)===1&&null!==(i=null===(t=this.activeInstance)||void 0===t?void 0:t.imageTypeList[0])&&void 0!==i?i:d.PK.SINGLE_AND_COLLECTION}get isActiveInstanceHadFetch(){var e,t;return null!==(t=null===(e=this.activeInstance)||void 0===e?void 0:e.hadFetch)&&void 0!==t&&t}get isActiveImageTypeEmpty(){var e;return(null===(e=this.activeInstance)||void 0===e?void 0:e.itemList.length)===0}get allWorkCardCount(){var e,t;return null!==(t=null===(e=this._instanceAll)||void 0===e?void 0:e.totalCount)&&void 0!==t?t:0}get workCardList(){var e,t;return null!==(t=null===(e=this.activeInstance)||void 0===e?void 0:e.itemList)&&void 0!==t?t:[]}setActiveInstance(e){this.activeInstance=e}setActiveSubTabType(e){this.activeSubTabType=e}changeCurrentSubTabType(e){switch(e){case d.Ym.Story:this.setActiveSubTabType(d.Ym.Story),this.setActiveInstance(this._instanceMasterpiece);break;case d.Ym.Template:this.setActiveSubTabType(d.Ym.Template),this.setActiveInstance(this._instanceAllAndVideo);break;default:(0,k.bP)(e,"unknown sub tab type")}}changeCurrentImageType(e){switch(e){case d.PK.IMAGE_SINGLE:(0,k.ss)("currently no implementation for MWebImageType.IMAGE_SINGLE");case d.PK.IMAGE_COLLECTION:(0,k.ss)("currently no implementation for MWebImageType.IMAGE_COLLECTION");case d.PK.SINGLE_AND_COLLECTION:this.setActiveInstance(this._instanceAll);break;case d.PK.MASTERPIECE:this.setActiveSubTabType(d.Ym.Story),this.setActiveInstance(this._instanceMasterpiece);break;default:this.setActiveSubTabType(d.Ym.Template),this.setActiveInstance(this._instanceAllAndVideo)}}constructor(e,t){this.hasLikeStateChanged=!1,this.hasLikeReady=!0,this._instanceAllAndVideo=void 0,this._instanceMasterpiece=void 0,this._instanceAll=void 0,this.activeInstance=void 0,this.activeSubTabType=d.Ym.Template,this.listDataType=t,this._instanceAllAndVideo=e.createInstance(w,t,[...u.fk[d.Ym.Template]]),this._instanceMasterpiece=e.createInstance(w,t,[...u.fk[d.Ym.Story]]),this._instanceAll=e.createInstance(w,t,[d.PK.SINGLE_AND_COLLECTION]),this.activeInstance=this._instanceAllAndVideo,(0,s.rC)(this)}}(0,o.gn)([s.LO,(0,o.w6)("design:type",Object)],T.prototype,"activeInstance",void 0),(0,o.gn)([s.LO,(0,o.w6)("design:type",void 0===d.Ym?Object:d.Ym)],T.prototype,"activeSubTabType",void 0),(0,o.gn)([s.Fl,(0,o.w6)("design:type",void 0===d.PK?Object:d.PK),(0,o.w6)("design:paramtypes",[])],T.prototype,"activeImageType",null),(0,o.gn)([s.Fl,(0,o.w6)("design:type",Boolean),(0,o.w6)("design:paramtypes",[])],T.prototype,"isActiveInstanceHadFetch",null),(0,o.gn)([s.Fl,(0,o.w6)("design:type",Boolean),(0,o.w6)("design:paramtypes",[])],T.prototype,"isActiveImageTypeEmpty",null),(0,o.gn)([s.Fl,(0,o.w6)("design:type",Number),(0,o.w6)("design:paramtypes",[])],T.prototype,"allWorkCardCount",null),(0,o.gn)([s.Fl,(0,o.w6)("design:type",void 0),(0,o.w6)("design:paramtypes",[])],T.prototype,"workCardList",null),(0,o.gn)([s.aD.bound,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[Object]),(0,o.w6)("design:returntype",void 0)],T.prototype,"setActiveInstance",null),(0,o.gn)([s.aD.bound,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[void 0===d.Ym?Object:d.Ym]),(0,o.w6)("design:returntype",void 0)],T.prototype,"setActiveSubTabType",null);class L{static getHomePageStoreInstance(e,t){return(!this._instance||t.needCreateNewInstance)&&(this._instance=null==e?void 0:e.createInstance(L,e,t)),this._instance}static removeTargetItem(e){var t,i,a,r;null===(i=this._instance)||void 0===i||null===(t=i._postTabInstanceMap)||void 0===t||t.removeTargetItem(e),null===(r=this._instance)||void 0===r||null===(a=r._likeTabInstanceMap)||void 0===a||a.removeTargetItem(e)}static makeItemFavorite(e,t){var i,o,s,d;if(null===(o=this._instance)||void 0===o||null===(i=o._postTabInstanceMap)||void 0===i||i.makeItemFavorite(e,t),null===(d=this._instance)||void 0===d||null===(s=d._likeTabInstanceMap)||void 0===s||s.makeItemFavorite(e,t),t){var c,l,u,v,m,h=null===(u=this._instance)||void 0===u?void 0:null===(l=u._postTabInstanceMap)||void 0===l?void 0:null===(c=l.activeInstance)||void 0===c?void 0:c.itemList.find(t=>((0,n.w3)(t)||(0,n.sQ)(t)?t.key:t.commonAttr.id)===e);h&&(null===(m=this._instance)||void 0===m?void 0:null===(v=m._likeTabInstanceMap)||void 0===v?void 0:v.activeInstance)&&(this._instance._likeTabInstanceMap.activeInstance.itemList=[(0,r._)((0,a._)({},h),{statistic:(0,a._)({},h.statistic)}),...this._instance._likeTabInstanceMap.activeInstance.itemList])}else{var _,p,f,g,y,I=null===(f=this._instance)||void 0===f?void 0:null===(p=f._likeTabInstanceMap)||void 0===p?void 0:null===(_=p.activeInstance)||void 0===_?void 0:_.itemList.find(t=>((0,n.w3)(t)||(0,n.sQ)(t)?t.key:t.commonAttr.id)===e);I&&(null===(y=this._instance)||void 0===y?void 0:null===(g=y._likeTabInstanceMap)||void 0===g?void 0:g.activeInstance)&&(this._instance._likeTabInstanceMap.activeInstance.itemList=this._instance._likeTabInstanceMap.activeInstance.itemList.filter(e=>e!==I))}}static refetchPostDataList(e){var t,i;null===(i=this._instance)||void 0===i||null===(t=i._postTabInstanceMap)||void 0===t||t.refetchData(e)}static deletePrefetchCache(e){var t,i;null===(i=this._instance)||void 0===i||null===(t=i.deletePrefetchCache)||void 0===t||t.call(i,e)}setActiveListTabInstance(e){this.activeTabInstance=e}get postTabInstance(){return this._postTabInstanceMap}get likeTabInstance(){return this._likeTabInstanceMap}changeTabImageType(e){var t,i;null===(t=this.postTabInstance)||void 0===t||t.changeCurrentImageType(e),null===(i=this.likeTabInstance)||void 0===i||i.changeCurrentImageType(e)}changeCurrentListDataType(e){switch(e){case d.lX.Post:this.setActiveListTabInstance(this._postTabInstanceMap);break;case d.lX.Like:this.setActiveListTabInstance(this._likeTabInstanceMap);break;default:this.setActiveListTabInstance(this._postTabInstanceMap)}}deletePrefetchCache(e){if(!!this._containerService){var t=this._containerService.invokeFunction(e=>e.get(c.d));t.deleteCache({displayName:"homepage",params:{secUid:e}}),t.deleteCache({displayName:"user-info",params:{secUid:e}})}}constructor(e,t){if(this._postTabInstanceMap=void 0,this._likeTabInstanceMap=void 0,this._containerService=void 0,this.activeTabInstance=void 0,!e)return;this._containerService=e;var{hasPublishAuthority:i}=t;this._postTabInstanceMap=e.createInstance(T,e,d.lX.Post),this._likeTabInstanceMap=e.createInstance(T,e,d.lX.Like),this.activeTabInstance=i?this._postTabInstanceMap:this._likeTabInstanceMap,(0,s.rC)(this)}}L._instance=void 0,(0,o.gn)([s.LO,(0,o.w6)("design:type",Object)],L.prototype,"activeTabInstance",void 0),(0,o.gn)([s.aD.bound,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[T]),(0,o.w6)("design:returntype",void 0)],L.prototype,"setActiveListTabInstance",null)},661551:function(e,t,i){i.d(t,{j:()=>w});var a=i("876826"),r=i("366103"),o=i("789786"),n=i("758261"),s=i("280166"),d=i("260963"),c=i("836413"),l=i("927457"),u=i("7197");function v(){return(v=(0,a._)(function*(e){if(!(null===(t=window)||void 0===t?void 0:t._secUid)||(null===(i=window)||void 0===i?void 0:i._secUid)!==e)return Promise.resolve((0,c.wf)(-1,"secUid mismatch"));if(!(null===(a=window)||void 0===a?void 0:a.__get_user_info_result))try{yield window.pSecUserInfo}catch(e){(0,l.P)(e)}var t,i,a,r,o=null===(r=window)||void 0===r?void 0:r.__get_user_info_result;return o?"0"!==o.ret?Promise.resolve((0,c.wf)(Number(o.ret),o.errmsg)):(window.__get_user_info_result=void 0,window._secUid=void 0,Promise.resolve((0,c.oW)((yield(0,u.G)(o.data,o.logid,o.cache_sync_token))))):Promise.resolve((0,c.ly)())})).apply(this,arguments)}var m=i("745017"),h=i("819340"),_=i("200294"),p=i("161041");class f{refreshUserInfo(e){var t=this;return(0,a._)(function*(){if(!(!e&&t.isValid())&&!t.loading){(0,d.z)(()=>{t.loading=!0});var i=null;if(null===t.userInfo&&(i=yield function(e){return v.apply(this,arguments)}(t.secUid)),!i||!(i.ok&&i.value)){var a=t._prefetchRequestService.findReusableConnect({displayName:p.s,params:{secUid:t.secUid}});a?(t._prefetchRequestService.burnLater(a),i=yield a.pRequest):i=yield t._userService.repository.getUserInfo({secUid:t.secUid})}return(0,d.z)(()=>{t.loading=!1}),i.ok&&(0,d.z)(()=>{t.userInfo=i.value,t.updateTime=Date.now()}),i}})()}isValid(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.maxAge;return!!(this.userInfo&&Date.now()-this.updateTime<=e)||!1}updateUserInfo(e){var t=this;return(0,a._)(function*(){return yield t._userService.repository.updateUserInfo(e)})()}follow(e,t){(0,d.z)(()=>{if(!!this.userInfo)t?this.userInfo.follow+=1:this.userInfo.fans+=1,e===this.userInfo.secUid&&(this.userInfo.hasFollowed=!0)})}cancelFollow(e,t){(0,d.z)(()=>{if(!!this.userInfo)t&&this.userInfo.follow>0?this.userInfo.follow-=1:!t&&this.userInfo.fans>0&&(this.userInfo.fans-=1),e===this.userInfo.secUid&&(this.userInfo.hasFollowed=!1)})}increaseLikeCount(){(0,d.z)(()=>{if(!!this.userInfo)this.userInfo.totalMaterialsFavorite+=1})}decreaseLikeCount(){(0,d.z)(()=>{if(!!this.userInfo)this.userInfo.totalMaterialsFavorite>0&&(this.userInfo.totalMaterialsFavorite-=1)})}increaseUsageCount(){(0,d.z)(()=>{if(!!this.userInfo)this.userInfo.totalMaterialsUsage+=1})}updateAvatarImage(e){var t=this;return(0,a._)(function*(){var i=t._uploadService.getImageXUploader(t._environmentService.appId,m.I),a=yield i.uploadImage({file:e});if(a.ok)return a.value.uri})()}clear(){(0,d.z)(()=>{this.userInfo=null})}constructor(e,t,i,a,r){this._userService=t,this._environmentService=i,this._uploadService=a,this._prefetchRequestService=r,this.userInfo=null,this.secUid="",this.loading=!1,this.updateTime=0,this.maxAge=36e4,(0,d.rC)(this),this.secUid=e}}(0,o.gn)([d.LO,(0,o.w6)("design:type",Object)],f.prototype,"userInfo",void 0),(0,o.gn)([d.LO],f.prototype,"secUid",void 0),(0,o.gn)([d.LO],f.prototype,"loading",void 0),(0,o.gn)([d.LO],f.prototype,"updateTime",void 0),f=(0,o.gn)([(0,o.fM)(1,n.h),(0,o.fM)(2,s.Y),(0,o.fM)(3,h.Z),(0,o.fM)(4,_.d),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[String,void 0===n.h?Object:n.h,void 0===s.Y?Object:s.Y,void 0===h.Z?Object:h.Z,void 0===_.d?Object:_.d])],f);var g=i("902519"),y=i("884569");class I{addFollowUser(e){return this._webHomePageService.homePageRepository.doFollowUser({secUid:e,op:g.im.Follow})}cancelFollowUser(e){return this._webHomePageService.homePageRepository.doFollowUser({secUid:e,op:g.im.CancelFollow})}constructor(e){this._webHomePageService=e}}I=(0,o.gn)([(0,o.fM)(0,y.o),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[void 0===y.o?Object:y.o])],I);class b{loadData(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;return(0,a._)(function*(){if(e&&(t.offset=0,t.hasMore=!0,t.userList=[]),!!t.hasMore){(0,d.z)(()=>{t.loading=!0});var i=yield t.getFollowingUserList();return(0,d.z)(()=>{t.loading=!1}),i.ok&&(0,d.z)(()=>{t.userList=[...e?[]:t.userList,...i.value.userList],t.offset=i.value.nextOffset,t.hasMore=i.value.hasMore,t.totalCount=i.value.totalCount}),i}})()}getFollowingUserList(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return this._userService.repository.getFollowList({listType:this.followListType,count:e,offset:this.offset})}follow(e){var t=this.userList.find(t=>t.secUid===e);t&&(0,d.z)(()=>{t.hasFollowed=!0,t.fans+=1})}cancelFollow(e){var t=this.userList.find(t=>t.secUid===e);t&&(0,d.z)(()=>{t.hasFollowed=!1,t.fans>0&&(t.fans-=1)})}constructor(e,t){this._userService=t,this.followListType=r.bK.Fans,this.offset=0,this.totalCount=0,this.hasMore=!0,this.userList=[],this.loading=!1,this.followListType=e,(0,d.rC)(this)}}(0,o.gn)([d.LO],b.prototype,"offset",void 0),(0,o.gn)([d.LO],b.prototype,"totalCount",void 0),(0,o.gn)([d.LO],b.prototype,"hasMore",void 0),(0,o.gn)([d.LO,(0,o.w6)("design:type",Array)],b.prototype,"userList",void 0),(0,o.gn)([d.LO],b.prototype,"loading",void 0),b=(0,o.gn)([(0,o.fM)(1,n.h),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[void 0===r.bK?Object:r.bK,void 0===n.h?Object:n.h])],b);class w{static get selfSecUid(){return w._selfSecUid}static initUserInfoInstance(e,t,i){return this.updateSelfSecUid(t),this.getUserInfoInstance(e,i)}static updateSelfSecUid(e){this._selfSecUid=e}static getUserInfoInstance(e,t){var i=this._userInfoInstanceCacheMap.get(t);return i?(i.refreshUserInfo(),i):this.createUserInfoInstance(e,t)}static getFollowInstance(e){return!this._followStoreInstance&&(this._followStoreInstance=e.createInstance(I)),this._followStoreInstance}static getMyFollowingListInstance(e){return!this._myFollowingListInstance&&(this._myFollowingListInstance=e.createInstance(b,r.bK.Follow)),this._myFollowingListInstance}static getMyFansListInstance(e){return!this._myFansListInstance&&(this._myFansListInstance=e.createInstance(b,r.bK.Fans)),this._myFansListInstance}static createUserInfoInstance(e,t){var i=e.createInstance(f,t);return i.refreshUserInfo(),this._userInfoInstanceCacheMap.set(t,i),i}static handlerFollowUser(e){var t,i,a=this._userInfoInstanceCacheMap.get(e),r=this._userInfoInstanceCacheMap.get(this._selfSecUid);a&&a.follow(e,!1),r&&r.follow(e,!0),null===(t=this._myFansListInstance)||void 0===t||t.follow(e),null===(i=this._myFollowingListInstance)||void 0===i||i.follow(e)}static handlerCancelFollowUser(e){var t,i,a=this._userInfoInstanceCacheMap.get(e),r=this._userInfoInstanceCacheMap.get(this._selfSecUid);a&&a.cancelFollow(e,!1),r&&r.cancelFollow(e,!0),null===(t=this._myFansListInstance)||void 0===t||t.cancelFollow(e),null===(i=this._myFollowingListInstance)||void 0===i||i.cancelFollow(e)}static handlerLikeProduction(e){var t=this._userInfoInstanceCacheMap.get(e);t&&t.increaseLikeCount()}static handlerUnlikeProduction(e){var t=this._userInfoInstanceCacheMap.get(e);t&&t.decreaseLikeCount()}static handlerUsePromote(e){var t=this._userInfoInstanceCacheMap.get(e);t&&t.increaseUsageCount()}static updateSelfUserInfo(e,t){var i=this;return(0,a._)(function*(){var a=i.getUserInfoInstance(e,i._selfSecUid);return yield null==a?void 0:a.updateUserInfo(t)})()}static getSelfUserInfoInstance(e){return this.getUserInfoInstance(e,this._selfSecUid)}}w._userInfoInstanceCacheMap=new Map},791628:function(e,t,i){i.d(t,{Ck:function(){return r},j$:function(){return n},xk:function(){return o}});var a=i(433965);function r(e,t){var i=new Map,r=[];for(var o of[...e,...t]){var n=(0,a.w3)(o)?o.key:o.commonAttr.id;if(!i.has(n))i.set(n,o),r.push(o)}return r}function o(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"id",a=new Map,r=[];for(var o of[...e,...t]){if(!a.has(o[i]))a.set(o[i],o),r.push(o)}return r}function n(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"id",a=new Map,r=[];for(var o of[...e,...t]){if(!a.has(o[i]))a.set(o[i],o),r.push(o)}return Array.from(a.values()).sort((e,t)=>t[i]-e[i])}},7197:function(e,t,i){i.d(t,{G:function(){return l}});var a=i(876826),r=i(530989),o=i(265587),n=i(820266),s=i(804274),d=i(423719),c=i(793723);function l(e,t,i){return u.apply(this,arguments)}function u(){return(u=(0,a._)(function*(e,t,i){var a=(0,n.b)(e,s.D1);if(i&&t&&a.item_list){var l=yield r.Li.decryptIV(i,t);yield(0,d.sh)(r.Li.decrypt.bind(r.Li),a.item_list,l)}if(Array.isArray(a.item_list)){var u=yield r.sn.getSignOptions();(0,c.$U)(r.sn.sign.bind(r.sn),a.item_list,u)}if(a.item_list)for(var v=0;v<a.item_list.length;v++)a.item_list[v].video&&(a.item_list[v]=(0,o.Q)(a.item_list[v],a.item_list[v].video.origin_video)),0===a.next_offset&&a.request_id&&(a.item_list[v].impressionId=a.request_id);return(0,n.b)(a,s.zW,!1)})).apply(this,arguments)}},422600:function(e,t,i){i.d(t,{b:function(){return r}});var a=i(259273);function r(e,t){var i,{panel:r}=e,o=t.getData(a.Sj.Home);return o&&o.panel===r&&o.panelInfo?(null===(i=o.panelInfo)||void 0===i?void 0:i.ok)&&o.panelInfo.value?o.panelInfo.value:null:null}},542994:function(e,t,i){i.d(t,{T:function(){return r}});var a=i(562092);function r(e,t){var i,r,o,n,s,d=(0,a.D)(e.common_attr.extra);return{key:"".concat(t,"_").concat(e.common_attr.id||e.common_attr.md5),resourceId:e.common_attr.id,effectId:e.common_attr.effect_id.toString(),effectType:e.common_attr.effect_type,publishSource:e.common_attr.publish_source,aspectRatio:e.common_attr.aspect_ratio,isBusiness:e.common_attr.is_business,md5:e.common_attr.md5,isVip:null!==(o=d.is_vip)&&void 0!==o&&o,title:e.common_attr.title,description:e.common_attr.description,coverUrl:e.common_attr.cover_url,originUrl:null!==(s=null!==(n=null===(i=e.common_attr.item_urls)||void 0===i?void 0:i[0])&&void 0!==n?n:null===(r=e.common_attr.download_info)||void 0===r?void 0:r.url)&&void 0!==s?s:"",isFavorite:e.common_attr.has_favorited,createTime:e.common_attr.create_time,coverUrlMap:e.common_attr.cover_url_map,localItemId:e.common_attr.local_item_id,thirdResourceId:e.common_attr.third_resource_id,status:e.common_attr.status}}},826717:function(e,t,i){i.d(t,{X:function(){return o},p:function(){return n}});var a,r,o=((a={}).Image="image",a.Video="video",a.Canvas="canvas",a.ShortVideo="short_video",a);var n=((r={}).FeedEnterauto="feed_enterauto",r.FeedLoadmore="feed_loadmore",r.FeedRefresh="feed_refresh",r.FeedPreloadMore="feed_preloadmore",r)},416794:function(e,t,i){i.d(t,{o:function(){return function e(t){if("object"==typeof t&&null!==t)for(var i of Object.keys(t)){var r=function e(t){var i=t.replace(a,(e,t,i,a,r,o,n)=>t&&a?t+a:r&&n?r+n:e);return i.length!==t.length?e(i):i}(i);r!==i&&!(r in t)&&(t[r]=t[i]),"object"==typeof t[i]&&e(t[i])}}}});var a=/([a-zA-Z])(_)(\d)|(\d)(_|$)([a-zA-Z])/g},265587:function(e,t,i){i.d(t,{Q:function(){return g}});var a=i(85728),r=i(929753),o=i(474956),n=i(820266),s=i(804274),d=i(936690),c=i(733787),l=i(830563),u=i(542994),v=i(416794),m=i(521950),h=i(562092),_=i(296194),p=i(117275),f=i(535823),g=(e,t)=>{var i,g,y,I,b,w,k,T,L,D,S,F=(0,m.I)(e);(0,v.o)(F),(0,f.jc)(F),F.video.transcoded_video=(0,_.Z)(F.video.transcoded_video,(e,t)=>/^\d+_p$/.test(t));var C=(0,u.T)(F,o._g.DreaminaAiVideo),{aigc_image_params:A,statistic:P}=F,M=null!==(w=null!==(b=null!==(I=null!==(y=F.video.transcoded_video["720p"])&&void 0!==y?y:F.video.transcoded_video["360p"])&&void 0!==I?I:F.video.transcoded_video.origin)&&void 0!==b?b:t)&&void 0!==w?w:F.video.origin_video,O=Object.keys(null!==(k=F.video.transcoded_video)&&void 0!==k?k:{}),R=null==A?void 0:A.text2video_params,U=null==A?void 0:A.generate_type;var E=R?(i=R,(g=(0,n.b)((0,m.I)(i),s.zW)).videoGenInputs.forEach(e=>{if((null===(i=e.i2vOpt)||void 0===i?void 0:null===(t=i.realmanAvatar)||void 0===t?void 0:t.ttsInfo)&&(e.i2vOpt.realmanAvatar.ttsInfo=(0,n.b)((0,h.D)(null===(m=e.i2vOpt)||void 0===m?void 0:null===(v=m.realmanAvatar)||void 0===v?void 0:v.ttsInfo))),(null===(s=e.v2vOpt)||void 0===s?void 0:null===(o=s.lipSyncUserVideo)||void 0===o?void 0:o.ttsInfo)&&(e.v2vOpt.lipSyncUserVideo.ttsInfo=(0,n.b)((0,h.D)(e.v2vOpt.lipSyncUserVideo.ttsInfo))),null===(u=e.firstFrameImage)||void 0===u?void 0:null===(l=u.aigcImage)||void 0===l?void 0:null===(c=l.aigcImageParams)||void 0===c?void 0:c.blendParams){var t,i,o,s,c,l,u,v,m,_,f,{aigcImageParams:g}=e.firstFrameImage.aigcImage;if(!!(null==g?void 0:null===(_=g.blendParams)||void 0===_?void 0:_.abilityList)){var y=(0,p.o)({prompt:(0,d.A1)(g),abilityList:null==g?void 0:null===(f=g.blendParams)||void 0===f?void 0:f.abilityList,promptPlaceholderInfoList:null==g?void 0:g.blendParams.promptPlaceholderInfoList});g.blendParams=(0,r._)((0,a._)({},g.blendParams),{abilityList:y.abilityList,promptPlaceholderInfoList:y.promptPlaceholderInfoList}),(0,d.V8)(g,y.prompt)}}}),g):{videoGenInputs:[],seed:0,videoAspectRatio:c.py.VideoAspectRatioType_16_9},x=null==A?void 0:A.publish_opt;return x&&(T={publicCloneVoice:x.public_clone_voice,publicUserAudio:x.public_user_audio}),(0,r._)((0,a._)({},C),{generateType:U,publishedItemId:F.common_attr.published_item_id,author:F.author?{avatar:F.author.avatar_url,name:F.author.name,uid:F.author.uid,secUid:F.author.sec_uid}:{avatar:"",name:"",uid:"",secUid:""},video:{duration:F.video.duration,durationMs:BigInt(F.video.duration_ms),watermarkType:F.video.watermark_type,originVideo:M&&{definition:M.definition,format:M.format,height:M.height,size:M.size,width:M.width,videoUrl:M.video_url},videoTranscodeInfo:O.reduce((e,t)=>{var i,o,n=null!==(o=null===(i=F.video.transcoded_video)||void 0===i?void 0:i[t])&&void 0!==o?o:{},s=(0,r._)((0,a._)({},e),{videoUrl:n.video_url});return(0,r._)((0,a._)({},e),{[t]:s})},{}),videoId:F.video.video_id,transcodeStatus:F.video.transcode_status,videoSizeType:F.video.video_size_type},fixedVdaStatus:F.video.vda_status===l.X.Encoding&&O.length?l.X.EncodeSuccess:F.video.vda_status,aigcVideoParam:(0,r._)((0,a._)({},E),{publishOpt:T}),genVideoParams:E,statistic:{usageNum:null!==(L=P.usage_num)&&void 0!==L?L:0,hasFavorited:null!==(D=P.has_favorited)&&void 0!==D&&D,favoriteNum:null!==(S=P.favorite_num)&&void 0!==S?S:0},coverUrlMap:F.common_attr.cover_url_map,categoryIdList:F.category_id_list,actData:F.act_data?{weeklyChallengeList:F.act_data.weekly_challenge_list.map(e=>{var{act_key:t,act_name:i,award_ranking:a}=e;return{actKey:t,actName:i,awardRanking:a}})}:void 0,competitionData:F.competition_data?{competitionKey:F.competition_data.competition_key,competitionTitle:F.competition_data.competition_title,award:F.competition_data.award}:void 0,shortVideoData:F.short_video_data?{aiTools:F.short_video_data.ai_tools,storyId:F.short_video_data.story_id,downloadable:F.short_video_data.downloadable}:void 0,requestId:F.request_id,impressionId:F.request_id,publishOpt:T,videoTemplateItem:(0,n.b)(F.video_template_item,s.zW)})}},748312:function(e,t,i){i.d(t,{Z:()=>f,N:()=>g});var a=i("971245"),r=i("876826"),o=i("643590"),n=i("416105"),s=i("804274"),d=i("875649"),c=i("879976"),l=i("940140"),u={getUnreadCount:{hostNameType:l.b_.Default,url:"/mweb/v1/get_unread_count"},getNoticeList:{hostNameType:l.b_.Default,url:"/mweb/v1/get_notice_list"}},v=i("836413"),m=i("712942"),h=i("100470"),_=i("242089");class p{getUnreadCount(e){var t=this;return(0,r._)(function*(){return yield t._request("".concat((0,m.H4)()).concat(u.getUnreadCount.url),e)})()}getNoticeList(e){var t=this;return(0,r._)(function*(){var i="".concat((0,m.H4)()).concat(u.getNoticeList.url),a="".concat(i,"_").concat(e.noticeType);return yield(0,_.O)(a,()=>t._request(i,e))})()}_request(e,t){var i=this;return(0,r._)(function*(){try{var a=yield i._networkClient.post(e,t);return(0,v.oW)(a)}catch(e){var{ret:r,errmsg:o}=e||{},n=r?Number(r):h.b.ErrCommon;return(0,v.wf)(n,null!=o?o:"unknown error")}})()}constructor(){var e;this._networkClient=(e=new o.y().build({headers:{"Content-Type":"application/json"},withCredentials:!0}),(0,c.V)(e),(0,n.mH)(e),(0,s.xP)(e),(0,d.e_)(e),e)}}var f=(0,a.yh)("mWeb-notice-service");class g{get noticeRepository(){return this._noticeRepository}constructor(){this._noticeRepository=new p}}},81612:function(e,t,i){i.d(t,{m:()=>h,x:()=>_});var a=i("876826"),r=i("836413"),o=i("643590"),n=i("416105"),s=i("804274"),d=i("875649"),c=i("879976"),l={photoReport:{hostNameType:i("940140").b_.Default,url:"/mweb/v1/add_report"}},u=i("712942"),v=i("100470");class m{reportPhoto(e){var t=this;return(0,a._)(function*(){var i="".concat((0,u.H4)()).concat(l.photoReport.url);return yield t._request(i,e)})()}_request(e,t){var i=this;return(0,a._)(function*(){try{return yield i._networkClient.post(e,t),(0,r.ly)()}catch(e){var{errNo:a,errTips:o}=e||{},n=a?Number(a):v.b.ErrCommon;return(0,r.wf)(n,null!=o?o:"unknown error")}})()}constructor(){var e;this._networkClient=(e=new o.y().build({headers:{"Content-Type":"application/json"},withCredentials:!0}),(0,c.V)(e),(0,n.mH)(e),(0,s.xP)(e),(0,d.i3)(e),e)}}var h=(0,i("971245").yh)("mWeb-photo-report-service");class _{get repository(){return this._repository}constructor(){this._repository=new m}}},104170:function(e,t,i){i.d(t,{$:function(){return n},u:function(){return o}});var a,r,o=((a={})[a.Like=1]="Like",a[a.Unlike=2]="Unlike",a);var n=((r={})[r.Image=9]="Image",r[r.Video=53]="Video",r[r.Collection=109]="Collection",r[r.TextArt=116]="TextArt",r[r.Canvas=211]="Canvas",r)},519927:function(e,t,i){i.d(t,{l:function(){return r}});var a,r=((a={}).PAGE_LOAD="PAGE_LOAD",a.PAGE_IDLE="PAGE_IDLE",a)},252805:function(e,t,i){i.d(t,{f:function(){return a}});var a=(0,i(971245).yh)("preload")}}]);