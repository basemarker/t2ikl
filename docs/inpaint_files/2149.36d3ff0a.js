"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["2149"],{986831:function(e,t,r){r.d(t,{h:function(){return o}});var i,o=((i={}).ADD="ADD",i.DECREASE="DECREASE",i.SYNCED="SYNCED",i)},163142:function(e,t,r){r.d(t,{Ai:function(){return R},Hj:function(){return a},N_:function(){return p},V7:function(){return l},c:function(){return u},gb:function(){return _},gr:function(){return f},id:function(){return c},j1:function(){return g},nH:function(){return n},nd:function(){return v},vW:function(){return h},vd:function(){return y},vy:function(){return s},zP:function(){return d}});var i=r(409625),o=r(37454),n="MWEB_FLOW_INIT",s="MWEB_REPORT_INIT",c="MWEB_USER_INIT",a="MWEB_I18N_INIT",u="MWEB_CONTRIBUTION_INIT",d="MWEB_WORKBENCH_INIT",v="USER_INIT_PHASE",h="PREPARE_PHASE",l="RENDER_PHASE",_="COMPLETE_PHASE",g="ENTRY_SCRIPT_EXECUTION",y=[n,s,c,a,v,h,l,_,"HEAD_SCRIPT_EXECUTION","HEAD_BEFORE_SCRIPT","SECURITY_SCRIPT_EXECUTION","SCRIPT_BEFORE_ENTRY",g,"HOME_CSR_DYNAMIC_IMPORT","HOME_FEED_DECRYPT"],p=[u,o.j.INIT_COMMERCIAL_DATA_FIRST_STEP,o.j.INIT_COMMERCIAL_DATA_SECOND_STEP,o.j.RECEIVE_CREDIT,i.L_,i.v2,i.i_,i.iE,i.U7,"AGW_HOME_FEED_INJECT"],f="fmp-element",R="ccfmp-element"},522692:function(e,t,r){r.d(t,{Z:function(){return s}});var i=r(484702),o=r(66003),n=r(218571),s=()=>{var e=(0,o.G)(i.N),[t,r]=(0,n.useState)(e.isInFreemiumStage);return(0,n.useEffect)(()=>{r(e.isInFreemiumStage);var t=e.onIsInFreemiumStageChange(e=>{r(e)});return()=>{t.dispose()}},[]),t}},590045:function(e,t,r){function i(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!!e){var i=e.scrollTop+t;e.scrollTo&&r?e.scrollTo({top:i,left:0,behavior:"smooth"}):e.scrollTop=i}}function o(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!!e){var{scrollHeight:r}=e;i(e,r,t)}}function n(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!!e){var{scrollTop:r}=e;i(e,-r,t)}}function s(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!t&&console.log("[record-list] assigned element does not exist",r,e);var o=i?null==t?void 0:t.querySelector("#".concat(e)):document.getElementById(e);if(!o||!t){console.log("[record-list] assigned element does not exist",r,e);return}o.scrollIntoView({block:"start",inline:"nearest",behavior:r?"smooth":"instant"})}r.d(t,{As:function(){return s},Dh:function(){return o},lL:function(){return n},tr:function(){return i}})},49176:function(e,t,r){r.d(t,{Z:function(){return a}});var i=r(85728),o=r(772322);r(218571);var n=r(889715),s=r(839141),c={[s.d.Standard]:{icon:n._VM,iconExpired:n.TrG},[s.d.Artisan]:{icon:n.PxL,iconExpired:n.q1Y},[s.d.Maestro]:{icon:n.lbg,iconExpired:n.enG}};function a(e){var t,r,{className:n="",style:a,level:u,inactive:d,enableClick:v=!1,size:h=20,onClick:l}=e,_=e=>!!e&&[s.d.Standard,s.d.Artisan,s.d.Maestro].includes(e);var g=(t=null,u&&_(u)&&(t=d?c[u].iconExpired:c[u].icon),t);return g?(0,o.jsx)(g,{className:n,style:(r={width:"".concat(h,"px"),height:"".concat(h,"px"),fontSize:"".concat(h,"px")},v&&(r.cursor="pointer"),(0,i._)({},r,a)),onClick:()=>{if(!!v)null==l||l()}}):null}},945781:function(e,t,r){r.d(t,{g:function(){return v},u:function(){return d}});var i=r(85728),o=r(163142),n=r(608358),s=r(591586),c=r(70529),a=r(144307),u=null,d=()=>u,v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{var r=new URLSearchParams(location.search),d=(0,n.ko)(e,c.m);if(u)return;var v=(0,a.Po)("mweb_init",o.vd,{largestContentfulPaintTime:t,isDebug:!!r.get("isDebug"),clear:!r.get("isDebug"),extraParams:(0,i._)({},(0,a.sG)())});if(!v)return;u=v,d.reportBusinessEvent(v.eventName,v.params),d.reportDevEvent(v.eventName,v.params),s.t.info("[mweb_init]",v.params)}catch(e){s.t.warn("[mweb_init] report error",e)}}},144307:function(e,t,r){r.d(t,{Po:function(){return c},_s:function(){return a},aK:function(){return u},sG:function(){return d}});var i=r(85728),o=r(591586),n=(e,t)=>{var r={};for(var i in t){if(!("object"==typeof t[i]&&("categories"===i||"metrics"===i))){r["".concat(e,"_").concat(i)]=t[i];continue}for(var o in t[i])r["".concat(e,"_").concat(o)]=t[i][o]}return r},s={isDebug:!1,largestContentfulPaintTime:0,timeOrigin:0},c=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s,{isDebug:c,clear:a,largestContentfulPaintTime:u,timeOrigin:d,extraParams:v}=(0,i._)({},s,r),h={eventName:e,params:(0,i._)({},v)},l=1/0,_=-1/0,g=[];for(var y of t){var p,f,R,m,S,T=null===(m=performance.getEntriesByName("".concat(y,"_START")))||void 0===m?void 0:m[0],k=null===(S=performance.getEntriesByName("".concat(y,"_END")))||void 0===S?void 0:S[0];if(!!T&&!!k){g.push(y);var b=(0,i._)({start:T.startTime-d,end:k.startTime-d,duration:k.startTime-T.startTime},T.detail,k.detail);if(c)try{performance.measure(y,"".concat(y,"_START"),"".concat(y,"_END"))}catch(e){o.t.warn(e)}l=Math.min(l,b.start),_=Math.max(_,b.end),Object.assign(h.params,n(y,b))}}var w=_-l;h.params["timing-".concat(e)]=w,h.params["timing-".concat(e,"-start")]=l,h.params["timing-".concat(e,"-end")]=_;var I=null===(p=performance.getEntriesByName("first-paint")[0])||void 0===p?void 0:p.startTime,M=null===(f=performance.getEntriesByName("first-contentful-paint")[0])||void 0===f?void 0:f.startTime,C=null===(R=performance.getEntriesByName("HOME_ENTRY_START")[0])||void 0===R?void 0:R.startTime;return Object.assign(h.params,{reportTime:performance.now(),timingInitStart:l,timingInitEnd:_,timingInit:w,timingFP:I,timingFCP:M,timingLCP:u,timeOrigin:d},C?{timingHomeEntryStart:C}:{}),c&&o.t.log("[init] ".concat(e,": "),JSON.stringify(h)),!1!==a&&g.forEach(e=>{performance.clearMarks("".concat(e,"_START")),performance.clearMarks("".concat(e,"_END"))}),h},a=(e,t)=>{var{timingInitStart:r,timingInitEnd:o,timingInit:n,timingFP:s,timingFCP:c,timingLCP:a,timeOrigin:u,timingHomeEntryStart:d,["timing-".concat(e.eventName,"-start")]:v,["timing-".concat(e.eventName,"-end")]:h}=e.params,{timingInitStart:l,timingInitEnd:_,timingInit:g,timingFP:y,timingFCP:p,timingLCP:f,timeOrigin:R,timingHomeEntryStart:m,["timing-".concat(t.eventName,"-start")]:S,["timing-".concat(t.eventName,"-end")]:T}=t.params,k={eventName:e.eventName,params:(0,i._)({},e.params,t.params,{timingInitStart:Math.min(Number(r),Number(l)),timingInitEnd:Math.max(Number(o),Number(_)),timingInit:Math.max(Number(n),Number(g)),timingFP:Math.max(Number(s||0),Number(y||0)),timingFCP:Math.max(Number(c||0),Number(p||0)),timingLCP:Math.max(Number(a||0),Number(f||0)),timeOrigin:Math.max(Number(u),Number(R))},d&&m?{timingHomeEntryStart:Math.max(Number(d),Number(m))}:{})};delete k.params["timing-".concat(t.eventName)],delete k.params["timing-".concat(t.eventName,"-start")],delete k.params["timing-".concat(t.eventName,"-end")];var b=Math.min(Number(v),Number(S)),w=Math.max(Number(h),Number(T));return k.params["timing-".concat(e.eventName,"-start")]=b,k.params["timing-".concat(e.eventName,"-end")]=w,k.params["timing-".concat(e.eventName)]=w-b,k};function u(e,t){var r=(0,i._)({},e.params);for(var o of t)delete r["".concat(o,"_duration")];return delete r.timingInit,delete r["timing-".concat(e.eventName)],r}function d(){var e,t,r,o,n,s,c,a=null!==(n=null===(o=window._SSR_DATA)||void 0===o?void 0:o.renderLevel)&&void 0!==n?n:0,u=null!==(s=window.__ssr_click_count)&&void 0!==s?s:0,d=Object.keys(null!==(c=window.__ssr_click_area)&&void 0!==c?c:{}).sort().join(",");var v=(!((e=performance.timing.requestStart-performance.timeOrigin)>0)&&(e=0),e),h=function(){var e,t=performance.getEntriesByType("navigation");if(t.length){var[r]=t;e=r.responseStart-r.requestStart}else e=performance.timing.responseStart-performance.timing.requestStart;return!(e>0)&&(e=0),e}();var l=(r=null===(t=performance.getEntriesByType("navigation"))||void 0===t?void 0:t[0])?r.decodedBodySize/1024:0,_=function(){var e,t=performance.getEntriesByType("navigation");if(t.length){var[r]=t;e=r.domainLookupStart}else e=performance.timing.domainLookupStart-performance.timeOrigin;return!(e>0)&&(e=0),e}(),g=window.__asset_retry_count;return(0,i._)({ssrRenderLevel:a,ssrClickCount:u,ssrClickArea:d,timingRequestStart:v,timingTTFB:h,timingDomainLookupStart:_,htmlBodySize:l,assetRetryCount:g},function(){var e,t=performance.getEntriesByType("navigation");if(t.length){var[r]=t;e={redirectStart:r.redirectStart,redirectEnd:r.redirectEnd,redirectDuration:r.redirectEnd-r.redirectStart}}else e={redirectStart:performance.timing.redirectStart,redirectEnd:performance.timing.redirectEnd,redirectDuration:performance.timing.redirectEnd-performance.timing.redirectStart};return e.redirectEnd>0&&e.redirectDuration>0?e:{redirectStart:0,redirectEnd:0,redirectDuration:0}}())}},793724:function(e,t,r){r.d(t,{$d:function(){return c},Zj:function(){return s},tQ:function(){return a}});var i,o,n,s=((i={})[i.HitSensitiveWord=2334]="HitSensitiveWord",i[i.DirectoryExceedMaxDepth=2416]="DirectoryExceedMaxDepth",i[i.FolderNotExist=2417]="FolderNotExist",i);var c=((o={}).WaitForSync="waitForSync",o.Normal="normal",o);var a=((n={})[n.Initial=0]="Initial",n[n.Process=1]="Process",n[n.CleanUp=2]="CleanUp",n[n.Success=3]="Success",n[n.Failure=4]="Failure",n)},671381:function(e,t,r){r.d(t,{H9:function(){return u},ec:function(){return d},f7:function(){return a},m5:function(){return c}});var i,o,n,s=r(971245);var c=((i={})[i.NoCopy=4]="NoCopy",i[i.NoOccupation=8]="NoOccupation",i[i.Invisible=16]="Invisible",i[i.InvisibleNoOccupation=24]="InvisibleNoOccupation",i);var a=((o={}).Vod="vod",o.Normal="normal",o);var u=((n={})[n.Unknown=1]="Unknown",n[n.Cancel=2]="Cancel",n[n.FolderNotExist=23001]="FolderNotExist",n[n.Insufficient=20113]="Insufficient",n[n.EncodingNotSupport=20209]="EncodingNotSupport",n[n.InvalidFormat=200206]="InvalidFormat",n[n.NotMatchExtFormat=20233]="NotMatchExtFormat",n[n.InvalidMaterialInformation=200204]="InvalidMaterialInformation",n[n.InvalidMaterialName=24001]="InvalidMaterialName",n),d=(0,s.yh)("user-material-upload")},831593:function(e,t,r){r.d(t,{$E:()=>_,fl:()=>l,uC:()=>p,O1:()=>g});var i=r("549947"),o=r("876826"),n=r("2910"),s=r("836413"),c=r("56935"),a=r("264546"),u=r("743880");function d(e,t){return new Promise(t=>{e.toBlob(e=>{e?t(e.arrayBuffer()):t(new ArrayBuffer(0))})})}function v(e,t){return Promise.resolve(t.getImageData(0,0,e.width,e.height))}class h{next(){var e=this;return(0,o._)(function*(){if(0===e._times.length)return{value:null,done:!0};var t=e._times.shift();if(e._cache&&e._cache.timestamp===t)return{value:e._cache,done:!1};var r=yield e._builder.getFrame(t);return e._cache=r,{value:r,done:!1}})()}[Symbol.asyncIterator](){return this}constructor(e,t){this._builder=e,this._times=t}}class l{captureSingleFrame(e,t){var r=this._getReturnDataProcessFunction(t);return this._makeFrameBuilder(r).getFrame(e)}captureByTimes(e,t){var r=this._getReturnDataProcessFunction(t);return new h(this._makeFrameBuilder(r),e)}captureByInterval(e,t){(0,c.Y2)(e>0);for(var r=1e3*this._video.duration,i=[],o=0;o<=r;o+=e)i.push(o);return this.captureByTimes(i,t)}captureByCount(e,t){(0,c.Y2)(e>0);var r=1e3*this._video.duration;return this.captureByInterval(r/e,t)}_makeFrameBuilder(e){return new u.L(this._video,this._canvas,this._ctx,e)}_getReturnDataProcessFunction(e){switch(e){case a.l.ArrayBuffer:return d;case a.l.ImageData:return v;default:(0,c.bP)(e)}}constructor(e,t){this._video=e,this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvas.width=t.width,this._canvas.height=t.height}}function _(e){return new Promise(t=>{e.addEventListener("canplay",()=>{t((0,s.ly)())}),e.addEventListener("error",e=>{t((0,s.Mx)(-1,"video cant play.",e.error))})})}function g(e,t){return y.apply(this,arguments)}function y(){return(y=(0,o._)(function*(e,t){var r=document.createElement("video");r.crossOrigin="anonymous",r.src=(0,n.C)(e,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_dreamina",region:"cn",urlLimit:"-1",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1,escapeRule:"escape-report"});var i=yield _(r);return i.ok?(0,s.oW)(new l(r,t)):i})).apply(this,arguments)}function p(e){return f.apply(this,arguments)}function f(){return(f=(0,o._)(function*(e){var t=[],r,o=!1,n=!1;try{for(var s,c=(0,i._)(e);o=!(s=yield c.next()).done;o=!1){var a=s.value;t.push(a)}}catch(e){n=!0,r=e}finally{try{o&&null!=c.return&&(yield c.return())}finally{if(n)throw r}}return t})).apply(this,arguments)}},743880:function(e,t,r){r.d(t,{L:function(){return n}});var i=r(876826),o=r(82615);class n{getFrame(e){var t=this;return(0,i._)(function*(){var r;yield t._sharedMutex.lock(),e=Math.min(e=Math.max(e,0),1e3*t._video.duration),t._video.currentTime=e/1e3,yield(r=t._video,new Promise(e=>{r.addEventListener("seeked",e,{once:!0})})),t._ctx.drawImage(t._video,0,0,t._video.videoWidth,t._video.videoHeight,0,0,t._canvas.width,t._canvas.height);try{return{timestamp:e,data:yield t._formatFunction(t._canvas,t._ctx)}}finally{t._sharedMutex.unLock()}})()}constructor(e,t,r,i){this._video=e,this._canvas=t,this._ctx=r,this._formatFunction=i,this._sharedMutex=new o.L}}},264546:function(e,t,r){r.d(t,{T:function(){return s},l:function(){return n}});var i,o=r(971245);var n=((i={})[i.ArrayBuffer=0]="ArrayBuffer",i[i.ImageData=1]="ImageData",i),s=(0,o.yh)("video-capture-service")},998519:function(e,t,r){r.d(t,{F:function(){return i}});var i=(0,r(971245).yh)("audio-data-service")},312518:function(e,t,r){r.d(t,{o:function(){return i}});var i=(0,r(971245).yh)("evercloud-token-data-service")},325398:function(e,t,r){r.d(t,{H:function(){return i}});var i=(0,r(971245).yh)("font-data-service")},211809:function(e,t,r){r.d(t,{N:function(){return i}});var i=(0,r(971245).yh)("gif-data-service")},998052:function(e,t,r){r.d(t,{W:function(){return i}});var i=(0,r(971245).yh)("dreamina-canvas-template-service")},266049:function(e,t,r){r.d(t,{l:function(){return i}});var i=(0,r(971245).yh)("dreamina-text-art-data-service")},712823:function(e,t,r){r.d(t,{_:function(){return i}});var i=(0,r(971245).yh)("photo-dreamina-data-service")},599647:function(e,t,r){r.d(t,{B:function(){return i}});var i=(0,r(971245).yh)("photo-data-service")},680359:function(e,t,r){r.d(t,{Z:function(){return i}});var i=(0,r(971245).yh)("video-dreamina-data-service")},705408:function(e,t,r){r.d(t,{u:function(){return i}});var i=(0,r(971245).yh)("video-data-service")},347853:function(e,t,r){r.d(t,{z:()=>r3});var i,o,n=r("789786"),s=r("497973"),c=r("719800"),a=r("56935"),u=r("474956");class d{add(e,t){if((0,a.Y2)(e,"key is not invalid"),!this._cache.has(e)){var r=this.createResource(e,t);r.onResourceCreated(),this._cache.set(e,r)}}get(e){if(!!this._cache.has(e))return this._cache.get(e)}delete(e){if(!!this._cache.has(e))this._cache.delete(e)}constructor(e){this._instantiationService=e,this._cache=new Map}}d=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],d);var v=r("876826"),h=r("85728"),l=r("705408"),_=r("294202"),g=r("233307"),y=r("836413"),p=r("5564"),f=r("61556"),R=r("91849"),m=r("816258"),S=r(966465).Buffer,T=(e,t)=>{var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r};function k(){return(k=(0,v._)(function*(e,t,r){var i=S.from(r,"hex"),o=yield crypto.subtle.importKey("raw",i,{name:"AES-GCM"},!1,["decrypt"]),n=e.slice(0,12),s=e.slice(12,t);return yield crypto.subtle.decrypt({name:"AES-GCM",iv:n},o,s)})).apply(this,arguments)}var b=(i=(0,v._)(function*(e,t){var r=e.byteLength,i=Number(new DataView(new Uint8Array(e.slice(0,256)).buffer).getBigInt64(24,!0));if(r<256||i<=0)throw Error("buf size invalid");for(var o=i+28,n=new Uint8Array(o),s=new Uint8Array,c=256;c<r;){var a=Math.min(o,r-c);n.set(new Uint8Array(e.slice(c,c+a))),s=T(s,new Uint8Array((yield function(e,t,r){return k.apply(this,arguments)}(n,a,t)))),c+=a}return s.buffer}),function(e,t){return i.apply(this,arguments)}),w=r("426473");class I extends f.y{startImmediately(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this;return(0,v._)(function*(){yield t.start(!0,e)})()}cancel(){var e;return!!super.cancel()&&(null===(e=this._downloadTask)||void 0===e||e.cancel(),this._downloadTask=void 0,!0)}loadResource(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this;return(0,v._)(function*(){try{return yield r._doLoadPersistentResource({downloadType:e?g._5.Eager:g._5.Idle,disableTokenHeaders:t})}catch(i){if((0,y.oi)(i)&&1e3===i.code)return yield r._loadResourceWithoutCache(e,t);throw i}})()}_loadResourceWithoutCache(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._doLoadPersistentResource({downloadType:e?g._5.Eager:g._5.Idle,clearCacheIfExist:!0,databaseFirst:!1,disableTokenHeaders:t})}_makeDownloadTask(e){var t=(0,w.Y)({tokenKey:this._metadata.key,decryptKey:(0,R.d)(this._metadata)?this._metadata.decryptKey:void 0}),r=(0,R.d)(this._metadata)?(0,p.Cv)(this._metadata.decryptKey).toString():"";return this._downloadService.download({key:t,url:this._metadata.url,decryptHash:r,uniqueId:this._metadata.md5||t},(0,h._)({},this.config,e))}_doLoadPersistentResource(e){return new Promise((t,r)=>{var i=this._makeDownloadTask(e);this._downloadTask=i;var o=this;i.onSuccess((0,v._)(function*(){(0,a.ZB)(i.value);try{yield o.doParseArrayBuffer(i.value),t(o.value)}catch(e){r((0,y.Mx)(1e3,"parse arraybuffer error",e))}})),i.onFail(e=>{r(e)})})}doParseArrayBuffer(e){var t=this;return(0,v._)(function*(){var{buffer:r}=e;r=yield t.decryptResourceIfNeeded(r),t.value.buffer=r,t.value.contentType=e.contentType})()}decryptResourceIfNeeded(e){var t=this;return(0,v._)(function*(){if((0,R.d)(t._metadata)&&t._metadata.shouldAutoDecrypt){if(t._metadata.encryptType===_.PS.AES_CBC)return yield(0,m.Z)(e,t._metadata.decryptKey);if(t._metadata.encryptType===_.PS.AES_GCM)return yield b(e,t._metadata.decryptKey)}return e})()}constructor(e,t,r){super(),this._metadata=e,this._downloadService=t,this.config=r,this.value=(0,h._)({},this._metadata)}}var M=r("305466");class C extends I{doParseArrayBuffer(e){var t=this,r=()=>super.doParseArrayBuffer;return(0,v._)(function*(){r().call(t,e);var i=yield(0,M.x)(e.buffer,e.contentType);(0,a.Y2)(!(i instanceof ArrayBuffer));var o=Object.keys(i).find(e=>t._contentFileFilter(e));(0,a.Y2)(o),Object.defineProperty(t.value,"content",{get:()=>new TextDecoder("utf-8").decode(i[o].arrayBuffer),enumerable:!0})})()}constructor(e,t,r){super(e,t),this._contentFileFilter=r}}class O extends I{doParseArrayBuffer(e){var t=this,r=()=>super.doParseArrayBuffer;return(0,v._)(function*(){return yield r().call(t,e),Promise.resolve()})()}constructor(e,t,r){var i;super(e,t,r),i=this,Object.defineProperty(this.value,"files",{value:(0,v._)(function*(){(0,a.Y2)(i.value.buffer,"should call files after buffer ready.");try{var e=yield(0,M.x)(i.value.buffer,i.value.contentType);return(0,a.Y2)(!(e instanceof ArrayBuffer)),e}catch(e){yield i._loadResourceWithoutCache(!0);var t=yield(0,M.x)(i.value.buffer,i.value.contentType);return(0,a.Y2)(!(t instanceof ArrayBuffer)),t}}),enumerable:!0})}}class x extends I{doParseArrayBuffer(e){var t=this,r=()=>super.doParseArrayBuffer;return(0,v._)(function*(){return yield r().call(t,e),Object.defineProperty(t.value,"file",{value:()=>e.buffer,enumerable:!0}),Promise.resolve()})()}}var j=r("121192"),F=new TextDecoder("utf-8"),U=e=>{if(!e)return null;var t=F.decode(e);if(!t)return null;try{return JSON.parse(t)}catch(e){return null}};class K extends O{doParseArrayBuffer(e){var t=this,r=()=>super.doParseArrayBuffer;return(0,v._)(function*(){yield r().call(t,e),yield Promise.all([t._extractAttributes(),t._extractRequirements(),t._extractModelNames()])})()}_extractModelNames(){var e=this;return(0,v._)(function*(){var t,r,i,o=yield e.value.files(),n=U(null===(t=o["config.json"])||void 0===t?void 0:t.arrayBuffer),s=U(null===(r=o["algorithmConfig.json"])||void 0===r?void 0:r.arrayBuffer),c=new Set,a=e=>{if(!!e)Object.keys(e).forEach(t=>{var r=e[t];null==r||r.forEach(e=>null==c?void 0:c.add(e))})};a(null==n?void 0:null===(i=n.effect)||void 0===i?void 0:i.model_names),a(null==s?void 0:s.model_names),e.value.modelNames=Array.from(c)})()}constructor(...e){var t;super(...e),t=this,this._extractAttributes=(0,v._)(function*(){var e,r,i,o,n,s=yield t.value.files(),c=U(null===(e=s["config.json"])||void 0===e?void 0:e.arrayBuffer),a=U(null===(r=s["extra.json"])||void 0===r?void 0:r.arrayBuffer),u=[],d=[];(null==c?void 0:null===(o=c.effect)||void 0===o?void 0:null===(i=o.Link)||void 0===i?void 0:i.length)&&(null==c||null===(n=c.effect)||void 0===n||n.Link.forEach(e=>{e.path&&u.push(e.path),"Filter"===e.type&&d.push({key:j.$3,defaultValue:1})})),(null==a?void 0:a.settings)&&Object.keys(a.settings).forEach(e=>{d.push({key:e,defaultValue:a.settings[e]})}),t.value.attributes=d}),this._extractRequirements=(0,v._)(function*(){var e,r=yield t.value.files(),i=U(null===(e=r["config.json"])||void 0===e?void 0:e.arrayBuffer),o=[];(null==i?void 0:i.requirement)&&o.push(i.requirement),Object.keys(r).forEach(e=>{if(/\/content.json$/.test(e)){var t,i=U(null===(t=r[e])||void 0===t?void 0:t.arrayBuffer);(null==i?void 0:i.requirement)&&o.push(i.requirement)}if(/^algorithmConfig.json$/.test(e)){var n,s,c=U(null===(n=r[e])||void 0===n?void 0:n.arrayBuffer);if(!(null==c?void 0:null===(s=c.nodes)||void 0===s?void 0:s.length))return;c.nodes.forEach(e=>{o.push({[e.type]:!0})})}});var n={};o.forEach(e=>{Object.keys(e).forEach(t=>{e[t]&&(n[t]=e[t])})}),t.value.requirements=n})}}var D=new Map;function A(e,t,r){if(D.has(e.key))return D.get(e.key);var i=new I(e,t,r);return D.set(e.key,i),i}function E(e,t,r){if(D.has(e.key))return D.get(e.key);var i=new O(e,t,r);return D.set(e.key,i),i}function B(e,t,r){var i=(0,R.d)(e)?"".concat(e.key,"_").concat(e.shouldAutoDecrypt):e.key;if(D.has(i))return D.get(i);var o=new x(e,t,r);return D.set(i,o),o}var P=(e,t,r)=>{if(D.has(e.key))return D.get(e.key);var i=new K(e,t,r);return D.set(e.key,i),i},Y=r("184564"),V=r("665000");class L extends V.i{getCoverResourceToken(){return this._getResourceTokenSync(this._createCoverToken.bind(this),()=>this._coverResourceToken,e=>this._coverResourceToken=e)}getCoverResourceTokenByFuzzyMatchWidth(e){return(0,a.Y2)((0,Y.R)(this.value)),this.getCoverResourceToken()}_createCoverToken(e){return A({key:this._getCoverResourceKey(),url:this.getCover(e)},this._downloadService)}_getCoverResourceKey(){return"".concat(this.key,"_cover")}constructor(e,t,r){super(e,t),this.key=e,this._downloadService=r}}L=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof Resource?Object:Resource,void 0===g.tx?Object:g.tx])],L);var N={[_.V6.DEPOSIT]:_.n9.MaterialPlatformTuchongDeposit,[_.V6.ADOBE]:_.n9.MaterialPlatformTuchongAdobe,[_.V6.POND5]:_.n9.MaterialPlatformTuchongPond5},G=(e,t)=>{var r;switch(e){case _.Hw.HEYCAN:return _.EE.EffectPlatformArtist;case _.Hw.LOKI:return _.EE.EffectPlatformLoki;case _.Hw.MUSIC:return _.Ll.AudioPlatformLibrary;case _.Hw.TUCHONG:if(r=t&&N[t])return r;default:return _.EE.EffectPlatformArtist}};function H(e){return!e.order||!!(e.order&&e.order.id&&e.order.source===_.Hw.TUCHONG&&e.order.url)}function W(e){var t=G(e.source,e.publishSource);return t===_.n9.MaterialPlatformTuchongAdobe||t===_.n9.MaterialPlatformTuchongPond5}var q=r("280166");class z extends L{getCover(e){return e.coverUrl}getVideoResourceToken(){return this._getResourceTokenSync(this._createVideoResourceToken.bind(this),()=>this._videoResourceToken,e=>this._videoResourceToken=e)}getMaskVideoResourceToken(){return this._getResourceTokenSync(this._createMaskVideoResourceToken.bind(this),()=>this._maskVideoResourceToken,e=>this._maskVideoResourceToken=e)}getVideoOrderedResourceToken(){var e=this;return(0,v._)(function*(){if(yield e._onResourceReadyDefer.promise,(0,a.Y2)((0,Y.R)(e.value)),e._videoOrderedResourceToken)return(0,y.oW)(e._videoOrderedResourceToken);if(!W(e.value))return(0,y.oW)(e.getVideoResourceToken());if(H(e.value))return(0,y.oW)(e._createVideoOrderedResourceToken(e.value));var t=yield e._orderTuchongVideo();return t.ok?(0,y.oW)(e._createVideoOrderedResourceToken(e.value)):t})()}getThumbResourceTokens(){return this._getResourceTokenAsync(this._createVideoThumbTokens.bind(this),()=>this._thumbResourceTokens,e=>this._thumbResourceTokens=e)}getMaskVideoResolutionInfo(){for(var e of((0,a.Y2)((0,Y.R)(this.value)),(0,a.Y2)(this.value.maskVideoTranscode),this._environmentService.isAutoTest?["720p","1080p","540p","480p","360p"]:["480p","360p","540p","720p","1080p"])){var t=this.value.maskVideoTranscode[e];if(null==t?void 0:t.url)return{url:t.url,resolution:e,decryptKey:t.decryptKey}}var{url:r}=this.value.maskVideo;return{url:r,resolution:"origin"}}getVideoResolutionInfo(){for(var e of((0,a.Y2)((0,Y.R)(this.value)),this._environmentService.isAutoTest?["720p","1080p","540p","480p","360p"]:["480p","360p","540p","720p","1080p"])){var t=this.value.transcode[e];if(null==t?void 0:t.url)return{url:t.url,resolution:e,decryptKey:t.decryptKey}}var{url:r}=this.value.originVideo;return{url:r,resolution:"origin"}}getVideoOrderedResolutionInfo(){return((0,a.Y2)((0,Y.R)(this.value)),this.value.order)?((0,a.Y2)(this.value.order.url),{url:this.value.order.url,resolution:"origin"}):this.getVideoResolutionInfo()}getVideoStreamInfo(){var e=this;return(0,v._)(function*(){if(yield e._onResourceReadyDefer.promise,(0,a.Y2)((0,Y.R)(e.value)),!W(e.value)){var t,{url:r,decryptKey:i}=e.getVideoResolutionInfo();return(0,y.oW)({url:r,decryptKey:i,encryptType:_.PS.AES_CBC,withCredentials:null!==(t=e.value.isFromBrand)&&void 0!==t&&t})}if(H(e.value)){var{url:o}=e.getVideoOrderedResolutionInfo();return(0,y.oW)({url:o})}var n=yield e._orderTuchongVideo();return n.ok?(0,y.oW)({url:n.value.url}):n})()}_createCoverToken(e){return A({key:this._getCoverResourceKey(),url:this.getCover(e)},this._downloadService,this._getDownloadConfig(e))}_orderTuchongVideo(){var e=this;return(0,v._)(function*(){(0,a.Y2)((0,Y.R)(e.value));var t=e.value.order,r=yield e._videoDataService.order({id:t.id});if(!r.ok)return r;var{url:i}=r.value;return e.value.order.url=i,r})()}_getDownloadConfig(e){return{withCredentials:e.isFromBrand}}_createMaskVideoResourceToken(e){(0,a.Y2)((0,Y.R)(this.value));var{url:t,decryptKey:r,resolution:i}=this.getMaskVideoResolutionInfo(),o=this._getMaskResolutionResourceKey(i);return this._maskVideoResourceToken=A({key:o,url:t,decryptKey:r,shouldAutoDecrypt:!1},this._downloadService,this._getDownloadConfig(e)),this._maskVideoResourceToken}_createVideoResourceToken(e){(0,a.Y2)((0,Y.R)(this.value));var{url:t,decryptKey:r,resolution:i}=this.getVideoResolutionInfo(),o=this._getResolutionResourceKey(i);return this._videoResourceToken=A({key:o,url:t,decryptKey:r,shouldAutoDecrypt:!1},this._downloadService,this._getDownloadConfig(e)),this._videoResourceToken}_createVideoOrderedResourceToken(e){(0,a.Y2)((0,Y.R)(this.value));var{url:t}=this.getVideoOrderedResolutionInfo(),r=this._getOrderedResolutionResourceKey();return this._videoResourceToken=A({key:r,url:t},this._downloadService,this._getDownloadConfig(e)),this._videoResourceToken}_createVideoThumbTokens(e){return e.thumb.details.map(t=>{var r=this._getThumbResourceKey(t.url),{singleFrameWidth:i,singleFrameHeight:o}=e.thumb.common,n={frameCount:t.frameCount,singleFrameWidth:i,singleFrameHeight:o,imageWidth:t.imageWidth,imageHeight:t.imageHeight};return A((0,h._)({key:r,url:t.url},n),this._downloadService)})}_getMaskResolutionResourceKey(e){return"".concat(this.key,"_mask_resolution_").concat(e)}_getResolutionResourceKey(e){return"".concat(this.key,"_resolution_").concat(e)}_getOrderedResolutionResourceKey(){return"".concat(this.key,"_ordered")}_getThumbResourceKey(e){return"".concat(this.key,"_thumb_").concat(e)}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)("resourceId"in e.value,"resourceId is not defined");var[t,r]=(yield e._videoDataService.batchGetVideos({resourceIds:[e.value.resourceId]})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._videoDataService=i,this._environmentService=o}}z=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,l.u),(0,n.fM)(4,q.Y),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IVideoMeta?Object:IVideoMeta,void 0===g.tx?Object:g.tx,void 0===l.u?Object:l.u,void 0===q.Y?Object:q.Y])],z);class Q extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(z,[e,t]))}constructor(e){super(e),this._instantiationService=e}}Q=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],Q);var Z=r("777632"),$=r("971245"),J=(0,$.yh)("shape-data-service");class X extends L{getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}_createContentToken(e){var t=this._getContentResourceKey();return function(e,t,r){if(D.has(e.key))return D.get(e.key);var i=new C(e,t,r);return D.set(e.key,i),i}({key:t,url:this.getContentUrl(e)},this._downloadService,this.contentFileFilter)}_getContentResourceKey(){return"".concat(this.key,"_content")}constructor(e,t,r){super(e,t,r),this.key=e,this._downloadService=r}}X=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof Resource?Object:Resource,void 0===g.tx?Object:g.tx])],X);var ee=r("969015");class et extends X{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileFilter(){return e=>e.endsWith(".svg")}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._shapeDataService.batchGetShapesByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId]})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._shapeDataService=i,this._configurationService=o}}et=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,J),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IShapeMeta?Object:IShapeMeta,void 0===g.tx?Object:g.tx,void 0===J?Object:J,void 0===ee.Ui?Object:ee.Ui])],et);class er extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(et,[e,t]))}constructor(e){super(e),this._instantiationService=e}}er=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],er);class ei{load(){var e=this;return(0,v._)(function*(){e.environmentService.isProd?e._svgResource=yield r.e("9433").then(r.t.bind(r,421687,19)):e._svgResource=yield r.e("4717").then(r.t.bind(r,86573,19)),e.initAwaitLock.initDone()})()}get(e){(0,a.ZB)(this._svgResource);var t=this._svgResource.svgMap.find(t=>t.id===e);return null==t?void 0:t.svg}getAll(){return this._svgResource}constructor(e){this.environmentService=e,this.initAwaitLock=new Z.G}}ei=(0,n.gn)([(0,n.fM)(0,q.Y),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===q.Y?Object:q.Y])],ei);var eo=r("998519");class en extends L{getCover(e){return e.coverUrl}getAudioResourceToken(){return this._getResourceTokenSync(this._createAudioResourceToken.bind(this),()=>this._audioResourceToken,e=>this._audioResourceToken=e)}getAudioResourceDecryptKey(){return(0,a.Y2)((0,Y.R)(this.value)),this.value?this.value.decryptKey:void 0}_createAudioResourceToken(e){var t,{originUrl:r}=e,i=this._getAudioResourceKey();return e.isFromBrand?A({key:i,url:r,decryptKey:null!==(t=e.decryptKey)&&void 0!==t?t:"",shouldAutoDecrypt:!1,encryptType:_.PS.AES_GCM},this._downloadService,{withCredentials:e.isFromBrand}):A({key:i,url:r,md5:e.md5},this._downloadService)}_getAudioResourceKey(){return"".concat(this.key,"_audio_").concat(this.value.resourceId)}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var{audioType:t}=e.value,[r,i]=(yield e._audioDataService.batchGetAudios({resourceIds:[e.value.resourceId],audioResourceType:t})).pair();if(r)throw Error("doFetch error-".concat(r.code,"-").concat(r.msg));return(0,h._)({type:e.value.type},i.list[0])})()}constructor(e,t,r,i){super(e,t,r),this.key=e,this._downloadService=r,this._audioDataService=i}}en=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,eo.F),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IAudioMeta?Object:IAudioMeta,void 0===g.tx?Object:g.tx,void 0===eo.F?Object:eo.F])],en);class es extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(en,[e,t]))}constructor(e){super(e),this._instantiationService=e}}es=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],es);var ec=r("249651"),ea=r("599647");class eu extends L{getCover(e){return e.coverUrl}getContentResourceToken(){return this._getResourceTokenSync(this._createContentResourceToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}getContentOrderedResourceToken(){var e=this;return(0,v._)(function*(){if(yield e._onResourceReadyDefer.promise,(0,a.Y2)((0,Y.R)(e.value)),e._contentOrderedResourceToken)return(0,y.oW)(e._contentOrderedResourceToken);if(!W(e.value))return(0,y.oW)(e.getContentResourceToken());if(H(e.value))return(0,y.oW)(e._createContentOrderedResourceToken(e.value));var t=e.value.order,r=yield e._photoDataService.order({id:t.id});if(!r.ok)return r;var{url:i}=r.value;return e.value.order.url=i,(0,y.oW)(e._createContentOrderedResourceToken(e.value))})()}getContentResolutionInfo(){return(0,a.Y2)((0,Y.R)(this.value)),this._getPhotoResolutionInfo(this.value)}getIfNeedCredential(){return(0,a.Y2)((0,Y.R)(this.value)),!!this.value.isFromBrand}_createCoverToken(e){return A({key:this._getCoverResourceKey(),url:this.getCover(e)},this._downloadService,this._getDownloadConfig(e))}_createContentResourceToken(e){var{url:t,resolution:r}=this._getPhotoResolutionInfo(e);return A({key:this._getResolutionResourceKey(r),url:t,md5:e.md5},this._downloadService,{withCredentials:e.isFromBrand})}_getDownloadConfig(e){return{withCredentials:e.isFromBrand}}_createContentOrderedResourceToken(e){(0,a.Y2)((0,Y.R)(this.value));var{url:t,resolution:r}=this.getPhotoOrderedResolutionInfo(),i=this._getOrderedResolutionResourceKey();return this._contentOrderedResourceToken=A({key:i,url:t,md5:e.md5},this._downloadService),this._contentOrderedResourceToken}_getResolutionResourceKey(e){return"".concat(this.key,"_resolution_").concat(e)}_getOrderedResolutionResourceKey(){return"".concat(this.key,"_ordered")}_getPhotoResolutionInfo(e){var t=function(e){var t=r.find(t=>t.resolution===e);if(t)return{v:t}},r=e.transcode.map(e=>{var{url:t,width:r,height:i}=e;return{url:t,resolution:this._getResolutionKeyByLongSide(r,i)}}).filter(e=>e.resolution);for(var i of this._environmentService.isAutoTest?["720p","1024p","540p","480p","360p","288p"]:["480p","720p","360p","540p","1024p","288p"]){var o=t(i);if("object"===(0,ec._)(o))return o.v}return{url:e.originUrl,resolution:"origin"}}getPhotoOrderedResolutionInfo(){return((0,a.Y2)((0,Y.R)(this.value)),this.value.order)?((0,a.Y2)(this.value.order.url),{url:this.value.order.url,resolution:"origin"}):this.getContentResolutionInfo()}_getResolutionKeyByLongSide(e,t){var r=100,i=null;for(var o of[1024,720,540,480,360,288]){var n=void 0;(n=e>t?Math.abs(o-e):Math.abs(o-t))<r&&(r=n,i=o)}if(!!i)return"".concat(i,"p")}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._photoDataService.batchGetPhotos({resourceIds:[e.value.resourceId]})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._photoDataService=i,this._environmentService=o}}eu=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,ea.B),(0,n.fM)(4,q.Y),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IPhotoMeta?Object:IPhotoMeta,void 0===g.tx?Object:g.tx,void 0===ea.B?Object:ea.B,void 0===q.Y?Object:q.Y])],eu);class ed extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(eu,[e,t]))}constructor(e){super(e),this._instantiationService=e}}ed=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],ed);var ev=(0,$.yh)("curve-preset-data-service");class eh extends X{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileFilter(){return e=>"config.json"===e}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._curvePresetDataService.batchGetCurvePresetsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._curvePresetDataService=i,this._configurationService=o}}eh=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,ev),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ICurvePresetMeta?Object:ICurvePresetMeta,void 0===g.tx?Object:g.tx,void 0===ev?Object:ev,void 0===ee.Ui?Object:ee.Ui])],eh);class el extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(eh,[e,t]))}constructor(e){super(e),this._instantiationService=e}}el=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],el);var e_=(0,$.yh)("integration-data-service");class eg extends V.i{getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}_createContentToken(e){var t=this._getContentResourceKey();return E({key:t,url:this.getContentUrl(e)},this._downloadService)}_getContentResourceKey(){return"".concat(this.key,"_content")}constructor(e,t,r){super(e,t),this.key=e,this._downloadService=r}}eg=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof Resource?Object:Resource,void 0===g.tx?Object:g.tx])],eg);class ey extends eg{getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._integrationDataService.batchGetIntegrationsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._integrationDataService=i,this._configurationService=o}}ey=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,e_),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IIntegrationMeta?Object:IIntegrationMeta,void 0===g.tx?Object:g.tx,void 0===e_?Object:e_,void 0===ee.Ui?Object:ee.Ui])],ey);class ep extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(ey,[e,t]))}constructor(e){super(e),this._instantiationService=e}}ep=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],ep);var ef=(0,$.yh)("object-lock-data-service");class eR extends eg{getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._objectLockDataService.batchGetObjectLocksByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId]})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._objectLockDataService=i,this._configurationService=o}}eR=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,ef),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IObjectLockMeta?Object:IObjectLockMeta,void 0===g.tx?Object:g.tx,void 0===ef?Object:ef,void 0===ee.Ui?Object:ee.Ui])],eR);class em extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(eR,[e,t]))}constructor(e){super(e),this._instantiationService=e}}em=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],em);var eS=(0,$.yh)("mask-data-service");class eT extends eg{getLightCoverResourceToken(){return this._getResourceTokenSync(this._createLightCoverToken.bind(this),()=>this._lightCoverResourceToken,e=>this._lightCoverResourceToken=e)}getDarkCoverResourceToken(){return this._getResourceTokenSync(this._createDarkCoverToken.bind(this),()=>this._darkCoverResourceToken,e=>this._darkCoverResourceToken=e)}_createDarkCoverToken(e){var t=this._getDarkCoverResourceKey();return A({key:t,url:e.themeIcon.dark.urlList[0],md5:e.md5},this._downloadService)}_createLightCoverToken(e){var t=this._getLightCoverResourceKey();return A({key:t,url:e.themeIcon.light.urlList[0],md5:e.md5},this._downloadService)}_getCoverResourceKey(){return"".concat(this.key,"_cover")}_getLightCoverResourceKey(){return"".concat(this._getCoverResourceKey(),"_light")}_getDarkCoverResourceKey(){return"".concat(this._getCoverResourceKey(),"_dark")}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._maskDataService.batchGetMasksByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._maskDataService=i,this._configurationService=o}}eT=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,eS),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IMaskMeta?Object:IMaskMeta,void 0===g.tx?Object:g.tx,void 0===eS?Object:eS,void 0===ee.Ui?Object:ee.Ui])],eT);class ek extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(eT,[e,t]))}constructor(e){super(e),this._instantiationService=e}}ek=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],ek);var eb=(0,$.yh)("transition-data-service");class ew extends L{getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}_getDownloadConfig(e){return{}}_createContentToken(e){var t=this._getContentResourceKey();return E({key:t,url:this.getContentUrl(e),md5:e.md5},this._downloadService,this._getDownloadConfig(e))}_getContentResourceKey(){return"".concat(this.key,"_content")}constructor(e,t,r){super(e,t,r),this.key=e,this._downloadService=r}}ew=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof Resource?Object:Resource,void 0===g.tx?Object:g.tx])],ew);class eI extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._transitionDataService.batchGetTransitionsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._transitionDataService=i,this._configurationService=o}}eI=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,eb),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ITransitionMeta?Object:ITransitionMeta,void 0===g.tx?Object:g.tx,void 0===eb?Object:eb,void 0===ee.Ui?Object:ee.Ui])],eI);class eM extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(eI,[e,t]))}constructor(e){super(e),this._instantiationService=e}}eM=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],eM);var eC=(0,$.yh)("audio-voice-data-service");class eO extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)((0,Y.R)(e.value));var[t,r]=(yield e._audioVoiceDataService.batchGetAudioVoicesByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._audioVoiceDataService=i,this._configurationService=o}}eO=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,eC),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IAudioVoiceMeta?Object:IAudioVoiceMeta,void 0===g.tx?Object:g.tx,void 0===eC?Object:eC,void 0===ee.Ui?Object:ee.Ui])],eO);class ex extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(eO,[e,t]))}constructor(e){super(e),this._instantiationService=e}}ex=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],ex);var ej=(0,$.yh)("video-background-data-service");class eF extends L{getCover(e){return e.previewUrl}getVideoBackgroundResourceToken(){return this._getResourceTokenSync(this._createVideoBackgroundResourceToken.bind(this),()=>this._videoBackgroundResourceToken,e=>this._videoBackgroundResourceToken=e)}_createVideoBackgroundResourceToken(e){var t=e.package.urlList[0];return A({key:this._getVideoBackgroundResourceResourceKey(),url:t},this._downloadService,this._getDownloadConfig(e))}_getVideoBackgroundResourceResourceKey(){return"".concat(this.key,"_resource")}_getDownloadConfig(e){return{withCredentials:e.isFromBrand}}doFetch(){var e=this;return(0,v._)(function*(){var[t,r]=(yield e._videoBackgroundDataService.batchGetVideoBackgroundsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._videoBackgroundDataService=i,this._configurationService=o}}eF=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,ej),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IVideoBackgroundMeta?Object:IVideoBackgroundMeta,void 0===g.tx?Object:g.tx,void 0===ej?Object:ej,void 0===ee.Ui?Object:ee.Ui])],eF);class eU extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(eF,[e,t]))}constructor(e){super(e),this._instantiationService=e}}eU=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],eU);var eK=r("926838"),eD=r("312518"),eA=r("584072"),eE=Y.R;(0,$.yh)("user-video-resource-service");class eB extends V.i{getCoverResourceToken(){return this._getResourceTokenSync(this._createCoverToken.bind(this),()=>this._coverResourceToken,e=>this._coverResourceToken=e)}_createCoverToken(e){var t=this._getCoverResourceKey(),{url:r,decryptKey:i,shouldAutoDecrypt:o}=this.getCover(e);return A({key:t,url:r,decryptKey:i,shouldAutoDecrypt:o,encryptType:_.PS.AES_CBC},this._downloadService)}_getCoverResourceKey(){return"".concat(this.key,"_cover")}constructor(e,t,r){super(e,t),this.key=e,this._downloadService=r}}eB=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof Resource?Object:Resource,void 0===g.tx?Object:g.tx])],eB);class eP extends eB{isSupportFastImport(){return this._onFastImportDefer.promise}getOriginResourceToken(){return this._getResourceTokenSync(this._createOriginResourceToken.bind(this),()=>this._userVideoOriginResourceToken,e=>this._userVideoOriginResourceToken=e)}getPreviewResourceToken(){return this._getResourceTokenSyncWithCondition(e=>{if(!!e)return this._createPreviewResourceToken()},()=>this._userVideoPreviewResourceToken,e=>this._userVideoPreviewResourceToken=e,this._onFastImportDefer)}_doResourceReady(e){var t=this,r=()=>super._doResourceReady;return(0,v._)(function*(){if((0,a.Y2)(eE(t.value)),t._isOriginUserFile(t.value.url)){var[i,o]=(yield t._evercloudTokenDataService.getEvercloudToken()).pair();!i&&(t._liveRequestToken=o.token)}r().call(t,e)})()}getCover(e){(0,a.Y2)(e.cover);var t=e.cover.key;return{url:e.cover.url,decryptKey:t,shouldAutoDecrypt:!!t,encryptType:_.PS.AES_CBC}}getUserVideoResourceToken(){return this._getResourceTokenSync(this._createEncryptedUserVideoResourceToken.bind(this),()=>this._userVideoEncryptedResourceToken,e=>this._userVideoEncryptedResourceToken=e)}getUserVideoDecryptedResourceToken(){return this._getResourceTokenSync(this._createDecryptedUserVideoResourceToken.bind(this),()=>this._userVideoResourceToken,e=>this._userVideoResourceToken=e)}getCoverResourceToken(){var e,t,r=this.value;return!r.cover&&(null===(t=r.uploading)||void 0===t||null===(e=t.generateCoverTrigger)||void 0===e||e.call(t)),this._getResourceTokenSyncWithCondition(this._createCoverToken.bind(this),()=>this._coverResourceToken,e=>this._coverResourceToken=e,this._onCoverDefer)}getThumbResourceTokens(){var e=this;return(0,v._)(function*(){if(!e._userVideoThumbResourceTokens){var t,r,i;null===(i=e.value)||void 0===i||null===(r=i.uploading)||void 0===r||null===(t=r.generateThumbTrigger)||void 0===t||t.call(r)}return(yield e._onThumbDefer.promise,e._userVideoThumbResourceTokens)?e._userVideoThumbResourceTokens:(e._userVideoThumbResourceTokens=e._createUserVideoThumbTokens(e.value),e._userVideoThumbResourceTokens)})()}_createDecryptedUserVideoResourceToken(e){(0,a.Y2)(eE(this.value));var t=this._environmentService.isAutoTest||this._environmentService.highQuality?["720p","540p","480p","360p"]:["480p","360p","540p","720p"];for(var r of((0,a.Y2)(e.videoTranscodeInfo,"videoTranscodeInfo should not be undefined!"),t)){var i=e.videoTranscodeInfo[r],{url:o,key:n}=null!=i?i:{};if(o)return A({key:this._getResolutionResourceKey(r),url:o,decryptKey:n,shouldAutoDecrypt:!!n,encryptType:_.PS.AES_CBC},this._downloadService)}(0,a.ss)("UserVideoResource::_createDecryptedUserVideoResourceToken no appropriate resolution")}_createEncryptedUserVideoResourceToken(e){(0,a.Y2)(eE(this.value));var t=this._environmentService.isAutoTest||this._environmentService.highQuality?["720p","480p","360p","540p"]:["480p","360p","540p","720p"];for(var r of((0,a.Y2)(e.videoTranscodeInfo,"videoTranscodeInfo should not be undefined!"),t)){var i=e.videoTranscodeInfo[r],{url:o,key:n}=null!=i?i:{};if(o)return A({key:this._getResolutionResourceKey(r),url:o,decryptKey:n,shouldAutoDecrypt:!1,encryptType:_.PS.AES_CBC},this._downloadService)}(0,a.ss)("UserVideoResource::_createEncryptedUserVideoResourceToken no appropriate resolution")}_createUserVideoThumbTokens(e){(0,a.Y2)(e.thumb);var{singleFrameWidth:t,singleFrameHeight:r}=e.thumb.common;return this._userVideoThumbResourceTokens=e.thumb.details.map(e=>{var i=this._getThumbResourceKey(e.url),o={frameCount:e.frameCount,singleFrameWidth:t,singleFrameHeight:r,imageWidth:e.imageWidth,imageHeight:e.imageHeight};return A((0,h._)({key:i,url:e.url,decryptKey:e.encryptedKey,shouldAutoDecrypt:!!e.encryptedKey,encryptType:_.PS.AES_CBC},o),this._downloadService)}),this._userVideoThumbResourceTokens}_createPreviewResourceToken(){var e,t=this.value;return(0,a.Y2)(null===(e=t.uploading)||void 0===e?void 0:e.blobUrl),A({key:"".concat(this.key,"_fast_import"),url:t.uploading.blobUrl},this._downloadService)}_createOriginResourceToken(e){return(0,a.Y2)(eE(e)),A({key:"".concat(this.key,"_origin"),url:e.url},this._downloadService,this.downloadConfig)}_createCoverToken(){var e,t=this.value;return(0,a.Y2)(t.cover),A({key:this._getCoverResourceKey(),url:t.cover.url,decryptKey:null!==(e=t.cover.key)&&void 0!==e?e:"",shouldAutoDecrypt:!!t.cover.key,encryptType:_.PS.AES_CBC},this._downloadService)}_getResolutionResourceKey(e){return"".concat(this.key,"_resolution_").concat(e)}_getThumbResourceKey(e){return"".concat(this.key?"".concat(this.key,"_"):"","thumb_").concat(e)}doFetch(){return new Promise(e=>{(0,a.Y2)(!eE(this.value)),this.value.onProgress(e=>{Object.assign(this.value,e),this._checkAndMarkResourceToken()}),this.value.onReady(t=>{if(Object.assign(this.value,t),!eE(this.value))(0,Y.K)(this.value),this._checkAndMarkResourceToken(),(0,a.Y2)(eE(this.value)),e(this.value)})})}get downloadConfig(){if(this._liveRequestToken)return{headers:{"x-everphoto-global-session-token":this._liveRequestToken,"x-everphoto-token":this._liveRequestToken}}}_isOriginUserFile(e){return(0,a.Y2)(eE(this.value)),!!e&&!!e.match(/origin/)}_checkAndMarkResourceToken(){var e,t,r,i=this.value;(null===(e=i.uploading)||void 0===e?void 0:e.isSupportFastImport)&&(null===(t=i.uploading)||void 0===t?void 0:t.file)&&this._onFastImportDefer.resolve(!0),(i.status===eK.a.Success||(null===(r=i.uploading)||void 0===r?void 0:r.isSupportFastImport)===!1)&&this._onFastImportDefer.resolve(!1),i.thumb&&!this._userVideoThumbResourceTokens&&this._onThumbDefer.resolve(),i.cover&&this._onCoverDefer.resolve()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._evercloudTokenDataService=i,this._environmentService=o,this._onFastImportDefer=(0,eA.PQ)(),this._onThumbDefer=(0,eA.PQ)(),this._onCoverDefer=(0,eA.PQ)(),this._checkAndMarkResourceToken()}}eP=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,eD.o),(0,n.fM)(4,q.Y),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IUserVideoMeta?Object:IUserVideoMeta,void 0===g.tx?Object:g.tx,void 0===eD.o?Object:eD.o,void 0===q.Y?Object:q.Y])],eP);class eY extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(eP,[e,t]))}constructor(e){super(e),this._instantiationService=e}}eY=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],eY);var eV=(0,$.yh)("text-motion-data-service");class eL extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._textMotionDataService.batchGetTextMotionsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._textMotionDataService=i,this._configurationService=o}}eL=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,eV),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ITextMotionMeta?Object:ITextMotionMeta,void 0===g.tx?Object:g.tx,void 0===eV?Object:eV,void 0===ee.Ui?Object:ee.Ui])],eL);class eN extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(eL,[e,t]))}constructor(e){super(e),this._instantiationService=e}}eN=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],eN);var eG=(0,$.yh)("video-motion-data-service");class eH extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._videoMotionDataService.batchGetVideoMotionsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._videoMotionDataService=i,this._configurationService=o}}eH=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,eG),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IVideoMotionMeta?Object:IVideoMotionMeta,void 0===g.tx?Object:g.tx,void 0===eG?Object:eG,void 0===ee.Ui?Object:ee.Ui])],eH);class eW extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(eH,[e,t]))}constructor(e){super(e),this._instantiationService=e}}eW=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],eW);var eq=(0,$.yh)("sticker-motion-data-service");class ez extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._stickerMotionDataService.batchGetStickerMotionsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._stickerMotionDataService=i,this._configurationService=o}}ez=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,eq),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IStickerMotionMeta?Object:IStickerMotionMeta,void 0===g.tx?Object:g.tx,void 0===eq?Object:eq,void 0===ee.Ui?Object:ee.Ui])],ez);class eQ extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(ez,[e,t]))}constructor(e){super(e),this._instantiationService=e}}eQ=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],eQ);var eZ=r("582558");class e$ extends eB{isSupportFastImport(){return this._onFastImportDefer.promise}getOriginResourceToken(){return this._getResourceTokenSync(this._createOriginResourceToken.bind(this),()=>this._userPhotoOriginResourceToken,e=>this._userPhotoOriginResourceToken=e)}_waitPreviewResourceUrlReady(){var e=this;return(0,v._)(function*(){var t,r,i=e.value;i.uploading&&!i.uploading.blobUrl&&i.uploading.waitBlobUrlReady&&(yield null===(t=(r=i.uploading).waitBlobUrlReady)||void 0===t?void 0:t.call(r))})()}getPreviewResourceToken(){var e=this;return(0,v._)(function*(){return yield e._waitPreviewResourceUrlReady(),e._getResourceTokenSyncWithCondition(t=>{if(!!t)return e._createPreviewResourceToken()},()=>e._userPhotoPreviewResourceToken,t=>e._userPhotoPreviewResourceToken=t,e._onFastImportDefer)})()}_createOriginResourceToken(e){return(0,a.Y2)((0,eZ.wS)(e)),A({key:"".concat(this.key,"_origin"),url:e.url},this._downloadService)}getCoverResourceToken(){var e,t,r=this.value;return!r.cover&&(null===(t=r.uploading)||void 0===t||null===(e=t.generateCoverTrigger)||void 0===e||e.call(t)),this._getResourceTokenSyncWithCondition(this._createCoverToken.bind(this),()=>this._coverResourceToken,e=>this._coverResourceToken=e,this._onCoverDefer)}getCover(e){(0,a.Y2)(e.cover);var t=e.cover.key;return{url:e.cover.url,decryptKey:t,shouldAutoDecrypt:!!t,encryptType:_.PS.AES_CBC}}getUserPhotoResourceToken(){return this.getResolutionResourceTokenByQueue(this._environmentService.isAutoTest||this._environmentService.highQuality?eZ.pE:eZ._W)}getResolutionResourceTokenByQueue(e){return this._getResourceTokenSync(t=>{(0,a.Y2)(t.imgTranscodeInfo,"imgTranscodeInfo should not be undefined!");var r=this._getBestResolution(t,e);return this._allResolutionResourceTokens[r]?this._allResolutionResourceTokens[r]:this._createUserPhotoResourceTokenByKey(r)},()=>{if(this.status===R.n.complete){(0,a.Y2)((0,eZ.wS)(this.value));var t=this._getBestResolution(this.value,e);return this._allResolutionResourceTokens[t]}},t=>{(0,a.Y2)((0,eZ.wS)(this.value));var r=this._getBestResolution(this.value,e);if(!this._allResolutionResourceTokens[r])this._allResolutionResourceTokens[r]=t})}getAllResolutionResourceTokens(){return this._getResourceTokenAsync(this._createAllResolutionResourceTokens.bind(this),()=>{if(0!==Object.keys(this._allResolutionResourceTokens).length)return this._allResolutionResourceTokens},e=>this._allResolutionResourceTokens=e)}getResourceTokenByFuzzyMatchWidth(e){(0,a.Y2)((0,eZ.wS)(this.value));var t,r="",i=0,o="";for(var n in this.value.imgTranscodeInfo){var s=this.value.imgTranscodeInfo[n];if("width"in s&&"height"in s){var c=Math.max(s.width,s.height);if(c>i&&(i=c,o=n),c>=e){if(t&&c>t)continue;t=c,r=n}}}return(!r&&(r=o),this._allResolutionResourceTokens[r])?this._allResolutionResourceTokens[r]:this._createUserPhotoResourceTokenByKey(r)}_createUserPhotoResourceTokenByKey(e){(0,a.Y2)((0,eZ.wS)(this.value)),(0,a.Y2)(this.value.imgTranscodeInfo,"imgTranscodeInfo should not be undefined!");var{url:t,key:r,decryptType:i}=this.value.imgTranscodeInfo[e];return A({key:this._getResolutionResourceKey(e),url:t,decryptKey:r,shouldAutoDecrypt:!!r,encryptType:null!=i?i:_.PS.AES_CBC},this._downloadService)}_createAllResolutionResourceTokens(e){return(0,a.Y2)(e.imgTranscodeInfo),Object.keys(e.imgTranscodeInfo).reduce((e,t)=>e[t]?e:(e[t]=this._createUserPhotoResourceTokenByKey(t),e),{})}_createPreviewResourceToken(){var e,t=this.value;return(0,a.Y2)(null===(e=t.uploading)||void 0===e?void 0:e.blobUrl),A({key:"".concat(this.key,"_fast_import"),url:t.uploading.blobUrl},this._downloadService)}_createCoverToken(){var e,t,r=this.value;return(0,a.Y2)(r.cover),A({key:this._getCoverResourceKey(),url:r.cover.url,md5:r.md5,decryptKey:null!==(e=r.cover.key)&&void 0!==e?e:"",shouldAutoDecrypt:!!r.cover.key,encryptType:null!==(t=r.cover.decryptType)&&void 0!==t?t:_.PS.AES_CBC},this._downloadService)}_getResolutionResourceKey(e){return"".concat(this.key,"_resolution_").concat(e)}doFetch(){return new Promise(e=>{(0,a.Y2)(!(0,eZ.wS)(this.value)),this.value.onProgress(e=>{Object.assign(this.value,e),this._checkAndMarkResourceToken()}),this.value.onReady(t=>{if(Object.assign(this.value,t),!(0,eZ.wS)(this.value))(0,Y.K)(this.value),this._checkAndMarkResourceToken(),(0,a.Y2)((0,eZ.wS)(this.value)),e(this.value)})})}_checkAndMarkResourceToken(){var e,t,r,i=this.value;(null===(e=i.uploading)||void 0===e?void 0:e.isSupportFastImport)&&(null===(t=i.uploading)||void 0===t?void 0:t.file)&&this._onFastImportDefer.resolve(!0),(i.status===eK.a.Success||(null===(r=i.uploading)||void 0===r?void 0:r.isSupportFastImport)===!1)&&this._onFastImportDefer.resolve(!1),i.cover&&this._onCoverDefer.resolve()}_getBestResolution(e,t){for(var r of((0,a.Y2)(e.imgTranscodeInfo,"imgTranscodeInfo should not be undefined!"),t)){var i,{url:o}=null!==(i=e.imgTranscodeInfo[r])&&void 0!==i?i:{};if(o)return r}(0,a.ss)("UserPhotoResource::_getBestResolution no appropriate resolution")}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._evercloudTokenDataService=i,this._environmentService=o,this._onFastImportDefer=(0,eA.PQ)(),this._onCoverDefer=(0,eA.PQ)(),this._allResolutionResourceTokens={},this._checkAndMarkResourceToken()}}e$=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,eD.o),(0,n.fM)(4,q.Y),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IUserPhotoMeta?Object:IUserPhotoMeta,void 0===g.tx?Object:g.tx,void 0===eD.o?Object:eD.o,void 0===q.Y?Object:q.Y])],e$);class eJ extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(e$,[e,t]))}constructor(e){super(e),this._instantiationService=e}}eJ=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],eJ);var eX=(0,$.yh)("auto-beauty-data-service");class e0 extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._autoBeautyDataService.batchGetAutoBeautyByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],resourceType:u._g.AutoBeautyBody,source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));var i=r.list[0];return(0,h._)({type:e.value.type},i)})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._autoBeautyDataService=i,this._configurationService=o}}e0=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,eX),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IAutoBeautyBodyMeta?Object:IAutoBeautyBodyMeta,void 0===g.tx?Object:g.tx,void 0===eX?Object:eX,void 0===ee.Ui?Object:ee.Ui])],e0);class e2 extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(e0,[e,t]))}constructor(e){super(e),this._instantiationService=e}}e2=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],e2);class e6 extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._autoBeautyDataService.batchGetAutoBeautyByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],resourceType:u._g.AutoBeautyFace,source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));var i=r.list[0];return(0,h._)({type:e.value.type},i)})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._autoBeautyDataService=i,this._configurationService=o}}e6=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,eX),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IAutoBeautyFaceMeta?Object:IAutoBeautyFaceMeta,void 0===g.tx?Object:g.tx,void 0===eX?Object:eX,void 0===ee.Ui?Object:ee.Ui])],e6);class e4 extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(e6,[e,t]))}constructor(e){super(e),this._instantiationService=e}}e4=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],e4);class e1 extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._autoBeautyDataService.batchGetAutoBeautyByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],resourceType:u._g.AutoBeautyShape,source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));var i=r.list[0];return(0,h._)({type:e.value.type},i)})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._autoBeautyDataService=i,this._configurationService=o}}e1=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,eX),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IAutoBeautyShapeMeta?Object:IAutoBeautyShapeMeta,void 0===g.tx?Object:g.tx,void 0===eX?Object:eX,void 0===ee.Ui?Object:ee.Ui])],e1);class e5 extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(e1,[e,t]))}constructor(e){super(e),this._instantiationService=e}}e5=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],e5);class e3 extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._autoBeautyDataService.batchGetAutoBeautyByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],resourceType:u._g.AutoBeautyMakeup,source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));var i=r.list[0];return(0,h._)({type:e.value.type},i)})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._autoBeautyDataService=i,this._configurationService=o}}e3=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,eX),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IAutoBeautyMakeupMeta?Object:IAutoBeautyMakeupMeta,void 0===g.tx?Object:g.tx,void 0===eX?Object:eX,void 0===ee.Ui?Object:ee.Ui])],e3);class e8 extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(e3,[e,t]))}constructor(e){super(e),this._instantiationService=e}}e8=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],e8);var e7=r("325398");class e9 extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}_getDownloadConfig(e){return{withCredentials:e.isFromBrand}}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value)),"dreamina"===e.value.sourceFrom&&(0,a.ss)("");var[t,r]=(yield e._fontDataService.batchGetFontsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._fontDataService=i,this._configurationService=o}}e9=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,e7.H),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IFontMeta?Object:IFontMeta,void 0===g.tx?Object:g.tx,void 0===e7.H?Object:e7.H,void 0===ee.Ui?Object:ee.Ui])],e9);class te extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(e9,[e,t]))}constructor(e){super(e),this._instantiationService=e}}te=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],te);var tt=(0,$.yh)("sticker-data-service");class tr extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}_getDownloadConfig(e){return{withCredentials:e.isFromBrand}}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._stickerDataService.batchGetStickersByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._stickerDataService=i,this._configurationService=o}}tr=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,tt),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IStickerMeta?Object:IStickerMeta,void 0===g.tx?Object:g.tx,void 0===tt?Object:tt,void 0===ee.Ui?Object:ee.Ui])],tr);class ti extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(tr,[e,t]))}constructor(e){super(e),this._instantiationService=e}}ti=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],ti);var to=r("702095"),tn=Y.R;(0,$.yh)("user-file-resource-service");class ts extends V.i{getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}_createContentToken(e){var t=this._getFileResourceKey();return B({key:t,url:this.getContentUrl(e)},this._downloadService)}_getFileResourceKey(){return"".concat(this.key,"_file")}constructor(e,t,r){super(e,t),this.key=e,this._downloadService=r}}ts=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof Resource?Object:Resource,void 0===g.tx?Object:g.tx])],ts);class tc extends ts{getFileUniqueId(){return(0,a.Y2)((0,Y.R)(this.value),"resource is not ready yet! please ensure resource is ready before call this function."),this.value.sourceType===to.ov.EverCloud?this.value.assetId:this.value.vid}getUserFileResourceToken(){return this._getResourceTokenSync(this._createEncryptedUserFileResourceToken.bind(this),()=>this._userFileEncryptedResourceToken,e=>this._userFileEncryptedResourceToken=e)}_createEncryptedUserFileResourceToken(e){var t=this._getFileResourceKey(),r=this.getContentUrl(e),{decryptKey:i=""}=e;return B({key:t,url:r,encryptType:_.PS.AES_CBC,shouldAutoDecrypt:!1,decryptKey:i},this._downloadService)}getContentUrl(e){return(0,a.ZB)(e.url,"un expect fullResource url"),e.url}_createContentToken(e){var t=this._getFileResourceKey(),r=this.getContentUrl(e),{decryptKey:i}=e;return i?B({key:t,url:r,encryptType:_.PS.AES_CBC,shouldAutoDecrypt:!0,decryptKey:i},this._downloadService):B({key:t,url:r},this._downloadService)}doFetch(){return new Promise(e=>{(0,a.Y2)(!(0,Y.R)(this.value)),this.value.onProgress(e=>{Object.assign(this.value,e)}),this.value.onReady(t=>{Object.assign(this.value,t),(0,Y.K)(this.value),(0,a.Y2)(tn(this.value)),e(this.value)})})}constructor(e,t,r){super(e,t,r),this.key=e,this._downloadService=r}}tc=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IUserFileMeta?Object:IUserFileMeta,void 0===g.tx?Object:g.tx])],tc);class ta extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(tc,[e,t]))}constructor(e){super(e),this._instantiationService=e}}ta=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],ta);var tu=Y.R;(0,$.yh)("user-audio-resource-service");class td extends V.i{isSupportFastImport(){return this._onFastImportDefer.promise}getPreviewResourceToken(){return this._getResourceTokenSyncWithCondition(e=>{if(!!e)return this._createPreviewResourceToken()},()=>this._previewResourceToken,e=>this._previewResourceToken=e,this._onFastImportDefer)}getOriginResourceToken(){return this._getResourceTokenSync(this._createOriginResourceToken.bind(this),()=>this._userAudioOriginResourceToken,e=>this._userAudioOriginResourceToken=e)}_createOriginResourceToken(e){return(0,a.Y2)(tu(e)),A({key:"".concat(this.key,"_origin"),url:e.url},this._downloadService)}getUserAudioResourceToken(){return this._getResourceTokenSync(this._createUserAudioResourceToken.bind(this),()=>this._userAudioResourceToken,e=>this._userAudioResourceToken=e)}_createUserAudioResourceToken(e){(0,a.Y2)((0,Y.R)(this.value));for(var t of((0,a.Y2)(e.audioTranscodeInfo,"audioTranscodeInfo should not be undefined!"),["128kb"])){var{url:r,key:i}=e.audioTranscodeInfo[t];if(r)return A({key:this._getResolutionResourceKey(t),url:r,md5:e.md5,decryptKey:i,shouldAutoDecrypt:!1,encryptType:_.PS.AES_CBC},this._downloadService)}(0,a.ss)("UserAudioResource::_createUserAudioResourceToken no appropriate resolution")}_createPreviewResourceToken(){var e,t=this.value;return(0,a.Y2)(null===(e=t.uploading)||void 0===e?void 0:e.blobUrl),A({key:"".concat(this.key,"_fast_import"),url:t.uploading.blobUrl},this._downloadService)}_getResolutionResourceKey(e){return"".concat(this.key,"_resolution_").concat(e)}doFetch(){return new Promise(e=>{(0,a.Y2)(!(0,Y.R)(this.value)),this.value.onProgress(e=>{Object.assign(this.value,e),this._checkAndMarkResourceToken()}),this.value.onReady(t=>{if(Object.assign(this.value,t),!(0,Y.R)(this.value))(0,Y.K)(this.value),this._checkAndMarkResourceToken(),(0,a.Y2)((0,Y.R)(this.value)),e(this.value)})})}_checkAndMarkResourceToken(){var e,t,r,i=this.value;(null===(e=i.uploading)||void 0===e?void 0:e.isSupportFastImport)&&(null===(t=i.uploading)||void 0===t?void 0:t.file)&&this._onFastImportDefer.resolve(!0),(i.status===eK.a.Success||(null===(r=i.uploading)||void 0===r?void 0:r.isSupportFastImport)===!1)&&this._onFastImportDefer.resolve(!1)}constructor(e,t,r,i){super(e,t),this.key=e,this._downloadService=r,this._evercloudTokenDataService=i,this._onFastImportDefer=(0,eA.PQ)(),this._checkAndMarkResourceToken()}}td=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,eD.o),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IUserAudioMeta?Object:IUserAudioMeta,void 0===g.tx?Object:g.tx,void 0===eD.o?Object:eD.o])],td);class tv extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(td,[e,t]))}constructor(e){super(e),this._instantiationService=e}}tv=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],tv);var th=(0,$.yh)("video-template-data-service");class tl extends L{getThumbResourceTokens(){return this._getResourceTokenAsync(this._createThumbResourceTokens.bind(this),()=>this._thumbResourceTokens,e=>this._thumbResourceTokens=e)}getBuiltinResourceTokens(){return this._getResourceTokenAsync(this._createBuiltinResourceTokens.bind(this),()=>this._builtinResourceTokens,e=>this._builtinResourceTokens=e)}getCover(e){return e.cover.url}_createThumbResourceTokens(e){return e.encryptedSprites.map(e=>{var{count:t,url:r}=e,i={frameCount:e.count,singleFrameWidth:e.width/e.x,singleFrameHeight:e.height/e.y,imageWidth:e.width,imageHeight:e.height},o="".concat(this.key,"_thumb_").concat(t);return A((0,h._)({key:o,url:r},i),this._downloadService)})}_createBuiltinResourceTokens(e){return e.preload.builtIns.map(e=>{var{md5:t,url:r,aes:i,key:o}=e;return o?A({key:"".concat(t,"_").concat(o.slice(0,6)),url:r,decryptKey:o,shouldAutoDecrypt:i,encryptType:_.PS.AES_GCM},this._downloadService):A({key:t,url:r},this._downloadService)})}doFetch(){var e=this;return(0,v._)(function*(){if(!e._jsonpTemplate){var t,r,[i,o]=(yield e._videoTemplateDataService.getVideoTemplatesByJsonp()).pair(),n=null==o?void 0:o.list[0];!i&&n&&(e._jsonpTemplate=n)}if((null===(t=e._jsonpTemplate)||void 0===t?void 0:t.id)===e.value.id)return(0,h._)({type:e.value.type},e._jsonpTemplate);var{searchParams:s,pathname:c}=new URL(window.location.href);r="tiktok_anchor"===s.get("utm_medium")?"tiktok_anchor_template_ccweb":c.startsWith("/editor-template")?"template_editor":"editor";var[a,u]=(yield e._videoTemplateDataService.batchGetVideoTemplatesByIds({ids:[e.value.id],enterFrom:r})).pair();if(a)throw Error("doFetch error-".concat(a.code,"-").concat(a.msg),{cause:a.code});return(0,h._)({type:e.value.type},u.list[0])})()}setOriginVideoAlgorithmInfo(e){this._originVideoAlgorithmInfo=e}getOriginVideoAlgorithmInfo(){return this._originVideoAlgorithmInfo}constructor(e,t,r,i){super(e,t,r),this.key=e,this._downloadService=r,this._videoTemplateDataService=i}}tl=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,th),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IVideoTemplateMeta?Object:IVideoTemplateMeta,void 0===g.tx?Object:g.tx,void 0===th?Object:th])],tl);class t_ extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(tl,[e,t]))}constructor(e){super(e),this._instantiationService=e}}t_=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],t_);class tg extends V.i{getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}_createContentToken(e){var t=this._getContentResourceKey();return A({key:t,url:this.getContentUrl(e),md5:e.md5},this._downloadService)}_getContentResourceKey(){return"".concat(this.key,"_content")}getContentUrl(e){return e.package.urlList[0]}doFetch(){(0,a.ss)("not support do fetch single model")}constructor(e,t,r){super(e,t),this.key=e,this._downloadService=r}}tg=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IArithmeticModelMeta?Object:IArithmeticModelMeta,void 0===g.tx?Object:g.tx])],tg);class ty extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(tg,[e,t]))}constructor(e){super(e),this._instantiationService=e}}ty=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],ty);var tp=(0,$.yh)("effect-data-service");class tf extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._effectDataService.batchGetEffectsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],effectResourceType:e.value.type,source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._effectDataService=i,this._configurationService=o}}tf=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,tp),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IEffectMeta?Object:IEffectMeta,void 0===g.tx?Object:g.tx,void 0===tp?Object:tp,void 0===ee.Ui?Object:ee.Ui])],tf);class tR extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(tf,[e,t]))}constructor(e){super(e),this._instantiationService=e}}tR=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],tR);var tm=((o={}).Loki="loki",o.Heycan="heycan",o),tS=(0,$.yh)("tone-data-service");class tT extends X{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileFilter(){return e=>"config.json"===e}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var t=e._configurationService.getAppConfigurationValue("toolbar.tts.fromHeycan"),[r,i]=(yield e._toneDataService.batchGetTonesByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source},t?tm.Heycan:tm.Loki)).pair();if(r)throw Error("doFetch error-".concat(r.code,"-").concat(r.msg));return(0,h._)({type:e.value.type},i.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._toneDataService=i,this._configurationService=o}}tT=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,tS),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IToneMeta?Object:IToneMeta,void 0===g.tx?Object:g.tx,void 0===tS?Object:tS,void 0===ee.Ui?Object:ee.Ui])],tT);class tk extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(tT,[e,t]))}constructor(e){super(e),this._instantiationService=e}}tk=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],tk);var tb=(0,$.yh)("filter-data-service");class tw extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileFilter(){return e=>e.endsWith(".json")}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._filterDataService.batchGetFiltersByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._filterDataService=i,this._configurationService=o}}tw=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,tb),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IFilterMeta?Object:IFilterMeta,void 0===g.tx?Object:g.tx,void 0===tb?Object:tb,void 0===ee.Ui?Object:ee.Ui])],tw);class tI extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(tw,[e,t]))}constructor(e){super(e),this._instantiationService=e}}tI=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],tI);var tM=(0,$.yh)("curve-speed-data-service");class tC extends X{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileFilter(){return e=>"config.json"===e}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._curveSpeedDataService.batchGetCurveSpeedsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._curveSpeedDataService=i,this._configurationService=o}}tC=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,tM),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ICurveSpeedMeta?Object:ICurveSpeedMeta,void 0===g.tx?Object:g.tx,void 0===tM?Object:tM,void 0===ee.Ui?Object:ee.Ui])],tC);class tO extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(tC,[e,t]))}constructor(e){super(e),this._instantiationService=e}}tO=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],tO);var tx=(0,$.yh)("mix-data-service");class tj extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileMix(){return e=>e.endsWith(".json")}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._mixDataService.batchGetMixsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._mixDataService=i,this._configurationService=o}}tj=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,tx),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IMixMeta?Object:IMixMeta,void 0===g.tx?Object:g.tx,void 0===tx?Object:tx,void 0===ee.Ui?Object:ee.Ui])],tj);class tF extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(tj,[e,t]))}constructor(e){super(e),this._instantiationService=e}}tF=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],tF);var tU=(0,$.yh)("text-preset-service");class tK extends ew{getPresetSchemaResourceToken(){return this._getResourceTokenSync(this._createPresetSchemaToken.bind(this),()=>this._presetSchemaResourceToken,e=>this._presetSchemaResourceToken=e)}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}_getDownloadConfig(e){return{withCredentials:e.isFromBrand}}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value)),(0,a.Y2)(e.value.resourceId,"text preset should have an resource id");var[t,r]=(yield e._textPresetDataService.getTextByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}_createPresetSchemaToken(e){return(0,a.ZB)(e.presetSchemaUrl),A({key:this._getPresetSchemaResourceKey(),url:e.presetSchemaUrl},this._downloadService,{withCredentials:!0})}_getPresetSchemaResourceKey(){return"".concat(this.key,"_preset_schema")}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._textPresetDataService=i,this._configurationService=o}}tK=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,tU),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ITextPresetMeta?Object:ITextPresetMeta,void 0===g.tx?Object:g.tx,void 0===tU?Object:tU,void 0===ee.Ui?Object:ee.Ui])],tK);class tD extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(tK,[e,t]))}constructor(e){super(e),this._instantiationService=e}}tD=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],tD);var tA=r("929753"),tE=(0,$.yh)("text-template-service"),tB=(0,$.yh)("text-motion-resource-service"),tP=(0,$.yh)("video-motion-resource-service"),tY=(0,$.yh)("sticker-motion-resource-service"),tV=(0,$.yh)("font-resource-service"),tL=(0,$.yh)("sticker-resource-service"),tN=(0,$.yh)("text-preset-resource-service"),tG=(0,$.yh)("shape-animation-resource-service");function tH(e,t){for(var r of Object.keys(t))if(t[r]===e)return r;(0,a.ss)("no match resource type for panel ".concat(e))}var tW=r("487059");class tq extends ew{getPresetSchemaResourceToken(){return this._getResourceTokenSync(this._createPresetSchemaToken.bind(this),()=>this._presetSchemaResourceToken,e=>this._presetSchemaResourceToken=e)}_createPresetSchemaToken(e){return(0,a.ZB)(e.presetSchemaUrl),A({key:this._getPresetSchemaResourceKey(),url:e.presetSchemaUrl},this._downloadService,{withCredentials:!0})}_getPresetSchemaResourceKey(){return"".concat(this.key,"_preset_schema")}getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._textTemplateDataService.getTextByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId]})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}_getResourceKey(e){return"".concat(e.type,"_").concat(e.key)}_doResourceReady(e){super._doResourceReady(e),this.parseAndInitChildResources()}parseAndInitChildResources(){for(var e of this.dependencyResources)switch(e.type){case u._g.Font:this._fontResourceService.add(this._getResourceKey(e),(0,tA._)((0,h._)({},e),{key:this._getResourceKey(e),resourceId:e.key}));break;case u._g.TextMotion:this._textMotionResourceService.add(this._getResourceKey(e),(0,tA._)((0,h._)({},e),{key:this._getResourceKey(e),resourceId:e.key}));break;case u._g.StickerMotion:this._stickerMotionResourceService.add(this._getResourceKey(e),(0,tA._)((0,h._)({},e),{key:this._getResourceKey(e),resourceId:e.key}));break;case u._g.Sticker:this._stickerResourceService.add(this._getResourceKey(e),(0,tA._)((0,h._)({},e),{key:this._getResourceKey(e),resourceId:e.key}));break;case u._g.TextPreset:this._textPresetResourceService.add(this._getResourceKey(e),(0,tA._)((0,h._)({},e),{key:this._getResourceKey(e),resourceId:e.key}));break;case u._g.ShapeAnimation:this._shapeAnimationResourceService.add(this._getResourceKey(e),(0,tA._)((0,h._)({},e),{key:this._getResourceKey(e),resourceId:e.key}));break;case u._g.SystemFonts:break;default:(0,a.ss)("unsupported child resource type in text template resource!")}}getBuiltinContentTokens(){return this.dependencyResources.map(e=>{switch(e.type){case u._g.Font:var t=this._fontResourceService.get(this._getResourceKey(e));return(0,a.Y2)(t),t.getContentResourceToken();case u._g.TextMotion:var r=this._textMotionResourceService.get(this._getResourceKey(e));return(0,a.Y2)(r),r.getContentResourceToken();case u._g.StickerMotion:var i=this._stickerMotionResourceService.get(this._getResourceKey(e));return(0,a.Y2)(i),i.getContentResourceToken();case u._g.Sticker:var o=this._stickerResourceService.get(this._getResourceKey(e));return(0,a.Y2)(o),o.getContentResourceToken();case u._g.TextPreset:var n=this._textPresetResourceService.get(this._getResourceKey(e));return(0,a.Y2)(n),n.getContentResourceToken();case u._g.ShapeAnimation:var s=this._shapeAnimationResourceService.get(this._getResourceKey(e));return(0,a.Y2)(s),s.getContentResourceToken();case u._g.SystemFonts:return;default:(0,a.ss)("unsupported child resource type in text template resource!")}}).filter(e=>void 0!==e)}get dependencyResources(){var e;return(0,a.Y2)((0,Y.R)(this.value),"resource is not ready yet! please call this function after resource ready."),(null!==(e=this.value.dependentResources)&&void 0!==e?e:[]).map(e=>((0,a.Y2)(e.resourceId,"dependency resource should have a resource id"),{type:tH(tW.j7[e.type]||e.type,this._configurationService.resourcePanel),source:e.source,key:e.resourceId}))}constructor(e,t,r,i,o,n,s,c,a,u,d,v){super(e,t,u),this.key=e,this._fontResourceService=r,this._stickerResourceService=i,this._textPresetResourceService=o,this._textMotionResourceService=n,this._videoMotionResourceService=s,this._stickerMotionResourceService=c,this._shapeAnimationResourceService=a,this._downloadService=u,this._textTemplateDataService=d,this._configurationService=v}}tq=(0,n.gn)([(0,n.fM)(9,g.tx),(0,n.fM)(10,tE),(0,n.fM)(11,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ITextTemplateMeta?Object:ITextTemplateMeta,void 0===tV?Object:tV,void 0===tL?Object:tL,void 0===tN?Object:tN,void 0===tB?Object:tB,void 0===tP?Object:tP,void 0===tY?Object:tY,void 0===tG?Object:tG,void 0===g.tx?Object:g.tx,void 0===tE?Object:tE,void 0===ee.Ui?Object:ee.Ui])],tq);class tz extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(tq,[e,t,this._fontResourceService,this._stickerResourceService,this._textPresetResourceService,this._textMotionResourceService,this._videoMotionResourceService,this._stickerMotionResourceService,this._shapeAnimationResourceService]))}constructor(e,t,r,i,o,n,s,c){super(c),this._fontResourceService=e,this._stickerResourceService=t,this._textPresetResourceService=r,this._textMotionResourceService=i,this._videoMotionResourceService=o,this._stickerMotionResourceService=n,this._shapeAnimationResourceService=s,this._instantiationService=c}}tz=(0,n.gn)([(0,n.fM)(7,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===tV?Object:tV,void 0===tL?Object:tL,void 0===tN?Object:tN,void 0===tB?Object:tB,void 0===tP?Object:tP,void 0===tY?Object:tY,"undefined"==typeof IShapeAnimationResourceService?Object:IShapeAnimationResourceService,void 0===c.T?Object:c.T])],tz);var tQ=r("211809");class tZ extends L{getCover(e){return e.coverUrl}getGifResourceToken(){return this._getResourceTokenSync(this._createGifResourceToken.bind(this),()=>this._gifResourceToken,e=>this._gifResourceToken=e)}_createGifResourceToken(e){var{animatedUrl:t,key:r}=e;return A({key:r,url:t},this._downloadService)}doFetch(){var e=this;return(0,v._)(function*(){var[t,r]=(yield e._gifDataService.getGifsByIds({ids:[e.value.key]})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i){super(e,t,r),this.key=e,this._downloadService=r,this._gifDataService=i}}tZ=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,tQ.N),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IGifMeta?Object:IGifMeta,void 0===g.tx?Object:g.tx,void 0===tQ.N?Object:tQ.N])],tZ);class t$ extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(tZ,[e,t]))}constructor(e){super(e),this._instantiationService=e}}t$=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],t$);var tJ=(0,$.yh)("bubble-data-service");class tX extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileBubble(){return e=>e.endsWith(".json")}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._bubbleDataService.batchGetBubblesByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._bubbleDataService=i,this._configurationService=o}}tX=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,tJ),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IBubbleMeta?Object:IBubbleMeta,void 0===g.tx?Object:g.tx,void 0===tJ?Object:tJ,void 0===ee.Ui?Object:ee.Ui])],tX);class t0 extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(tX,[e,t]))}constructor(e){super(e),this._instantiationService=e}}t0=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],t0);var t2=(0,$.yh)("shape-animation-data-service");class t6 extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFileShapeAnimation(){return e=>e.endsWith(".json")}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._shapeAnimationDataService.batchGetShapeAnimationsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._shapeAnimationDataService=i,this._configurationService=o}}t6=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,t2),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IShapeAnimationMeta?Object:IShapeAnimationMeta,void 0===g.tx?Object:g.tx,void 0===t2?Object:t2,void 0===ee.Ui?Object:ee.Ui])],t6);class t4 extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(t6,[e,t]))}constructor(e){super(e),this._instantiationService=e}}t4=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],t4);var t1=(0,$.yh)("graffiti-data-service");class t5 extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._graffitiDataService.batchGetGraffitisByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._graffitiDataService=i,this._configurationService=o}}t5=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,t1),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IGraffitiMeta?Object:IGraffitiMeta,void 0===g.tx?Object:g.tx,void 0===t1?Object:t1,void 0===ee.Ui?Object:ee.Ui])],t5);class t3 extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(t5,[e,t]))}constructor(e){super(e),this._instantiationService=e}}t3=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],t3);var t8=(0,$.yh)("path-animation-data-service");class t7 extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}get contentFilePathAnimation(){return e=>e.endsWith(".json")}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._pathAnimationDataService.batchGetPathAnimationsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId]})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._pathAnimationDataService=i,this._configurationService=o}}t7=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,t8),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IPathAnimationMeta?Object:IPathAnimationMeta,void 0===g.tx?Object:g.tx,void 0===t8?Object:t8,void 0===ee.Ui?Object:ee.Ui])],t7);class t9 extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(t7,[e,t]))}constructor(e){super(e),this._instantiationService=e}}t9=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],t9);class re extends eg{getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._aiAvatarMaskDataService.batchGetAiAvatarMaskByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId]})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._aiAvatarMaskDataService=i,this._configurationService=o}}re=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,eS),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IAiAvatarMaskMeta?Object:IAiAvatarMaskMeta,void 0===g.tx?Object:g.tx,void 0===eS?Object:eS,void 0===ee.Ui?Object:ee.Ui])],re);class rt extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(re,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rt=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rt);var rr=(0,$.yh)("emoji-data-service");class ri extends eg{getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._emojiDataService.batchGetEmojisByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._emojiDataService=i,this._configurationService=o}}ri=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,rr),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IEmojiMeta?Object:IEmojiMeta,void 0===g.tx?Object:g.tx,void 0===rr?Object:rr,void 0===ee.Ui?Object:ee.Ui])],ri);class ro extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(ri,[e,t]))}constructor(e){super(e),this._instantiationService=e}}ro=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],ro);var rn=(0,$.yh)("smart-color-adjust-data-service");class rs extends eg{getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._smartColorAdjustDataService.batchGetSmartColorAdjustsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._smartColorAdjustDataService=i,this._configurationService=o}}rs=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,rn),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ISmartColorAdjustMeta?Object:ISmartColorAdjustMeta,void 0===g.tx?Object:g.tx,void 0===rn?Object:rn,void 0===ee.Ui?Object:ee.Ui])],rs);class rc extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rs,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rc=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rc);var ra=(0,$.yh)("brand-data-service");class ru extends ew{getCover(e){return e.coverUrl}getContentUrl(e){return e.itemUrl}get contentFileFilter(){return e=>e.endsWith(".json")}_getDownloadConfig(e){return{withCredentials:!0}}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._brandDataService.getBrandAdjustmentPresetsByIds({ids:[e.value.id]})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._configurationService=i,this._brandDataService=o}}ru=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,ee.Ui),(0,n.fM)(4,ra),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IAdjustmentPresetMeta?Object:IAdjustmentPresetMeta,void 0===g.tx?Object:g.tx,void 0===ee.Ui?Object:ee.Ui,void 0===ra?Object:ra])],ru);class rd extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(ru,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rd=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rd);var rv=(0,$.yh)("digital-human-data-service");class rh extends ew{getCover(e){return e.coverUrl}_getDigitalResourceKey(){return"".concat(this.key,"_video")}_createDigitalResourceToken(e){var{originUrl:t}=e;return A({key:this._getDigitalResourceKey(),url:t,md5:e.md5},this._downloadService)}getDigitalResourceToken(){return this._getResourceTokenSync(this._createDigitalResourceToken.bind(this),()=>this._digitalResourceToken,e=>this._digitalResourceToken=e)}getContentUrl(e){return e.previewVideo.originUrl}getDigitalHumanResourceToken(){return this._getResourceTokenSync(this._createDigitalHumanResourceToken.bind(this),()=>this._digitalResourceToken,e=>this._digitalResourceToken=e)}_createDigitalHumanResourceToken(e){var{originUrl:t}=e;return A({key:this._getDigitalHumanResourceKey(),url:t,md5:e.md5},this._downloadService)}_getDigitalHumanResourceKey(){return"".concat(this.key,"_digital_human_").concat(this.value.resourceId)}getThumbResourceTokens(){return this._getResourceTokenAsync(this._createVideoThumbTokens.bind(this),()=>this._thumbResourceTokens,e=>this._thumbResourceTokens=e)}_createVideoThumbTokens(e){return e.previewVideo.thumb.details.map(t=>{var r=this._getThumbResourceKey(t.url),{singleFrameWidth:i,singleFrameHeight:o}=e.previewVideo.thumb.common,n={frameCount:t.frameCount,singleFrameWidth:i,singleFrameHeight:o,imageWidth:t.imageWidth,imageHeight:t.imageHeight};return A((0,h._)({key:r,url:t.url},n),this._downloadService,this._getDownloadConfig(e))})}_getThumbResourceKey(e){return"".concat(this.key,"_thumb_").concat(e)}doFetch(){var e=this;return(0,v._)(function*(){var[t,r]=(yield e._digitalHumanDataService.getDigitalHumanByIds({resourceIds:[e.value.resourceId]})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o,n){super(e,t,r),this.key=e,this._downloadService=r,this._configurationService=i,this._videoDataService=o,this._digitalHumanDataService=n}}rh=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,ee.Ui),(0,n.fM)(4,l.u),(0,n.fM)(5,rv),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IDigitalHumanMeta?Object:IDigitalHumanMeta,void 0===g.tx?Object:g.tx,void 0===ee.Ui?Object:ee.Ui,void 0===l.u?Object:l.u,void 0===rv?Object:rv])],rh);class rl extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rh,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rl=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rl);var r_=(0,$.yh)("image-figure-effect-data-service");class rg extends L{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}_createContentToken(e){var t=this._getContentResourceKey();return P({key:t,url:this.getContentUrl(e)},this._downloadService)}_getContentResourceKey(){return"".concat(this.key,"_content")}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._imageFigureEffectDataService.batchGetHeycanEffectByIds({resourceIds:[e.value.resourceId]})).pair();if(t)throw Error("doFetch error ".concat(t.code));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._imageFigureEffectDataService=i,this._configurationService=o}}rg=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,r_),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IImageFigureEffectMeta?Object:IImageFigureEffectMeta,void 0===g.tx?Object:g.tx,void 0===r_?Object:r_,void 0===ee.Ui?Object:ee.Ui])],rg);class ry extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rg,[e,t]))}constructor(e){super(e),this._instantiationService=e}}ry=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],ry);var rp=(0,$.yh)("image-filter-data-service");new TextDecoder("utf-8");class rf extends L{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}getContentResourceToken(){return this._getResourceTokenSync(this._createContentToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}_createContentToken(e){var t=this._getContentResourceKey();return P({key:t,url:this.getContentUrl(e)},this._downloadService)}_getContentResourceKey(){return"".concat(this.key,"_content")}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._imageFilterDataService.batchGetImageFiltersByIds({enterFrom:e._configurationService.editorCategory,list:[{ids:[e.value.resourceId],type:e._configurationService.resourcePanel[u._g.ImageEffect]}]})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._imageFilterDataService=i,this._configurationService=o}}rf=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,rp),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IImageFilterMeta?Object:IImageFilterMeta,void 0===g.tx?Object:g.tx,void 0===rp?Object:rp,void 0===ee.Ui?Object:ee.Ui])],rf);class rR extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rf,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rR=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rR);var rm=(0,$.yh)("subtitle-template-service");class rS extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._subtitleTemplateDataService.getSubtitleTemplateByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId]})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}_getResourceKey(e){return"".concat(e.type,"_").concat(e.key)}_doResourceReady(e){super._doResourceReady(e),this.parseAndInitChildResources()}parseAndInitChildResources(){for(var e of this.dependencyResources)switch(e.type){case u._g.Font:this._fontResourceService.add(this._getResourceKey(e),(0,tA._)((0,h._)({},e),{key:this._getResourceKey(e),resourceId:e.key}));break;case u._g.TextMotion:this._textMotionResourceService.add(this._getResourceKey(e),(0,tA._)((0,h._)({},e),{key:this._getResourceKey(e),resourceId:e.key}));break;case u._g.StickerMotion:this._stickerMotionResourceService.add(this._getResourceKey(e),(0,tA._)((0,h._)({},e),{key:this._getResourceKey(e),resourceId:e.key}));break;case u._g.Sticker:this._stickerResourceService.add(this._getResourceKey(e),(0,tA._)((0,h._)({},e),{key:this._getResourceKey(e),resourceId:e.key}));break;case u._g.TextPreset:this._textPresetResourceService.add(this._getResourceKey(e),(0,tA._)((0,h._)({},e),{key:this._getResourceKey(e),resourceId:e.key}));break;case u._g.ShapeAnimation:this._shapeAnimationResourceService.add(this._getResourceKey(e),(0,tA._)((0,h._)({},e),{key:this._getResourceKey(e),resourceId:e.key}));break;case u._g.SystemFonts:break;default:(0,a.ss)("unsupported child resource type in text template resource!")}}getBuiltinContentTokens(){return this.dependencyResources.map(e=>{switch(e.type){case u._g.Font:var t=this._fontResourceService.get(this._getResourceKey(e));return(0,a.Y2)(t),t.getContentResourceToken();case u._g.TextMotion:var r=this._textMotionResourceService.get(this._getResourceKey(e));return(0,a.Y2)(r),r.getContentResourceToken();case u._g.StickerMotion:var i=this._stickerMotionResourceService.get(this._getResourceKey(e));return(0,a.Y2)(i),i.getContentResourceToken();case u._g.Sticker:var o=this._stickerResourceService.get(this._getResourceKey(e));return(0,a.Y2)(o),o.getContentResourceToken();case u._g.TextPreset:var n=this._textPresetResourceService.get(this._getResourceKey(e));return(0,a.Y2)(n),n.getContentResourceToken();case u._g.ShapeAnimation:var s=this._shapeAnimationResourceService.get(this._getResourceKey(e));return(0,a.Y2)(s),s.getContentResourceToken();case u._g.SystemFonts:return;default:(0,a.ss)("unsupported child resource type in text template resource!")}}).filter(e=>void 0!==e)}get dependencyResources(){var e;return(0,a.Y2)((0,Y.R)(this.value),"resource is not ready yet! please call this function after resource ready."),(null!==(e=this.value.dependentResources)&&void 0!==e?e:[]).filter(e=>e.type!==u._g.SystemFonts).map(e=>((0,a.Y2)(e.resourceId,"dependency resource should have a resource id"),{type:tH(tW.hR[e.type]||e.type,this._configurationService.resourcePanel),source:e.source,key:e.resourceId}))}constructor(e,t,r,i,o,n,s,c,a,u,d,v){super(e,t,u),this.key=e,this._fontResourceService=r,this._stickerResourceService=i,this._textPresetResourceService=o,this._textMotionResourceService=n,this._videoMotionResourceService=s,this._stickerMotionResourceService=c,this._shapeAnimationResourceService=a,this._downloadService=u,this._subtitleTemplateDataService=d,this._configurationService=v}}rS=(0,n.gn)([(0,n.fM)(9,g.tx),(0,n.fM)(10,rm),(0,n.fM)(11,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ISubtitleTemplateMeta?Object:ISubtitleTemplateMeta,void 0===tV?Object:tV,void 0===tL?Object:tL,void 0===tN?Object:tN,void 0===tB?Object:tB,void 0===tP?Object:tP,void 0===tY?Object:tY,void 0===tG?Object:tG,void 0===g.tx?Object:g.tx,void 0===rm?Object:rm,void 0===ee.Ui?Object:ee.Ui])],rS);class rT extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rS,[e,t,this._fontResourceService,this._stickerResourceService,this._textPresetResourceService,this._textMotionResourceService,this._videoMotionResourceService,this._stickerMotionResourceService,this._shapeAnimationResourceService]))}constructor(e,t,r,i,o,n,s,c){super(c),this._fontResourceService=e,this._stickerResourceService=t,this._textPresetResourceService=r,this._textMotionResourceService=i,this._videoMotionResourceService=o,this._stickerMotionResourceService=n,this._shapeAnimationResourceService=s,this._instantiationService=c}}rT=(0,n.gn)([(0,n.fM)(7,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===tV?Object:tV,void 0===tL?Object:tL,void 0===tN?Object:tN,void 0===tB?Object:tB,void 0===tP?Object:tP,void 0===tY?Object:tY,"undefined"==typeof IShapeAnimationResourceService?Object:IShapeAnimationResourceService,void 0===c.T?Object:c.T])],rT);class rk extends L{getCover(e){return e.coverUrl}doFetch(){(0,a.ss)("dreamina user ai video should not trigger doFetch ")}getVideoResourceToken(){return this._getResourceTokenSync(this._createDreaminaAiVideoResourceToken.bind(this),()=>this._dreaminaAiVideoResourceToken,e=>this._dreaminaAiVideoResourceToken=e)}_createDreaminaAiVideoResourceToken(e){(0,a.Y2)((0,Y.R)(e));var t=e.video.originVideo.videoUrl,{key:r}=e;return this._dreaminaAiVideoResourceToken=A({key:r,url:t},this._downloadService),this._dreaminaAiVideoResourceToken}constructor(e,t,r){super(e,t,r),this.key=e,this._downloadService=r}}rk=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IDreaminaAiVideoMeta?Object:IDreaminaAiVideoMeta,void 0===g.tx?Object:g.tx])],rk);class rb extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rk,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rb=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rb);class rw extends L{getVideoResolutionInfo(){var e,t;return(0,a.Y2)((0,Y.R)(this.value)),{url:null!==(t=null===(e=this.value.video)||void 0===e?void 0:e.originVideo.videoUrl)&&void 0!==t?t:"",resolution:"origin"}}getThumbResourceTokens(){return this._getResourceTokenAsync(this._createUserVideoThumbTokens.bind(this),()=>this._dreaminaVideoThumbResourceTokens,e=>this._dreaminaVideoThumbResourceTokens=e)}getCover(e){return e.coverUrl}doFetch(){(0,a.ss)("dreamina user ai video should not trigger doFetch ")}getVideoResourceToken(){return this._getResourceTokenSync(this._createDreaminaUserAiVideoResourceToken.bind(this),()=>this._dreaminaUserAiVideoResourceToken,e=>this._dreaminaUserAiVideoResourceToken=e)}_createDreaminaUserAiVideoResourceToken(e){(0,a.Y2)((0,Y.R)(e)),(0,a.Y2)(null==e?void 0:null===(r=e.video)||void 0===r?void 0:null===(t=r.originVideo)||void 0===t?void 0:t.videoUrl);var t,r,i=e.video.originVideo.videoUrl,{key:o}=e,n=this._getVideoResourceKey(o,i);return this._dreaminaUserAiVideoResourceToken=A({key:n,url:i},this._downloadService),this._dreaminaUserAiVideoResourceToken}_getVideoResourceKey(e,t){return"".concat(e,"_").concat(t)}_getThumbResourceKey(e){return"".concat(this.key?"".concat(this.key,"_"):"","thumb_").concat(e)}_createUserVideoThumbTokens(e){(0,a.Y2)(null===(t=e.video)||void 0===t?void 0:t.thumb);var t,r,i,{singleFrameWidth:o,singleFrameHeight:n}=null===(r=e.video)||void 0===r?void 0:r.thumb.thumbCommonInfo;return this._dreaminaVideoThumbResourceTokens=null===(i=e.video)||void 0===i?void 0:i.thumb.detailInfos.map(e=>{var t=this._getThumbResourceKey(e.url),r={frameCount:e.frameCount,singleFrameWidth:o,singleFrameHeight:n,imageWidth:e.imageWidth,imageHeight:e.imageHeight};return A((0,h._)({key:t,url:e.url},r),this._downloadService)}),this._dreaminaVideoThumbResourceTokens}constructor(e,t,r,i){super(e,t,r),this.key=e,this._downloadService=r,this._environmentService=i,(0,Y.K)(this.value)}}rw=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,q.Y),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IDreaminaUserAiVideoMeta?Object:IDreaminaUserAiVideoMeta,void 0===g.tx?Object:g.tx,void 0===q.Y?Object:q.Y])],rw);class rI extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rw,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rI=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rI);class rM extends L{getCover(e){return e.coverUrl}doFetch(){(0,a.ss)("dreamina user ai video should not trigger doFetch ")}getVideoResourceToken(){return this._getResourceTokenSync(this._createDreaminaAiVideoResourceToken.bind(this),()=>this._dreaminaAiVideoResourceToken,e=>this._dreaminaAiVideoResourceToken=e)}_createDreaminaAiVideoResourceToken(e){(0,a.Y2)((0,Y.R)(e));var t=e.video.originVideo.videoUrl,{key:r}=e;return this._dreaminaAiVideoResourceToken=A({key:r,url:t},this._downloadService),this._dreaminaAiVideoResourceToken}constructor(e,t,r){super(e,t,r),this.key=e,this._downloadService=r}}rM=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IDreaminaShowcaseVideoMeta?Object:IDreaminaShowcaseVideoMeta,void 0===g.tx?Object:g.tx])],rM);class rC extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rM,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rC=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rC);var rO=(0,$.yh)("text-glow-data-service");class rx extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._textGlowDataService.batchGetTextGlowsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._textGlowDataService=i,this._configurationService=o}}rx=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,rO),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ITextGlowMeta?Object:ITextGlowMeta,void 0===g.tx?Object:g.tx,void 0===rO?Object:rO,void 0===ee.Ui?Object:ee.Ui])],rx);class rj extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rx,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rj=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rj);var rF=r("712823"),rU=["1024p","720p","540p","480p","360p","288p"];class rK extends L{getCover(e){return e.coverUrl}getContentResourceToken(){return this._getResourceTokenSync(this._createContentResourceToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}getContentResolutionInfo(){return(0,a.Y2)((0,Y.R)(this.value)),this._getPhotoDreaminaResolutionInfo(this.value)}getResourceTokenByFuzzyMatchWidth(e){for(var t of((0,a.Y2)((0,Y.R)(this.value)),this.value.transcode)){var r,i,o=Math.max(t.width,t.height);if(o>=e){if(i&&o>i)continue;i=o,r=t}}return!r&&(r=this.value.transcode[this.value.transcode.length-1]),A({key:this._getResolutionResourceKey(String(i)),url:r.url,md5:this.value.md5},this._downloadService)}_createCoverToken(e){return A({key:this._getCoverResourceKey(),url:this.getCover(e)},this._downloadService)}_createContentResourceToken(e){var{url:t,resolution:r}=this._getPhotoDreaminaResolutionInfo(e);return A({key:this._getResolutionResourceKey(r),url:t,md5:e.md5},this._downloadService)}_getResolutionResourceKey(e){return"".concat(this.key,"_resolution_").concat(e)}_getPhotoDreaminaResolutionInfo(e){var t=function(e){var t=r.find(t=>t.resolution===e);if(t)return{v:t}},r=e.transcode.map(t=>{var{url:r,width:i,height:o}=t;return{url:r,resolution:this._getResolutionKeyByLongSide(i,o,e.resolutionKeys)}}).filter(e=>e.resolution),i=e.resolutionKeys?e.resolutionKeys.map(e=>"".concat(e,"p")):["480p","720p","360p","540p","1024p","288p"],o=this._environmentService.isAutoTest?["720p","1024p","540p","480p","360p","288p"]:i;for(var n of(this._environmentService.highQuality&&(o=rU),o)){var s=t(n);if("object"===(0,ec._)(s))return s.v}return{url:e.coverUrl,resolution:"origin"}}getPhotoDreaminaOrderedResolutionInfo(){return(0,a.Y2)((0,Y.R)(this.value)),this.getContentResolutionInfo()}_getResolutionKeyByLongSide(e,t,r){var i=100,o=null;for(var n of null!=r?r:[1024,720,540,480,360,288]){var s=void 0;(s=e>t?Math.abs(n-e):Math.abs(n-t))<i&&(i=s,o=n)}if(!!o)return"".concat(o,"p")}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._photoDataService.batchGetPhotos({resourceIds:[e.value.resourceId]})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._photoDataService=i,this._environmentService=o}}rK=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,rF._),(0,n.fM)(4,q.Y),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IPhotoDreaminaMeta?Object:IPhotoDreaminaMeta,void 0===g.tx?Object:g.tx,void 0===rF._?Object:rF._,void 0===q.Y?Object:q.Y])],rK);class rD extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rK,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rD=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rD);var rA=(0,$.yh)("curve-hsl-data-service");class rE extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._curveHslDataService.batchGetCurveHslsByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._curveHslDataService=i,this._configurationService=o}}rE=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,rA),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ICurveHslMeta?Object:ICurveHslMeta,void 0===g.tx?Object:g.tx,void 0===rA?Object:rA,void 0===ee.Ui?Object:ee.Ui])],rE);class rB extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rE,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rB=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rB);class rP extends L{getCover(e){return e.url}doFetch(){(0,a.ss)("dreamina lipsync audio should not trigger doFetch ")}}class rY extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rP,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rY=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rY);var rV=r("680359"),rL=[360,480,720,1080,2400];class rN extends L{getCover(e){return e.coverUrl}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._videoDataService.batchGetVideos({resourceIds:[e.value.resourceId],historyRecordId:e.value.historyRecordId})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}getVideoResolutionInfo(){var e;return(0,a.Y2)((0,Y.R)(this.value)),{url:null!==(e=this.value.originVideo.url)&&void 0!==e?e:"",resolution:"origin"}}getVideoResourceToken(){return this._getResourceTokenSync(this._createDreaminaUserAiVideoResourceToken.bind(this),()=>this._videoDreaminaResourceToken,e=>this._videoDreaminaResourceToken=e)}getThumbResourceTokens(){return this._getResourceTokenAsync(this._createUserVideoThumbTokens.bind(this),()=>this._videoDreaminaThumbResourceTokens,e=>this._videoDreaminaThumbResourceTokens=e)}getCoverResourceTokenByFuzzyMatchWidth(e){(0,a.Y2)((0,Y.R)(this.value));var t,r,{coverUrlMap:i}=this.value,o={};for(var n of(rL.forEach(e=>{o[e]=i[e]}),Object.keys(o))){var s=Number(n);if(s>=e){if(r&&s>r)continue;r=s,t=o[s]}}return!t&&(t=this.value.coverUrl,r=200),(0,a.Y2)(t),A({key:this._getCoverResolutionResourceKey(String(r)),url:t},this._downloadService)}_getVideoResourceKey(e,t){return"".concat(e,"_").concat(t)}_getThumbResourceKey(e){return"".concat(this.key?"".concat(this.key,"_"):"","thumb_").concat(e)}_getCoverResolutionResourceKey(e){return"".concat(this.key,"_cover_resolution_").concat(e)}_createDreaminaUserAiVideoResourceToken(e){(0,a.Y2)((0,Y.R)(e)),(0,a.Y2)(null==e?void 0:null===(t=e.originVideo)||void 0===t?void 0:t.url);var t,{url:r}=e.originVideo,{key:i}=e,o=this._getVideoResourceKey(i,r);return this._videoDreaminaResourceToken=A({key:o,url:r},this._downloadService),this._videoDreaminaResourceToken}_createUserVideoThumbTokens(e){(0,a.Y2)(e.thumb);var{singleFrameWidth:t,singleFrameHeight:r}=e.thumb.thumbCommonInfo;return this._videoDreaminaThumbResourceTokens=e.thumb.detailInfos.map(e=>{var i=this._getThumbResourceKey(e.url),o={frameCount:e.frameCount,singleFrameWidth:t,singleFrameHeight:r,imageWidth:e.imageWidth,imageHeight:e.imageHeight};return A((0,h._)({key:i,url:e.url},o),this._downloadService)}),this._videoDreaminaThumbResourceTokens}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._videoDataService=i,this._environmentService=o}}rN=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,rV.Z),(0,n.fM)(4,q.Y),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IVideoDreaminaMeta?Object:IVideoDreaminaMeta,void 0===g.tx?Object:g.tx,void 0===rV.Z?Object:rV.Z,void 0===q.Y?Object:q.Y])],rN);class rG extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rN,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rG=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rG);var rH=(0,$.yh)("matting-stroke-data-service");class rW extends ew{getCover(e){return e.icon.urlList[0]}getContentUrl(e){return e.package.urlList[0]}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(!(0,Y.R)(e.value));var[t,r]=(yield e._mattingStrokeDataService.batchGetMattingStrokesByIds({enterFrom:e._configurationService.editorCategory,ids:[e.value.resourceId],source:e.value.source})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));return(0,h._)({type:e.value.type},r.list[0])})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._mattingStrokeDataService=i,this._configurationService=o}}rW=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,rH),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IMattingStrokeMeta?Object:IMattingStrokeMeta,void 0===g.tx?Object:g.tx,void 0===rH?Object:rH,void 0===ee.Ui?Object:ee.Ui])],rW);class rq extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rW,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rq=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rq);var rz=r("266049");class rQ extends ts{getContentUrl(e){return e.fileUrl}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)((0,Y.R)(e.value)),(0,a.Y2)(e.value.key,"text art should have an resource id");var[t,r]=(yield e._textArtDataService.queryTextArtItems({itemList:[{itemId:e.value.itemId,uriList:[e.value.fileUri]}]})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));var i="",o="",n=r.itemConfs[0];return(0,a.Y2)(n.uriToUrl,"error uriToUrl"),Object.keys(n.uriToUrl).forEach(e=>{i=e,o=n.uriToUrl[e]}),(0,tA._)((0,h._)({type:e.value.type,key:e.value.key},r),{resourceId:i,itemId:e.value.itemId,fileUrl:o,fileUri:i})})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._textArtDataService=i,this._configurationService=o}}rQ=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,rz.l),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ITextArtMeta?Object:ITextArtMeta,void 0===g.tx?Object:g.tx,void 0===rz.l?Object:rz.l,void 0===ee.Ui?Object:ee.Ui])],rQ);class rZ extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rQ,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rZ=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rZ);class r$ extends ts{getContentUrl(e){return e.fileUrl}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)((0,Y.R)(e.value)),(0,a.Y2)(e.value.key,"text art should have an resource id");var[t,r]=(yield e._textArtDataService.queryTextArtItems({itemList:[{itemId:e.value.itemId}]})).pair();if(t)throw Error("doFetch error-".concat(t.code,"-").concat(t.msg));var i=r.itemConfs[0];return{type:e.value.type,key:e.value.key,resourceId:i.iconFileUri,itemId:e.value.itemId,fileUrl:i.iconFileUrl,fileUri:i.iconFileUri,fontId:i.fontId,model:i.model,prompt:i.prompt}})()}constructor(e,t,r,i,o){super(e,t,r),this.key=e,this._downloadService=r,this._textArtDataService=i,this._configurationService=o}}r$=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,rz.l),(0,n.fM)(4,ee.Ui),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ITextArtIconMeta?Object:ITextArtIconMeta,void 0===g.tx?Object:g.tx,void 0===rz.l?Object:rz.l,void 0===ee.Ui?Object:ee.Ui])],r$);class rJ extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(r$,[e,t]))}constructor(e){super(e),this._instantiationService=e}}rJ=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],rJ);class rX extends L{getCover(e){return e.url}getContentResourceToken(){return this._getResourceTokenSync(this._createContentResourceToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}getContentResolutionInfo(){return(0,a.Y2)((0,Y.R)(this.value)),this._getImageSourceResolutionInfo(this.value)}getResourceTokenByFuzzyMatchWidth(e){var t,r;for(var i of((0,a.Y2)((0,Y.R)(this.value)),this.value.transcode))if(i.width>=e){if(r&&i.width>r)continue;r=i.width,t=i}return!t&&(t=this.value.transcode[this.value.transcode.length-1]),A({key:this._getResolutionResourceKey(String(r)),url:t.url,md5:this.value.uri},this._downloadService)}getAllResolutionResourceTokens(){return this._getResourceTokenAsync(this._createAllResolutionResourceTokens.bind(this),()=>{if(0!==Object.keys(this._allResolutionResourceTokens).length)return this._allResolutionResourceTokens},e=>this._allResolutionResourceTokens=e)}_createCoverToken(e){return A({key:this._getCoverResourceKey(),url:this.getCover(e)},this._downloadService)}_createAllResolutionResourceTokens(e){return(0,a.Y2)(e.transcode),e.transcode.reduce((e,t,r)=>e[t.width]?e:(e[t.width]=this._createUserPhotoResourceTokenByKey(r),e),{})}_createUserPhotoResourceTokenByKey(e){(0,a.Y2)((0,Y.R)(this.value)),(0,a.Y2)(this.value.transcode,"transcode should not be undefined!");var t=this.value.transcode[e],{url:r,width:i}=t;return A({key:this._getResolutionResourceKey(String(i)),url:r,md5:t.url},this._downloadService)}_createContentResourceToken(e){var{url:t,resolution:r}=this._getImageSourceResolutionInfo(e);return A({key:this._getResolutionResourceKey(r),url:t,md5:e.url},this._downloadService)}_getResolutionResourceKey(e){return"".concat(this.key,"_resolution_").concat(e)}_getImageSourceResolutionInfo(e){var t=function(e){var t=r.find(t=>t.resolution===e);if(t)return{v:t}},r=e.transcode.map(e=>{var{url:t,width:r,height:i}=e;return{url:t,resolution:this._getResolutionKeyByLongSide(r,i)}}).filter(e=>e.resolution);for(var i of this._environmentService.isAutoTest?["720p","1024p","540p","480p","360p","288p"]:["480p","720p","360p","540p","1024p","288p"]){var o=t(i);if("object"===(0,ec._)(o))return o.v}return{url:e.url,resolution:"origin"}}getImageSourceOrderedResolutionInfo(){return(0,a.Y2)((0,Y.R)(this.value)),this.getContentResolutionInfo()}_getResolutionKeyByLongSide(e,t,r){var i=100,o=null;for(var n of null!=r?r:[1024,720,540,480,360,288]){var s=void 0;(s=e>t?Math.abs(n-e):Math.abs(n-t))<i&&(i=s,o=n)}if(!!o)return"".concat(o,"p")}doFetch(){return(0,a.Y2)((0,Y.R)(this.value)),Promise.resolve(this.value)}constructor(e,t,r,i){super(e,t,r),this.key=e,this._downloadService=r,this._environmentService=i,this._allResolutionResourceTokens={}}}rX=(0,n.gn)([(0,n.fM)(2,g.tx),(0,n.fM)(3,q.Y),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof IImageSourceMeta?Object:IImageSourceMeta,void 0===g.tx?Object:g.tx,void 0===q.Y?Object:q.Y])],rX);class r0 extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(rX,[e,t]))}constructor(e){super(e),this._instantiationService=e}}r0=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],r0);var r2=r("998052");class r6 extends L{getCover(e){return e.url}getContentResourceToken(){return this._getResourceTokenSync(this._createContentResourceToken.bind(this),()=>this._contentResourceToken,e=>this._contentResourceToken=e)}getContentResolutionInfo(){return(0,a.Y2)((0,Y.R)(this.value)),this._getImageSourceResolutionInfo(this.value)}getResourceTokenByFuzzyMatchWidth(e){for(var t of((0,a.Y2)((0,Y.R)(this.value)),this.value.transcode)){var r,i,o=Math.max(t.width,t.height);if(o>=e){if(i&&o>i)continue;i=o,r=t}}return!r&&(r=this.value.transcode[this.value.transcode.length-1]),A({key:this._getResolutionResourceKey(String(i)),url:r.url},this._downloadService)}getAllResolutionResourceTokens(){return this._getResourceTokenAsync(this._createAllResolutionResourceTokens.bind(this),()=>{if(0!==Object.keys(this._allResolutionResourceTokens).length)return this._allResolutionResourceTokens},e=>this._allResolutionResourceTokens=e)}_createCoverToken(e){return A({key:this._getCoverResourceKey(),url:this.getCover(e)},this._downloadService)}_createAllResolutionResourceTokens(e){return(0,a.Y2)(e.transcode),e.transcode.reduce((e,t,r)=>e[t.width]?e:(e[t.width]=this._createUserPhotoResourceTokenByKey(r),e),{})}_createUserPhotoResourceTokenByKey(e){(0,a.Y2)((0,Y.R)(this.value)),(0,a.Y2)(this.value.transcode,"transcode should not be undefined!");var t=this.value.transcode[e],{url:r,width:i}=t;return A({key:this._getResolutionResourceKey(String(i)),url:r,md5:t.url},this._downloadService)}_createContentResourceToken(e){var{url:t,resolution:r}=this._getImageSourceResolutionInfo(e);return A({key:this._getResolutionResourceKey(r),url:t,md5:e.url},this._downloadService)}_getResolutionResourceKey(e){return"".concat(this.key,"_resolution_").concat(e)}_getImageSourceResolutionInfo(e){var t=function(e){var t=r.find(t=>t.resolution===e);if(t)return{v:t}},r=e.transcode.map(e=>{var{url:t,width:r,height:i}=e;return{url:t,resolution:this._getResolutionKeyByLongSide(r,i)}}).filter(e=>e.resolution);for(var i of this._environmentService.isAutoTest?["720p","1024p","540p","480p","360p","288p"]:["480p","720p","360p","540p","1024p","288p"]){var o=t(i);if("object"===(0,ec._)(o))return o.v}return{url:e.url,resolution:"origin"}}getImageSourceOrderedResolutionInfo(){return(0,a.Y2)((0,Y.R)(this.value)),this.getContentResolutionInfo()}_getResolutionKeyByLongSide(e,t,r){var i=100,o=null;for(var n of null!=r?r:[1024,720,540,480,360,288]){var s=void 0;(s=e>t?Math.abs(n-e):Math.abs(n-t))<i&&(i=s,o=n)}if(!!o)return"".concat(o,"p")}doFetch(){var e=this;return(0,v._)(function*(){(0,a.Y2)(e.value.templateId);var t,r,i=yield e._templateDataService.getCanvasDetail({itemId:e.value.templateId,packOptions:{packEverPhotoList:[{imageUri:e.value.key}]}});if(!i.ok)throw Error("doFetch error-".concat(i.code,"-").concat(i.msg));(0,a.Y2)(null===(t=i.value.everPhotoList)||void 0===t?void 0:t[0]);var o=i.value.everPhotoList[0];return{type:u._g.TemplatePhotoDreamina,key:o.imageUri,uri:o.imageUri,url:o.imageUrl,transcode:null===(r=Object.keys(o.coverUrlMap||{}))||void 0===r?void 0:r.map(e=>{var t=o.coverUrlMap[e];return{width:o.width,height:o.height,url:t,uri:o.imageUri}}),templateId:e.value.templateId,aspectRatio:o.width/o.height}})()}constructor(e,t,r,i,o){super(e,t,i),this.key=e,this._templateDataService=r,this._downloadService=i,this._environmentService=o,this._allResolutionResourceTokens={}}}r6=(0,n.gn)([(0,n.fM)(2,r2.W),(0,n.fM)(3,g.tx),(0,n.fM)(4,q.Y),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof IResourceKey?Object:IResourceKey,"undefined"==typeof ITemplatePhotoDreaminaMeta?Object:ITemplatePhotoDreaminaMeta,void 0===r2.W?Object:r2.W,void 0===g.tx?Object:g.tx,void 0===q.Y?Object:q.Y])],r6);class r4 extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(r6,[e,t]))}constructor(e){super(e),this._instantiationService=e}}r4=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],r4);class r1 extends L{getCover(e){return e.url}doFetch(){(0,a.ss)("vod video source should not trigger doFetch ")}}class r5 extends d{createResource(e,t){return this._instantiationService.createInstance(new s.M(r1,[e,t]))}constructor(e){super(e),this._instantiationService=e}}r5=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],r5);class r3{add(e,t){this._getChildResourceService(t.type).add(e,t)}get(e,t){return this._getChildResourceService(t).get(e)}delete(e,t){this._getChildResourceService(t).delete(e,t)}_getChildResourceService(e){var t=this._childResourceServices.get(e);if(!t){var r=this._childResourceServiceCreator.get(e);if((0,a.Y2)(r,"".concat(e," ResourceService has not register yet. please register it at the resource service constructor!")),r instanceof Function){var i=r();t=this._instantiationService.createInstance(i)}else t=this._instantiationService.createInstance(...r);this._childResourceServices.set(e,t)}return t}_buildTextTemplateResourceServiceSyncDescriptorCreator(){return()=>{var e=[u._g.Font,u._g.Sticker,u._g.TextPreset,u._g.TextMotion,u._g.VideoMotion,u._g.StickerMotion,u._g.ShapeAnimation].map(e=>this._getChildResourceService(e));return new s.M(tz,e)}}_buildSubtitleTemplateResourceServiceSyncDescriptorCreator(){return()=>{var e=[u._g.Font,u._g.Sticker,u._g.TextPreset,u._g.TextMotion,u._g.VideoMotion,u._g.StickerMotion,u._g.ShapeAnimation].map(e=>this._getChildResourceService(e));return new s.M(rT,e)}}constructor(e){this._childResourceServiceCreator=new Map,this._childResourceServices=new Map,this._instantiationService=e,this._childResourceServiceCreator.set(u._g.TextTemplate,this._buildTextTemplateResourceServiceSyncDescriptorCreator()),this._childResourceServiceCreator.set(u._g.SubtitleTemplate,this._buildSubtitleTemplateResourceServiceSyncDescriptorCreator()),this._childResourceServiceCreator.set(u._g.Font,[te]),this._childResourceServiceCreator.set(u._g.Video,[Q]),this._childResourceServiceCreator.set(u._g.Shape,[er]),this._childResourceServiceCreator.set(u._g.Photo,[ed]),this._childResourceServiceCreator.set(u._g.Audio,[es]),this._childResourceServiceCreator.set(u._g.Mask,[ek]),this._childResourceServiceCreator.set(u._g.Sticker,[ti]),this._childResourceServiceCreator.set(u._g.VideoTemplate,[t_]),this._childResourceServiceCreator.set(u._g.AutoBeautyBody,[e2]),this._childResourceServiceCreator.set(u._g.AutoBeautyFace,[e4]),this._childResourceServiceCreator.set(u._g.AutoBeautyShape,[e5]),this._childResourceServiceCreator.set(u._g.AutoBeautyMakeup,[e8]),this._childResourceServiceCreator.set(u._g.Bubble,[t0]),this._childResourceServiceCreator.set(u._g.VideoBackground,[eU]),this._childResourceServiceCreator.set(u._g.UserVideo,[eY]),this._childResourceServiceCreator.set(u._g.UserPhoto,[eJ]),this._childResourceServiceCreator.set(u._g.UserAudio,[tv]),this._childResourceServiceCreator.set(u._g.UserFile,[ta]),this._childResourceServiceCreator.set(u._g.Transition,[eM]),this._childResourceServiceCreator.set(u._g.TextMotion,[eN]),this._childResourceServiceCreator.set(u._g.VideoMotion,[eW]),this._childResourceServiceCreator.set(u._g.StickerMotion,[eQ]),this._childResourceServiceCreator.set(u._g.ArithmeticModel,[ty]),this._childResourceServiceCreator.set(u._g.Effects,[tR]),this._childResourceServiceCreator.set(u._g.FaceProp,[tR]),this._childResourceServiceCreator.set(u._g.Filter,[tI]),this._childResourceServiceCreator.set(u._g.CurveSpeed,[tO]),this._childResourceServiceCreator.set(u._g.Mix,[tF]),this._childResourceServiceCreator.set(u._g.TextPreset,[tD]),this._childResourceServiceCreator.set(u._g.Tone,[tk]),this._childResourceServiceCreator.set(u._g.VoiceChange,[ex]),this._childResourceServiceCreator.set(u._g.CurvePreset,[el]),this._childResourceServiceCreator.set(u._g.Integration,[ep]),this._childResourceServiceCreator.set(u._g.ObjectLock,[em]),this._childResourceServiceCreator.set(u._g.Gif,[t$]),this._childResourceServiceCreator.set(u._g.ShapeAnimation,[t4]),this._childResourceServiceCreator.set(u._g.Graffiti,[t3]),this._childResourceServiceCreator.set(u._g.PathAnimation,[t9]),this._childResourceServiceCreator.set(u._g.AiAvatarMask,[rt]),this._childResourceServiceCreator.set(u._g.Emoji,[ro]),this._childResourceServiceCreator.set(u._g.SmartColorAdjust,[rc]),this._childResourceServiceCreator.set(u._g.AdjustmentPreset,[rd]),this._childResourceServiceCreator.set(u._g.DigitalHuman,[rl]),this._childResourceServiceCreator.set(u._g.ImageFilter,[rR]),this._childResourceServiceCreator.set(u._g.ImageEffect,[rR]),this._childResourceServiceCreator.set(u._g.ImageFigureFaceEffect,[ry]),this._childResourceServiceCreator.set(u._g.ImageFigureMakeupEffect,[ry]),this._childResourceServiceCreator.set(u._g.ImageFigureBodyEffect,[ry]),this._childResourceServiceCreator.set(u._g.ImageFigureReshapeEffect,[ry]),this._childResourceServiceCreator.set(u._g.DreaminaAiVideo,[rb]),this._childResourceServiceCreator.set(u._g.DreaminaUserAiVideo,[rI]),this._childResourceServiceCreator.set(u._g.DreaminaShowCaseVideo,[rC]),this._childResourceServiceCreator.set(u._g.TextGlow,[rj]),this._childResourceServiceCreator.set(u._g.PhotoDreamina,[rD]),this._childResourceServiceCreator.set(u._g.CurveHSL,[rB]),this._childResourceServiceCreator.set(u._g.DreaminaLipSyncAudio,[rY]),this._childResourceServiceCreator.set(u._g.VideoDreamina,[rG]),this._childResourceServiceCreator.set(u._g.MattingStroke,[rq]),this._childResourceServiceCreator.set(u._g.TextArt,[rZ]),this._childResourceServiceCreator.set(u._g.TextArtIcon,[rJ]),this._childResourceServiceCreator.set(u._g.ImageSource,[r0]),this._childResourceServiceCreator.set(u._g.TemplatePhotoDreamina,[r4]),this._childResourceServiceCreator.set(u._g.VodVideoSource,[r5])}}r3=(0,n.gn)([(0,n.fM)(0,c.T),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===c.T?Object:c.T])],r3)},549947:function(e,t,r){function i(e){var t,r,i,n=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,i=Symbol.iterator);n--;){if(r&&null!=(t=e[r]))return t.call(e);if(i&&null!=(t=e[i]))return new o(t.call(e));r="@@asyncIterator",i="@@iterator"}throw TypeError("Object is not async iterable")}function o(e){function t(e){if(Object(e)!==e)return Promise.reject(TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return(o=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new o(e)}r.d(t,{_:function(){return i}})}}]);