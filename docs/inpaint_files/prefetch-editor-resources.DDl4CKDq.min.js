!function(e){"use strict";let t;var r=Object.defineProperty,s=(e,t,s)=>{var o,i,n;return o=e,i="symbol"!=typeof t?t+"":t,n=s,i in o?r(o,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[i]=n,s};let o="1.0.0.3674",i=[],n=!1,a=(e,t)=>{window.ccWebSlardar?window.ccWebSlardar(e,t):(i.push({method:e,params:t}),n||(n=!0,(()=>{let e=10,t=setInterval(()=>{e--,window.ccWebSlardar?(i.forEach(e=>{let{method:t,params:r}=e;window.ccWebSlardar(t,r)}),i=[],clearInterval(t)):e||clearInterval(t)},1e3)})()))},c={info:(...e)=>{console.info("[Prefetcher] ",...e)},report:(e,t,r)=>{console.info("[Prefetcher] ",e,t),a("sendEvent",{name:e,categories:{side_code_scm:o,...t},metrics:r})},error:(...e)=>{console.error("[Prefetcher] ",...e),a("captureException",{error:e})}},l=async(e,t,r)=>{var s;let o;if((e=>{let t=localStorage.getItem("prefetch_versions");return null!==t&&t.includes(e)})(t)||!Array.isArray(e))return;r.report("side_code_prefetch_resource_begin",{version:t,resourceCount:e.length});let i=0;if(e.length>0)for(let t of e)try{await fetch(t,{priority:"low"})}catch(e){i+=1,r.error(e)}r.report("side_code_prefetch_resource_success",{version:t,failedResourceCount:i,resourceCount:e.length}),s=t,null===(o=localStorage.getItem("prefetch_versions"))&&(o="#"),(o=`${s};${o}`).length>1e3&&o.slice(0,o.lastIndexOf(";")),localStorage.setItem("prefetch_versions",o)};var d=((t=d||{}).editor_page_resource="/editor-page-resource.json",t.editor_wasm_resource="/editor-wasm-resource.json",t);let h=async e=>{let t=await fetch(d.editor_page_resource,{credentials:"same-origin",priority:"low"}),r=t.headers.get("content-type");if(200!==t.status||"string"!=typeof r||!r.includes("application/json"))return[];let{list:s,scm:o}=await t.json(),i=Array.isArray(s)?s.length:0;return e.report("side_code_get_page_resource_success",{length:i,resource_list_scm:o}),i>0&&await l(s,`editor_page_${o}`,e),s},u=async e=>{let t=await fetch(d.editor_wasm_resource,{credentials:"same-origin",priority:"low"}),r=t.headers.get("content-type");if(200!==t.status||"string"!=typeof r||!r.includes("application/json"))return[];let{list:s,scm:o}=await t.json(),i=Array.isArray(s)?s.length:0;return e.report("side_code_get_wasm_resource_success",{length:i,resource_list_scm:o}),i>0&&await l(s,`editor_wasm_${o}`,e),s},{searchParams:_}=new URL(window.location.href),f=_.get("debug_prefetcher")?1e4:6e5;class g{constructor(e){s(this,"_pendingTask",null),s(this,"_prefetchCount",1),s(this,"_hasStarted",!1),s(this,"_domainFilter",()=>!0),this._logger=e}async startPrefetchTask(e=!0){c.info(`Start Task #${this._prefetchCount}`);try{let t=performance.now();await this.waitForIdlePeriod(),c.info(`Idle Period Reached #${this._prefetchCount}`),this._logger.report("side_code_start_prefetch",{times:this._prefetchCount}),this._pendingTask||(this._pendingTask=Promise.all([h(this._logger),u(this._logger)]),this._pendingTask.finally(()=>{this._pendingTask=null}),await this._pendingTask);let r=performance.now()-t;this._logger.report("side_code_end_prefetch",{times:this._prefetchCount,duration:r,newTask:this._pendingTask?"false":"true"}),this._prefetchCount++,e&&setTimeout(()=>{this.startPrefetchTask(!0)},f)}catch(e){this._pendingTask=null,this._logger.report("side_code_failed_prefetch",{times:this._prefetchCount}),this._logger.error(e)}}beginPollingNewEditorResources(){var e;setTimeout(()=>{this.startPrefetchTask()},f),null==(e=null==window?void 0:window.addEventListener)||e.call(window,"beforeunload",()=>{this._prefetchCount=-1,this.startPrefetchTask(!1),c.info("prefetch before unload, SCM:",o)})}waitForIdlePeriod(e=1e3,t=["resource"]){let r;let s=t=>{r&&clearTimeout(r),r=setTimeout(()=>{t(),clearTimeout(r)},e)};return new Promise(e=>{let r=new PerformanceObserver(t=>{t.getEntriesByType("resource").some(e=>this._domainFilter(e.name))&&s(()=>{e(),r.disconnect()})});r.observe({entryTypes:t}),s(()=>{e(),r.disconnect()})})}beginPrefetch(){this._hasStarted||(this._hasStarted=!0,this.startPrefetchTask().then(()=>{this.beginPollingNewEditorResources()}))}setDomainFilter(e){this._domainFilter=e}}let p=window._didInvokeBegin,w=new g(c);window.editorResourcePrefetcher=w,window.beginPrefetchEditorResources=()=>{w.beginPrefetch(),c.info("Begin prefetch editor resources, SCM",o)},p&&window.beginPrefetchEditorResources(),e.EditorResourcePrefetcher=g,e.editorResourcePrefetcher=w,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}({});