"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["3744"],{300226:function(e,t,i){i.r(t),i.d(t,{abChannelDomain:function(){return o},argusSDK:function(){return v},sladarInitDomain:function(){return u},sladarPluginPathPrefix:function(){return c},slardarBid:function(){return l},slardarURL:function(){return d},teaChannel:function(){return r},teaChannelDomain:function(){return n},ttWidUnionHost:function(){return a},webmssdkURL:function(){return s}});let r="cn",n="https://mcs-normal-sg.capcutapi.com",o="https://vmweb-normal-sg.capcutapi.com",a="https://ttwid-normal-sg.capcutapi.com",s="https://sf16-web-tos-buz.capcutstatic.com/obj/rc-web-sdk-sg/webmssdk/1.0.0.770/webmssdk.js",c="https://sf16-web-tos-buz.capcutstatic.com/obj/capcut-web-buz-sg/slardar-web-sdk/plugins",u="https://mon-sg.capcutapi.com",l="cn_mweb",d="https://lf3-short.ibytedapm.com/slardar/fe/sdk-web/browser.cn.js",v="https://lf3-lv-buz.vlabstatic.com/obj/image-lvweb-buz/common/scripts/security-secsdk-runtime-v1.0.0.js"},568664:function(){},152521:function(e,t,i){i.d(t,{M:function(){return s},i:function(){return c}});var r=i(604488),n=i(320402),o="by".concat(r._8,"edan").concat(r.tf,"e.net"),a="".concat(r.tf,"apcu").concat(r._8,".com");"".concat(r.tf,"apcu").concat(r._8,".cn");var s={[n.s.Boe]:{[n.a.Sg]:"https://capcut-os-boe.".concat(o),[n.a.Cn]:"https://dreamina-cn-boe.".concat(o)},[n.s.Ppe]:{[n.a.Sg]:"https://mweb-api-sg.".concat(o),[n.a.Cn]:"https://".concat(location.hostname)},[n.s.Online]:{[n.a.Sg]:"https://mweb-api-sg.".concat(a),[n.a.Cn]:"https://".concat(location.hostname)}},c={[n.s.Boe]:s[n.s.Boe][n.a.Cn],[n.s.Ppe]:s[n.s.Ppe][n.a.Cn],[n.s.Online]:"https://www.".concat(r.P5,"i").concat(r.aj,"ny").concat(r.pq,"ng.com")}},42286:function(e,t,i){i.d(t,{j:function(){return c}});var r=i(747086),n=i(282473),o=i(490165),a=i(859840),s="invite-status";function c(e){var t=e.invokeFunction(e=>e.get(o.D));e.invokeFunction(i=>{var o=i.get(r.b),c=window.__invite_status__;if(c){var u=c[n.j.DreaminaImage],l={[n.j.DreaminaImage]:{invitedStatus:u.invited_status,regionBlock:u.region_block}};o.init(l),(0,a.C)(s,!0,e)}else o.init(),t.hasLogin&&(0,a.C)(s,!1,e)})}},628886:function(e,t,i){i.d(t,{L:function(){return a}});var r=i(806663),n=i(557343),o=i(490165);function a(e){e.invokeFunction(e=>{var t=e.get(o.D),i=e.get(n.L);if(t.hasLogin){var{uid:a}=t.userProfile;i.setConfig({userId:a})}else(0,r.V)(t.onDidLogin)(()=>{var{uid:e}=t.userProfile;i.setConfig({userId:e})})})}},856024:function(e,t,i){i.d(t,{D:function(){return v},q:function(){return f}});var r,n,o=i(876826),a=i(85728),s=i(150615),c=i(467475),u=i(702251),l=i(578771),d=i(73809);var v=((r={}).video="video",r.image="image",r.temp="temp",r),p={baseURL:"/lv/v1",method:"POST",headers:{loc:c.yM.CHANNEL,lan:s.ZP.language||c.yM.LAN,pf:c.yM.APP_PF,appvr:c.yM.VERSION,tdid:"","sign-ver":1,"app-sdk-version":c.yM.APP_SDK_VERSION},params:{}},_=u.ZP.createAxios(p);_.interceptors.response.use(e=>{if(200!==e.status)return Promise.reject(e);var t=e.data;return"0"===t.ret?Promise.resolve(t.data):Promise.reject(e)}),(0,l.Z)(_,{retries:5,resetTimeout:!0,retryDelay:1e3,isRetry:e=>{var t;return(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.ret)!=="200206"}});var m=()=>n?{[u.R0]:{domain:n}}:{},f={fixRequestDomain(){n=u.ZP.getWebDomain()},getUploadToken(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"video",t=arguments.length>1?arguments[1]:void 0;return(0,o._)(function*(){var i,r="/upload_sign";return yield _((0,a._)({url:r,headers:(0,a._)({},(0,d.O)((0,a._)({url:"".concat(p.baseURL).concat(r)},p.headers))),data:{key_version:"v5",biz:null!==(i=null==t?void 0:t.biz)&&void 0!==i?i:({video:"web_video",image:"replicate",temp:"temp_file"})[e]}},m()))})()},createVideoData:e=>(0,o._)(function*(){var t="/upload/create_upload_task";return(yield _((0,a._)({url:t,headers:(0,a._)({},(0,d.O)((0,a._)({url:"".concat(p.baseURL).concat(t)},p.headers))),data:e},m()))).task_id})(),getVideoTaskInfo:e=>(0,o._)(function*(){var t="/upload/get_upload_task";return yield _((0,a._)({url:t,[l.R]:{canRetry:!1},headers:(0,a._)({},(0,d.O)((0,a._)({url:"".concat(p.baseURL).concat(t)},p.headers))),data:e},m()))})()}},344752:function(e,t,i){i.d(t,{$:function(){return u}});var r=i(876826),n=i(85728),o=i(929753),a=i(856024),s=i(467475),c=i(594055);class u extends c.g{init(){var e=this;return(0,r._)(function*(){var t=yield a.q.getUploadToken(a.D.image);e.stsToken={AccessKeyId:t.access_key_id,SecretAccessKey:t.secret_access_key,SessionToken:t.session_token,ExpiredTime:t.expired_time,CurrentTime:t.current_time},e.config=(0,o._)((0,n._)({userId:"unknow",appId:Number(s.yM.APP_ID),useServerCurrentTime:!0},e.props),{videoConfig:{spaceName:t.space_name}})})()}getStsToken(){return this.stsToken}getConfig(){return this.config}constructor(e){super(),this.props=e}}},165870:function(e,t,i){i.d(t,{g:function(){return r}});class r{}},188294:function(e,t,i){i.d(t,{m:function(){return r}});var r={name:"resource-request",key:"id",index:[{name:"createTime",unique:!1},{name:"updateTime",unique:!1}]}},525524:function(e,t,i){i.d(t,{m:function(){return a}});var r=i(549947),n=i(876826),o=i(405317);class a{has(e){return new Promise((t,i)=>{var r=this._transaction.objectStore(this._storeName).openCursor(e);r.onerror=()=>{i(r.error)},r.onsuccess=()=>{t(!!r.result)}})}set(e,t){var i=this;return(0,n._)(function*(){var r=yield i.query(e);return r?t.createTime=r.createTime:t.createTime=Date.now(),t.updateTime=Date.now(),new Promise((e,r)=>{var n=i._transaction.objectStore(i._storeName).put(t);n.onerror=()=>{r(n.error)},n.onsuccess=()=>{e()}})})()}setMany(e){var t=[];for(var i of e)t.push(this.set(i.key,i.value));return new Promise((e,i)=>{Promise.all(t).then(()=>{e()}).catch(e=>{i(e)})})}delete(e){return new Promise((t,i)=>{var r=this._transaction.objectStore(this._storeName).delete(e);r.onerror=()=>{i(r.error)},r.onsuccess=()=>{t()}})}deleteMany(e){var t=[];for(var i of e)t.push(this.delete(i));return new Promise((e,i)=>{Promise.all(t).then(()=>{e()}).catch(e=>{i(e)})})}deleteByIndex(e,t){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:IDBKeyRange.only(t),s=this;return new Promise((i=(0,n._)(function*(t,i){var n=s._transaction.objectStore(s._storeName).index(e),c,u=!1,l=!1;try{for(var d,v=(0,r._)((0,o.v)(n,a));u=!(d=yield v.next()).done;u=!1){var p=d.value;if(!p)break;p.delete()}}catch(e){l=!0,c=e}finally{try{u&&null!=v.return&&(yield v.return())}finally{if(l)throw c}}t()}),function(e,t){return i.apply(this,arguments)}))}query(e){return new Promise((t,i)=>{var r=this._transaction.objectStore(this._storeName).get(e);r.onerror=()=>{i(r.error)},r.onsuccess=()=>{t(this._handleResult(r.result))}})}queryMany(e){var t,i=function(e){n.push(t.query(e).then(t=>(t&&r.set(e,t),t)))},r=new Map,n=[];for(var o of e)t=this,i(o);return new Promise((e,t)=>{Promise.all(n).then(()=>{e(r)}).catch(e=>{t(e)})})}queryByIndex(e,t){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:IDBKeyRange.only(t),s=this;return new Promise((i=(0,n._)(function*(t,i){var n=s._transaction.objectStore(s._storeName).index(e),c=[],u,l=!1,d=!1;try{for(var v,p=(0,r._)((0,o.v)(n,a));l=!(v=yield p.next()).done;l=!1){var _=v.value;if(!_)break;c.push(_.value)}}catch(e){d=!0,u=e}finally{try{l&&null!=p.return&&(yield p.return())}finally{if(d)throw u}}t(c)}),function(e,t){return i.apply(this,arguments)}))}queryByRange(e,t){var i,a=this;return new Promise((i=(0,n._)(function*(i,n){var s=a._transaction.objectStore(a._storeName).index(e),c=[],u,l=!1,d=!1;try{for(var v,p=(0,r._)((0,o.v)(s,t));l=!(v=yield p.next()).done;l=!1){var _=v.value;if(!_)break;c.push(_.value)}}catch(e){d=!0,u=e}finally{try{l&&null!=p.return&&(yield p.return())}finally{if(d)throw u}}i(c)}),function(e,t){return i.apply(this,arguments)}))}queryByConditions(e){var t,i=this;return new Promise((t=(0,n._)(function*(t,n){var a=i._transaction.objectStore(i._storeName),s=[],c,u=!1,l=!1;try{for(var d,v=(0,r._)((0,o.v)(a,null));u=!(d=yield v.next()).done;u=!1){var p=d.value;if(!p)break;e(p.value)&&s.push(p.value)}}catch(e){l=!0,c=e}finally{try{u&&null!=v.return&&(yield v.return())}finally{if(l)throw c}}t(s)}),function(e,i){return t.apply(this,arguments)}))}clear(){return new Promise((e,t)=>{var i=this._transaction.objectStore(this._storeName).clear();i.onerror=()=>{t(i.error)},i.onsuccess=()=>{e()}})}_handleResult(e){if(!e)return;if(void 0===e.maxAge)return e;if(!(e.updateTime+e.maxAge<Date.now()))return e}constructor(e,t){this._transaction=e,this._storeName=t}}},23426:function(e,t,i){i.d(t,{SA:function(){return n.S},_c:function(){return r._}});var r=i(890712),n=i(533901)},510951:function(e,t,i){i.d(t,{B:function(){return q}});var r=i(876826),n=i(85728),o=i(929753),a=i(789786),s=i(584072),c=i(562092),u=i(247170),l=i(836413),d=i(378081),v=i(56935),p=i(830563),_=i(434712),m=i(256408),f=i(143608),h=i(693895),g=i(280166),b=i(260963),y=i(304916),S=i(150615),I=i(64513),C=i(216997),T=i(873237),w=i(818398),k=i.n(w),D=i(417442),R=i(475578),P=i(474182),x=i(189717),A=i(867929),O=i(570499),F=i(369617),L=i(861748),G=i(745017),M=i(971125),E=i(819340),U=i(453344),j=i(529227),V=i(200294),N=i(661551);class q{get canSubmit(){return!!((0,y.jV)(this.observableData.videoState)&&("uploaded"===this.observableData.coverState.type||"empty"===this.observableData.coverState.type)&&this.observableData.title&&this.observableData.desc)}get isEmpty(){return"empty"===this.observableData.videoState.type&&"empty"===this.observableData.coverState.type&&!this.observableData.title&&!this.observableData.desc}_exportStory(e){var t=this;return(0,r._)(function*(){(0,y.nr)(t.observableData.videoState)&&t.observableData.videoState.cancellationTokenSource.cancel();var i,a,s,l,v,p={actionType:x.j.Click,materialSource:O.O9.Assets,position:A.Z.AssetSelectPopup},_=new d.A;t.observableData.videoState={type:"exporting",story:e,progress:0,cancellationTokenSource:_};var{space_id:m,workspace_id:f}=t._workspaceService.workspaceList[0],h=(0,L.w)(t._containerService,G.I),g=yield t._packageInfoDataService.getPackageInfo((0,u.fC)(),{packageKey:e.draftId,spaceId:m,workspaceId:f,lang:"en",fromEmail:!1}),b=yield h;if(_.token.isCancellationRequested)return;if(!g.ok||!b.ok||!b.value){t._reportImportMaterial((0,o._)((0,n._)({},p),{status:O.CF.FAIL,failReason:"fail_to_get_draft_info_or_imageX"})),t.observableData.videoState={type:"uploadError",isFromExport:!0};return}var S=(0,c.D)(g.value.data.draft),I=k().parse(g.value.data.package_meta),C=null!==(l=null===(a=S.canvas_config)||void 0===a?void 0:a.width)&&void 0!==l?l:1920,T=null!==(v=null===(s=S.canvas_config)||void 0===s?void 0:s.height)&&void 0!==v?v:1080,w=Math.min(C,T)/720,D=Math.round(C/w),R=Math.round(T/w),P=yield t._exportService.createExportTaskLifecycle({width:D,height:R,video_name:e.name,fps:24,quality:1,format:"mp4",duration:1e3,draft_id:e.draftId,definition:"720p",package_id:I.id,cover:void 0,type:0,video_id:"",from_workspace_id:f,need_upload_videoarch:!0,uploader:b.value});if(!_.token.isCancellationRequested){if(!P.ok){t._reportImportMaterial((0,o._)((0,n._)({},p),{status:O.CF.FAIL,failReason:"[".concat(P.code,"] ").concat(P.msg,"]")})),t.observableData.videoState={type:"uploadError",isFromExport:!0};return}var F=P.value;_.token.onCancellationRequested(()=>{F.cancel()}),F.onSuccess((i=(0,r._)(function*(i){if(t._reportImportMaterial((0,o._)((0,n._)({},p),{status:O.CF.SUCCESS})),_.token.isCancellationRequested)return;var r=i.vid;t.observableData.videoState={type:"exported",story:e,vid:r};var a=yield t._competitionDataService.previewVideo({video_id:r});if(!!a.ok)t.observableData.videoState.preview=a.value.video_preview.origin_video.video_url,t.observableData.videoState.coverPreview=a.value.video_preview.cover_url}),function(e){return i.apply(this,arguments)})),F.onProgress(i=>{if(!_.token.isCancellationRequested&&!!i.ok)t.observableData.videoState={type:"exporting",story:e,cancellationTokenSource:_,progress:i.value.progress}}),F.onError(e=>{if(t._reportImportMaterial((0,o._)((0,n._)({},p),{status:O.CF.FAIL,failReason:"[".concat(e.code,"] ").concat(e.msg,"]")})),!_.token.isCancellationRequested)t.observableData.videoState={type:"uploadError",isFromExport:!0}})}})()}submit(){var e=this;return(0,r._)(function*(){e.observableData.isSubmiting=!0,(0,v.Y2)((0,y.jV)(e.observableData.videoState),"video not ready"),N.j.selfSecUid&&(e._prefetchRequestService.deleteCache({displayName:"homepage",params:{secUid:N.j.selfSecUid}}),e._prefetchRequestService.deleteCache({displayName:"user-info",params:{secUid:N.j.selfSecUid}}));var t=yield e._competitionDataService.submitArtwork({title:e.observableData.title,description:e.observableData.desc,video_id:e.observableData.videoState.vid,cover_uri:"uploaded"===e.observableData.coverState.type?e.observableData.coverState.uri:void 0,act_key_list:e._config.act_key?[e._config.act_key]:void 0,story_id:"exported"===e.observableData.videoState.type?e.observableData.videoState.story.storyId:void 0,downloadable:e.observableData.downloadable});return(e.observableData.isSubmiting=!1,t.ok)?(e.observableData.hasPublished=!0,e.reportPublishStatus({status:"success"}),(0,l.ly)()):(e.reportPublishStatus({status:"fail",fail_reason:"[".concat(t.code,"] ").concat(t.msg)}),t)})()}dispose(){(0,y.nr)(this.observableData.videoState)&&this.observableData.videoState.cancellationTokenSource.cancel(),"uploading"===this.observableData.coverState.type&&this.observableData.coverState.cancellationTokenSource.cancel(),this.observableData.videoState={type:"empty"}}_reportImportMaterial(e){(0,x.p)(this._containerService,(0,n._)({page:this._config.page,materialType:O.V$.VIDEO},e))}getAcceptsByType(e){var t,i=e=>[...e.acceptType,...e.acceptSuffix].join(",");return null!==(t=null==e?void 0:e.reduce((e,t)=>"".concat(e?",":"").concat(e).concat(i(j.NF[t]),","),""))&&void 0!==t?t:"*/*"}_reportUploadCover(e,t){(0,x.p)(this._containerService,{position:A.Z.Cover,page:this._config.page,status:e,failReason:t,actionType:x.j.Click,materialSource:O.O9.LOCAL,materialType:O.V$.IMAGE})}reportPublishPage(e){var t=this._getPublishPageReportParams(),i=this.observableData.downloadable?R.eD.True:R.eD.False;"publish"!==e&&(i=void 0);var r=(0,o._)((0,n._)({},t),{action:e,download_permit:i});(0,D.Oc)(this._containerService,r)}reportPublishStatus(e){var t=this._getPublishStatusReportParams(),i=(0,n._)({request_id:"",fail_reason:"",template_source:"",seed:"",steps:"",scale:"",prompt_source:"",prompt:"",model:"",is_super_resolution:"",generate_id:"",picture_cnt:0},t,e);(0,P.dx)(this._containerService,i)}_getPublishPageReportParams(){return{type:"story",activity_id:this._config.act_key,activity:this._config.act_name,content_id:(0,y.jV)(this.observableData.videoState)?this.observableData.videoState.vid:void 0,picture_cnt:0,page:this._config.page,channel:this._config.channel,author_type:this._config.authorType,title:this.observableData.title}}_getPublishStatusReportParams(){var e="local";return"exported"===this.observableData.videoState.type?e="assets":"imported"===this.observableData.videoState.type&&(e="capcut_pc"),{type:"story",activity_id:this._config.act_key,activity:this._config.act_name,author_type:this._config.authorType,channel:this._config.channel,title:this.observableData.title,description:this.observableData.desc,page:this._config.page,content_id:(0,y.jV)(this.observableData.videoState)?this.observableData.videoState.vid:void 0,material_source:e,download_permit:this.observableData.downloadable?R.eD.True:R.eD.False}}_uploadVcloudVideo(e){var t=this;return(0,r._)(function*(){var i=new d.A;if(t._setVideoState({type:"importing",progress:0,cancellationTokenSource:i}),t._fakeImportingProgress(0),i.token.isCancellationRequested)return;var r=yield t._competitionDataService.previewVideo({video_id:e});if(!!r.ok){var n=r.value.video_preview;if(!(0,y.tb)({duration:n.duration_ms/1e3,videoWidth:n.origin_video.width,videoHeight:n.origin_video.height},e=>S.ZP.t(e)).ok){t._setVideoState({type:"uploadError",isFromExport:!1});return}t._setVideoState({type:"imported",preview:r.value.video_preview.origin_video.video_url,coverPreview:r.value.video_preview.cover_url,vid:e})}})()}_setVideoState(e){(0,b.z)(()=>{this.observableData.videoState=e})}_fakeImportingProgress(e){var t=e,i=null,r=()=>{i&&clearTimeout(i);var{videoState:e}=this.observableData;if("importing"===e.type&&!e.cancellationTokenSource.token.isCancellationRequested)t=Math.min(t+1,100),this.observableData.videoState={progress:t,type:e.type,cancellationTokenSource:e.cancellationTokenSource},t<100&&(i=setTimeout(r,10))};i=setTimeout(r,10)}constructor(e,t,i,a,c,u,l,_,m){var f,h,g=this;this._config=e,this._uploadService=t,this._containerService=i,this._competitionDataService=a,this._exportService=c,this._packageInfoDataService=u,this._workspaceService=l,this._environmentService=_,this._prefetchRequestService=m,this.observableData={videoState:{type:"empty"},coverState:{type:"empty"},title:"",desc:"",isSubmiting:!1,hasPublished:!1,downloadable:!0},this.setTitle=e=>{this.observableData.title=e},this.setDesc=e=>{this.observableData.desc=e},this.setDownloadable=e=>{this.observableData.downloadable=e},this.selectLocalFile=e=>{var t=(0,s.PQ)(),i=document.createElement("input");return i.type="file",i.accept=this.getAcceptsByType(["video"]),i.style.display="none",i.dataset.from="publish-story-input",i.onchange=()=>{document.body.removeChild(i);var r,n=null===(r=i.files)||void 0===r?void 0:r[0];if(!!n)this._uploadVideo(n,e,x.j.Click),t.resolve()},document.body.appendChild(i),i.click(),t.promise},this.selectDreaminaStory=e=>{var{onGoCreate:t}=e;(0,I.X)({containerService:this._containerService,onClickLocalFile:()=>this.selectLocalFile(A.Z.AssetSelectPopup),onSelected:e=>{this._exportStory(e)},page:this._config.page,activity:this._config.act_name,activity_id:this._config.act_key,onGoCreate:t})},this.handleFileDrop=e=>{if(e.type&&!this.getAcceptsByType(["video"]).includes(e.type)&&!j.NF.video.acceptSuffix.some(t=>e.name.endsWith(t))){F.s.error(S.ZP.t("competition_upload_error_format"));return}this._uploadVideo(e,A.Z.Publish,x.j.Drag)},this._uploadVideo=(f=(0,r._)(function*(e,t,i){(0,y.nr)(g.observableData.videoState)&&g.observableData.videoState.cancellationTokenSource.cancel();var a,s=new d.A;g.observableData.videoState={type:"uploading",file:e,progress:0,cancellationTokenSource:s,position:t,actionType:i};var c={actionType:i,materialSource:O.O9.LOCAL,position:t},u=yield(0,y.g9)(e,e=>S.ZP.t(e));if(!u.ok){g._reportImportMaterial((0,o._)((0,n._)({},c),{status:O.CF.FAIL,failReason:u.msg})),g.observableData.videoState={type:"uploadError",isFromExport:!1};return}"passed"===u.value&&(0,y.v8)(e).then(e=>{if(!s.token.isCancellationRequested)"uploading"===g.observableData.videoState.type&&(a=e,g.observableData.videoState=(0,o._)((0,n._)({},g.observableData.videoState),{coverPreview:e}))});var l=g._uploadService.getVodUploader(g._environmentService.appId,M.i,{actions:[{name:"GetMeta"},{name:"Snapshot",input:{SnapshotTime:0}},{name:"StartWorkflow",input:{TemplateId:"001437b1be294eb1996fdce77b45d6db"}}]}),_=yield l.uploadVideoAndGetTask({file:e});if(!s.token.isCancellationRequested)"uploading"===g.observableData.videoState.type&&(g.observableData.videoState=(0,o._)((0,n._)({},g.observableData.videoState),{uploadTask:_})),s.token.onCancellationRequested(()=>{_.cancel()}),_.onComplete(t=>{if(s.token.isCancellationRequested)return;if("needTranscode"===u.value){if(!t.width||!t.height){g._reportImportMaterial((0,o._)((0,n._)({},c),{status:O.CF.FAIL,failReason:"metadata_not_found"})),g.observableData.videoState={type:"uploadError",isFromExport:!1},F.s.error(S.ZP.t("competition_upload_error_format"));return}var i,l=(0,y.tb)({duration:t.duration,videoWidth:t.width,videoHeight:t.height},e=>S.ZP.t(e));if(!l.ok){g._reportImportMaterial((0,o._)((0,n._)({},c),{status:O.CF.FAIL,failReason:l.msg})),g.observableData.videoState={type:"uploadError",isFromExport:!1};return}}if(g._reportImportMaterial((0,o._)((0,n._)({},c),{status:O.CF.SUCCESS})),g.observableData.videoState={type:"uploaded",file:e,vid:t.vid,preview:"needTranscode"===u.value?void 0:URL.createObjectURL(e),coverPreview:a},"passed"!==u.value){var d=()=>"uploaded"===g.observableData.videoState.type&&g.observableData.videoState.vid===t.vid;var _=(i=(0,r._)(function*(){if(g.observableData.isSubmiting&&(yield(0,b.gx)(()=>!g.observableData.isSubmiting)),g.observableData.hasPublished)return;var e,i=yield g._competitionDataService.previewVideo({video_id:t.vid});if(!!d()){if((0,v.Y2)("uploaded"===g.observableData.videoState.type),!i.ok||i.value.video_preview.vda_status===p.X.EncodeFailed){g._reportImportMaterial((0,o._)((0,n._)({},c),{status:O.CF.FAIL,failReason:"failed_to_transcode_".concat(t.vid)}));return}if(i.value.video_preview.vda_status===p.X.EncodeSuccess){g._reportImportMaterial((0,o._)((0,n._)({},c),{status:O.CF.SUCCESS}));return}!g.observableData.videoState.coverPreview&&(g.observableData.videoState.coverPreview=i.value.video_preview.cover_url);var r=(0,U.eQ)(t.width||0,t.height||0);if(null===(e=i.value.video_preview.transcoded_video)||void 0===e?void 0:e[r]){g.observableData.videoState.preview=i.value.video_preview.transcoded_video[r].video_url;return}setTimeout(_,5e3)}}),function(){return i.apply(this,arguments)});_()}}),_.onError(e=>{if(!s.token.isCancellationRequested)g._reportImportMaterial((0,o._)((0,n._)({},c),{status:O.CF.FAIL,failReason:"[".concat(e.code,"] ").concat(e.msg)})),g.observableData.videoState={type:"uploadError",isFromExport:!1}}),_.onProgress(e=>{if(!s.token.isCancellationRequested)"uploading"===g.observableData.videoState.type&&(g.observableData.videoState=(0,o._)((0,n._)({},g.observableData.videoState),{progress:e}))})}),function(e,t,i){return f.apply(this,arguments)}),this.cancel=()=>{if("uploading"===this.observableData.videoState.type||"exporting"===this.observableData.videoState.type)this._reportImportMaterial({actionType:"uploading"===this.observableData.videoState.type?this.observableData.videoState.actionType:x.j.Click,materialSource:"uploading"===this.observableData.videoState.type?O.O9.LOCAL:O.O9.Assets,position:"uploading"===this.observableData.videoState.type?this.observableData.videoState.position:A.Z.AssetSelectPopup,status:O.CF.CANCEL}),this.observableData.videoState.cancellationTokenSource.cancel(),this.observableData.videoState={type:"empty"}},this.selectCover=()=>{var e=document.createElement("input");e.type="file",e.accept="image/*",e.style.display="none",e.dataset.from="publish-story-input",e.onchange=(0,b.aD)(t=>{document.body.removeChild(e);var i,r=null===(i=e.files)||void 0===i?void 0:i[0];if(!!r)this._uploadCover(r)}),document.body.appendChild(e),e.click()},this.resetCover=()=>{this.observableData.coverState={type:"empty"}},this._uploadCover=(h=(0,r._)(function*(e){if(!(yield(0,C.m)(e,e=>S.ZP.t(e)))){g._reportUploadCover(O.CF.FAIL,"check_error");return}"uploading"===g.observableData.coverState.type&&(g._reportUploadCover(O.CF.CANCEL),g.observableData.coverState.cancellationTokenSource.cancel());var t=new d.A,i=URL.createObjectURL(e);g.observableData.coverState={type:"uploading",file:e,progress:0,cancellationTokenSource:t,preview:i};var r=g._uploadService.getImageXUploader(g._environmentService.appId,G.I),n=yield r.uploadImage({file:e});if(!t.token.isCancellationRequested){if(!n.ok){g._reportUploadCover(O.CF.FAIL,"[".concat(n.code,"] ").concat(n.msg)),g.observableData.coverState={type:"uploadError"};return}g._reportUploadCover(O.CF.SUCCESS),g.observableData.coverState={type:"uploaded",file:e,md5:n.value.md5,uri:n.value.uri,preview:i}}}),function(e){return h.apply(this,arguments)}),(0,b.rC)(this,{observableData:b.LO}),e.publishVid&&this._uploadVcloudVideo(e.publishVid)}}q=(0,a.gn)([(0,a.fM)(1,E.Z),(0,a.fM)(2,_.t),(0,a.fM)(3,m.D),(0,a.fM)(4,T.AA),(0,a.fM)(5,f.j),(0,a.fM)(6,h.W),(0,a.fM)(7,g.Y),(0,a.fM)(8,V.d),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof PublishManagerConfig?Object:PublishManagerConfig,void 0===E.Z?Object:E.Z,void 0===_.t?Object:_.t,void 0===m.D?Object:m.D,void 0===T.AA?Object:T.AA,void 0===f.j?Object:f.j,void 0===h.W?Object:h.W,void 0===g.Y?Object:g.Y,void 0===V.d?Object:V.d])],q)},953516:function(e,t,i){i.d(t,{Mj:function(){return f}});var r=i(772322);i(181382);var n=i(293793),o=i(370640),a=i(338665),s=i(218571),c=i(889715),u=i(105789),l=i.n(u),d=i(597444),v=i(150615),p=i(650248),_=o.Z.Search,m=e=>(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:a.Z.searchBtnContainer,onClick:e.onClick,children:[(0,r.jsx)(c.C49,{}),(0,r.jsx)("span",{className:a.Z.searchText,children:v.ZP.t("search",{},"\u641C\u7D22")})]})}),f=e=>{var t,[i,o]=(0,s.useState)(e.value),[u,v]=(0,s.useState)(!1),[f,h]=(0,s.useState)(!1);(0,s.useEffect)(()=>{o(e.value)},[e.value]);var g=(0,n.default)(t=>{var i;o(t),null===(i=e.onChange)||void 0===i||i.call(e,t)}),b=(0,n.default)(()=>{g("")}),y=(0,p.default)(()=>{if(!e.isMinContainerToInteractVisible&&window.innerWidth<=d._2){e.setIsMinContainerToInteractVisible(!0);return}var t,r=i;if(!i&&e.guess&&(o(e.guess),r=e.guess),!!(null==r?void 0:r.trim()))null===(t=e.onSearch)||void 0===t||t.call(e,r,!!i)},1e3,{leading:!0,trailing:!1}),S=()=>{var t;null===(t=e.onClick)||void 0===t||t.call(e)};(0,s.useEffect)(()=>{var t=()=>{e.isMinContainerToInteractVisible?v(!1):v(window.innerWidth<=d._2)};return t(),window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e.isMinContainerToInteractVisible]);var I=(0,s.useCallback)(()=>{v(!1),!e.isMinContainerToInteractVisible&&window.innerWidth<=d._2&&e.setIsMinContainerToInteractVisible(!0)},[e.isMinContainerToInteractVisible,e.setIsMinContainerToInteractVisible]);return u?(0,r.jsxs)("div",{className:a.Z.miniSearch,onClick:I,children:[(0,r.jsx)(c.C49,{className:a.Z.miniSearchIcon}),(0,r.jsx)("span",{className:a.Z.miniSearchText,children:"\u641C\u7D22"})]}):(0,r.jsx)(_,{placeholder:null!==(t=e.guess)&&void 0!==t?t:e.placeholder,className:l()(e.className,a.Z.inputGroup,{[a.Z.inputGroupFocus]:f,[a.Z.minInputGroupToInteract]:e.isMinContainerToInteractVisible,[a.Z.disabled]:!i&&!e.guess}),searchButton:(0,r.jsx)(m,{onClick:S}),onFocus:()=>{var t;h(!0),null===(t=e.onFocus)||void 0===t||t.call(e)},onBlur:()=>{var t;h(!1),null===(t=e.onBlur)||void 0===t||t.call(e)},onChange:g,onSearch:y,onClick:S,onMouseEnter:()=>{var t;null===(t=e.onHover)||void 0===t||t.call(e)},value:i,allowClear:!0,onClear:b,maxLength:d.bu})}},972979:function(e,t,i){i.d(t,{p:function(){return p}});var r=i(772322),n=i(590839),o=i(735212),a=i(259273),s=i(642273),c=i(889715),u=i(708274),l=i(150615),d=i(848303),v=i(185617),p={[n.a.PageRoute]:[{id:a.Sj.Asset,path:s.EZ[a.Sj.Asset],isNeedCache:!v.lY,skeleton:()=>null}],[n.a.SideMenu]:[{id:a.Sj.Asset,title:()=>l.ZP.t("frame_change_asset",{},"Asset"),tooltips:()=>l.ZP.t("frame_change_asset",{},"Asset"),icon:e=>{var{selected:t,isHover:i}=e;return t||i?(0,r.jsx)(c.lBy,{}):(0,r.jsx)(c.gQX,{fill:d.Z.pageIconColor})},group:u.Bl.UserTools,position:"top",order:a.us.Asset}],[n.a.TitleBar]:[{id:a.$W.TitleBarSearch,position:"center",orderLevel:o.r.low,type:"Custom",content:()=>null}]}},683519:function(e,t,i){i.d(t,{O:function(){return r}});var r={id:"dreamina-ai-agent",version:1,tables:[i(532038).C]}},718995:function(e,t,i){i.d(t,{b:function(){return r}});var r={name:"beta-test-survey-cache",key:"id",index:[{name:"createTime",unique:!1},{name:"updateTime",unique:!1}]}},605060:function(e,t,i){i.d(t,{d:function(){return u}});var r=i(876826),n=i(789786),o=i(503006),a=i(900875),s=i(718995),c=i(56935);class u{getIsSubmittedSurvey(e,t){var i=this;return(0,r._)(function*(){if(!!(yield i._ensureConnected())){(0,c.Y2)(i._connectRequest);var r=yield i._connectRequest.query(i._makeQueryId(e,t));if(r.ok){var n,{submitted_survey:o}=null!==(n=r.value)&&void 0!==n?n:{};return o}}})()}setIsSubmittedSurvey(e,t,i){var n=this;return(0,r._)(function*(){if(!!(yield n._ensureConnected())){(0,c.Y2)(n._connectRequest);var r=n._makeQueryId(e,t);yield n._connectRequest.set(r,{id:r,submitted_survey:i})}})()}_ensureConnected(){var e=this;return(0,r._)(function*(){return!e._connectRequest&&(yield e._connect()),!!e._connectRequest})()}_connect(){var e=this;return(0,r._)(function*(){var t=yield e._storageService.database.connect(a.Z.id,s.b.name);if(!!t.ok)e._connectRequest=t.value})()}_makeQueryId(e,t){return"".concat(e,"_").concat(t)}constructor(e){this._storageService=e,this._connectRequest=null,this._connect()}}u=(0,n.gn)([(0,n.fM)(0,o.U),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===o.U?Object:o.U])],u)},819020:function(e,t,i){i.d(t,{b:function(){return r}});var r={GET_HISTORY:"/mweb/v1/get_history",DOWNLOAD_TASK:"/mweb/v1/get_local_item_list",LOCATE_TASK:"/mweb/v1/locate_workbench",DELETE_TASK:"/mweb/v1/remove_history",FEEDBACK_TASK:"/mweb/v1/feedback",GET_ASSET_LIST:"/mweb/v1/get_asset_list",GET_HISTORY_COLLECTION_DETAIL:"/mweb/v1/get_history_group_detail",LOCATE_HISTORY_COLLECTION:"/mweb/v1/locate_history_group",GET_HISTORY_COLLECTION:"/mweb/v1/get_history_group"}},176274:function(e,t,i){i.d(t,{k:function(){return S}});var r=i(876826),n=i(85728),o=i(789786),a=i(700645),s=i(867713),c=i(705309),u=i(56935),l=i(217854),d=i(426572),v=i(969015),p=i(434712),_=i(732884),m=i(800613),f=i(558032),h=i(648326),g=i(488148),b=i(619121),y=i(923401);class S{get ctx(){return this._ctx}updateContext(e){this._ctx=(0,n._)({},this._ctx,e)}dispatchEvent(e){var t=this;return(0,r._)(function*(){var i;yield t._handlerReadyBarrier.wait(),null===(i=t._firstHandler)||void 0===i||i.handle(e)})()}clearPrefetchTasks(){this._feedPrefetchTasksMap.forEach(e=>{this._runtimePrefetchService.cancelTask(e.key)}),this._feedPrefetchTasksMap.clear()}getCommunityStoreInstance(){return h.p.getCommunityStoreInstance(this._containerService)}getCarouselService(){return this._containerService.invokeFunction(e=>e.get(m.s))}postPrefetchTask(e){return e.onDone(()=>{this._feedPrefetchTasksMap.delete(e.key)}),this._feedPrefetchTasksMap.set(e.key,e),this._runtimePrefetchService.postTask(e)}cancelPrefetchTask(e){this._runtimePrefetchService.cancelTask(e),this._feedPrefetchTasksMap.delete(e)}_getRuntimePrefetchABTestValue(){var e=this;return(0,r._)(function*(){var t=yield e._configurationService.abTestManager.getAbTestValue(y.$s.enableRuntimePrefetch,!1),i=yield e._configurationService.abTestManager.getAbTestValue(y.$s.enableRuntimePrefetchExtraFeed,!1);return e._abTestValueInitializedBarrier.open(),e.abTestValues.enableRuntimePrefetch=t,e.abTestValues.enableRuntimePrefetchExtraFeed=i,{enableRuntimePrefetch:t,enableRuntimePrefetchExtraFeed:i}})()}_listenPerformanceObserverForLog(){new PerformanceObserver(e=>{this._ctx.performanceResourceTimings.push(...e.getEntries().filter(e=>(0,d.TO)(e)).filter(e=>"img"===e.initiatorType))}).observe({entryTypes:["resource"]})}_listenHeroImageEntryAddForLog(){l.N.onEntryAdded(e=>{this._ctx.performanceElementTimings.push(...e)})}_calculateImagesRenderDelay(){var{performanceElementTimings:e}=this._ctx;if(!e.length)return{};var t=e.map(e=>{var{inViewTime:t,loadTime:i,renderTime:r}=e;return Math.max(r,i)-t});return{imageRenderDelayMax:Math.max(...t),imageRenderDelayMin:Math.min(...t),imageRenderDelayAvg:t.reduce((e,t)=>e+t,0)/t.length,imageRenderDelayPCT75:t.sort((e,t)=>e-t)[Math.floor(.75*t.length)]}}_reportPrefetchCoverage(){var{performanceResourceTimings:e,prefetchedResourceNames:t}=this._ctx,i=e.length,r=e.filter(e=>0===e.transferSize).length,o=t.length,a=e.filter(e=>0===e.transferSize&&-1!==t.indexOf(e.name)).length,s=this._calculateImagesRenderDelay();this._ctx.performanceResourceTimings.length=0,this._ctx.prefetchedResourceNames.length=0,this._ctx.performanceElementTimings.length=0,(0,g.l)(this._containerService,(0,n._)({total:i,cacheMissCount:i-r,cacheHitCount:r,prefetchCount:o,prefetchHitCount:a},s))}_reportPrefetchCoverageWhileIdle(){(0,a.n)(()=>{this._reportPrefetchCoverage(),requestAnimationFrame(()=>this._reportPrefetchCoverageWhileIdle())},{priorityLevel:s.q.IdlePriority,delay:3e4})}_createHandlerChain(){var e=this;return(0,r._)(function*(){yield e._abTestValueInitializedBarrier.wait();var t=e.abTestValues.enableRuntimePrefetch?b.K:b.q;!t.length&&(0,u.ss)("no handler registered");var i=new t[0](e);return t.reduce((t,i)=>{var r=new i(e);return t.setNextHandler(r),r},i),e._firstHandler=i,e._handlerReadyBarrier.open(),i})()}constructor(e,t,i,r){this._runtimePrefetchService=e,this._pageLoadEventService=t,this._configurationService=i,this._containerService=r,this._abTestValueInitializedBarrier=new c.U,this._handlerReadyBarrier=new c.U,this._ctx={prefetchedResourceNames:[],performanceResourceTimings:[],performanceElementTimings:[]},this._feedPrefetchTasksMap=new Map,this._firstHandler=null,this.abTestValues={enableRuntimePrefetch:!1,enableRuntimePrefetchExtraFeed:!1},this._listenPerformanceObserverForLog(),this._listenHeroImageEntryAddForLog(),this._reportPrefetchCoverageWhileIdle(),this._getRuntimePrefetchABTestValue(),this._createHandlerChain(),this._pageLoadEventService.onPageLoad(()=>{this._runtimePrefetchService.start()})}}S=(0,o.gn)([(0,o.fM)(0,_.v),(0,o.fM)(1,f.tu),(0,o.fM)(2,v.Ui),(0,o.fM)(3,p.t),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[void 0===_.v?Object:_.v,void 0===f.tu?Object:f.tu,void 0===v.Ui?Object:v.Ui,void 0===p.t?Object:p.t])],S)},219940:function(e,t,i){i.d(t,{L:function(){return r}});class r{get textToImageManager(){return this._textToImageManager}get imageToImageManager(){return this._imageToImageManager}setTextToImageManager(e){this._textToImageManager=e}setImageToImageManager(e){this._imageToImageManager=e}}},477235:function(e,t,i){i.d(t,{s:function(){return f}});var r=i(150615),n=i(608358),o=i(244867),a=i(17248),s=i(357217),c=i(259273),u=i(178589),l=i(403167),d=i(369617),v=i(591586),p=i(491971),_=i(81185),m=e=>{var t=(0,a.Y)(s.hJ.ModelCampaignCodeStart,e);if(!t){v.t.debug("getCampaignInfo","campaignResourceInfo is null");return}var{imageUrls:i,inviteTotalLimit:n,inviteRewardLimit:o,modelNameStarlingKey:c,modelName:u,shareUrl:l,inviteCode:d}=t,p=r.oc.t("dre_invite_intro_desc_step1_detail",{link:null!=l?l:"",code:null!=d?d:""},"\u5373\u68A6AI\u65B0\u529F\u80FD\u5185\u6D4B\u62DB\u52DF\uFF01\u4F7F\u7528\u94FE\u63A5{link} \u6216\u590D\u5236\u53E3\u4EE4\u7801 {code} \u5230\u5373\u68A6\u7F51\u9875\u7248/APP \u5151\u6362\u89E3\u9501\u5185\u6D4B\u8D44\u683C\uFF01");return{bannerUrls:i,campaignName:s.Nd.FissionS30Model,inviteText:p,inviteTotal:null!=n?n:10,inviteLimit:null!=o?o:6,modelName:r.oc.t(null!=c?c:"",{},u)}},f=(e,t)=>{var i=m(e);if(!i){null==t||t();return}var{inviteTotal:a,inviteLimit:v,inviteText:f,bannerUrls:h,modelName:g}=i,b=()=>{(0,n.ko)(e,u.e).navigate(c.Sj.InviteFission,{state:{enterFrom:p.mE.ModelActivityPopup}})},y=()=>{(0,l.u)(f),d.s.success(r.oc.t("dre_invite_link_copied_toast",{},"\u9080\u8BF7\u94FE\u63A5\u5DF2\u590D\u5236 \u53BB\u7C98\u8D34\u7ED9\u521B\u4F5C\u8005\u597D\u53CB\u5427"))};(0,o.L)({innerModalProps:{headerImgUrls:h,modalTitle:r.oc.t("dre_event_ends_popup_title",{model:g},"\u9080\u8BF7\u597D\u53CB\u4F53\u9A8C\u65B0\u6A21\u578B\u5F97\u5956\u52B1\u6D3B\u52A8\u5373\u5C06\u7ED3\u675F"),modalDesc:r.oc.t("dre_event_ends_popup_desc",{number1:a,number2:v},"\u60A8\u5DF2\u83B7\u5F97  {number1} \u4E2A\u9080\u8BF7\u540D\u989D\uFF0C\u9080\u8BF7\u597D\u53CB\u4F53\u9A8C\u5373\u68A6 AI \u65B0\u89C6\u9891\u6A21\u578B\uFF01\u6210\u529F\u9080\u8BF7 {number2} \u4F4D\u65B0\u7528\u6237\uFF0C\u60A8\u5C06\u83B7\u5F97 30\u5929\u4F1A\u5458\u5956\u52B1\u3002\u5FEB\u6765\u5206\u4EAB\u5427\uFF01"),cancelButtonProps:{text:r.oc.t("dre_event_ends_popup_btn_view",{},"\u67E5\u770B\u6D3B\u52A8"),onClick:()=>{(0,_.RL)(e,{popupType:_.s9.ActivityExpireNovip,action:_.pF.CheckActivity,activityName:s.Nd.FissionS30Model}),b()}},okButtonProps:{text:r.oc.t("dre_event_ends_popup_btn_copy_link",{},"\u590D\u5236\u94FE\u63A5\u53BB\u9080\u8BF7"),onClick:()=>{y(),(0,_.RL)(e,{popupType:_.s9.ActivityExpireNovip,action:_.pF.CopyLink,activityName:s.Nd.FissionS30Model})}}},otherModalProps:{maskClosable:!1,duration:200,autoFocus:!0,afterClose:t,onCancel:()=>{(0,_.RL)(e,{popupType:_.s9.ActivityExpireNovip,action:_.pF.Close,activityName:s.Nd.FissionS30Model})}}}),(0,_.RL)(e,{popupType:_.s9.ActivityExpireNovip,action:_.pF.Show,activityName:s.Nd.FissionS30Model})}},339459:function(e,t,i){i.d(t,{g:function(){return r}});var r=()=>"undefined"!=typeof window&&window.navigator.userAgent.includes("CAPCUT_PC")},959446:function(e,t,i){i.d(t,{V:function(){return f}});var r=i(876826),n=i(789786),o=i(836413),a=i(346526),s=i(406630),c=i(636601),u=i(643590),l=i(875649),d=i(416105),v=i(927457),p=i(726019),_=i(936226),m=i(810413);class f{get _networkClient(){if(!this._networkClientInstance){var e;this._networkClientInstance=(e=new u.y().build(u.D),(0,l.i3)(e),(0,d.mH)(e),(0,a.V)(e),e)}return this._networkClientInstance}getMusicAlbums(){var e=this;return(0,r._)(function*(){try{var t,i,r=yield e._networkClient.post("".concat(e._api,"?lite_aid=").concat(m.AF),{scene:s.x.normal}),n=Number(null!==(t=r.ret)&&void 0!==t?t:0),a=null!==(i=r.errmsg)&&void 0!==i?i:"";if(0!==n)return(0,o.wf)(null!=n?n:-1,null!=a?a:"");var c=e._convertResponseToCollectionData(r);return(0,o.oW)(c)}catch(e){return(0,v.m)(e,-1,"getMusicAlbums api error")}})()}_convertResponseToCollectionData(e){var{data:t}=e;return{albums:t.collections.map(e=>{var t=Object.values(e.cover_url).map(e=>this._parseUrlToTranscodeInfo(e));return{id:e.id,name:e.name,coverUrl:e.cover_url.medium,transcodeInfo:t}})}}_parseUrlToTranscodeInfo(e){var t,i,r=e.match(/_(\d+)x(\d+)\./);return{url:e,width:Number(null!==(t=null==r?void 0:r[1])&&void 0!==t?t:0),height:Number(null!==(i=null==r?void 0:r[2])&&void 0!==i?i:0)}}get _api(){return"".concat(c._L.getVar("web_domain")).concat(p.J.GET_MUSIC_COLLECTIONS)}constructor(e){this._capcutAccountService=e}}f=(0,n.gn)([(0,n.fM)(0,_.Gw),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===_.Gw?Object:_.Gw])],f)},878891:function(e,t,i){i.d(t,{k:function(){return b}});var r=i(876826),n=i(85728),o=i(929753),a=i(789786),s=i(936226),c=i(636601),u=i(643590),l=i(875649),d=i(243494),v=i(927457),p=i(836413),_=i(346526),m=i(807744),f=i(12939),h=i(150615),g=i(810413);class b{get _networkClient(){if(!this._networkClientInstance){var e;this._networkClientInstance=(e=new u.y().build(u.D),(0,l.i3)(e),(0,_.V)(e),e)}return this._networkClientInstance}getCollections(e){var t=this;return(0,r._)(function*(){try{var i,r,a,s,c=e instanceof d.yt?e.config:e,u=yield t._networkClient.post(t._getCollectionApi,t._convertParamsToRequest(e),(0,o._)((0,n._)({},(0,f._)(null!==(r=null!==(i=t._options.fixedRegion)&&void 0!==i?i:t._accountService.userProfile.region)&&void 0!==r?r:"",h.ZP.language,void 0,g.AF,!!t._options.fixedRegion)),{withCredentials:!0})),l=Number(null!==(a=u.ret)&&void 0!==a?a:0),_=null!==(s=u.errmsg)&&void 0!==s?s:"";if(0!==l)return(0,p.wf)(null!=l?l:-1,null!=_?_:"");var m=t._convertResponseToQueryToken(c,u);return(0,p.oW)(m)}catch(e){return(0,v.m)(e,-1,"[".concat(t.resourceType,"] getCollections api error"))}})()}addToCollection(e){var t=this;return(0,r._)(function*(){try{var i,r,a,s,c=yield t._networkClient.post(t._addCollectionApi,t._convertAddParamsToRequest(e),(0,o._)((0,n._)({},(0,f._)(null!==(r=null!==(i=t._options.fixedRegion)&&void 0!==i?i:t._accountService.userProfile.region)&&void 0!==r?r:"",h.ZP.language,void 0,g.AF,!!t._options.fixedRegion)),{withCredentials:!0})),u=Number(null!==(a=c.ret)&&void 0!==a?a:0),l=null!==(s=c.errmsg)&&void 0!==s?s:"";if(0!==u)return(0,p.wf)(null!=u?u:-1,null!=l?l:"");var d=c.data.favorite_info,_=Object.keys(d).filter(e=>0===d[e]),m=Object.keys(d).filter(e=>0!==d[e]);return(0,p.oW)({successfulItems:_,failedItems:m})}catch(e){var b="string"==typeof e?e:"addToCollection api error";return(0,v.m)(e,-1,b)}})()}removeFromCollection(e){var t=this;return(0,r._)(function*(){try{var i,r,a,s,c=yield t._networkClient.post(t._removeCollectionApi,t._convertRemoveParamsToRequest(e),(0,o._)((0,n._)({},(0,f._)(null!==(r=null!==(i=t._options.fixedRegion)&&void 0!==i?i:t._accountService.userProfile.region)&&void 0!==r?r:"",h.ZP.language,void 0,g.AF,!!t._options.fixedRegion)),{withCredentials:!0})),u=Number(null!==(a=c.ret)&&void 0!==a?a:0),l=null!==(s=c.errmsg)&&void 0!==s?s:"";if(0!==u)return(0,p.wf)(null!=u?u:-1,null!=l?l:"");var d=c.data.unfavorite_info,_=Object.keys(d).filter(e=>0===d[e]),m=Object.keys(d).filter(e=>0!==d[e]);return(0,p.oW)({successfulItems:_,failedItems:m})}catch(e){var b="string"==typeof e?e:"removeFromCollection api error";return(0,v.m)(e,-1,b)}})()}buildCustomRequest(){return{}}get defaultQueryToken(){return{offset:0,count:50}}_convertParamsToRequest(e){e instanceof d.yt&&e.config;var t,i,r=this.buildCustomRequest(),o=(0,d.ky)(e)?{count:null!==(t=e.config.limit)&&void 0!==t?t:50,offset:null!==(i=e.offset)&&void 0!==i?i:0}:(0,n._)({},this.defaultQueryToken,e.limit?{count:e.limit}:void 0);return(0,n._)({effect_type:this.resourceType},r,o)}_convertAddParamsToRequest(e){var{collections:t}=e,i=t.map(e=>(0,o._)((0,n._)({},e),{effect_type:this.resourceType})),r=this.buildCustomRequest();return(0,n._)({items:i},r)}_convertRemoveParamsToRequest(e){var{collections:t}=e,i=t.map(e=>(0,o._)((0,n._)({},e),{effect_type:this.resourceType})),r=this.buildCustomRequest();return(0,n._)({items:i},r)}_convertResponseToQueryToken(e,t){var i=t.data.effect_item_list.map(e=>this.parseHeycanResponseDataToResources(e)),r=t.data.next_offset,n=t.data.has_more;return(0,d.ib)(e,{list:i},{hasMore:n,offset:r})}get _getCollectionApi(){return"".concat(c._L.getVar("web_domain")).concat(m.bl.GET_COLLECTIONS)}get _addCollectionApi(){return"".concat(c._L.getVar("web_domain")).concat(m.bl.BATCH_FAVORITE)}get _removeCollectionApi(){return"".concat(c._L.getVar("web_domain")).concat(m.bl.BATCH_UNFAVORITE)}constructor(e={},t){this._options=e,this._accountService=t,this._options=e}}b=(0,a.gn)([(0,a.fM)(1,s.Gw),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof ICollectionResourcesRepositoryParam?Object:ICollectionResourcesRepositoryParam,void 0===s.Gw?Object:s.Gw])],b)},831210:function(e,t,i){i.d(t,{L:function(){return R}});var r=i(876826),n=i(85728),o=i(929753),a=i(789786),s=i(490165),c=i(643590),u=i(875649),l=i(243494),d=i(927457),v=i(119850),p=i(836413),_=i(346526),m=i(807744),f=i(892611),h=i(150615),g=i(12939),b=i(275646),y=i(343638),S=i(835993),I=i(649337),C=i(969015),T=i(442452),w=i(557343),k=i(627176),D=i(503006);class R{shouldUseRace(){return!1}get _networkClient(){if(!this._networkClientInstance){var e=function(e){var{addBusinessPlugins:t}=e,i=new c.y().build(c.D);return t(i,[k.U.Preload]),(0,u.i3)(i),(0,_.V)(i),i}(this._clientPluginService);this._networkClientInstance=this.shouldUseRace()?(0,f.d)(e,this._storageService,this._accountService.uniqueId,this._configurationService.disableRequestCache):(0,f.D)(e,this._storageService,this._accountService.uniqueId,this._configurationService.disableRequestCache)}return this._networkClientInstance}get skipSingleDataParseError(){return!1}setFixedRegion(e){this._fixedRegion=e}get _api(){return this._httpApiSettingService.getRequestURL({domainType:T.Y.DEFAULT,path:m.bl.GET_CATEGORY_BY_PANEL})}getCategories(e){var t=this;return(0,r._)(function*(){var i=Date.now(),r=e instanceof l.yt?e.config:e;try{var o=yield t._convertParamsToRequest(e),a=t._configurationService.getAppConfigurationValue("heycanDataService.fixedRegion")||t._fixedRegion,s=yield t._networkClient.postWithCache(t._api,o,{params:(0,n._)({},(0,g._)(null!==(v=null!=a?a:t._accountService.userProfile.region)&&void 0!==v?v:"",h.ZP.language,r.sdkVersion,r.appID,!!a,r.bizId).params,t.buildCustomRequestParams()),withCredentials:!0}),c=Number(null!==(_=s.ret)&&void 0!==_?_:0),u=null!==(f=s.errmsg)&&void 0!==f?f:"";try{var v,_,f,b,y,S=Object.values(s.data.category_resources||{}).reduce((e,t)=>{var i;return e+((null===(i=t.effect_item_list)||void 0===i?void 0:i.length)||0)},0);null===(y=t._slardarAdapterService)||void 0===y||y.sendEvent("vimo_material_fetch_result",{path:m.bl.GET_CATEGORY_BY_PANEL,ret:String(c),msg:u,panel:t.resourcePanelType,logid:s.logid||"",panelCount:null===(b=s.data.categories)||void 0===b?void 0:b.length,defaultCount:S,duration:Date.now()-i})}catch(e){console.error("_slardarAdapterService error",e)}if(0!==c)return(0,p.wf)(null!=c?c:-1,null!=u?u:"");var I=t._convertResponseToQueryToken(r,s);return(0,p.oW)(I)}catch(e){var C,T,w=(0,d.m)(e,-1,"".concat(t.resourcePanelType," getCategories api error: ").concat(null==e?void 0:e.message));console.error("GetResourceCategoriesRepository getCategories error",e);try{null===(T=t._slardarAdapterService)||void 0===T||T.sendEvent("vimo_material_fetch_result",{path:m.bl.GET_CATEGORY_BY_PANEL,ret:String(w.code),logid:null===(C=w.cause)||void 0===C?void 0:C.logid,msg:w.msg,panel:t.resourcePanelType,duration:Date.now()-i})}catch(e){console.error("_slardarAdapterService error",e)}return w}})()}_convertParamsToRequest(e){var t=this;return(0,r._)(function*(){var i,r,a,s,c,u,d,p,_=e instanceof l.yt?e.config:e,m=t.buildCustomRequest(_),f=yield t.buildCustomFilterParams(),h={app_id:null!==(u=_.appID)&&void 0!==u?u:v.kJ,panel:_.panel||t.resourcePanelType,get_res_category_count:null===(i=_.polyConfig)||void 0===i?void 0:i.categoryCount,resource_count:null===(r=_.polyConfig)||void 0===r?void 0:r.detailCount,get_resource:(null===(a=_.polyConfig)||void 0===a?void 0:a.getAllResource)||!!(null===(s=_.polyConfig)||void 0===s?void 0:s.detailCount),only_commercial:!!_.onlyCommercial,panel_source:_.panelSource,get_all_resource:null===(c=_.polyConfig)||void 0===c?void 0:c.getAllResource},g=(0,l.ky)(e)?(0,o._)((0,n._)({},{count:null!==(d=e.config.limit)&&void 0!==d?d:50}),{offset:null!==(p=e.offset)&&void 0!==p?p:0}):(0,n._)({},t.defaultQueryToken,e.limit?{count:e.limit}:void 0);return(0,n._)({},f,h,m,g)})()}_convertResponseListToResourceList(e){return e.map(e=>{var t=(0,o._)((0,n._)({},e),{panel:this.resourcePanelType});if(!this.skipSingleDataParseError)return this.parseHeycanResponseDataToResources(t);try{return this.parseHeycanResponseDataToResources(t)}catch(e){return console.error("".concat(this.resourceType," parse error:"),e),null}}).filter(Boolean)}_getCategoryKey(e,t){return e.category_key}_convertResponseToQueryToken(e,t){var{category_resources:i={}}=t.data,r=(t.data.categories||[]).map(e=>({id:String(e.category_id),key:this._getCategoryKey(e,t.data.panel_source),name:e.category_name,starlingKey:e.name_starling_key,panelSource:t.data.panel_source,tags:e.tags||[]})),n=Object.keys(i).map(String).reduce((e,t)=>{var r=i[t];return e[t]={list:this._convertResponseListToResourceList(r.effect_item_list),hasMore:r.has_more,offset:r.next_offset,fail_reason:r.fail_reason},e},{});return(0,l.ib)(e,{list:r,details:n,panelSource:t.data.panel_source})}buildCustomRequest(e){return{}}buildCustomRequestParams(){return{}}get defaultQueryToken(){return{offset:0,count:50}}_getWhiteUserPermission(){var e=this;return(0,r._)(function*(){if(!e._accountService.hasLogin)return!1;var[t,i]=(yield e._userPermissionDataService.getUserPermission({})).pair();return!t&&!!i.publishWebTemplatePermission||!1})()}buildCustomFilterParams(){var e=this;return(0,r._)(function*(){var t=yield e._getWhiteUserPermission();return!e._configurationService.getAppConfigurationValue("vip.disableFilter")&&(yield(0,b.g)(t,e.resourceType))?{filter_optional:{filter_paid_type:[y.mT.Subscribe]}}:{}})()}constructor(e,t,i,r,n,o,a,s){this._accountService=e,this._effectAbTestService=t,this._userPermissionDataService=i,this._configurationService=r,this._httpApiSettingService=n,this._slardarAdapterService=o,this._storageService=a,this._clientPluginService=s}}R=(0,a.gn)([(0,a.fM)(0,s.D),(0,a.fM)(1,S.c),(0,a.fM)(2,I.c),(0,a.fM)(3,C.Ui),(0,a.fM)(4,T.x),(0,a.fM)(5,w.L),(0,a.fM)(6,D.U),(0,a.fM)(7,k.a),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===s.D?Object:s.D,void 0===S.c?Object:S.c,void 0===I.c?Object:I.c,void 0===C.Ui?Object:C.Ui,void 0===T.x?Object:T.x,void 0===w.L?Object:w.L,void 0===D.U?Object:D.U,void 0===k.a?Object:k.a])],R)},947605:function(e,t,i){i.d(t,{F:function(){return r}});function r(e){return{id:e.Id.toString(),key:e.Key,name:e.Name,tags:e.Tags}}},32927:function(e,t,i){i.d(t,{K:function(){return s}});var r=i(831210),n=i(755020),o=i(265510),a=i(474956);class s extends r.L{get resourceType(){return a._g.Font}get resourcePanelType(){return n.q.Font}parseHeycanResponseDataToResources(e){return(0,o.n)(e)}buildCustomRequest(e){var t,i;return{client_ab_param:e.clientABParam,panel_source:e.panelSource,pack_optional:{need_thumb:null!==(t=e.enableAlbum)&&void 0!==t&&t,only_commercial:null!==(i=e.onlyCommercial)&&void 0!==i&&i}}}buildCustomRequestParams(){var e;return{device_type:"default",channel:null!==(e=new URLSearchParams(location.search).get("lokiChannel"))&&void 0!==e?e:"online"}}}},170486:function(e,t,i){i.d(t,{x:function(){return m}});var r=i(876826),n=i(789786),o=i(836413),a=i(346526),s=i(636601),c=i(643590),u=i(875649),l=i(927457),d=i(936226),v=i(504867),p=i(150615),_=i(12939);class m{get _networkClient(){if(!this._networkClientInstance){var e;this._networkClientInstance=(e=new c.y().build(c.D),(0,u.i3)(e),(0,a.V)(e),e)}return this._networkClientInstance}getTrendingSearchWords(){var e=this;return(0,r._)(function*(){try{var t,i,r=yield e._networkClient.post(e._api,{},(0,_._)(e._capcutAccountService.userProfile.region,p.ZP.language)),n=Number(null!==(t=r.ret)&&void 0!==t?t:0),a=null!==(i=r.errmsg)&&void 0!==i?i:"";if(0!==n)return(0,o.wf)(null!=n?n:-1,null!=a?a:"");var s=e._convertResponseToResourceData(r);return(0,o.oW)(s)}catch(e){return(0,l.m)(e,-1,"getTrendingSearchWords api error")}})()}_convertResponseToResourceData(e){return{words:e.data.recommend_words}}get _api(){return"".concat(s._L.getVar("web_domain")).concat(v.b.SEARCH_WORDS)}constructor(e){this._capcutAccountService=e}}m=(0,n.gn)([(0,n.fM)(0,d.Gw),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===d.Gw?Object:d.Gw])],m)},165991:function(e,t,i){i.d(t,{x:function(){return r}});var r=(0,i(971245).yh)("heycan-upload-data-service")},187347:function(e,t,i){i.d(t,{Q:function(){return l}});var r=i(876826),n=i(789786),o=i(836413),a=i(927457),s=i(149350),c=i(174950),u=i(442452);class l{getUploadToken(e){var t=this;return(0,r._)(function*(){try{var i=yield t._networkClient.post(t._httpApiSettingService.getRequestURL({domainType:u.Y.DEFAULT,path:c.K.getUploadToken}),e,{withCredentials:!0});return(0,o.oW)(t._convertUploadTokenFromServer(i.data))}catch(e){return(0,a.m)(e)}})()}_convertUploadTokenFromServer(e){return{accessKeyId:e.access_key_id,secretAccessKey:e.secret_access_key,sessionToken:e.session_token,expiredTime:e.expired_time,currentTime:e.current_time,spaceName:e.space_name,uploadDomain:e.upload_domain,spaceType:e.space_type,region:e.region}}get _networkClient(){return!this._networkClientInstance&&(this._networkClientInstance=(0,s.G)()),this._networkClientInstance}constructor(e){this._httpApiSettingService=e}}l=(0,n.gn)([(0,n.fM)(0,u.x),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[void 0===u.x?Object:u.x])],l)},240514:function(e,t,i){i.d(t,{C:function(){return a}});var r=i(85728),n=i(712942),o=i(76252);function a(e){e.interceptors.request.use(e=>{var t={aid:(0,n.Iv)()},i={"x-idc-region":(0,o.H)()?n.tL.Sg:""};return Object.assign(e,{params:(0,r._)({},t,e.params),headers:(0,r._)({},i,e.headers)}),e})}},995098:function(e,t,i){i.d(t,{i:function(){return u}});var r=i(85728),n=i(929753),o=i(442452),a=i(895131),s=i(599918),c=i(564992);class u extends a.C{get getResourcesApi(){return this._httpApiSettingService.getRequestURL({domainType:o.Y.DEFAULT,path:c.b.GET_SHORT_VIDEO_RESOURCE_BY_CATEGORY})}get requestConfig(){return{params:{aid:this._environmentService.appId}}}parseHeycanResponseDataToResources(e){return(0,s.g)(e)}buildCustomRequest(e){var t;return{category_id:e.categoryId,image_info:null!==(t=e.imageInfo)&&void 0!==t?t:{height:2e3,width:2e3,format:"webp"},pack_item_opt:(0,n._)((0,r._)({},e.packItemOpt),{need_data_integrity:!0})}}}},485945:function(e,t,i){i.d(t,{K:function(){return c}});var r=i(876826),n=i(410875),o=i(774449),a=i(836413),s=i(100470);class c{_commonErrorHandler(e){var{errNo:t,errTips:i}=e||{},r=t?Number(t):s.b.ErrCommon;return(0,a.wf)(r,null!=i?i:"unknown error")}traceInviteLink(e){var t=this;return(0,r._)(function*(){try{var i=yield t._networkClient.post(o.v.traceInviteLink.url,e);return(0,a.oW)(i)}catch(e){return t._commonErrorHandler(e)}})()}getInviteLinkInfo(){var e=this;return(0,r._)(function*(){try{var t=yield e._networkClient.get(o.v.getInviteLinkInfo.url);return(0,a.oW)(t)}catch(t){return e._commonErrorHandler(t)}})()}constructor(){this._networkClient=(0,n.G)()}}},219575:function(e,t,i){i.d(t,{t:function(){return A}});var r=i(876826),n=i(85728),o=i(929753),a=i(789786),s=i(836413),c=i(346526),u=i(643590),l=i(904337),d=i(416105),v=i(875649),p=i(820266),_=i(804274),m=i(927457),f=i(660149),h=i(280166),g=i(442452),b=i(588735),y=i(818292),S=i(549654),I=i(490165),C=i(535823),T=i(869409),w=i(56168),k=i(850078),D=i(373722),R=i(64790),P=i(316115),x=i(879976);class A{get _networkClient(){if(!this._networkClientInstance){var e;this._networkClientInstance=(e=new u.y().build({headers:{"Content-Type":"application/json"},withCredentials:!0}),(0,x.V)(e),(0,l.$)(e),(0,d.mH)(e),(0,v.i3)(e),(0,c.V)(e),e)}return this._networkClientInstance}_getApi(e){return this._httpApiSettingService.getRequestURL({domainType:g.Y.DEFAULT,path:e})}submitTask(e,t){var i=this;return(0,r._)(function*(){try{var r,a=i._environmentService.appId,c=i._convertSubmitRequestParams(e,a),u=yield i._networkClient.post(i._getApi(f.b.TASK_SUBMIT),(0,o._)((0,n._)({},c),{http_common_info:{aid:a}}),{params:(0,n._)({aid:a},t)});if("0"!==u.ret)return(0,s.wf)(Number(u.ret),u.errmsg,{logId:u.logid});if(0!==Number(u.data.code))return(0,s.wf)(Number(u.data.code),"submit error",{logId:u.logid,data:(null===(r=u.data)||void 0===r?void 0:r.aigc_data)&&u.data.code!==b.sb.RateLimit&&(0,C.ZF)((0,p.b)(u.data.aigc_data,_.zW))});var l=(0,C.ZF)((0,p.b)(u.data.aigc_data,_.zW));return l.generateId=u.logid,(0,s.oW)(l)}catch(e){return(0,m.P)(e)}})()}submitBatchTask(e,t){var i=this;return(0,r._)(function*(){try{var r=i._environmentService.appId,a=i._convertBatchSubmitRequestParams(e,r),s=yield i._networkClient.post(i._getApi(f.b.BATCH_TASK_SUBMIT),(0,o._)((0,n._)({},a),{http_common_info:{aid:r}}),{params:(0,n._)({aid:r},t)});return e.submitIdList.map((e,t)=>{var i,r,n,o,a,c,u,l;return(0,R.j)({ret:(null==s?void 0:null===(n=s.data)||void 0===n?void 0:null===(r=n.res_list)||void 0===r?void 0:null===(i=r[t].err_info)||void 0===i?void 0:i.ret)||s.ret,errmsg:(null==s?void 0:null===(c=s.data)||void 0===c?void 0:null===(a=c.res_list)||void 0===a?void 0:null===(o=a[t].err_info)||void 0===o?void 0:o.errmsg)||s.errmsg,logid:s.logid,data:null==s?void 0:null===(l=s.data)||void 0===l?void 0:null===(u=l.res_list)||void 0===u?void 0:u[t].data})})}catch(t){return e.submitIdList.map((e,i)=>(0,m.P)(t))}})()}queryTask(e){var t=this;return(0,r._)(function*(){try{var i=(0,p.X)(e),r=yield t._networkClient.post(t._getApi(f.b.TASK_QUERY),i);if("0"!==r.ret)return(0,s.wf)(Number(r.ret),r.errmsg,{logId:r.logid});var a=(0,p.b)(r,_.zW),c=Object.keys(a.data.taskMap).reduce((e,t)=>{var i=a.data.taskMap[t];return a?(0,o._)((0,n._)({},e),{[t]:(0,C.ZF)(i)}):e},{});return(0,s.oW)({taskMap:c,logId:r.logid})}catch(e){return(0,m.m)(e,-1,"aigc query task error")}})()}fetchTaskList(e){var t=this;return(0,r._)(function*(){try{var i,r=[100,360,720].map(e=>({height:e,width:e,format:"webp"})),n={offset:0===e.offset?void 0:e.offset,count:e.count,history_type:y.B.Text2Video,type:y.B.Text2Video,direction:e.direction,mode:e.mode,history_option:{story_id:null===(i=e.historyOption)||void 0===i?void 0:i.storyId,multi_size_image_config:r},is_pack_origin:!0},o=yield t._networkClient.post(t._getApi(f.b.TASK_LIST),n);if("0"!==o.ret)return(0,s.wf)(Number(o.ret),o.errmsg);var a=(0,p.b)(o.data,_.zW),c={data:a.recordsList.map(e=>{try{return(0,C.ZF)(e)}catch(e){return}}).filter(e=>!!e),nextOffset:a.nextOffset,hasMore:a.hasMore};return(0,s.oW)(c)}catch(e){return(0,m.m)(e,-1,"aigc fetch task list error")}})()}fetchAssetList(e){var t=this;return(0,r._)(function*(){try{var i,r,o,a=yield t._networkClient.post(t._getApi(f.b.GET_ASSET_LIST),(0,p.X)((0,n._)({asset_type:T.d.Video},e)));if("0"!==a.ret)return(0,s.wf)(Number(a.ret),a.errmsg);var c=(0,p.b)(a.data,_.zW),u={data:(null!==(i=c.assetList)&&void 0!==i?i:[]).map(e=>(0,C.$q)(e.video)).filter(Boolean),nextOffset:null!==(r=c.nextOffset)&&void 0!==r?r:0,hasMore:null!==(o=c.hasMore)&&void 0!==o&&o};return u.data=(0,k.Z)(u.data,e=>{var{historyRecordId:t}=e;return t}),(0,s.oW)(u)}catch(e){return(0,m.m)(e,-1,"get video assets list error")}})()}fetchDownloadTask(e){var t=this;return(0,r._)(function*(){try{var i={item_id_list:e.itemIdList,is_for_video_download:!0},r=yield t._networkClient.post(t._getApi(f.b.DOWNLOAD_TASK),i);if("0"!==r.ret)return(0,s.wf)(Number(r.ret),r.errmsg);var n={itemList:(0,p.b)(r.data,_.zW).itemList.map(e=>(0,w.C)(e))};return(0,s.oW)(n)}catch(e){return(0,m.m)(e,-1,"aigc fetch download task error")}})()}deleteTask(e){var t=this;return(0,r._)(function*(){try{var i=(0,p.X)(e),r=yield t._networkClient.post(t._getApi(f.b.DELETE_TASK),(0,o._)((0,n._)({},i),{type:y.B.Text2Video}));if("0"!==r.ret)return(0,s.wf)(Number(r.ret),r.errmsg);return(0,s.oW)(!0)}catch(e){return(0,m.m)(e,-1,"aigc delete task error")}})()}locateTask(e){var t=this;return(0,r._)(function*(){try{var i,r={history_record_id:e.historyRecordId,next_count:e.nextCount,pre_count:e.preCount,type:e.type,mode:e.mode,history_option:{story_id:null===(i=e.historyOption)||void 0===i?void 0:i.storyId}},n=yield t._networkClient.post(t._getApi(f.b.LOCATE_TASK),r);if("0"!==n.ret)return(0,s.wf)(Number(n.ret),n.errmsg);var o=(0,p.b)(n.data,_.zW),a={data:o.recordsList.map(e=>{try{return(0,C.ZF)(e)}catch(e){return}}).filter(e=>!!e),nextOffset:o.nextOffset,hasMore:o.hasMore};return(0,s.oW)(a)}catch(e){return(0,m.m)(e,-1,"aigc locate task error")}})()}_convertSubmitRequestParams(e,t){var i,r,a,s,c,u,l,d,v,_,m,f,h,g,b,y,I,{submitId:C,taskPayload:T,input:w,commerceInfo:k,scene:D,aiGenInfo:R,preTaskId:x}=e,{taskExtra:A={}}=T,O=(0,o._)((0,n._)({},A),{isUseAiGenPrompt:!!(!w.videoGenInputs.prompt&&(null==R?void 0:R.aiGenPrompt)),batchNumber:null!==(I=w.videoGenInputs.batchNumber)&&void 0!==I?I:1}),F=w.videoGenInputs.i2vOpt?(0,p.X)(w.videoGenInputs.i2vOpt):void 0;if(null==F?void 0:F.realman_avatar){var{image_url:L}=F.realman_avatar.origin_image;F.realman_avatar.origin_image.image_url=(0,P.n)(L)?"":L}(null==F?void 0:null===(i=F.realman_avatar)||void 0===i?void 0:i.tts_info)&&(F.realman_avatar.tts_info=JSON.stringify(F.realman_avatar.tts_info));var G=w.videoGenInputs.v2vOpt?(0,n._)({},w.videoGenInputs.v2vOpt.extend?{extend:{enable:w.videoGenInputs.v2vOpt.extend.enable,extend_duration_ms:w.videoGenInputs.v2vOpt.extend.extendDurationMs,extend_fps:w.videoGenInputs.v2vOpt.extend.extendFps,extend_prompt:w.videoGenInputs.v2vOpt.extend.extendPrompt}}:{},w.videoGenInputs.v2vOpt.insertFrame?{insert_frame:{enable:w.videoGenInputs.v2vOpt.insertFrame.enable,origin_fps:w.videoGenInputs.v2vOpt.insertFrame.originFps,target_fps:w.videoGenInputs.v2vOpt.insertFrame.targetFps,duration_ms:w.videoGenInputs.v2vOpt.insertFrame.durationMs}}:{},w.videoGenInputs.v2vOpt.superResolution?{super_resolution:{enable:w.videoGenInputs.v2vOpt.superResolution.enable,target_width:w.videoGenInputs.v2vOpt.superResolution.targetWidth,target_height:w.videoGenInputs.v2vOpt.superResolution.targetHeight,origin_height:w.videoGenInputs.v2vOpt.superResolution.originHeigth,origin_width:w.videoGenInputs.v2vOpt.superResolution.originWidth}}:{},w.videoGenInputs.v2vOpt.labSr?{lab_sr:{enable:w.videoGenInputs.v2vOpt.labSr.enable,sr_duration_ms:w.videoGenInputs.v2vOpt.labSr.srDurationMs,sr_fps:w.videoGenInputs.v2vOpt.labSr.srFps}}:{},w.videoGenInputs.v2vOpt.lipSync?{lip_sync:{enable:w.videoGenInputs.v2vOpt.lipSync.enable,audio_vid:w.videoGenInputs.v2vOpt.lipSync.audioVid,vid:w.videoGenInputs.v2vOpt.lipSync.vid,voice_info:(null===(r=w.videoGenInputs.v2vOpt.lipSync.voiceInfo)||void 0===r?void 0:r.idInfo)?{id_info:{id:w.videoGenInputs.v2vOpt.lipSync.voiceInfo.idInfo.id,item_platform:w.videoGenInputs.v2vOpt.lipSync.voiceInfo.idInfo.itemPlatform}}:void 0,audio_before_conversion:w.videoGenInputs.v2vOpt.lipSync.audioBeforeConversion}}:{},w.videoGenInputs.v2vOpt.lipSyncUserVideo?{lip_sync_user_video:{enable:w.videoGenInputs.v2vOpt.lipSyncUserVideo.enable,origin_video:{video_id:w.videoGenInputs.v2vOpt.lipSyncUserVideo.originVideo.videoId,video_url:(0,P.n)(w.videoGenInputs.v2vOpt.lipSyncUserVideo.originVideo.videoUrl)?"":w.videoGenInputs.v2vOpt.lipSyncUserVideo.originVideo.videoUrl,width:w.videoGenInputs.v2vOpt.lipSyncUserVideo.originVideo.width,height:w.videoGenInputs.v2vOpt.lipSyncUserVideo.originVideo.height},origin_audio:(0,p.X)(w.videoGenInputs.v2vOpt.lipSyncUserVideo.originAudio),tts_info:JSON.stringify(w.videoGenInputs.v2vOpt.lipSyncUserVideo.ttsInfo),voice_info:(null===(a=w.videoGenInputs.v2vOpt.lipSyncUserVideo.voiceInfo)||void 0===a?void 0:a.idInfo)?{id_info:{id:w.videoGenInputs.v2vOpt.lipSyncUserVideo.voiceInfo.idInfo.id,item_platform:w.videoGenInputs.v2vOpt.lipSyncUserVideo.voiceInfo.idInfo.itemPlatform}}:void 0,audio_before_conversion:w.videoGenInputs.v2vOpt.lipSyncUserVideo.audioBeforeConversion}}:{},w.videoGenInputs.v2vOpt.avMix?{av_mix:{enable:w.videoGenInputs.v2vOpt.avMix.enable,video_item_id:w.videoGenInputs.v2vOpt.avMix.videoItemId,audio_vid:w.videoGenInputs.v2vOpt.avMix.audioVid,scene:w.videoGenInputs.v2vOpt.avMix.scene}}:{}):void 0,M=w.videoGenInputs.boximator?{enable:w.videoGenInputs.boximator.enable,boximator_image:{image_uri:null===(s=w.videoGenInputs.boximator.boximatorImage)||void 0===s?void 0:s.imageUri,image_url:null===(c=w.videoGenInputs.boximator.boximatorImage)||void 0===c?void 0:c.imageUrl,width:null===(u=w.videoGenInputs.boximator.boximatorImage)||void 0===u?void 0:u.width,height:null===(l=w.videoGenInputs.boximator.boximatorImage)||void 0===l?void 0:l.height},boxes:w.videoGenInputs.boximator.boxes.map(e=>({motion_path:e.motionPath,boxes:e.boundingBox.map(e=>({edge_type:e.boxEdgeType,vertexs:e.vertex})),color:e.color,prompt:e.prompt})),draft:(null===(d=w.videoGenInputs.boximator.draftFile)||void 0===d?void 0:d.fileUri)?void 0:w.videoGenInputs.boximator.draft,draft_file:{file_uri:null===(v=w.videoGenInputs.boximator.draftFile)||void 0===v?void 0:v.fileUri,file_url:null===(_=w.videoGenInputs.boximator.draftFile)||void 0===_?void 0:_.fileUrl}}:void 0;return{submit_id:C,task_extra:JSON.stringify(O),http_common_info:{aid:t},input:{video_aspect_ratio:w.videoAspectRatio,seed:w.seed,video_gen_inputs:[{prompt:w.videoGenInputs.prompt||(null==R?void 0:R.aiGenPrompt),first_frame_image:w.videoGenInputs.firstFrameImage?{width:w.videoGenInputs.firstFrameImage.width,height:w.videoGenInputs.firstFrameImage.height,image_uri:w.videoGenInputs.firstFrameImage.imageUri,format:w.videoGenInputs.firstFrameImage.format,ever_photo:w.videoGenInputs.firstFrameImage.everPhoto?{asset_id:w.videoGenInputs.firstFrameImage.everPhoto.assetId,workspace_id:w.videoGenInputs.firstFrameImage.everPhoto.workspaceId}:void 0,aigc_image:w.videoGenInputs.firstFrameImage.aigcImage?{item_id:w.videoGenInputs.firstFrameImage.aigcImage.itemId}:void 0}:void 0,end_frame_image:w.videoGenInputs.endFrameImage?{width:w.videoGenInputs.endFrameImage.width,height:w.videoGenInputs.endFrameImage.height,image_uri:w.videoGenInputs.endFrameImage.imageUri,format:w.videoGenInputs.endFrameImage.format,ever_photo:w.videoGenInputs.endFrameImage.everPhoto?{asset_id:w.videoGenInputs.endFrameImage.everPhoto.assetId,workspace_id:w.videoGenInputs.endFrameImage.everPhoto.workspaceId}:void 0,aigc_image:w.videoGenInputs.endFrameImage.aigcImage?{item_id:w.videoGenInputs.endFrameImage.aigcImage.itemId}:void 0}:void 0,lens_motion_type:w.videoGenInputs.lensMotionType,motion_speed:w.videoGenInputs.motionSpeed?S.o[w.videoGenInputs.motionSpeed]:void 0,vid:w.videoGenInputs.vid,v2v_opt:G,i2v_opt:F,audio_vid:w.videoGenInputs.audioVid,ending_control:w.videoGenInputs.endFrameImage?"1.0":void 0,pre_task_id:x,fps:w.videoGenInputs.originFps,duration_ms:w.videoGenInputs.originDurationMs,camera_strength:w.videoGenInputs.motionIntensity,video_mode:w.videoGenInputs.videoMode,boximator:M,template_id:w.videoGenInputs.templateId}],priority:null==w?void 0:w.priority,model_req_key:null==w?void 0:w.modelReqKey},mode:e.mode,history_option:{story_id:null===(m=e.historyOption)||void 0===m?void 0:m.storyId},commerce_info:(0,p.X)(k),scene:D,client_trace_data:{impression_id:null===(f=e.clientTraceData)||void 0===f?void 0:f.impressionId,activity_id:null===(h=e.clientTraceData)||void 0===h?void 0:h.activityId,hashtag_id:null===(g=e.clientTraceData)||void 0===g?void 0:g.hashtagId,profile_id:null===(b=e.clientTraceData)||void 0===b?void 0:b.profileId,is_regenerate:null===(y=e.clientTraceData)||void 0===y?void 0:y.isRegenerate}}}_convertBatchSubmitRequestParams(e,t){var i=(0,D.Z)(this._convertSubmitRequestParams((0,o._)((0,n._)({},(0,D.Z)(e,"submitIdList")),{submitId:""}),t),"submitId");return(0,o._)((0,n._)({},i),{submit_id_list:e.submitIdList})}constructor(e,t,i){this._httpApiSettingService=e,this._accountService=t,this._environmentService=i}}A=(0,a.gn)([(0,a.fM)(0,g.x),(0,a.fM)(1,I.D),(0,a.fM)(2,h.Y),(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[void 0===g.x?Object:g.x,void 0===I.D?Object:I.D,void 0===h.Y?Object:h.Y])],A)},615704:function(e,t,i){i.d(t,{G:function(){return o}});var r=i(324069),n=i(116244);class o extends r.i{parseResponseDataToResources(e){return(0,n.Ar)(e,!0)}}},114107:function(e,t,i){i.d(t,{x:function(){return s}});var r=i(598506),n=i(897727),o=i(457523),a=i(294202);class s extends r.T{get effectType(){return n.g.Image}get effectSource(){return a.Hw.TUCHONG}get scene(){return o.c.TrackEditor}}},280515:function(e,t,i){i.d(t,{y:function(){return c}});var r=i(789786),n=i(719800),o=i(874800),a=i(401339),s=i(497091);class c extends o.JT{getWorkspace(e){return this._getWorkspaceRepository.getWorkspace(e)}getChanelWorkspace(e){return this._getChanelRepository.getChanelWorkspace(e)}constructor(e){super(),this._instantiationService=e,this._getWorkspaceRepository=this._instantiationService.createInstance(a.u),this._getChanelRepository=new s.Y}}c=(0,r.gn)([(0,r.fM)(0,n.T),(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[void 0===n.T?Object:n.T])],c)},127404:function(e,t,i){i.d(t,{t:function(){return r}});var r=(0,i(971245).yh)("dynamic-dependency-service")},956417:function(e,t,i){i.d(t,{H:function(){return o},a:function(){return a}});var r=i(557679);let n=[];function o({type:e,id:t,data:i}){let o=[],a=[],s=new Set,c=new Set;return i.forEach(e=>{let t=e.type||r.oQ;o.push([t,{...e,local_ms:e.createAt}]),e.id&&a.push(e.id),s.add(t),c.add(e.loggerId)}),n.push({type:e,id:t,ids:new Set(a),loggerIds:c,events:[...s.values()],startTime:Date.now(),endTime:0}),{ids:a,events:o}}function a(e){let t=[];return e.eventData.forEach(e=>{e.events.forEach(e=>{let{id:t}=JSON.parse(e.params);n.forEach(e=>e.ids.delete(t))})}),n=n.filter(e=>{if(e.ids.size)return!0;t.push({...e,endTime:Date.now()+6e4})}),t}},809846:function(e,t,i){let r;i.d(t,{b:function(){return o},l:function(){return a}});var n=i(480277);function o(e,t,i){return void 0===r&&(r=new n.m({region:i})),r.getTraceRetrievalTasks(e,t)}function a(e,t){return void 0===r&&(r=new n.m({region:t})),r.finishRetrievalTask(e)}}}]);