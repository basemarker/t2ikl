"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["8078"],{792316:function(e){var t=Object.prototype.hasOwnProperty,r="~";function s(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function n(e,t,s,n,o){if("function"!=typeof s)throw TypeError("The listener must be a function");var a=new i(s,n||e,o),d=r?r+t:t;return e._events[d]?e._events[d].fn?e._events[d]=[e._events[d],a]:e._events[d].push(a):(e._events[d]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),!new s().__proto__&&(r=!1)),a.prototype.eventNames=function(){var e,s,i=[];if(0===this._eventsCount)return i;for(s in e=this._events)t.call(e,s)&&i.push(r?s.slice(1):s);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=r?r+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var i=0,n=s.length,o=Array(n);i<n;i++)o[i]=s[i].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,s=this._events[t];return s?s.fn?1:s.length:0},a.prototype.emit=function(e,t,s,i,n,o){var a=r?r+e:e;if(!this._events[a])return!1;var d,l,u=this._events[a],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,s),!0;case 4:return u.fn.call(u.context,t,s,i),!0;case 5:return u.fn.call(u.context,t,s,i,n),!0;case 6:return u.fn.call(u.context,t,s,i,n,o),!0}for(l=1,d=Array(c-1);l<c;l++)d[l-1]=arguments[l];u.fn.apply(u.context,d)}else{var p,v=u.length;for(l=0;l<v;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),c){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,s);break;case 4:u[l].fn.call(u[l].context,t,s,i);break;default:if(!d)for(p=1,d=Array(c-1);p<c;p++)d[p-1]=arguments[p];u[l].fn.apply(u[l].context,d)}}return!0},a.prototype.on=function(e,t,r){return n(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return n(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,s,i){var n=r?r+e:e;if(!this._events[n])return this;if(!t)return o(this,n),this;var a=this._events[n];if(a.fn)a.fn===t&&(!i||a.once)&&(!s||a.context===s)&&o(this,n);else{for(var d=0,l=[],u=a.length;d<u;d++)(a[d].fn!==t||i&&!a[d].once||s&&a[d].context!==s)&&l.push(a[d]);l.length?this._events[n]=1===l.length?l[0]:l:o(this,n)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a;e.exports=a},529227:function(e,t,r){r.d(t,{eF:()=>b,J5:()=>O,zW:()=>e$,iH:()=>e5,_s:()=>z,dV:()=>e1,VW:()=>N,Lt:()=>ee,NF:()=>L,or:()=>et,Is:()=>X,qZ:()=>er,Gt:()=>R});var s,i,n,o,a,d,l,u,c,p,v,h,_,g,f,y,m,w,k=r("876826"),I=r("85728"),S=r("929753"),P=r("733730"),D=r("295834"),E=r("789786"),A=r("2910"),F=r("372699"),C=r("824547");function T(e){var t="";t=e<102.4?"".concat(e.toFixed(2),"B"):e<104857.6?"".concat((e/1024).toFixed(2),"KB"):e<0x40000000?"".concat((e/1048576).toFixed(2),"MB"):e<0x10000000000?"".concat((e/0x40000000).toFixed(2),"GB"):"".concat((e/0x10000000000).toFixed(2),"TB");var r="".concat(t),s=r.indexOf(".");return"00"==r.substr(s+1,2)?r.substring(0,s)+r.substr(s+3,2):t}var L=(s={file:{acceptType:["application/zip"],acceptSuffix:[".zip"]},video:{acceptType:["video/mp4","video/mov","video/m4v","video/x-flv","video/quicktime","video/avi","video/webm","video/mp2t","video/x-ms-asf"],acceptSuffix:[".mp4",".mov",".m4v",".flv",".mkv",".avi",".webm",".wmv",".rm",".rmvb",".3gp",".m2ts",".mt2s",".m2t",".mxf",".mpg",".mpeg",".mpe",".ts",".mts",".qt",".asf"]},audio:{acceptType:["audio/mp3","audio/mpeg","audio/m4a","audio/x-m4a","audio/wav","audio/flac"],acceptSuffix:[".mp3",".flac",".m4a",".wav",".aac",".oga",".ogg",".wma",".amr",".aif",".aiff",".ac3",".mpa",".ape",".mac",".mp2",".acc"]},image:{acceptType:["image/jpeg","image/jpg","image/webp","image/bmp","image/png","image/gif","image/heif","image/heic","image/tiff","image/x-tiff","image/x-icon","image/vnd.microsoft.icon","image/svg+xml","image/vnd.adobe.photoshop","image/avif"],acceptSuffix:[".jpeg",".jpg",".png",".gif",".heif",".heic",".tiff",".tif",".ico",".svg",".svgz",".psd",".avif"]}},i=e=>[...s[e].acceptType,...s[e].acceptSuffix].join(","),{file:(0,S._)((0,I._)({},s.file),{accept:i("file")}),video:(0,S._)((0,I._)({},s.video),{accept:i("video")}),audio:(0,S._)((0,I._)({},s.audio),{accept:i("audio")}),image:(0,S._)((0,I._)({},s.image),{accept:i("image")}),allAccept:"".concat(i("video"),",").concat(i("audio"),",").concat(i("image"))});function b(e){var{file:t,accepts:r=["audio","video","image"]}=e,s=t.name.lastIndexOf("."),i="";if(-1!==s&&(i=t.name.substr(s)),i){for(var n of r)if(L[n].acceptSuffix.includes(i.toLocaleLowerCase()))return n}var o=t.type.toLocaleLowerCase();if(o){for(var a of r)if(L[a].acceptType.includes(o))return a}}function O(e){var{file:t,accepts:r=["video","audio","image"]}=e;return!!b({file:t,accepts:r})}function R(e){var t;if(!e)return"file";for(var[r,s]of Object.entries({video:["application/vnd.rn-realmedia-vbr","application/vnd.rn-realmedia","application/mxf"],audio:["application/x-wav","application/ogg","video/x-ms-wma"],image:[]}))if(s.includes(e.toLocaleLowerCase()))return r;return t=e.toLowerCase().startsWith("video")?"video":e.toLowerCase().startsWith("image")?"image":e.toLowerCase().startsWith("audio")?"audio":"file"}function U(e){var t,{obj:r,serializeKey:s,targetKey:i}=e;try{t=JSON.parse(r[s])}catch(e){console.warn("".concat(s," \u5B57\u6BB5\u975E\u6CD5,\u65E0\u6CD5\u89E3\u6790\u8BE5\u5B57\u6BB5\u5185\u5BB9"),r)}return(0,S._)((0,I._)({},r),{[i]:t})}var N={FILM_ASSET:"10001",MID_PRODUCT:"40001",AIGC_VIDEO:"60001"},B=void 0;var H=((n={}).USER_SPACE_SIZE_CHANGE="USER_SPACE_SIZE_CHANGE",n);var z=((o={})[o.VA=0]="VA",o[o.GCP=1]="GCP",o[o.CN=2]="CN",o),x={[z.VA]:"va",[z.GCP]:"gcp"},M=[200,360,480,720,1080,2400,"origin"],j={P200:200,P360:360,P480:480,P720:720,P1080:1080,P2400:2400,ORIGIN:"origin"};j.P200,j.P360,j.P480,j.P720,j.P1080,j.P2400,j.ORIGIN;var Q={0:"origin",1:200,2:360,3:480,4:720,5:1080,6:2400},K={origin:0,200:1,360:2,480:3,720:4,1080:5,2400:6};var V=((a={})[a.UNTRANSCODE=-1]="UNTRANSCODE",a[a.SUCCESS=0]="SUCCESS",a[a.TRANSCODING=1]="TRANSCODING",a[a.FAILED=2]="FAILED",a[a.TIMEOUT=3]="TIMEOUT",a[a.CANCEL=-2]="CANCEL",a),G={360:[640,360],480:[854,480],720:[1280,720],1080:[1920,1080]},q={VIDEO:"video",AUDIO:"audio",IMAGE:"image",LIVE_PHOTO:"live-photo",FILM:"film",PACKAGE:"package",CLUSTER_FILM:"cluster-film",NORMAL:"file",FOLDER:"folder"};class J{constructor(e){this._sourceData=e}}var W=((d={})[d.NORMAL=0]="NORMAL",d[d.SCRIPT=3]="SCRIPT",d[d.GRAPHIC=5]="GRAPHIC",d);var Z=((l={})[l.EDIT=0]="EDIT",l[l.TEMPLATE=1]="TEMPLATE",l[l.IMAGE_TEXT=2]="IMAGE_TEXT",l[l.SCRIPT=3]="SCRIPT",l[l.TOOL=4]="TOOL",l[l.GRAPHIC=5]="GRAPHIC",l),Y=r("144690");var $=((u={})[u.PERSONAL=1]="PERSONAL",u[u.PUBLIC=0]="PUBLIC",u);class X extends J{get isValid(){return!(0,Y.Z)(this._sourceData._meta)}get id(){return this.notOnlyId}get notOnlyId(){return this._sourceData.id}get md5(){return this._sourceData.md5}get name(){var e;return(null===(e=this.entry)||void 0===e?void 0:e.entry_name)||this._sourceData.file_name}get author(){return this._sourceData.author}get sourcePath(){return this._sourceData.source_path}get mime(){return this._sourceData.mime}get subType(){return this._sourceData.sub_type}get size(){return this._sourceData.size}get sizeStr(){return T(this.size)}get filterList(){return this._sourceData.filter_list||[]}get type(){return q.NORMAL}get width(){return this._sourceData.width}get height(){return this._sourceData.height}get updatedAt(){var e,t;return 1e3*((null===(t=this._sourceData)||void 0===t?void 0:null===(e=t.entry)||void 0===e?void 0:e.access_at_ts)||this._sourceData.updated_at_ts)}get createdAt(){return 1e3*this._sourceData.uploaded_at}get downloadUrl(){var e;return null===(e=this._sourceData.asset_meta)||void 0===e?void 0:e.download_url}get meta(){var e;return null===(e=this._sourceData)||void 0===e?void 0:e._meta}get status(){var e;return null===(e=this._sourceData)||void 0===e?void 0:e.status}get permission(){return e5.isGroupSdk?this._sourceData.permission||$.PUBLIC:$.PERSONAL}get isPublic(){return this.permission===$.PUBLIC}get isPersonal(){return this.permission===$.PERSONAL}get owner(){var e,t,r;return null===(r=this._sourceData)||void 0===r?void 0:null===(t=r._meta)||void 0===t?void 0:null===(e=t.uploadSource)||void 0===e?void 0:e.owner}get uploadedAt(){return 1e3*this._sourceData.uploaded_at}get entryId(){return this._sourceData.entry_id}get entry(){return this._sourceData.entry||this._sourceData.entry_data}get sourceData(){return this._sourceData}get hasMaterialTag(){return this._sourceData.has_material_tag}constructor(e,t){super(U({obj:e,serializeKey:"meta",targetKey:"_meta"})),this.sdk=t}}class ee extends X{get type(){return q.AUDIO}get duration(){return this._sourceData.duration}get unencryptedPreviewUrl(){var e,t,r,s;return null===(s=this._sourceData)||void 0===s?void 0:null===(r=s.unencryptedPlayInfo)||void 0===r?void 0:null===(t=r.info)||void 0===t?void 0:null===(e=t.audio)||void 0===e?void 0:e.primary_url}get transcodeStatus(){return this._sourceData.transcode_status}}class et extends X{get type(){return q.IMAGE}get previewUrl(){var e,t,r;return(null===(e=this.imageTranscodeInfo[360])||void 0===e?void 0:e.status_code)===V.SUCCESS?this.imageTranscodeInfo[360].preview_url:null===(r=this._sourceData)||void 0===r?void 0:null===(t=r.asset_meta)||void 0===t?void 0:t.preview360_url}get previewKey(){var e,t,r;return(null===(e=this.imageTranscodeInfo[360])||void 0===e?void 0:e.status_code)===V.SUCCESS?this.imageTranscodeInfo[360].key:null===(r=this._sourceData)||void 0===r?void 0:null===(t=r.asset_meta)||void 0===t?void 0:t.key}get preview72Url(){var e,t,r;return(null===(e=this.imageTranscodeInfo[720])||void 0===e?void 0:e.status_code)===V.SUCCESS?this.imageTranscodeInfo[720].preview_url:null===(r=this._sourceData)||void 0===r?void 0:null===(t=r.asset_meta)||void 0===t?void 0:t.preview720_url}get imageAsyncResize(){return!!this._sourceData.image_async_resize}getTranscodeStatus(e){var t={};return((null==e?void 0:e.length)?e:M).forEach(e=>{var r,s,i,n=null===(s=this._sourceData)||void 0===s?void 0:null===(r=s.asset_meta)||void 0===r?void 0:r["preview".concat(e,"_url")],o=e===j.ORIGIN?e:"p_".concat(e),a=null===(i=this._sourceData.image_transcode_info)||void 0===i?void 0:i[o];a?t[e]=a.status_code:n?t[e]=V.SUCCESS:this.imageAsyncResize?t[e]=V.TRANSCODING:t[e]=V.UNTRANSCODE}),t}get imageTranscodeInfo(){var e={};return M.forEach(t=>{var r="preview".concat(t,"_url"),s=null===(a=this._sourceData)||void 0===a?void 0:null===(o=a.asset_meta)||void 0===o?void 0:o[r],i=t===j.ORIGIN?t:"p_".concat(t),n=null===(d=this._sourceData.image_transcode_info)||void 0===d?void 0:d[i];if(n)e[t]=(0,S._)((0,I._)({},n),{key:this._sourceData.image_transcode_info.key});else if(s&&!(null===(l=e[t])||void 0===l?void 0:l.preview_url)){var o,a,d,l,u,c,p=this.getPreviewSizeByResolution(t);e[t]={preview_url:s,width:p.width,height:p.height,status_code:V.SUCCESS,key:null===(c=this._sourceData)||void 0===c?void 0:null===(u=c.asset_meta)||void 0===u?void 0:u.key}}}),e}getPreviewInfo(e){var t=this;return(0,k._)(function*(){return t.sdk?t.sdk.getImagePreviewInfo(t,e):t.imageTranscodeInfo})()}getPreviewSizeByResolution(e){var t,r=G[e];if(!r||!this.width||!this.height||e===j.ORIGIN)return{width:0,height:0};var s=this.width||0,i=this.height||0,[n,o]=r;if(s/i>3){if(s*i<n*o)return{width:s,height:i};var a=Math.sqrt(n*o/(s*i));return{width:Math.floor(s*a),height:Math.floor(i*a)}}if(s<=n&&i<=o)return{width:s,height:i};var d=n/s,l=o/i;return{width:Math.floor(s*(t=d>l?l:d)),height:Math.floor(i*t)}}}class er extends X{get type(){return q.VIDEO}get duration(){return this._sourceData.duration}get width(){return this._sourceData.width}get height(){return this._sourceData.height}get previewUrl(){var e,t;return null===(t=this._sourceData)||void 0===t?void 0:null===(e=t.asset_meta)||void 0===e?void 0:e.preview360_url}get previewKey(){var e,t;return null===(t=this._sourceData)||void 0===t?void 0:null===(e=t.asset_meta)||void 0===e?void 0:e.key}get unencryptedPreviewUrl(){var e,t,r,s;return null===(s=this._sourceData)||void 0===s?void 0:null===(r=s.unencryptedPlayInfo)||void 0===r?void 0:null===(t=r.info)||void 0===t?void 0:null===(e=t.p360)||void 0===e?void 0:e.primary_url}get sprit(){return this._sourceData.sprite_info}get transcodeStatus(){return this._sourceData.transcode_status}setUnencryptedInfo(e){this._sourceData&&(this._sourceData.unencryptedPlayInfo=e)}}class es extends et{get type(){return q.LIVE_PHOTO}}var ei=r("850078");class en extends J{get isValid(){return!(0,Y.Z)(this._sourceData._meta)}get id(){return this.notOnlyId}get notOnlyId(){return this._sourceData.id}get author(){return this._sourceData.creator}get key(){return this._sourceData.key}get name(){var e,t,r,s;return null!==(s=null===(r=this._sourceData)||void 0===r?void 0:null===(t=r._meta)||void 0===t?void 0:null===(e=t.draft)||void 0===e?void 0:e.name)&&void 0!==s?s:""}get size(){var e,t,r;return(null===(r=this._sourceData)||void 0===r?void 0:null===(t=r._meta)||void 0===t?void 0:null===(e=t.draft)||void 0===e?void 0:e.size)||0}get sizeStr(){return this.size?T(this.size):void 0}get type(){return q.PACKAGE}get subType(){var e,t;return null===(t=this._sourceData._meta)||void 0===t?void 0:null===(e=t.draft)||void 0===e?void 0:e.type}get updatedAt(){var e,t,r,s,i;return(null===(e=this.entry)||void 0===e?void 0:e.access_at_ts)?(null===(t=this.entry)||void 0===t?void 0:t.access_at_ts)*1e3:null===(i=this._sourceData)||void 0===i?void 0:null===(s=i._meta)||void 0===s?void 0:null===(r=s.draft)||void 0===r?void 0:r.updateTime}get createdAt(){var e,t,r,s,i;return null!==(i=null===(t=this._sourceData._meta)||void 0===t?void 0:null===(e=t.createSource)||void 0===e?void 0:e.createTime)&&void 0!==i?i:null===(s=this._sourceData._meta)||void 0===s?void 0:null===(r=s.uploadSource)||void 0===r?void 0:r.createTime}get meta(){var e;return null===(e=this._sourceData)||void 0===e?void 0:e._meta}get coverMd5(){var e,t,r;return null===(r=this._sourceData)||void 0===r?void 0:null===(t=r.assets)||void 0===t?void 0:null===(e=t.find(e=>{var t,r;return e.path===(null===(r=this._sourceData)||void 0===r?void 0:null===(t=r._meta)||void 0===t?void 0:t.draft.cover)}))||void 0===e?void 0:e.md5}get allCoverMd5(){if(!(null===(t=this._sourceData)||void 0===t?void 0:null===(e=t._meta)||void 0===e?void 0:e.draft.cover))return[];var e,t,r,s,i=[...null===(r=this._sourceData)||void 0===r?void 0:r.assets].reverse();return null===(s=(0,ei.Z)(i,"path").reverse())||void 0===s?void 0:s.filter(e=>/^cover(_[0-9]+)?\.(jpe?g|png)$/.test(e.path)).map(e=>e.md5)}get duration(){var e,t;return null===(t=this._sourceData)||void 0===t?void 0:null===(e=t._meta)||void 0===e?void 0:e.draft.duration}get assets(){return(this._sourceData.assets||[]).map(e=>{var t=e.meta||"",r={};try{r=JSON.parse(t)}catch(e){}return(0,S._)((0,I._)({},e),{entryIds:e.entry_ids,meta:r,_meta:t})})}get creator(){return this._sourceData.creator}get status(){var e;return null===(e=this._sourceData)||void 0===e?void 0:e.status}get permission(){return e5.isGroupSdk?this._sourceData.permission||$.PUBLIC:$.PERSONAL}get isPublic(){return this.permission===$.PUBLIC}get isPersonal(){return this.permission===$.PERSONAL}get owner(){var e,t,r,s,i,n;return(null===(r=this._sourceData)||void 0===r?void 0:null===(t=r._meta)||void 0===t?void 0:null===(e=t.createSource)||void 0===e?void 0:e.owner)||(null===(n=this._sourceData)||void 0===n?void 0:null===(i=n._meta)||void 0===i?void 0:null===(s=i.uploadSource)||void 0===s?void 0:s.owner)||""}get entryId(){return this._sourceData.entry_id}get entry(){return this._sourceData.entry}constructor(e){var t=U({obj:e,serializeKey:"meta",targetKey:"_meta"});super((0,S._)((0,I._)({},e),{_meta:t._meta,entry:t}))}}class eo{get fileName(){return this.options.fileName}get uid(){return this.options.uid}get asset(){return this.options.assetInfo}get clusterInfo(){return this.options.clusterInfo}get duration(){return this.options.duration}get size(){return this.options.size}get type(){return this.options.type}get spritInfo(){return this.options.spritInfo}get videoInfo(){return this.options.videoInfo}get audioInfo(){return this.options.audioInfo}get extInfo(){return this.options.extInfo}merge(e){return(0,C.Z)(this.options,e.options),this}constructor(e){this.options=e}}class ea extends er{get type(){return q.FILM}}class ed extends J{get type(){return q.CLUSTER_FILM}get id(){var e;return this.entryId||(null===(e=this.entry)||void 0===e?void 0:e.entry_id)}get notOnlyId(){return this._sourceData.cluster_id}get name(){var e;return(null===(e=this._lastAsset)||void 0===e?void 0:e.name)||""}get duration(){var e;return null===(e=this._lastAsset)||void 0===e?void 0:e.duration}get size(){var e;return null===(e=this._lastAsset)||void 0===e?void 0:e.size}get sizeStr(){var e;return null===(e=this._lastAsset)||void 0===e?void 0:e.sizeStr}get author(){var e;return null===(e=this.entry)||void 0===e?void 0:e.owner_id}get updatedAt(){var e,t;return(null===(t=this._sourceData)||void 0===t?void 0:null===(e=t.entry)||void 0===e?void 0:e.access_at_ts)*1e3}get relation(){var e;return null===(e=this._sourceData._relation)||void 0===e?void 0:e.map(e=>"".concat(e))}get meta(){var e;return null===(e=this._sourceData)||void 0===e?void 0:e._meta}get assetCount(){return this._sourceData.n_asset}get asset(){return this._sourceData.assets||[]}get lastAssetId(){var e,t,r=this.asset[this.asset.length-1],s=e5.sortArrayByRelation({exists:this.asset,relation:null!==(e=this.relation)&&void 0!==e?e:[]});return null!==(t=s[s.length-1])&&void 0!==t?t:r}get bindId(){return this._sourceData.bind_id}updateLastAsset(e){this._lastAsset=e}get draftName(){var e,t,r;return null!==(r=this._draftName)&&void 0!==r?r:null===(t=this.meta)||void 0===t?void 0:null===(e=t.draft)||void 0===e?void 0:e.name}get lastAsset(){return this._lastAsset}tryGetDraftName(){var e=this;return(0,k._)(function*(){if(!e.bindId)return e._draftName=null===(i=e.meta)||void 0===i?void 0:null===(s=i.draft)||void 0===s?void 0:s.name,e._draftName;try{var t,r,s,i,n,o,a,d=yield e5.getPackageByKey(e.bindId);return e._draftName=null!==(a=null==d?void 0:d.name)&&void 0!==a?a:null===(o=e.meta)||void 0===o?void 0:null===(n=o.draft)||void 0===n?void 0:n.name,e._draftName}catch(s){return null===(r=e.meta)||void 0===r?void 0:null===(t=r.draft)||void 0===t?void 0:t.name}})()}get permission(){var e,t;return e5.isGroupSdk?null!==(t=null===(e=this.entry)||void 0===e?void 0:e.permission)&&void 0!==t?t:$.PUBLIC:$.PERSONAL}get isPublic(){return this.permission===$.PUBLIC}get isPersonal(){return this.permission===$.PERSONAL}get owner(){var e,t;return(null===(t=this._sourceData._meta)||void 0===t?void 0:null===(e=t.uploadSource)||void 0===e?void 0:e.owner)||""}get entryId(){return this._sourceData.entry_id}get entry(){return this._sourceData.entry}get createdAt(){var e,t;return(null===(t=this._sourceData)||void 0===t?void 0:null===(e=t.entry)||void 0===e?void 0:e.created_at_ts)*1e3}constructor({cluster:e,lastAsset:t}){var r=U({obj:e,serializeKey:"meta",targetKey:"_meta"});super(r=U({obj:r,serializeKey:"relation",targetKey:"_relation"})),this._lastAsset=t,this.tryGetDraftName()}}class el extends J{get type(){return q.FOLDER}get meta(){var e;return null===(e=this._sourceData)||void 0===e?void 0:e.entry._meta}get id(){var e;return null===(e=this.entry)||void 0===e?void 0:e.entry_id}get notOnlyId(){return this._sourceData.id}get entry(){var e;return null===(e=this._sourceData)||void 0===e?void 0:e.entry}get name(){var e;return null===(e=this._sourceData)||void 0===e?void 0:e.name}get subCnt(){return this._sourceData.sub_cnt}get updatedAt(){var e;return(null===(e=this._sourceData)||void 0===e?void 0:e.entry.access_at_ts)*1e3}get accessAt(){var e;return(null===(e=this._sourceData)||void 0===e?void 0:e.entry.access_at_ts)*1e3}get createdAt(){var e;return(null===(e=this._sourceData)||void 0===e?void 0:e.entry.created_at_ts)*1e3}get creator(){return this._sourceData.entry.creator_id}get permission(){return e5.isGroupSdk?this._sourceData.entry.permission||$.PUBLIC:$.PERSONAL}get isPublic(){return this.permission===$.PUBLIC}get isPersonal(){return this.permission===$.PERSONAL}get owner(){var e,t;return null===(t=this.meta)||void 0===t?void 0:null===(e=t.uploadSource)||void 0===e?void 0:e.owner}get author(){return this._sourceData.entry.owner_id}get size(){var e;return null!==(e=this._sourceData.size)&&void 0!==e?e:0}get sizeStr(){return"0"}constructor(e){super((0,S._)((0,I._)({},e),{entry:U({obj:e.entry,serializeKey:"meta",targetKey:"_meta"})}))}}function eu(e,t){switch(R(e.mime)){case"video":if((e.filter_list||[]).includes(N.FILM_ASSET))return new ea(e);return new er(e);case"audio":return new ee(e);case"image":if("livephoto"===e.sub_type)return new es(e);return new et(e,t);default:return new X(e)}}function ec(e,t){var r,s;(null==e5?void 0:e5.options)&&(null==e5?void 0:null===(r=e5.options)||void 0===r?void 0:r.level)==="trace"&&console[null!==(s=null==t?void 0:t.type)&&void 0!==s?s:"info"]("EverCloud: ".concat(e))}var ep=(e,t)=>{if(e===$.PERSONAL){var r=!1;if(t.type===q.PACKAGE){if(t.subType===Z.SCRIPT)return t.owner===e5.uid;r=t.creator===e5.everUserId||t.owner===e5.uid}return t.author===e5.everUserId||r}return t.isPublic},ev="1.0.0";function eh(){var e;return{uploadSource:{owner:null===(e=e5.options)||void 0===e?void 0:e.user_id,platform:"browser",systemVersion:window.navigator.userAgent,appVersion:ev}}}class e_{acquire(){var e=this;return(0,k._)(function*(){return new Promise(t=>{e._availableConcurrency>0?(e._availableConcurrency--,t()):e._waitingQueue.push(t)})})()}release(){if(this._waitingQueue.length>0){var e=this._waitingQueue.shift();e&&e()}else this._availableConcurrency<this._maxConcurrency&&this._availableConcurrency++}constructor(e){this._maxConcurrency=e,this._availableConcurrency=e,this._waitingQueue=[]}}var eg=((c={}).Start="start",c.CompleteUpload="complete_upload",c.CalcMd5="calc_md5",c.CalcCrc="calc_crc",c.AnalyzeFile="analyze_file",c.UploadProcess="upload_process",c.Init="init",c.Error="error",c.PrepareAsset="prepare_asset",c.CreateAsset="create_asset",c.CancelFileAnalyze="cancel_file_analyze",c);class ef extends Error{constructor(){super("DuplicateNameError")}}class ey extends Error{constructor(e){super("TranscodeError"),this.status=e}}class em extends Error{constructor(){super("Request Timeout")}}class ew extends Error{constructor(){super("Init Timeout")}}class ek extends Error{constructor(){super("Can not move public item to personal folder")}}class eI extends Error{constructor(e){super("Folder depth can not more than ".concat(e))}}class eS extends P.Z{destroy(){this.requestId="",this.isDestroy=!0,this.sdk.eventBus.removeListener(e$.BusDestroy,this.destroy),this.removeAllListeners()}constructor(e,t){super(),this.requestId="",this.isDestroy=!1,this.requestId=e,this.sdk=t,this.sdk.eventBus.addListener(e$.BusDestroy,this.destroy)}}var eP=((p={}).WaitingUpload="waitingUpload",p.Uploading="uploading",p.Success="success",p.Cancel="cancel",p.Error="error",p);class eD extends eS{destroy(){super.destroy()}}class eE extends eS{setRequestId(e){if("unknow"===this.requestId)this.requestId=e;else throw Error("request-id \u5DF2\u7ECF\u521D\u59CB\u5316\u5B8C\u6210\uFF0C\u8BF7\u52FF\u4FEE\u6539")}done(){return new Promise((e,t)=>{if(this.result){"success"===this.result.status?e(this.result):t(this.result);return}this.finishListenQueue.push([e,t])})}appendChunk(e){this.chunks.push(e)}cancel(){var e=this;return(0,k._)(function*(){return yield e.sdk.sdk.cancel_upload(e.requestId)})()}destroy(){super.destroy(),this.chunks=[],this.finishListenQueue=[],this.sdk.eventBus.removeListener(e$.AssetDownloadIdle,this.onIdleHandler),this.sdk.eventBus.removeListener(e$.AssetDownloadProgress,this.onProgressHandler),this.sdk.eventBus.removeListener(e$.AssetDownloaddFinish,this.onFinishHandler)}thirdpartDone(e){var{buffer:t}=e;this.result={status:"success",buffer:t},this._finish()}_onIdleHandler(){var e;null===(e=this.onIdle)||void 0===e||e.call(this)}_onProgressHandler(e){var t;null===(t=this.onProgress)||void 0===t||t.call(this,{total:e.bytes_total,done:e.bytes_done})}_onFinishHandler(e){if(e.completed){var t,r,s,i=(r=new Uint8Array((t=this.chunks).reduce((e,t)=>e+t.length,0)),s=0,t.forEach(e=>{r.set(e,s),s+=e.length}),r);this.result={status:"success",buffer:i},this.cacheSource(i)}else e.cancelled?this.result={status:"cancel"}:this.result={status:"error",errInfo:e.error_info};this._finish()}cacheSource(e){var t=this;return(0,k._)(function*(){var r;if(t.sdk.cachePlugin&&(null===(r=t._options)||void 0===r?void 0:r.url))try{yield t.sdk.cachePlugin.saveSourceBlob({key:t._options.url,buffer:e}),ec("\u7F13\u5B58\u6587\u4EF6".concat(t._options.url,"\u6210\u529F.")),console.log("\u7F13\u5B58\u6587\u4EF6".concat(t._options.url,"\u6210\u529F."))}catch(e){console.log("\u7F13\u5B58\u6587\u4EF6".concat(t._options.url,"\u5931\u8D25: ").concat(e)),ec("\u7F13\u5B58\u6587\u4EF6".concat(t._options.url,"\u5931\u8D25: ").concat(e),{type:"warn"})}})()}_finish(){var e;for(var t of this.finishListenQueue)"success"===this.result.status?t[0](this.result):t[1](this.result);null===(e=this.onFinish)||void 0===e||e.call(this,this.result),this.destroy()}eventFilter(e){return t=>{var{request_id:r}=t;r===this.requestId&&e(t)}}constructor(e,t){super("unknow",t),this.size=0,this.chunks=[],this.finishListenQueue=[],this._options=e,this.onIdleHandler=this.eventFilter(this._onIdleHandler.bind(this)),this.onProgressHandler=this.eventFilter(this._onProgressHandler.bind(this)),this.onFinishHandler=this.eventFilter(this._onFinishHandler.bind(this)),this.sdk.eventBus.addListener(e$.AssetDownloadIdle,this.onIdleHandler),this.sdk.eventBus.addListener(e$.AssetDownloadProgress,this.onProgressHandler),this.sdk.eventBus.addListener(e$.AssetDownloaddFinish,this.onFinishHandler)}}class eA extends eD{get fileType(){return this._fileType}done(){return new Promise((e,t)=>{if(this.result){"success"===this.result.status?e(this.result):t(this.result);return}this.finishListenQueue.push([e,t])})}cancel(){var e=this;return(0,k._)(function*(){return yield e.sdk.sdk.cancel_upload(e.requestId)})()}destroy(){super.destroy(),this.finishListenQueue=[],this.sdk.eventBus.removeListener(e$.UploadIdle,this.onIdleHandler),this.sdk.eventBus.removeListener(e$.UploadProgress,this.onProgressHandler),this.sdk.eventBus.removeListener(e$.UploadFinish,this.onFinishHandler)}_onUploadMetaReadyHandler(e){var t;null===(t=this.onUploadMetaReady)||void 0===t||t.call(this,{uploadId:e.upload_id,md5:e.md5})}_onIdleHandler(e){var t;null===(t=this.onIdle)||void 0===t||t.call(this,e)}_onProgressHandler(e){var t;null===(t=this.onProgress)||void 0===t||t.call(this,{total:e.bytes_total,done:e.bytes_done,md5:e.md5})}_onFinishHandler(e){var t=this;return(0,k._)(function*(){var r;if(e.completed){var s,i=e.asset_id,n=e.entry_id;if(!i){if(n)try{i=(yield t.sdk.getEntryAsset(n,!0)).id}catch(r){i=(yield t.sdk.getAssetByMd5(e.md5)).id}else i=(yield t.sdk.getAssetByMd5(e.md5)).id}if(t._autoPromote){if(i)try{yield t.sdk.dependencies.apiFunc.promoteAsset({assetId:i,spaceId:t.sdk.spaceId,workspaceId:t._workspaceId})}catch(e){t.result={status:"error",errInfo:{code:-1,msg:"asset promote failure, cause:".concat(null==e?void 0:e.message)}}}else t.result={status:"error",errInfo:{code:-1,msg:"asset id is not found, could not promote"}}}(null===(s=t.result)||void 0===s?void 0:s.status)!=="error"&&(t.result={status:"success",fileId:i,md5:e.md5,entry:e.entry,entryId:n})}else e.cancelled?t.result={status:"cancel"}:t.result={status:"error",errInfo:{code:e.error_info.code,msg:e.error_info.message,message:e.error_info.message}};for(var o of t.finishListenQueue)"success"===t.result.status?o[0](t.result):o[1](t.result);null===(r=t.onFinish)||void 0===r||r.call(t,t.result),t.destroy()})()}eventFilter(e){return t=>{var{request_id:r}=t;r===this.requestId&&e(t)}}constructor({requestId:e,fileType:t,autoPromote:r,workspaceId:s},i){super(e,i),this._autoPromote=!1,this.finishListenQueue=[],this._fileType=t,this._autoPromote=r,this._workspaceId=s,this.onIdleHandler=this.eventFilter(this._onIdleHandler.bind(this)),this.onUploadMetaReadyHandler=this.eventFilter(this._onUploadMetaReadyHandler.bind(this)),this.onProgressHandler=this.eventFilter(this._onProgressHandler.bind(this)),this.onFinishHandler=this.eventFilter(this._onFinishHandler.bind(this)),this.sdk.eventBus.addListener(e$.UploadIdle,this.onIdleHandler),this.sdk.eventBus.addListener(e$.UploadMetaReady,this.onUploadMetaReadyHandler),this.sdk.eventBus.addListener(e$.UploadProgress,this.onProgressHandler),this.sdk.eventBus.addListener(e$.UploadFinish,this.onFinishHandler)}}class eF extends eD{get fileType(){var e;return null===(e=this._params)||void 0===e?void 0:e.fileType}done(){return new Promise((e,t)=>{if(this.result){"success"===this.result.status?e(this.result):t(this.result);return}this.finishListenQueue.push([e,t])})}cancel(e){var t,r=this;return new Promise((t=(0,k._)(function*(t,s){var i,n,o,a;if(null===(i=r._params)||void 0===i?void 0:i.uploader){try{yield null===(o=r._params.uploader)||void 0===o?void 0:null===(n=o.cancel)||void 0===n?void 0:n.call(o,e),r.finishListenQueue=r.finishListenQueue.filter(t=>t.fileKey===e),null===(a=r.onCancel)||void 0===a||a.call(r,e),t()}catch(e){console.error(e),s(null==e?void 0:e.message)}return}s("uploader does not exist")}),function(e,r){return t.apply(this,arguments)}))}destroy(){this._params=void 0,this.finishListenQueue=[]}onFinishHandler(){var e,t;for(var r of this.finishListenQueue)(null===(t=this.result)||void 0===t?void 0:t.status)==="success"?r[0](this.result):r[1](this.result);null===(e=this.onFinish)||void 0===e||e.call(this,this.result),this.destroy()}constructor(e,t){super("unknow",t),s=this,this.finishListenQueue=[],this._params=e;var r,s,i,n="video";switch(e.fileType){case"video":n="video",i=0;break;case"audio":n="video",i=2;break;default:n="object",i=1}this.onStart=e.onStart,e.uploader.upload({file:e.file,type:n,onSuccess:(r=(0,k._)(function*(t){s.result={status:"success"};var r,n,o=t.Vid||t.Uri;s.vid=o;try{var a=yield s.sdk.dependencies.apiFunc.createVideoData({vid:o,tmp_id:s.sdk.getTempId,file_name:e.fileName,file_type:i,source_path:e.file.webkitRelativePath?e.file.webkitRelativePath:e.fileName});s.result.fileId=a,s.result.uri=t.Uri}catch(e){s.result.status="error",s.result.errInfo={code:(null==e?void 0:null===(r=e.data)||void 0===r?void 0:r.ret)||-1,msg:(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.errmsg)||"create video task failure"}}s.onFinishHandler()}),function(e){return r.apply(this,arguments)}),onError:e=>{var t;this.result={status:"error",errInfo:{code:null==e?void 0:null===(t=e.extra)||void 0===t?void 0:t.errorCode}},this.onFinishHandler()},onStart:(e,t)=>{var r,s;null===(r=this.onIdle)||void 0===r||r.call(this),null===(s=this.onStart)||void 0===s||s.call(this,e,t)},onProgress:e=>{var t;null===(t=this.onProgress)||void 0===t||t.call(this,{total:e.fileSize,done:Math.floor(e.fileSize*(e.percent/100))})}})}}class eC extends eS{destroy(){super.destroy()}}class eT extends eC{done(){return new Promise((e,t)=>{this.result&&("success"===this.result.status?e(this.result):t(this.result)),this.finishListenQueue.push([e,t])})}cancel(){var e=this;return(0,k._)(function*(){return yield e.sdk.sdk.cancel_get_asset_play_info_loop({ids:e.target.id})})()}destroy(){super.destroy(),this.finishListenQueue=[],this.sdk.eventBus.removeListener(e$.VideoInfoEndPullEvent,this.onTranscodeDoneHandler)}_onTranscodeDoneHandler(e){for(var t of e.infos)if(t[this.target.key]===this.target.id){this.result={status:"success",data:t},this.onFinishHandler();return}for(var r of e.failed_ids)if(r[this.target.key]===this.target.id){this.result={status:"error",errInfo:new ey(r.status)},this.onFinishHandler();return}}onFinishHandler(){var e,t;for(var r of this.finishListenQueue)(null===(t=this.result)||void 0===t?void 0:t.status)==="success"?r[0](this.result):r[1](this.result);null===(e=this.onFinish)||void 0===e||e.call(this,this.result),this.destroy()}constructor(e,t){super("unknow",t),this.finishListenQueue=[],this.target=e,this.onTranscodeDoneHandler=this._onTranscodeDoneHandler.bind(this),this.sdk.eventBus.addListener(e$.VideoInfoEndPullEvent,this.onTranscodeDoneHandler)}}class eL extends eC{done(){return new Promise((e,t)=>{if(this.result){"success"===this.result.status?e(this.result):t(this.result);return}this.finishListenQueue.push([e,t])})}cancel(){var e=this;return(0,k._)(function*(){e.result={status:"cancel"},e.onFinishHandler()})()}destroy(){super.destroy(),clearInterval(this.timer),this.finishListenQueue=[],this.sdk.eventBus.removeListener(e$.VideoInfoEndPullEvent,this.onTranscodeDoneHandler)}fetchVideoTaskInfo(){var e=this;return(0,k._)(function*(){try{var t=yield e.sdk.dependencies.apiFunc.getVideoTaskInfo(e.options);switch(e.delayTime=Date.now(),t.status){case 0:return;case 1:e.result={status:"success",data:t},e.onFinishHandler();return;default:e.onFinishHandler(),e.result={status:"error",errInfo:new TranscodeError};return}}catch(t){e.result={status:"error",errInfo:{code:t.data.ret,msg:t.data.errmsg}},e.onFinishHandler()}})()}onFinishHandler(){var e,t;for(var r of this.finishListenQueue)(null===(t=this.result)||void 0===t?void 0:t.status)==="success"?r[0](this.result):r[1](this.result);null===(e=this.onFinish)||void 0===e||e.call(this,this.result),this.destroy()}constructor(e,t){super("unknow",t),this.delayTime=Date.now(),this.Delay_Times=12e3,this.finishListenQueue=[],this.options=e,this.timer=setInterval(()=>{Date.now()-this.delayTime>this.Delay_Times?(this.result={status:"error",errInfo:{code:-1,msg:"overtime"}},this.onFinishHandler()):this.fetchVideoTaskInfo()},3e3)}}class eb extends eS{done(){return new Promise((e,t)=>{if(this.result){"success"===this.result.status?e(this.result):t(this.result);return}this.finishListenQueue.push([e,t])})}cancel(){var e=this;return(0,k._)(function*(){return yield e.sdk.sdk.cancel_get_sync_state_loop({resource:[e.target.id]})})()}destroy(){super.destroy(),this.finishListenQueue=[],this.sdk.eventBus.removeListener(e$.ThridPartResourceSyncStateEvent,this.onSyncAssetHandler)}_onSyncAssetHandler(e){for(var t of e.sync_ids)if(t.resource_id===this.target.id){this.result={status:"success",data:{resourceId:t.resource_id,md5:t.md5,assetId:t.asset_id,entryId:t.entry_id}},this.onFinishHandler();return}for(var r of e.failed_ids)if(r===this.target.id){this.result={status:"error"},this.onFinishHandler();return}if(1===e.api_failed){this.result={status:"error",errMsg:"Network failure"},this.onFinishHandler();return}}onFinishHandler(){var e,t;for(var r of this.finishListenQueue)(null===(t=this.result)||void 0===t?void 0:t.status)==="success"?r[0](this.result):r[1](this.result);null===(e=this.onFinish)||void 0===e||e.call(this,this.result),this.destroy()}constructor(e,t){super("unknow",t),this.finishListenQueue=[],this.target=e,this.onSyncAssetHandler=this._onSyncAssetHandler.bind(this),this.sdk.eventBus.addListener(e$.ThridPartResourceSyncStateEvent,this.onSyncAssetHandler)}}class eO{done(){return new Promise((e,t)=>{this.result&&("success"===this.result.status?e(this.result):t(this.result)),this.finishListenQueue.push([e,t])})}cancel(){var e=this;return(0,k._)(function*(){return yield e.sdk.sdk.cancel_get_preivew_info_loop({ids:"id"===e.target.key?[e.target.id]:[],md5s:"md5"===e.target.key?[e.target.id]:[]})})()}destroy(){this.finishListenQueue=[],this.sdk.eventBus.removeListener(e$.PreviewInfoEndPullEvent,this.onDoneHandler)}_onDoneHandler(e){for(var t of e.infos)if(t[this.target.key]===this.target.id){this.result={status:"success",data:eu(t,this.sdk)},this.onFinishHandler();return}e.timeout&&(this.result={status:"error",errInfo:new em})}onFinishHandler(){var e,t;for(var r of this.finishListenQueue)(null===(t=this.result)||void 0===t?void 0:t.status)==="success"?r[0](this.result):r[1](this.result);null===(e=this.onFinish)||void 0===e||e.call(this,this.result),this.destroy()}constructor(e,t){this.finishListenQueue=[],this.target=e,this.sdk=t,this.onDoneHandler=this._onDoneHandler.bind(this),this.sdk.eventBus.addListener(e$.PreviewInfoEndPullEvent,this.onDoneHandler)}}class eR{done(){return new Promise((e,t)=>{this.result&&("success"===this.result.status?e(this.result):t(this.result)),this.finishListenQueue.push([e,t])})}cancel(){var e=this;return(0,k._)(function*(){return yield e.sdk.sdk.cancel_get_preivew_info_loop({ids:"id"===e.target.key?[e.target.id]:[],md5s:"md5"===e.target.key?[e.target.id]:[]})})()}destroy(){this.finishListenQueue=[],this.sdk.eventBus.removeListener(e$.SpriteInfoEndPullEvent,this.onDoneHandler)}_onDoneHandler(e){for(var t of e.infos)if(t[this.target.key]===this.target.id){this.result={status:"success",data:eu(t)},this.onFinishHandler();return}e.timeout&&(this.result={status:"error",errInfo:new em})}onFinishHandler(){var e,t;for(var r of this.finishListenQueue)(null===(t=this.result)||void 0===t?void 0:t.status)==="success"?r[0](this.result):r[1](this.result);null===(e=this.onFinish)||void 0===e||e.call(this,this.result),this.destroy()}constructor(e,t){this.finishListenQueue=[],this.target=e,this.sdk=t,this.onDoneHandler=this._onDoneHandler.bind(this),this.sdk.eventBus.addListener(e$.SpriteInfoEndPullEvent,this.onDoneHandler)}}class eU extends eS{done(){return new Promise((e,t)=>{this.result&&("success"===this.result.status?e(this.result):t(this.result)),this.finishListenQueue.push([e,t])})}destroy(){super.destroy(),this.finishListenQueue=[],this.sdk.eventBus.removeListener(e$.PreviewInfoEndPullEvent,this.onDoneHandler)}_onProgressHandler(e){if(e.process_id=this.requestId){var t;null===(t=this.onProgress)||void 0===t||t.call(this,e.progress)}}_onDoneHandler(e){var t,r,{process_id:s,status:i}=e;if(s===this.requestId){if(3===i){this.result={status:"success",data:e},this._onFinishHandler(),null===(t=this.onProgress)||void 0===t||t.call(this,100);return}if(4===i){this.result={status:"error",data:e},this._onFinishHandler(),null===(r=this.onProgress)||void 0===r||r.call(this,100);return}}}_onFinishHandler(){for(var e of this.finishListenQueue){var t;(null===(t=this.result)||void 0===t?void 0:t.status)==="success"?e[0](this.result):e[1](this.result)}this.destroy()}constructor(e,t){super(e,t),this.finishListenQueue=[],this.onDoneHandler=this._onDoneHandler.bind(this),this.onProgressHandler=this._onProgressHandler.bind(this),this.sdk.eventBus.addListener(e$.SpaceMoveProgressEvent,this.onProgressHandler),this.sdk.eventBus.addListener(e$.SpaceMoveFinishEvent,this.onDoneHandler)}}class eN extends eS{done(){return new Promise((e,t)=>{this.result&&("success"===this.result.status?e(this.result):t(this.result)),this.finishListenQueue.push([e,t])})}destroy(){super.destroy(),this.finishListenQueue=[],this.sdk.eventBus.removeListener(e$.PreviewInfoEndPullEvent,this.onDoneHandler)}_onProgressHandler(e){if(e.process_id=this.requestId){var t;null===(t=this.onProgress)||void 0===t||t.call(this,e.progress)}}_onDoneHandler(e){var t,r,{process_id:s,status:i}=e;if(s===this.requestId){if(3===i){this.result={status:"success",data:e},this._onFinishHandler(),null===(t=this.onProgress)||void 0===t||t.call(this,100);return}if(4===i){this.result={status:"error",data:e},null===(r=this.onProgress)||void 0===r||r.call(this,100),this._onFinishHandler();return}}}_onFinishHandler(){for(var e of this.finishListenQueue){var t;(null===(t=this.result)||void 0===t?void 0:t.status)==="success"?e[0](this.result):e[1](this.result)}this.destroy()}constructor(e,t){super(e,t),this.finishListenQueue=[],this.sdk=t,this.onDoneHandler=this._onDoneHandler.bind(this),this.onProgressHandler=this._onProgressHandler.bind(this),this.sdk.eventBus.addListener(e$.SpaceCopyProgressEvent,this.onProgressHandler),this.sdk.eventBus.addListener(e$.SpaceCopyFinishEvent,this.onDoneHandler)}}class eB extends eC{done(){return new Promise((e,t)=>{this.result&&this.result.status&&("success"===this.result.status?e(this.result):t(this.result)),this.finishListenQueue.push([e,t])})}cancel(){var e=this;return(0,k._)(function*(){var t,r;return e.result.status="cancel",null===(r=e.result)||void 0===r||null===(t=r.data)||void 0===t||t.forEach((t,r)=>{if(t===V.UNTRANSCODE){var s,i;null===(i=e.result)||void 0===i||null===(s=i.data)||void 0===s||s.set(r,V.CANCEL)}}),yield e.sdk.sdk.cancel_image_transcode_info_loop({listeners:e.target.map(e=>(0,S._)((0,I._)({},e),{transcode_type:K[e.resolution]})),cancel_all:0})})()}destroy(){super.destroy(),clearTimeout(this._triggerTimer),this.finishListenQueue=[],this.sdk.eventBus.removeListener(e$.ImageTranscodeInfoEndPull,this.onTranscodeDoneHandler)}_triggerGetUpdates(){this._triggerTimer=setTimeout(()=>{this.sdk.throttlingGetUpdatesTrigger({throttle:this._triggerTimes}),this._triggerTimer=void 0,this._triggerGetUpdates()},this._triggerTimes)}_onTranscodeDoneHandler(e){var t,r,s;if(e.timeout){null===(t=this.result.data)||void 0===t||t.forEach((e,t)=>{if(e===V.UNTRANSCODE){var r;null===(r=this.result.data)||void 0===r||r.set(t,V.TIMEOUT),this.finishedFlag+=1}}),null===(r=this.onProcess)||void 0===r||r.call(this,this.result),this.result.status="error",this.onFinishHandler();return}for(var i of e.infos)s=this,function(e){var t,r,i,n=!1,{transcode_type:o,assets:a,failed_list:d}=e,l=Q[o];null==a||a.forEach(e=>{var t,r,i,o,a,d,u,c,p="".concat(l,"_").concat(e.id),v="".concat(l,"_").concat(e.md5);(null===(r=s.result)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.get(p))===V.UNTRANSCODE&&(null===(d=s.result)||void 0===d||null===(a=d.data)||void 0===a||a.set(p,V.SUCCESS),s.finishedFlag+=1,n=!0),(null===(o=s.result)||void 0===o?void 0:null===(i=o.data)||void 0===i?void 0:i.get(v))===V.UNTRANSCODE&&(null===(c=s.result)||void 0===c||null===(u=c.data)||void 0===u||u.set(v,V.SUCCESS),s.finishedFlag+=1,n=!0)}),null==d||d.forEach(e=>{var t,r,i,o,a,d,u,c,p="".concat(l,"_").concat(e.asset_id),v="".concat(l,"_").concat(e.md5);(null===(r=s.result)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.get(p))===V.UNTRANSCODE&&(null===(d=s.result)||void 0===d||null===(a=d.data)||void 0===a||a.set(p,V.FAILED),s.finishedFlag+=1,n=!0),(null===(o=s.result)||void 0===o?void 0:null===(i=o.data)||void 0===i?void 0:i.get(v))===V.UNTRANSCODE&&(null===(c=s.result)||void 0===c||null===(u=c.data)||void 0===u||u.set(v,V.FAILED),s.finishedFlag+=1,n=!0)}),n&&(null===(r=(i=s).onProcess)||void 0===r||r.call(i,s.result)),(null===(t=s.result.data)||void 0===t?void 0:t.size)===s.finishedFlag&&(s.result.status="success",s.onFinishHandler())}(i)}onFinishHandler(){var e,t;for(var r of this.finishListenQueue)(null===(t=this.result)||void 0===t?void 0:t.status)==="success"?r[0](this.result):r[1](this.result);null===(e=this.onFinish)||void 0===e||e.call(this,this.result),this.destroy()}constructor(e,t){super("unknow",t),this.result={data:new Map},this.finishedFlag=0,this.finishListenQueue=[],this._triggerTimes=3e3,this.target=e,e.forEach(e=>{var t,r;null===(t=e.ids)||void 0===t||t.forEach(t=>{var r,s;null===(s=this.result)||void 0===s||null===(r=s.data)||void 0===r||r.set("".concat(e.resolution,"_").concat(t),V.UNTRANSCODE)}),null===(r=e.md5s)||void 0===r||r.forEach(t=>{var r,s;null===(s=this.result)||void 0===s||null===(r=s.data)||void 0===r||r.set("".concat(e.resolution,"_").concat(t),V.UNTRANSCODE)})}),this._triggerGetUpdates(),this.onTranscodeDoneHandler=this._onTranscodeDoneHandler.bind(this),this.sdk.eventBus.addListener(e$.ImageTranscodeInfoEndPull,this.onTranscodeDoneHandler)}}function eH(){return function(e,t,r){var s=r.value;return"function"==typeof s&&(r.value=(0,k._)(function*(){for(var e,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];return yield null===this||void 0===this?void 0:null===(e=this.syncDone)||void 0===e?void 0:e.call(this),yield s.apply(this,r)})),r}}function ez(){return function(e,t,r){var s=r.value;return"function"==typeof s&&(r.value=(0,k._)(function*(){for(var e,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];return yield null===this||void 0===this?void 0:null===(e=this.init)||void 0===e?void 0:e.call(this),yield s.apply(this,r)})),r}}function ex(){return function(e,t,r){var s=r.value;return"function"==typeof s&&(r.value=(0,k._)(function*(){for(var e,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];var n=yield s.apply(this,r);return null===this||void 0===this||null===(e=this.emitUserSpaceSizeChange)||void 0===e||e.call(this),n})),r}}class eM{get hasBeenDone(){return this._hasBeenDone}get costTimes(){if(!!this._initCostTimes){var{start:e,end:t}=this._initCostTimes;return(t||Date.now())-e}}get initResult(){if(!!this._hasBeenDone)return{resolve:this.resolveResult,reject:this.rejectResult}}get isIniting(){return this._isIniting}awaitForInit(){var e,t,{key:r,timeout:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._hasBeenDone&&this.initResult){var{resolve:i,reject:n}=this.initResult;return n?Promise.reject(n):Promise.resolve(i)}if(r&&this._waitingResolverMap.has("key"))return this._waitingResolverMap.get("key");if(!s){var o=new Promise((e,t)=>{this._waitingResolvers.add([e,t])});return r&&this._waitingResolverMap.set(r,o),o}var a=Promise.race([new Promise((r,s)=>{e=[()=>{clearTimeout(t),r()},s],this._waitingResolvers.add([e,s])}),new Promise((r,i)=>{t=setTimeout(()=>{this._waitingResolvers.delete(e),i(Error("Timed out waiting for init"))},s)})]);return r&&this._waitingResolverMap.set(r,a),a}startToInit(){return!this._hasBeenDone&&!this._isIniting&&(this._isIniting=!0,this._initCostTimes={start:Date.now()},!0)}initDone(e){if(this._hasBeenDone)throw Error("Cannot release an inited locker");this._initCostTimes&&(this._initCostTimes.end=Date.now());var t=!1;for(var r of((null==e?void 0:e.reject)?(t=!0,this.rejectResult=e.reject):this.resolveResult=null==e?void 0:e.resolve,this._waitingResolvers))t?r[1](this.rejectResult):r[0](this.resolveResult);this._waitingResolverMap.clear(),this._waitingResolvers.clear(),this._hasBeenDone=!0,this._isIniting=!1}constructor(){this._hasBeenDone=!1,this._isIniting=!1,this._initCostTimes=void 0,this._waitingResolvers=new Set,this._waitingResolverMap=new Map}}class ej{addParams(e){this.data=(0,C.Z)({},this.data,e)}get reportData(){return{event:this.event,data:this.data}}addProcessParams(e){this.process=(0,C.Z)({},this.process,e)}get reportProcess(){return{event:this.progressEvent,data:this.process}}constructor(){this.event="evercloud_sdk_init_timer",this.data={},this.progressEvent="evercloud_sdk_init_process",this.process={}}}class eQ extends eS{uploadDone(){return new Promise((e,t)=>{if(this.result){"success"===this.result.status?e(this.result):t(this.result);return}this.finishListenQueue.push([e,t])})}done(){return new Promise((e,t)=>{if(this.result){"success"===this.result.status?e(this.result):t(this.result);return}this.finishListenQueue.push([e,t])})}cancel(){var e=this;return(0,k._)(function*(){return yield e.sdk.sdk.cancel_upload(e.requestId)})()}append(e){var t=this;return(0,k._)(function*(){return t.sdk.appendClipToUpload(t.requestId,e.seqNo,e.file,e.isLast)})()}destroy(){super.destroy(),this.finishListenQueue=[],this.sdk.eventBus.removeListener(e$.UploadIdle,this.onIdleHandler),this.sdk.eventBus.removeListener(e$.UploadProgress,this.onProgressHandler),this.sdk.eventBus.removeListener(e$.UploadFinish,this.onFinishHandler)}_onIdleHandler(e){var t;null===(t=this.onIdle)||void 0===t||t.call(this,e)}_onProgressHandler(e){var t;null===(t=this.onProgress)||void 0===t||t.call(this,{done:e.bytes_done})}_onFinishHandler(e){var t=this;return(0,k._)(function*(){var r,s,i,n;for(var o of(e.completed?e.stream_clip_transcode?t.result={status:"success",uploadId:e.stream_clip_transcode.upload_id,bucketKey:e.stream_clip_transcode.bucket_key,streamId:e.stream_clip_transcode.stream_id,streamM3u8:e.stream_clip_transcode.stream_m3u8,streamMp4:e.stream_clip_transcode.stream_mp4,streamMd5:e.stream_clip_transcode.stream_md5,coverUrl:e.stream_clip_transcode.cover_url,spriteUrl:e.stream_clip_transcode.sprite_url,streamDuration:e.stream_clip_transcode.stream_duration}:t.result={status:"error",errInfo:{code:"NO_TRANSCODE_INFO",msg:"NO_TRANSCODE_INFO"}}:e.cancelled?(t.result={status:"cancel"},null===(s=t.onError)||void 0===s||s.call(t,t.result)):(t.result={status:"error",errInfo:e.error_info,failedPartList:(null===(i=e.stream_clip_err_ext)||void 0===i?void 0:i.part_num)?[e.stream_clip_err_ext.part_num]:[]},null===(n=t.onError)||void 0===n||n.call(t,t.result)),t.finishListenQueue))"success"===t.result.status?o[0](t.result):o[1](t.result);null===(r=t.onFinish)||void 0===r||r.call(t,t.result),t.destroy()})()}eventFilter(e){return t=>{var{request_id:r}=t;r===this.requestId&&e(t)}}constructor({requestId:e},t){super(e,t),this.finishListenQueue=[],this.onIdleHandler=this.eventFilter(this._onIdleHandler.bind(this)),this.onProgressHandler=this.eventFilter(this._onProgressHandler.bind(this)),this.onFinishHandler=this.eventFilter(this._onFinishHandler.bind(this)),this.sdk.eventBus.addListener(e$.UploadIdle,this.onIdleHandler),this.sdk.eventBus.addListener(e$.UploadProgress,this.onProgressHandler),this.sdk.eventBus.addListener(e$.UploadFinish,this.onFinishHandler)}}var eK=r("503582"),eV=r("820072");var eG=function(){return!v&&(v=new eK.k({entryCDN:eV.x.entryCDN,wasmCDN:eV.x.wasmCDN})),v};class eq{get md5(){return this._md5}analyzeFileMd5(e){var{file:t,onError:r}=e;this._fileMd5Calculator.calcFileMd5(t).then(e=>{if(e.ok){var s,i;this._md5=e.value,null===(s=(i=this._options).onMd5Ready)||void 0===s||s.call(i)}else null==r||r({code:-1,msg:"[error]file md5 cal failed, file name is ".concat(t.name," and file size is ").concat(t.size," ]}")})}).catch(e=>{null==r||r({code:-1,msg:"[error]file md5 cal failed, ".concat(e.message)})})}constructor(e){this._options=e,this._fileMd5Calculator=eG()}}function eJ(){var e,t,r=new Promise((r,s)=>{e=r,t=s});return{resolve:e,reject:t,promise:r}}var eW=((h={})[h.UNKNOWN=-1]="UNKNOWN",h[h.SUCCESS=0]="SUCCESS",h[h.UPLOADING=3]="UPLOADING",h[h.FAILURE=4]="FAILURE",h);class eZ extends eD{get fileType(){return this._params.fileType}done(){return new Promise((e,t)=>{if(this._result){"success"===this._result.status?e(this._result):t(this._result);return}this._finishListenQueue.push([e,t])})}cancel(e){var t,r=this;return new Promise((t=(0,k._)(function*(t,s){var i,n,o,a,d,l;if(null===(i=r._params)||void 0===i?void 0:i.uploader){try{yield null===(d=r._params.uploader)||void 0===d?void 0:null===(a=d.cancel)||void 0===a?void 0:a.call(d,r._uploadKey),r._uploadStatus=eP.Cancel,r._finishListenQueue=r._finishListenQueue.filter(t=>t.fileKey===e),r._result=r._formatCancelResponse(),r._didUploadedDefer.reject({code:-1,msg:"[warn]cancel analyze because cancel upload"}),null===(l=r.onCancel)||void 0===l||l.call(r,r._uploadKey),t()}catch(e){console.error(e),s(null==e?void 0:e.message)}null===(n=(o=r._params).onCancel)||void 0===n||n.call(o);return}s("uploader does not exist")}),function(e,r){return t.apply(this,arguments)}))}destroy(){this._finishListenQueue=[]}_onFinishHandler(){var e=this;return(0,k._)(function*(){if(e._uploadStatus!==eP.Error){if(e._params.autoPromote){var t,r,s,i,n,o,a=null===(o=e._createAssetResult)||void 0===o?void 0:null===(n=o.cloud_asset)||void 0===n?void 0:n.asset_id;if(a)try{yield e.sdk.dependencies.apiFunc.promoteAsset({assetId:a,spaceId:e.sdk.spaceId,workspaceId:e._params.workspaceId})}catch(t){e._result={status:"error",errInfo:{code:-1,msg:"[error]asset promote failure, cause:".concat(null==t?void 0:t.message)}}}else e._result=e._formatErrorResponse({code:-1,msg:"[error]asset id is not found, could not promote"})}for(var d of e._finishListenQueue)(null===(t=e._result)||void 0===t?void 0:t.status)==="success"?d[0](e._result):d[1](e._result);if(null===(r=e.onFinish)||void 0===r||r.call(e,e._result),null===(s=(i=e._params).onFinish)||void 0===s||s.call(i),e._params.startTime){var l=Date.now()-e._params.startTime;e._reportUploadAnalyze({action:eg.CompleteUpload,size:e._params.file.size,duration:l,isInstantlyUpload:e._isFileExistOnCloud,filename:e._params.file.name})}e.destroy()}})()}_onErrorHandler(){var e=this;return(0,k._)(function*(){var t,r,s,i,n,o,a,d,l,u;if(e._uploadStatus!==eP.Success&&e._uploadStatus!==eP.Error&&e._uploadStatus!==eP.Cancel){for(var c of(yield null===(r=e._params.uploader)||void 0===r?void 0:null===(t=r.cancel)||void 0===t?void 0:t.call(r,e._uploadKey),e._reportUploadAnalyze({action:eg.Error,size:e._params.file.size,code:null===(i=e._result)||void 0===i?void 0:null===(s=i.errInfo)||void 0===s?void 0:s.code,errorMsg:null===(o=e._result)||void 0===o?void 0:null===(n=o.errInfo)||void 0===n?void 0:n.msg,filename:e._params.file.name}),e._uploadStatus=eP.Error,e._finishListenQueue))(null===(u=e._result)||void 0===u?void 0:u.status)==="success"?c[0](e._result):c[1](e._result);null===(a=e.onFinish)||void 0===a||a.call(e,e._result),null===(d=(l=e._params).onFinish)||void 0===d||d.call(l),e.destroy()}})()}_listenDidPreparedAndDidUploaded(){var e=this;Promise.all([this._didPreparedDefer.promise,this._didUploadedDefer.promise]).then((0,k._)(function*(){try{if(!e._isFileExistOnCloud&&!e._uploadedFileMeta)throw Error("[error]file not exist on server, but no uploaded file meta.");var t,r,s,i,n,o=Date.now(),a=yield e._postCreateAsset({everphoto_id:null===(i=e._prepareResult)||void 0===i?void 0:i.everphoto_user_id,asset:e._getAssetInfoForCreating()});e._createAssetResult=a,e._result=e._formatSuccessResponse({assetId:a.cloud_asset.asset_id,md5:e._fileInfoAnalyze.md5,entryId:null===(n=a.cloud_file_entry)||void 0===n?void 0:n.entry_id,entry:a.cloud_file_entry}),e._uploadStatus=eP.Success;var d=Date.now()-o;e._reportUploadAnalyze({action:eg.CreateAsset,size:e._params.file.size,duration:d,isInstantlyUpload:e._isFileExistOnCloud,filename:e._params.file.name})}catch(i){e._result=e._formatErrorResponse({code:(null==i?void 0:null===(t=i.data)||void 0===t?void 0:t.ret)||-1,msg:"[error]create asset failure: ".concat(null!==(s=null==i?void 0:null===(r=i.data)||void 0===r?void 0:r.errmsg)&&void 0!==s?s:i)}),e._onErrorHandler();return}e._onFinishHandler()})).catch(e=>{var t;return this._reportUploadAnalyze({action:eg.CancelFileAnalyze,size:this._params.file.size,code:e.code,errorMsg:null!==(t=e.msg)&&void 0!==t?t:e,filename:this._params.file.name})})}_formatSuccessResponse(e){var{assetId:t,md5:r,entryId:s,entry:i}=e;return{status:"success",fileId:t,entryId:s,md5:r,entry:i}}_formatErrorResponse(e){var{code:t,msg:r}=e;return{status:"error",errInfo:{code:Number(t),msg:r}}}_formatCancelResponse(){return{status:"cancel"}}_getAssetInfoForCreating(){try{e=JSON.stringify(this._params.meta)}catch(t){e="{}"}var e,t,r={size:this._params.file.size,workspace_id:this._params.workspaceId,filename:this._params.fileName,upload_id:this._prepareResult.upload_id,preserve_video_multi_definition:this._params.isMultiDefTranscode,if_image_async_resize:!0,transcode_template_type:this._params.transcodeTemplateType,permission:this._params.permission,space_id:"0",flags:this._params.flags,file_type:this._params.fileType,folder_id:this._params.folderId,meta:e,md5:this._fileInfoAnalyze.md5,no_copy:this._params.noCopy};if(this._isFileExistOnCloud)return r;return(0,I._)({uri:null===(t=this._uploadedFileMeta)||void 0===t?void 0:t.uri},r)}_handleFileAnalyzeError(e){var t;this._result=this._formatErrorResponse({code:e.code,msg:null!==(t=e.msg)&&void 0!==t?t:e}),this._onErrorHandler()}_reportUploadAnalyze(e){var{action:t,duration:r,size:s,isInstantlyUpload:i,errorMsg:n,code:o}=e;this.sdk.reportUploadAnalyze({action:t,size:s,duration:r,isInstantlyUpload:i,errorMsg:n,code:o,uploaderType:eY.Vod,filename:e.filename})}constructor(e,t){super("unknow",t),i=this,this._finishListenQueue=[],this._uploadStatus=eP.WaitingUpload,this._didPreparedDefer=eJ(),this._didUploadedDefer=eJ(),this._isFileExistOnCloud=!1,this._handleFileInfoAnalyzed=(0,k._)(function*(){try{var e,t,r,s,n,o,a=Date.now(),d=yield i._sdk.dependencies.apiFunc.prepareUpload({workspace_id:null===(e=i._params)||void 0===e?void 0:e.workspaceId,space_id:"0",md5:i._fileInfoAnalyze.md5,size:null===(t=i._params)||void 0===t?void 0:t.file.size,file_type:i._params.fileType,flags:null===(r=i._params)||void 0===r?void 0:r.flags});i._prepareResult=d,null===(s=i.onUploadMetaReady)||void 0===s||s.call(i,{uploadId:i._prepareResult.upload_id,md5:i._fileInfoAnalyze.md5});var l=Date.now()-a;if(i._reportUploadAnalyze({action:eg.PrepareAsset,size:i._params.file.size,duration:l,filename:i._params.file.name}),i._didPreparedDefer.resolve(),(null==d?void 0:d.state)===eW.SUCCESS)yield null===(o=i._params.uploader)||void 0===o?void 0:null===(n=o.cancel)||void 0===n?void 0:n.call(o,i._uploadKey),i._isFileExistOnCloud=!0,i._didUploadedDefer.resolve();else if((null==d?void 0:d.state)===eW.FAILURE){var u={code:-1,msg:"[error] prepare upload response fail"};i._didUploadedDefer.reject(u),i._result=i._formatErrorResponse(u),i._onErrorHandler()}}catch(e){var c,p,v,h="[error]prepare upload failure: ".concat(null!==(v=null==e?void 0:null===(c=e.data)||void 0===c?void 0:c.errmsg)&&void 0!==v?v:e);i._result=i._formatErrorResponse({code:(null==e?void 0:null===(p=e.data)||void 0===p?void 0:p.ret)||-1,msg:h}),i._didPreparedDefer.reject({code:-1,msg:h}),i._onErrorHandler()}}),this._postCreateAsset=(s=(0,k._)(function*(e){return i._sdk.dependencies.apiFunc.createAsset(e)}),function(e){return s.apply(this,arguments)});var r,s,i,n="video";switch(this._params=e,this._sdk=t,e.fileType){case"video":case"audio":n="video";break;default:n="object"}this.onStart=e.onStart;var o=Date.now();e.uploader.upload({file:e.file,type:n,onSuccess:(r=(0,k._)(function*(t){if(i._uploadStatus!==eP.Cancel){if("video"===e.fileType||"audio"===e.fileType){var r,s,n,a,d;i._uploadedFileMeta={duration:null===(r=t.VideoMeta)||void 0===r?void 0:r.Duration,height:null===(s=t.VideoMeta)||void 0===s?void 0:s.Height,width:null===(n=t.VideoMeta)||void 0===n?void 0:n.Width,size:null===(a=t.VideoMeta)||void 0===a?void 0:a.Size,uri:null===(d=t.VideoMeta)||void 0===d?void 0:d.Uri}}else i._uploadedFileMeta={uri:t.Uri};var l=Date.now()-o;i._reportUploadAnalyze({action:eg.UploadProcess,size:e.file.size,duration:l,isInstantlyUpload:i._isFileExistOnCloud,filename:e.file.name}),i._didUploadedDefer.resolve()}}),function(e){return r.apply(this,arguments)}),onError:e=>{var t,r,s,i="[error]error from uploader: [".concat(null==e?void 0:null===(t=e.extra)||void 0===t?void 0:t.errorCode,"] ").concat(null==e?void 0:null===(r=e.extra)||void 0===r?void 0:r.message);this._didUploadedDefer.reject({code:-1,msg:i}),this._result=this._formatErrorResponse({code:null==e?void 0:null===(s=e.extra)||void 0===s?void 0:s.errorCode,msg:i}),this._onErrorHandler()},onStart:(e,t)=>{var r,s;null===(r=this.onIdle)||void 0===r||r.call(this),null===(s=this.onStart)||void 0===s||s.call(this,e,t),this._uploadKey=e},onProgress:e=>{var t,r,s;this._uploadStatus=eP.Uploading,null===(t=this.onProgress)||void 0===t||t.call(this,{total:e.fileSize,done:Math.floor(e.fileSize*(e.percent/100))}),null===(r=(s=this._params).onProgress)||void 0===r||r.call(s,{total:e.fileSize,done:Math.floor(e.fileSize*(e.percent/100)),progress:e})}});var a=Date.now();this._fileInfoAnalyze=new eq({onMd5Ready:()=>{var t=Date.now()-a;this._handleFileInfoAnalyzed(),this._reportUploadAnalyze({action:eg.AnalyzeFile,size:e.file.size,duration:t,filename:e.file.name})}}),this._fileInfoAnalyze.analyzeFileMd5({file:e.file,onError:this._handleFileAnalyzeError}),this._listenDidPreparedAndDidUploaded()}}var eY=((_={}).Vod="vod",_.Normal="normal",_),e$={BusDestroy:"destroy",UploadMetaReady:"asset_upload_meta_ready",UploadIdle:"asset_upload_idle",UploadProgress:"asset_upload_progress",UploadFinish:"asset_upload_finish",AssetDownloadIdle:"asset_download_idle",AssetDownloadProgress:"asset_download_progress",AssetDownloaddFinish:"asset_download_finish",VideoInfoEndPullEvent:"video_info_end_pull",ThridPartResourceSyncStateEvent:"thirdpart_resource_sync_state",TrackSendEvent:"track_send_event",SpriteInfoEndPullEvent:"sprite_info_end_pull",PreviewInfoEndPullEvent:"preview_info_end_pull",SpaceMoveProgressEvent:"space_move_progress",SpaceMoveFinishEvent:"space_move_finish",SpaceCopyProgressEvent:"space_copy_progress",SpaceCopyFinishEvent:"space_copy_finish",ImageTranscodeInfoEndPull:"image_transcode_info_end_pull",EverCloudCancelImageTranscode:"ever_cloud_cancel_image_transcode",LogReportEvent:"log_report_event",UploadAnalyze:"import_material_upload_analyze"};class eX{get getTempId(){var e;return null===(e=this.noSignOptions)||void 0===e?void 0:e.uniqueId}get everUserId(){return this.webUserId}get cachePlugin(){return this.idbPlugin}get isGroupSdk(){return!!e5.space&&e5.space!==B}get spaceId(){var e;return null===(e=this.options)||void 0===e?void 0:e.space}get netconf(){var e;return null===(e=this.options)||void 0===e?void 0:e.netconf}setCachePlugin(e){this.idbPlugin=e}setTeaReporter(e){this.TeaReporter=e}setSlardarReporter(e){this.slardarReporter=e}setDependencies(e){this.dependencies=e}get hasSetOptions(){return!!this.options}get hasSetNoSignOptions(){return!!this.noSignOptions}setOptions(e){var t=this;return(0,k._)(function*(){var r;yield t._setEverCloudOptions(e),t._defaultUploaderType=(null==e?void 0:null===(r=e.defaultUploaderConfig)||void 0===r?void 0:r.type)==="vod"?"vod":"normal"})()}setPermission(e){this.permission=e}setNoSignOptions(e){if(this.noSignOptions){ec("\u53C2\u6570\u91CD\u590D\u8BBE\u7F6E\uFF0C\u8BF7\u786E\u8BA4\u3002 init \u540E\u5C06\u4E0D\u4F1A\u88AB\u8986\u76D6");return}this.noSignOptions=e,ec("\u521D\u59CB\u5316\u53C2\u6570\u5DF2\u8BBE\u7F6E\uFF08\u672A\u767B\u5F55\uFF09: ".concat(JSON.stringify(e)))}getUploader(e,t){return this.dependencies.getUploader(e,t)}getSignUploader(e){return this.dependencies.getSignUploader(e)}emitUserSpaceSizeChange(){this.eventBus.emit(H.USER_SPACE_SIZE_CHANGE)}onUserSpaceSizeChange(e){return this.eventBus.on(H.USER_SPACE_SIZE_CHANGE,e)}get uid(){var e;return null===(e=this.options)||void 0===e?void 0:e.user_id}init(){if(this.destroyed)return Promise.reject(Error("SDK destroyed"));if(this.initLocker.hasBeenDone)return this.initLocker.awaitForInit();var e=this.options&&this.options.user_id;if(!e&&ec("\u672A\u8BBE\u7F6E\u5FC5\u8981\u53C2\u6570, \u7B49\u5F85\u53C2\u6570\u8BBE\u7F6E\u4E2D"),!this.initLocker.isIniting&&e){this.initLocker.startToInit(),this.loadLocker.startToInit();var{timeout:t}=this.options||{},{init:r=3e5}=t||{};setTimeout(()=>{!this.initLocker.hasBeenDone&&this.initLocker.initDone({reject:new ew})},r),this.initEverCloudSdk({initDoneCb:()=>{this.initLocker.initDone()},loadDoneCb:()=>{this.loadLocker.initDone()},syncDoneCb:e=>{if(!!e)this.initLocker.hasBeenDone||this.initLocker.initDone(),this.syncLocker.initDone()}})}return this.initLocker.awaitForInit()}startSyncLoop(){var e=this;return(0,k._)(function*(){!e.syncLocker.isIniting&&!e.syncLocker.hasBeenDone&&(e.syncLocker.startToInit(),yield e.sdk.start_sync_loop())})()}syncDone(){var e=this;return(0,k._)(function*(){return yield e.startSyncLoop(),yield e.syncLocker.awaitForInit()})()}loadDone(){return this.loadLocker.awaitForInit()}noSignInit(){var e=this;return(0,k._)(function*(){var t,r=e.noSignOptions;return!r&&ec("\u672A\u8BBE\u7F6E\u5FC5\u8981\u53C2\u6570, \u7B49\u5F85\u53C2\u6570\u8BBE\u7F6E\u4E2D(noSing)"),new Promise((t=(0,k._)(function*(t,s){if(e.syncNoSignInitDone&&t(),e.syncNoSignInitError&&s(Error("Cloud Sdk \u53D1\u751F\u975E\u9884\u671F\u9519\u8BEF\uFF0C\u8BF7\u5237\u65B0\u9875\u9762")),e.initNoSignQueue.push([t,s]),!e.syncNoSignIniting&&r){e.syncNoSignIniting=!0,e.syncNoSignInitDone=!0;var i=e.noSignOptions;if(!i)throw Error("impossible way");e.offlineVideoUploader=e.getUploader(i,"video"),e.offlineFileUploader=e.getUploader(i,"file"),e.initNoSignQueue.forEach(e=>{e[0]()}),e.initNoSignQueue=[]}}),function(e,r){return t.apply(this,arguments)}))})()}destroy(){var e=this;return(0,k._)(function*(){return e.destroyed?(e.sdk=null,e.options=null,e.eventBus.emit(e$.BusDestroy),e.eventBus.removeAllListeners(),Promise.resolve()):(e.sdk=null,e.destroyed=!0,e.options=null,e.eventBus.emit(e$.BusDestroy),e.eventBus.removeAllListeners(),yield e.tearDown())})()}getFilesListByFloder(e){var t=this;return(0,k._)(function*(){var r=(yield t.getAsset(Object.assign({},{material:!0},e))).filter(e=>{var t;return!(null==e?void 0:null===(t=e.cluster_list)||void 0===t?void 0:t.length)}).map(e=>eu(e,t)),s=yield t.getPackages(),i=[];return[...r,...s,...i=yield t.getClusters()].sort((e,t)=>{var r,s;return(null!==(r=e.updatedAt)&&void 0!==r?r:0)-(null!==(s=t.updatedAt)&&void 0!==s?s:0)})})()}getAsset(e){var t=this;return(0,k._)(function*(){var r,s,i=Object.assign({},e);return(null==i?void 0:null===(r=i.ids)||void 0===r?void 0:r.length)||(null==i?void 0:null===(s=i.md5s)||void 0===s?void 0:s.length)?yield t.initLocker.awaitForInit():yield t.syncDone(),yield t.sdk.get_asset(i)})()}getAssets(e){var t=this;return(0,k._)(function*(){return(yield t.getAsset(Object.assign({},{material:!0},e))).filter(e=>{var t;return!(null==e?void 0:null===(t=e.cluster_list)||void 0===t?void 0:t.length)}).map(e=>eu(e,t))})()}asset_preview(e){var t=this;return(0,k._)(function*(){return new Promise(r=>{t.sdk.download_asset({md5:e,preview:"360p"},e=>{e.length<98304&&r(btoa(String.fromCharCode(...new Uint8Array(e))))})})})()}uploadAsset(e){var t=this;return(0,k._)(function*(){var r;return"vod"===((null===(r=e.uploaderConfig)||void 0===r?void 0:r.type)||t._defaultUploaderType)?t._uploadAssetByVod(e):t._uploadAssetByEverCloud(e)})()}reportUploadAnalyze(e){var t,r,{uploaderType:s,action:i,duration:n,size:o,errorMsg:a,code:d,isInstantlyUpload:l,filename:u}=e,c=null!=a?a:e.action===eg.Error?"unkown error.":"";this.reportSdkEvent({type:"event",event_name:e$.UploadAnalyze,str_params:{uploader_type:null!=s?s:"",action:i,error_msg:null!=a?a:"",code:String(d),filename:u},int_params:{duration:null!=n?n:-1,size:o},float_params:{}}),null===(t=this.slardarReporter)||void 0===t||t.call(this,{type:"event",eventName:e$.UploadAnalyze,extra:{event_name:e$.UploadAnalyze,event_from:"ever_cloud_sdk",space_id:null!==(r=this.spaceId)&&void 0!==r?r:"unknown",uploader_type:s,is_instantly_upload:l?1:0,action:i,duration:null!=n?n:-1,size:o,error_msg:c,code:String(d),filename:u},content:""})}streamClipUploadAsset(e){var t=this;return(0,k._)(function*(){var{format:r,fileName:s,meta:i,permission:n,extra:o}=e,a=JSON.stringify(i),d=o||{};d.ve&&(d.ve=JSON.stringify(d.ve));var{request_id:l}=yield t.sdk.stream_clip_upload_asset(r,s,a,n,d);return new eQ({requestId:l},t)})()}appendClipToUpload(e,t,r,s){var i=this;return(0,k._)(function*(){return yield i.sdk.append_clip_to_upload(e,t,r,s)})()}uploadVid(e){var t=this;return(0,k._)(function*(){return yield t.sdk.upload_vid(e.vid,e.material,e.folder)})()}syncVideoToEverCloud(e,t){var{resouceType:r=1,fileSize:s,meta:i,imageAsyncResize:n=!0,folderId:o=e5.rootFolderId,invisible:a=!1,noTranscode:d=!1,noOccupy:l=!1}=t,u=this;return(0,k._)(function*(){var t=new eb({id:e},u),c=(0,C.Z)(eh(),i);return yield u.sdk.sync_asset({resource:[{resource_id:e,resource_type:r||1,size:s,meta:JSON.stringify(c),region:null,image_async_resize:n,folder_id:o,invisible:a,no_transcode:d,no_occupy:l}]}),t})()}getAssetsByMd5(e){var t=this;return(0,k._)(function*(){var r;if(!e.length)return[];return null!==(r=(yield t.getAsset({md5s:e})).map(e=>eu(e,t)))&&void 0!==r?r:[]})()}getAssetByMd5(e){var t=this;return(0,k._)(function*(){var r=((yield t.getAsset({md5s:[e]}))||[])[0];if(!r)throw Error("asset not found: md5=".concat(e));return eu(r,t)})()}getAssetByFileId(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this;return(0,k._)(function*(){var s=(yield r.getAsset({ids:[e]}))[0];if(!s)throw Error("asset not found: assetId=".concat(e));if(t){var i=yield r.getUnencryptedPlayInfo({id:s.id});s.unencryptedPlayInfo=i}return eu(s,r)})()}getAssetsByFileId(e){var t=this;return(0,k._)(function*(){var r;if(!e.length)return[];return null!==(r=(yield t.getAsset({ids:e})).map(e=>eu(e,t)))&&void 0!==r?r:[]})()}getFileDetailWithTranscode(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this;return(0,k._)(function*(){var s,i,n,o,a,d=yield r.getVideoAssetTranscodeStatus(e),l=yield d.done();if("success"!==l.status)throw Error("transcode failure: ".concat(JSON.stringify(l.errInfo)));a=e.entryId?yield r.getEntryAsset(e.entryId,!0,t):e.md5?yield r.getAssetByMd5(e.md5):yield r.getEntryAsset(e.id,!0,t);var u=[],c=l.data;if(c){var p=(e,t)=>{if(c[e]){var{primary_url:r,url_key:s}=c[e];r&&s&&u.push({type:t,url:r,key:s})}};c.origin&&p("origin","origin"),p("p360","360p"),p("p480","480p"),p("p720","720p")}return new eo({uid:a.author,type:a.type,duration:a.duration,fileName:a.name,size:a.size,assetInfo:a,spritInfo:a.sprit,videoInfo:u,audioInfo:{url:null==l?void 0:null===(i=l.data)||void 0===i?void 0:null===(s=i.audio)||void 0===s?void 0:s.primary_url,key:null===(o=l.data)||void 0===o?void 0:null===(n=o.audio)||void 0===n?void 0:n.url_key}})})()}getFileDetailWithTranscodeNoSign(e,t){var r=this;return(0,k._)(function*(){var s,i,n,o,a,d,l,u,c,p,v=yield r.getVideoAssetTranscodeStatusNoSign(e,t),h=yield v.done();if("success"!==h.status)throw Error(JSON.stringify(h.errInfo));return new eo({fileName:null===(i=h.data)||void 0===i?void 0:null===(s=i.video)||void 0===s?void 0:s.file_name,type:q.VIDEO,size:null===(o=h.data)||void 0===o?void 0:null===(n=o.video)||void 0===n?void 0:n.size,spritInfo:null===(a=h.data)||void 0===a?void 0:a.video.thumb,duration:(null!==(p=null===(d=h.data)||void 0===d?void 0:d.video.duration)&&void 0!==p?p:0)*1e3,videoInfo:null===(u=h.data)||void 0===u?void 0:null===(l=u.video.video_infos)||void 0===l?void 0:l.map(e=>{var t;return{type:null!==(t=e.definition)&&void 0!==t?t:e.defination,url:e.url,key:e.key}}).sort((e,t)=>{var r=["360p","480p","720p"];return r.indexOf(null==e?void 0:e.type)-r.indexOf(null==t?void 0:t.type)}),extInfo:{vid:null===(c=h.data)||void 0===c?void 0:c.video.source}})})()}getVideoAssetTranscodeStatus(e){var t=this;return(0,k._)(function*(){e.md5?(r={id:e.md5,key:"md5"},s={md5s:[e.md5]}):(r={id:e.id,key:"asset_id"},s={ids:[e.id]});var r,s,i=new eT(r,t);return yield t.sdk.get_asset_play_info(s),i})()}getAssetsPlayInfo(e){var t=this;return(0,k._)(function*(){return yield t.sdk.get_asset_play_info(e)})()}getVideoAssetTranscodeStatusNoSign(e,t){var r=this;return(0,k._)(function*(){var s;return yield r.noSignInit(),new eL({tmp_id:null===(s=r.noSignOptions)||void 0===s?void 0:s.uniqueId,task_id:e,is_support_webp:!0===t?1:0},r)})()}getAssetSpirtInfo(e){var t=this;return(0,k._)(function*(){e.md5?(r={id:e.md5,key:"md5"},s={md5s:[e.md5]}):(r={id:e.id,key:"id"},s={ids:[e.id]});var r,s,i=new eR(r,t);return yield t.sdk.get_asset_sprite_info(s),i})()}getAssetPreviewInfo(e){var t=this;return(0,k._)(function*(){e.md5?(r={id:e.md5,key:"md5"},s={md5s:[e.md5]}):(r={id:e.id,key:"id"},s={ids:[e.id]});var r,s,i=new eO(r,t);return yield t.sdk.get_asset_preview_info(s),i})()}uploadAssetNoLogin(e){var t=this;return(0,k._)(function*(){yield t.noSignInit();var{file:r,fileName:s,onStart:i}=e,n=s||r.name,o=b({file:r}),a="video"===o||"audio"===o?t.offlineVideoUploader:t.offlineFileUploader;return yield a.init(),new eF({file:r,fileName:n,fileType:o,uploader:a,onStart:i},t)})()}cancelAllUploadAsset(){var e=this;return(0,k._)(function*(){return yield e.sdk.cancel_upload_all()})()}cancelUploadAsset(e){var t=this;return(0,k._)(function*(){return yield t.sdk.cancel_upload(e)})()}deleteAsset(e){var{ids:t=[],md5s:r=[]}=e,s=this;return(0,k._)(function*(){for(var e=[],i=0;20*i<t.length;i++)e.push(s.sdk.delete_asset({ids:t.slice(20*i,(i+1)*20)}));for(var n=0;20*n<r.length;n++)e.push(s.sdk.delete_asset({md5s:r.slice(20*n,(n+1)*20)}));yield Promise.all(e)})()}renameAsset(e){var t=this;return(0,k._)(function*(){if(yield t.isAssetNameDumplicate({fileName:e.fileName,filterMd5:e.md5}))throw new ef;return yield t.sdk.rename_asset({md5:e.md5,file_name:e.fileName})})()}downloadByUrlKey(e){var t=this;return(0,k._)(function*(){if(!(null==e?void 0:e.url))throw Error("[EverSdk] downloadByUrlKey: url can not be empty");var r=(0,S._)((0,I._)({},e),{url:e.url||""}),s=r.skipCache?void 0:yield t.getFromCache(r.url),i=new eE({url:r.url},t);if(s&&s instanceof Uint8Array)i.thirdpartDone({buffer:s});else{var n=yield t.sdk.download_url(r,e=>{i.appendChunk(e)});i.setRequestId(n.request_id),i.size=n.size}return i})()}downloadAssetStream(e){var t=this;return(0,k._)(function*(){var r=e.skipCache?void 0:yield t.getFromCache(e.md5),s=new eE({},t);if(r&&r instanceof Uint8Array)s.thirdpartDone({buffer:r});else{var i=yield t.sdk.download_asset(e,e=>{s.appendChunk(e)});s.setRequestId(i.request_id),s.size=i.size}return s})()}downloadAssetUrl(e,t,r){var s=this;return(0,k._)(function*(){var i,{token:n}=yield s.dependencies.apiFunc.getEverPhotoToken(null===(i=s.options)||void 0===i?void 0:i.space),{data:o,headers:a}=yield F.Z.get(e,{headers:{"x-everphoto-token":n},responseType:"blob"}),d=new Blob([o],{type:r||a["content-type"]}),l=(a["content-disposition"]||"").split("filename=")[1],u=document.createElement("a"),c=window.URL.createObjectURL(d);u.download=l||t||"",u.href=(0,A.C)(c,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_dreamina",region:"cn",urlLimit:"-1",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1,escapeRule:"escape-report"}),u.style.display="none",u.click()})()}getDownloadUrl(e){var t=this;return(0,k._)(function*(){for(var r=null!==(o=null===(n=yield t.sdk.get_asset_dynamic_download_url({ids:e.ids,max_time:e.maxTime,ttl:e.ttl}))||void 0===n?void 0:n.data)&&void 0!==o?o:{},s=[],i=0;i<e.ids.length;i++){var n,o,a,d,l=e.ids[i],u=null!==(d=null==e?void 0:null===(a=e.names)||void 0===a?void 0:a[i])&&void 0!==d?d:"";r[l]?r[l].url=r[l].url+(u?"&target_name=".concat(u):""):s.push(l)}return{urlMap:r,noDownloadLink:s}})()}downloadAssetUrlV2(e){var t=this;return(0,k._)(function*(){for(var r=null!==(o=null===(n=yield t.sdk.get_asset_dynamic_download_url({ids:e.ids,max_time:e.maxTime,ttl:e.ttl}))||void 0===n?void 0:n.data)&&void 0!==o?o:{},s=[],i=0;i<e.ids.length;i++){var n,o,a,d,l=e.ids[i],u=null!==(d=null==e?void 0:null===(a=e.names)||void 0===a?void 0:a[i])&&void 0!==d?d:"";r[l]?"anchor"===e.downloadMode?!function(e){var t=document.createElement("a");t.download="",t.target="_blank",t.href=(0,A.C)(e,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_dreamina",region:"cn",urlLimit:"-1",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1,escapeRule:"escape-report"}),t.style.display="none",t.click()}(r[l].url+(u?"&target_name=".concat(u):"")):!function(e){var t=document.createElement("iframe");t.src=(0,A.C)(e,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"cc_dreamina",region:"cn",urlLimit:"-1",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!1,escapeRule:"escape-report"}),t.style.display="none",document.body.appendChild(t)}(r[l].url+(u?"&target_name=".concat(u):"")):s.push(l)}return s})()}getPackages(){var e=this;return(0,k._)(function*(){var t=(yield e.sdk.get_package(null)).map(e=>new en(e)),r=[Z.EDIT,Z.SCRIPT,Z.TEMPLATE,Z.GRAPHIC];return t.filter(e=>e.isValid).filter(e=>r.includes(e.subType)).sort((e,t)=>{var r,s;return(null!==(r=t.updatedAt)&&void 0!==r?r:0)-(null!==(s=e.updatedAt)&&void 0!==s?s:0)})})()}getPackageById(e){var t=this;return(0,k._)(function*(){return t.getPackageByKey(e)})()}getPackageByKey(e){var t=this;return(0,k._)(function*(){var r=yield t.sdk.get_package([e]);if(r.length)return new en(r[0]);throw Error("\u8349\u7A3Fkey(".concat(e,")\u4E0D\u5B58\u5728"))})()}savePackage(e){var t=this;return(0,k._)(function*(){var r,{draftId:s,draftMeta:i,assets:n,isForceReplace:o=!1,permission:a=null!==(r=t.permission)&&void 0!==r?r:$.PUBLIC,folderId:d,name:l,draftType:u=W.NORMAL}=e,c=e.prePkgId||null;return o&&(c=(yield t.getPackageByKey(s)).id),yield t.sdk.save_package({key:s,meta:JSON.stringify(i),package_assets:n.map(e=>({md5:e.md5,size:e.size,path:e.path,entry_ids:e.entryIds,meta:JSON.stringify(e.meta)})),base_package_id:c,permission:a,folder_id:d,draft_type:u,name:l})})()}sharePackage(e){var t=this;return(0,k._)(function*(){var{entryId:r,spaceId:s,draftMeta:i,packageId:n,folderId:o,name:a,packageKey:d,overwrite:l,permission:u}=e;yield t.sdk.share_package({overwrite:l,permission:u,name:a,package_id:n,entry_id:r,meta:JSON.stringify(i),folder_id:o,package_key:d,to_space_id:s})})()}deletePackageById(e){var t=this;return(0,k._)(function*(){yield t.sdk.delete_package(e)})()}renamePackages(e){var{key:t,name:r}=e,s=this;return(0,k._)(function*(){var e=yield s.getPackageByKey(t),i=(0,C.Z)({},e.meta,{draft:{name:r,updateTime:new Date().valueOf()}});return new en((yield s.sdk.rename_package({package_id:e.id,meta:JSON.stringify(i)})).package)})()}updatePackageMeta(e){var{id:t,key:r,meta:s,autoMergeMeta:i=!1}=e,n=this;return(0,k._)(function*(){var e=t,o=s;if(r)try{var a=yield n.getPackageByKey(r);e=e||a.id,i&&(o=(0,C.Z)({},a.meta,o))}catch(e){if(i)throw Error("Not found local meta info, could not merge")}if(!e)throw Error("params id or key is required at least one.");return new en((yield n.sdk.rename_package({package_id:e,meta:JSON.stringify(o)})).package)})()}validateWebEditorSupportPkg(e){var t=this;return(0,k._)(function*(){var r,s,i=Object.assign({},{platform:["browser"]},e),n=yield t.getPackageByKey(i.draftId);return!!n&&i.platform.includes(null!==(s=null===(r=n.meta)||void 0===r?void 0:r.uploadSource.platform)&&void 0!==s?s:"")})()}forceSyncPullUpdates(){var e=this;return(0,k._)(function*(){yield e.sdk.sync_pull_updates({})})()}getClusters(){var e=this;return(0,k._)(function*(){var t=(yield e.sdk.get_clusters({})).filter(e=>e.n_asset).map(e=>new ed({cluster:e})),r=t.map(e=>e.lastAssetId),s=(yield e.getAssetsByFileId(r)).reduce((e,t)=>(e[t.id]=t,e),{});return t.forEach(e=>e.updateLastAsset(s[e.lastAssetId])),t})()}getClusterLastAsset(e){var t=this;return(0,k._)(function*(){var r=(yield t.getAssetsFromCluster({clusterId:e.id,sortByRelation:!0}))||[];return r[r.length-1]})()}getClusterById(e){var t=this;return(0,k._)(function*(){var r=(yield t.sdk.get_clusters({cluster_ids:[e.clusterId]}))[0];if(!(r&&r.n_asset))throw Error("cluster invalid");var s=new ed({cluster:r});if(e.needLastAsset){var i=yield t.getClusterLastAsset(s);s.updateLastAsset(i)}return s})()}createCluster(e){var t=this;return(0,k._)(function*(){var r;return yield t.sdk.create_cluster((0,S._)((0,I._)({},e),{relation:JSON.stringify(null!==(r=e.relation)&&void 0!==r?r:[]),meta:JSON.stringify(e.meta)}))})()}delCluster(e){var t=this;return(0,k._)(function*(){return yield t.sdk.delete_cluster({cluster_id:e.id,delete_resource:e.deleteAsset})})()}addAssetToCluster(e){var{clusterId:t,assetIds:r,relation:s}=e,i=this;return(0,k._)(function*(){if(!s){var e=yield i.getClusterById({clusterId:t});if(!e)throw Error("cluster id is not found: ".concat(t));null==(s=e.relation)||s.push(...r)}return yield i.sdk.add_cluster_resource({cluster_id:t,ids:r,relation:JSON.stringify(s)})})()}delAssetFromCluster(e){var{clusterId:t,assetIds:r=[],relation:s,delAsset:i}=e,n=this;return(0,k._)(function*(){if(!s){var e=yield n.getClusterById({clusterId:t});if(!e)throw Error("cluster id is not found: ".concat(t));s=null==(s=e.relation)?void 0:s.filter(e=>!r.includes(e))}yield n.sdk.remove_cluster_resource({cluster_id:t,ids:r,relation:JSON.stringify(s)}),i&&(yield n.deleteByEntry(r))})()}updateCluster(e){var{clusterId:t,meta:r,relation:s}=e,i=this;return(0,k._)(function*(){yield i.sdk.update_cluster({cluster_id:t,meta:r?JSON.stringify(r):void 0,relation:s?JSON.stringify(s):void 0})})()}getAssetsFromCluster(e){var t=this;return(0,k._)(function*(){var r,s=yield t.sdk.get_asset_from_cluster({cluster_id:e.clusterId}),i=null!==(r=null==s?void 0:s.map(e=>eu(e,t)))&&void 0!==r?r:[];if(e.sortByRelation){var n=yield t.getClusterById({clusterId:e.clusterId});(null==n?void 0:n.relation)&&(i=t.sortArrayByRelation({exists:i,relation:n.relation||[],getter:e=>e.notOnlyId}))}return i})()}createFolder(e){var t=this;return(0,k._)(function*(){return new el((yield t.sdk.create_folder({name:e.name,parent_id:e.parentId,permission:e.permission,meta:JSON.stringify((0,C.Z)(eh(),e.meta||{}))})).folder)})()}deleteFolder(e){var t=this;return(0,k._)(function*(){if(!!e&&!!e.length)return yield t.sdk.delete_folder({ids:e})})()}moveTo(e){var t=this;return(0,k._)(function*(){var{ids:r,target:s}=e,i={ids:e.ids,parent_id:e.target};try{t.cacheCurrentFolders(e.target)}catch(e){}var n=!t.isGroupSdk;if(e5.isRootFolderId(s))return yield t.sdk.move_to_folder(i);var o=yield t.getFolderPaths({folderId:s}),a=o.length,d=o.pop();if(!d)throw Error("[EverSDK] moveTo: target folder not exist");var l=yield t.getFolders(r);if((yield Promise.all(l.map(e=>t.getFolderMaxDepth(e.id)))).some(e=>e.depth>e5.maxFolderDepth-a))throw new eI(e5.maxFolderDepth);if(n||d.permission===$.PUBLIC)return yield t.sdk.move_to_folder(i);if([...yield t.getEntryAssets(r),...l].some(e=>e.isPublic))throw new ek;return yield t.sdk.move_to_folder(i)})()}updateFolder(e){var t=this;return(0,k._)(function*(){return yield t.sdk.update_folder((0,S._)((0,I._)({},e),{folderId:e.folderId,access_time:e.access?1:0}))})()}getFolders(e){var t=this;return(0,k._)(function*(){if(!e||!(null==e?void 0:e.length))return[];if(e.some(e=>e5.isRootFolderId(e)))throw Error("[EverSDK] getFolders: can not get root folder info ");var r=yield t.sdk.get_folders({ids:e});return((null==r?void 0:r.folders)||[]).map(e=>new el(e))})()}getFolder(e,t){var r=this;return(0,k._)(function*(){if(!e5.isRootFolderId(e)){var s=(yield r.getFolders([e]))[0];if(!s||void 0===t||!r.isGroupSdk)return s;var[i]=yield r.getFolderPaths({folderId:e},t);return t===$.PERSONAL&&(null==i?void 0:i.author)===e5.everUserId||t===$.PUBLIC&&i.isPublic?s:null}})()}getFolderPaths(e,t){var r=this;return(0,k._)(function*(){if(!e||!e.folderId)throw Error("[EverSDK] getFolderPaths: folder_id can not be empty");if(e5.isRootFolderId(e.folderId))throw Error("[EverSDK] getFolders: can not get root folder info ");var s=yield r.sdk.get_folder_path({folder_id:e.folderId}),i=((null==s?void 0:s.path)||[]).map(e=>new el(e));return i.length&&r.isGroupSdk&&void 0!==t&&(t!==$.PUBLIC||!i[0].isPublic)&&(t!==$.PERSONAL||i[0].author!==r.everUserId)?[]:i})()}getAssetsByFolder(e,t){var r=this;return(0,k._)(function*(){var s,{folderId:i,filter:n}=e,o=yield r.sdk.get_folder_items({folder_id:i,filter:n||0}),a=(o.assets||[]).filter(e=>{var t;return!(null==e?void 0:null===(t=e.cluster_list)||void 0===t?void 0:t.length)}).map(e=>eu(e,r)),d=(o.packages||[]).map(e=>new en(e)).filter(e=>e.isValid),l=d.filter(e=>e.subType===Z.EDIT).sort((e,t)=>{var r,s;return(null!==(r=t.updatedAt)&&void 0!==r?r:0)-(null!==(s=e.updatedAt)&&void 0!==s?s:0)}),u=d.filter(e=>e.subType===Z.SCRIPT).sort((e,t)=>{var r,s;return(null!==(r=t.updatedAt)&&void 0!==r?r:0)-(null!==(s=e.updatedAt)&&void 0!==s?s:0)}),c=[];c=(o.clusters||[]).filter(e=>e.n_asset).map(e=>new ed({cluster:e})),yield Promise.all(c.map((s=(0,k._)(function*(e){var t=yield r.getClusterLastAsset(e);e.updateLastAsset(t)}),function(e){return s.apply(this,arguments)})));var p=(o.folders||[]).map(e=>new el(e));if(!r.isGroupSdk||void 0===t)return{assets:a,packages:l,clusters:c,folders:p,scripts:u};if(e5.isRootFolderId(i))return{assets:a.filter(e=>ep(t,e)),packages:l.filter(e=>ep(t,e)),clusters:c.filter(e=>ep(t,e)),folders:p.filter(e=>ep(t,e)),scripts:u.filter(e=>ep(t,e))};var v=yield r.getFolderPaths({folderId:i},t);if(!v.length)return{};var h=v[0];return t===$.PERSONAL&&h.author===e5.everUserId||t===$.PUBLIC&&h.isPublic?{assets:a,packages:l,clusters:c,folders:p,scripts:u}:{}})()}copyAsset(e){var t=this;return(0,k._)(function*(){if(!e||!e.entryId)throw Error("[EverSDK] copyAsset: entry_id can not be empty");try{t.cacheCurrentFolders(e.parentId)}catch(e){}return eu((yield t.sdk.copy_asset({entry_id:e.entryId,name:e.name,parent_id:e.parentId})).asset,t)})()}copyPackage(e){var t=this;return(0,k._)(function*(){if(!e||!e.src_package_id)throw Error("[EverSDK] copyPackage: src_package_id can not be empty");var{owner:r,platform:s,appVersion:i,systemVersion:n}=eh().uploadSource,o={owner:r,platform:s,appVersion:i,systemVersion:n,createTime:Date.now()};return new en((yield t.sdk.copy_package({src_package_id:e.src_package_id,target_name:e.target_name,target_package_key:e.target_package_key,target_meta:JSON.stringify((0,C.Z)(eh(),e.target_meta,{createSource:o,uploadSource:o}))})).package)})()}copyAndRename(e){var t=this;return(0,k._)(function*(){var{file:r,parent:s}=e,i=yield e5.getAssetsByFolder({folderId:s,filter:0}),n=[...i.assets||[],...i.clusters||[],...i.folders||[],...i.packages||[],...i.scripts||[]].map(e=>e.name),o=t.dependencies.getFileCopyName(r.name,n);if(r.type===q.PACKAGE){var{meta:a}=r,d=(0,S._)((0,I._)({},a),{uploadSource:(0,S._)((0,I._)({},null==a?void 0:a.uploadSource,eh().uploadSource),{platform:"browser"}),createSource:(0,S._)((0,I._)({},null==a?void 0:a.createSource,eh().uploadSource),{platform:"browser"}),draft:(0,S._)((0,I._)({},null==a?void 0:a.draft),{name:o})});return e5.copyPackage({src_package_id:r.id,target_name:o,target_package_key:crypto.randomUUID().toUpperCase(),target_meta:d})}return e5.copyAsset({entryId:r.id,parentId:s,name:o})})()}cacheCurrentFolders(e){if(!e5.isRootFolderId(e)){var t=[e,...this.getCacheCurrentFolderIds().filter(t=>t!==e)].slice(0,this.cacheFoldersNum);window.localStorage.setItem(this.getCacheFolderKey(),JSON.stringify(t))}}getCacheCurrentFolderIds(){var e=[];try{var t=JSON.parse(window.localStorage.getItem(this.getCacheFolderKey())||"");Array.isArray(t)&&(e=t)}catch(e){}return e}getCurrentFolders(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=this;return(0,k._)(function*(){var r=t.getCacheCurrentFolderIds(),s=yield t.getFolders(r.filter(e=>!e5.isRootFolderId(e))),i=t.sortArrayByRelation({exists:s,relation:r,getter:e=>e.id}),n=i.map(e=>e.id);return window.localStorage.setItem(t.getCacheFolderKey(),JSON.stringify(n)),i.slice(0,e)})()}updateEntry(e){var t=this;return(0,k._)(function*(){if(!e||!e.id)throw Error("[EverSDK] updateEntry: entry_id can not be empty");var r={id:e.id};if(e.name&&(r.name=e.name),e.access&&(r.access_time=e.access),null!==e.permission&&void 0!==e.permission&&(r.permission=e.permission===$.PERSONAL?1:0),e.meta)try{r.meta=JSON.stringify(e.meta)}catch(e){}return yield t.sdk.update_entry(r)})()}getEntryAssets(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this;return(0,k._)(function*(){return((yield r.sdk.get_entry_asset({ids:e,allow_cluster:!!t}))||[]).map(e=>eu(e,r))})()}getEntryAsset(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=this;return(0,k._)(function*(){var i=(yield s.sdk.get_entry_asset({ids:[e],allow_cluster:!!t}))[0];if(!i)throw Error("asset not found: entryId=".concat(e));var n=eu(i,s);if(r){var o=yield s.getUnencryptedPlayInfo({id:n.notOnlyId});n._sourceData.unencryptedPlayInfo=o}return n})()}deleteByEntry(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this;return(0,k._)(function*(){for(var r=[],s=0;20*s<e.length;s++)r.push(t.sdk.delete_entry({ids:e.slice(20*s,(s+1)*20)}));return yield Promise.all(r)})()}getFolderMaxDepth(e){var t=this;return(0,k._)(function*(){return yield t.sdk.get_folder_max_depth({folder_id:e})})()}resetSpaceStorage(e){var t=this;return(0,k._)(function*(){var{quota:r,usage:s}=yield t.dependencies.apiFunc.getEverPhotoUserSpace(e);return r-s})()}sortArrayByRelation(e){var t,r=function(e){var t=i.findIndex(t=>s(t)===e);n.push(...i.splice(t,t<0?0:1))},s=(null==e?void 0:e.getter)||(e=>e),i=e.exists.slice(),n=[];for(var o of null!==(t=e.relation)&&void 0!==t?t:[])r(o);return n.push(...i),n}tearDown(){var e=this;return(0,k._)(function*(){return e.sdk?e.sdk.tear_down():Promise.resolve()})()}updatePermission(e){var t=this;return(0,k._)(function*(){var r,{permission:s=null!==(r=t.permission)&&void 0!==r?r:$.PUBLIC,assetIds:i=[],assetMd5s:n=[],packageIds:o=[]}=e;return yield t.sdk.update_permission({permission:s,asset_ids:i,asset_md5s:n,package_ids:o})})()}getUnencryptedPlayInfo(e){var t=this;return(0,k._)(function*(){return yield t.sdk.get_asset_unencrypted_play_info(e)})()}moveFromSpace(e){var t=this;return(0,k._)(function*(){var r,s,i,n={from_space:e.fromSpace||"0",resource_id:e.resourceId,resource_type:e.resourceType,to_space:e.toSpace||(null===(r=t.options)||void 0===r?void 0:r.space)||"0",meta:JSON.stringify(e.meta)};return!(null===(s=t.options)||void 0===s?void 0:s.is_boe)&&(n.from_idc=e.fromIdc,n.to_idc=null!==(i=e.toIdc)&&void 0!==i?i:t.idc),new eU((yield t.sdk.move_from_space(n)).process_id,t)})()}copyFromSpace(e){var t=this;return(0,k._)(function*(){var r,s,i,n={from_space:e.fromSpace||"0",resource_id:e.resourceId,resource_type:e.resourceType,to_space:e.toSpace||(null===(r=t.options)||void 0===r?void 0:r.space)||"0",meta:JSON.stringify(e.meta),package_key:e.packageKey};return!(null===(s=t.options)||void 0===s?void 0:s.is_boe)&&(n.from_idc=e.fromIdc,n.to_idc=null!==(i=e.toIdc)&&void 0!==i?i:t.idc),new eN((yield t.sdk.copy_from_space(n)).process_id,t)})()}getImagesTranscodeStatus(e){var t=this;return(0,k._)(function*(){var r=new eB(e,t);return yield t.sdk.get_image_transcode_info({listeners:e.map(e=>(0,S._)((0,I._)({},e),{transcode_type:K[e.resolution]}))}),r})()}triggerImageResize(e){var t=this;return(0,k._)(function*(){for(var{ids:r=[],md5s:s=[]}=e,i=[],n=0;50*n<r.length;n++)i.push(t.sdk.trigger_image_resize({ids:r.slice(50*n,(n+1)*50)}));for(var o=0;50*o<s.length;o++)i.push(t.sdk.trigger_image_resize({md5s:s.slice(50*o,(o+1)*50)}));return yield Promise.all(i)})()}cancelImagesTranscodeStatus(e,t){var r=this;return(0,k._)(function*(){yield r.sdk.cancel_image_transcode_info_loop({listeners:e.map(e=>(0,S._)((0,I._)({},e),{transcode_type:K[e.resolution]})),cancel_all:t}),r.eventBus.emit(e$.EverCloudCancelImageTranscode,{options:e,cancelAll:t})})()}getImagePreviewInfo(e,t){var r=this;return(0,k._)(function*(){var s=e.imageTranscodeInfo,i={},n=[];if((t||M).forEach(e=>{s[e]?i[e]=s[e]:n.push(e)}),!n.length)return i;var o=yield r.getImagesTranscodeStatus(n.map(t=>({ids:[e.id],resolution:t})));if(!e.imageAsyncResize){var a=yield r.triggerImageResize({ids:[e.id]});ec("EverCloud triggerImageResize ".concat(e.id," ").concat(JSON.stringify(a)))}try{return yield o.done(),(yield r.getAssetByFileId(e.id)).imageTranscodeInfo}catch(e){return i}})()}getImagesPreviewInfo(e){var t=this;return(0,k._)(function*(){var r,{resolutions:s,ids:i,md5s:n}=e,o=null==s?void 0:s.map(e=>({ids:i,md5s:n,resolution:e})),a=yield t.getImagesTranscodeStatus(o),d=yield t.triggerImageResize({ids:i,md5s:n});ec("EverCloud triggerImageResize: \n ids-[".concat(i,"] \n md5s-[").concat(n,"]: \n").concat(JSON.stringify(d))),yield a.done();var l=null!==(r=(yield t.getAsset({ids:i,md5s:n})).map(e=>eu(e,t)))&&void 0!==r?r:[],u={};l.forEach(e=>{u[e.id]=e,u[e.md5]=e});var c={};return null==i||i.forEach(e=>{u[e]&&(c[e]=u[e].imageTranscodeInfo)}),null==n||n.forEach(e=>{u[e]&&(c[e]=u[e].imageTranscodeInfo)}),c})()}throttlingGetUpdatesTrigger(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throttle:2e3},t=this;return(0,k._)(function*(){if(t._getUpdatesTriggerLastTime)Date.now()-t._getUpdatesTriggerLastTime>e.throttle&&(t._getUpdatesTriggerLastTime=Date.now(),t.sdk.trigger_pull_updates());else{t._getUpdatesTriggerLastTime=Date.now(),t.sdk.trigger_pull_updates();return}})()}initEverCloudSdk(e){var t=this;return(0,k._)(function*(){if(t.sdk){ec("this has been init",{type:"warn"});return}var s=Date.now(),i=function(){try{var e="undefined"!=typeof __userInfoStringify?JSON.parse(__userInfoStringify):void 0;if(e&&"0"===e.ret)return e.data;return}catch(e){return}}();if((null==i?void 0:i.ever_photo.token)&&(null==i?void 0:i.ever_photo.web_user_id))d=i.ever_photo.token,l=i.ever_photo.web_user_id;else{var n,o,a,d,l,u,c=yield t.dependencies.apiFunc.getEverPhotoToken(null===(u=t.options)||void 0===u?void 0:u.space);d=c.token,l=c.ever_photo_user.web_user_id}t.initEverCloudSdkReporter.addParams({getToken:Date.now()-s}),t.webUserId=l;var{EverCloudSdk:p}=yield r.e("1637").then(r.bind(r,425897)),{timeout:v}=t.options||{},h=v||{},{init:_=3e5}=h,g=(0,D._)(h,["init"]),f=new p((0,S._)((0,I._)({token:d,ep_uid:t.webUserId,source_from:t.dependencies.constant.sourceFrom,level:"error"},t.options),{event_conf:{enable_asset_status_event:!1,enable_package_status_event:!1},common_params:{aid:t.dependencies.constant.aid},headers:(0,I._)({},null===(n=t.options)||void 0===n?void 0:n.headers),backup_conf:(0,I._)({max_count_of_concurrent_upload:5,chunk_size:5},null===(o=t.options)||void 0===o?void 0:o.backup_conf),timeout:(0,I._)({general:30,upload:120,download:120},g)}),(0,k._)(function*(){var e,r=yield t.dependencies.apiFunc.getEverPhotoToken(null===(e=t.options)||void 0===e?void 0:e.space);return t.webUserId=r.ever_photo_user.web_user_id,{new_token:r.token,ep_uid:t.webUserId,third_party_uid:t.options.user_id}}));t.sdk=f;try{yield f.init()}catch(e){t.initLocker.initDone({reject:e})}!(null===(a=t.options)||void 0===a?void 0:a.disable_start_sync_loop)&&(yield t.startSyncLoop()),e.initDoneCb(),f.set_event_callback(r=>{var i=JSON.parse(r),n=i.type;if(ec("this receive event: ".concat(n," data: ").concat(r)),"sync_load_done"===n&&e.loadDoneCb(),"sync_init_done"===n){e.syncDoneCb(0===i.code,r),t.initEverCloudSdkReporter.addParams({sdkInit:t.initLocker.costTimes,sdkSync:t.syncLocker.costTimes,total:Date.now()-s});var o,{reportData:a}=t.initEverCloudSdkReporter;null===(o=t.TeaReporter)||void 0===o||o.event(a.event,a.data)}n===e$.TrackSendEvent&&t.reportSdkEvent(i),n===e$.LogReportEvent&&t._reportSlardarLog(i),t.eventBus.emit(n,i)})})()}isAssetNameDumplicate(e){var{fileName:t,filterMd5:r}=e,s=this;return(0,k._)(function*(){return Object.keys((yield s.getFilesListByFloder({})).reduce((e,t)=>{if(t.type!==q.PACKAGE){var s;if(r&&t.md5===r)return e;e[null!==(s=t.name)&&void 0!==s?s:""]=!0}return e},{})).includes(t)})()}reportSdkEvent(e){if(this.TeaReporter){var t,{event_name:r,str_params:s,int_params:i,float_params:n}=e;null===(t=this.TeaReporter)||void 0===t||t.event(r,Object.assign({},s,i,n))}}getFromCache(e){var t=this;return(0,k._)(function*(){if(e&&t.idbPlugin)return yield t.idbPlugin.tryGetSource(e)})()}getCacheFolderKey(){var e;return"current_folder_".concat(this.webUserId,"_").concat((null===(e=this.options)||void 0===e?void 0:e.space)||"")}_reportSlardarLog(e){var t,r;null===(t=this.slardarReporter)||void 0===t||t.call(this,{type:"log",content:e.content,level:e.level,extra:{event_name:e$.LogReportEvent,event_from:"ever_cloud_sdk",space_id:null!==(r=this.spaceId)&&void 0!==r?r:"unknown"}})}_setEverCloudOptions(e){var t=this;return(0,k._)(function*(){if(!t.hasSetOptions){if(!e.netconf){var r,s={base:"everphoto-lv-".concat("b","oe.").concat("b").concat("y").concat("t","edance.ne").concat("t"),media:"everphoto-lv-".concat("b","oe.").concat("b").concat("y").concat("t","edance.ne").concat("t"),is_https:!0};Object.assign(e,{netconf:e.is_boe?s:{base:"lv-everphoto-bcdn.".concat("u","like").concat("c","am.com"),media:"lv-everphoto-bcdn.".concat("u","like").concat("c","am.com"),is_https:!0}})}var i=t.dependencies.overwriteSDKInitOptions&&(yield t.dependencies.overwriteSDKInitOptions(e)),n=i||e;n.netconf=Object.assign({is_https:!0},n.netconf),t.options=n,t.idc=null!==(r=x[e.dc_name])&&void 0!==r?r:e.dc_name}})()}_uploadAssetByEverCloud(e){var t=this;return(0,k._)(function*(){var r,s,{file:i,fileName:n,permission:o=null!==(r=t.permission)&&void 0!==r?r:$.PUBLIC,folderId:a}=e,d=n||i.name;if(!(null==e?void 0:e.skipDuplicate)&&(yield t.isAssetNameDumplicate({fileName:d})))throw new ef;var l=(0,C.Z)(eh(),null==e?void 0:e.meta),{fileType:u}=e;return!u&&(u=null!==(s=b({file:i}))&&void 0!==s?s:"file"),new eA({requestId:(yield t.sdk.upload_asset(i,u,d,JSON.stringify(l),o===$.PERSONAL?"personal":"",null==e?void 0:e.flags,a,e.isMultiDefTranscode,e.transcodeTemplateType)).request_id,fileType:u,autoPromote:!!e.autoPromote,workspaceId:e.workspaceId},t)})()}_uploadAssetByVod(e){var t=this;return(0,k._)(function*(){t.reportUploadAnalyze({action:eg.Start,size:-1,uploaderType:"vod",filename:e.file.name});var r,s,i,n,o=Date.now(),a=e.fileName||e.file.name;if(!(null==e?void 0:e.skipDuplicate)){try{r=yield t.isAssetNameDumplicate({fileName:a})}catch(r){var d,l="[error]asset name dumplicate error: ".concat(r.msg||r.message);throw d={code:r.code,msg:l},t.reportUploadAnalyze({action:eg.Error,size:e.file.size||-1,uploaderType:"vod",errorMsg:d.msg,filename:e.file.name}),Error(r)}if(r)throw new ef}!t.vodUploader&&(t.vodUploader=t.getSignUploader({workspaceId:e.workspaceId,userId:null===(s=t.options)||void 0===s?void 0:s.user_id}));var u=(0,C.Z)(eh(),null==e?void 0:e.meta),{fileType:c}=e;!c&&(c=null!==(i=b({file:e.file}))&&void 0!==i?i:"file");var p=Date.now()-o;t.reportUploadAnalyze({action:eg.Init,size:e.file.size||0,duration:p,uploaderType:"vod",filename:e.file.name});var v=!1,h=()=>{t._concurrencyLockForVod.release(),!v&&(v=!0,clearTimeout(n))};yield t._concurrencyLockForVod.acquire();var _=e.uploaderConfig;return new eZ({file:e.file,fileName:a,fileType:c,uploader:t.vodUploader,workspaceId:e.workspaceId,flags:e.flags,folderId:e.folderId,meta:u,isMultiDefTranscode:e.isMultiDefTranscode,autoPromote:e.autoPromote,transcodeTemplateType:e.transcodeTemplateType,permission:e.permission||t.permission||$.PUBLIC,noCopy:null==_?void 0:_.noCopy,startTime:o,onStart:e.onStart,onCancel:()=>{h()},onFinish:()=>{h()},onProgress:()=>{!v&&(clearTimeout(n),n=setTimeout(()=>{!v&&(t._concurrencyLockForVod.release(),v=!0)},15e3))}},t)})()}constructor(){this.eventBus=new P.Z,this._defaultUploaderType="normal",this.noSignOptions=null,this.options=null,this.initLocker=new eM,this.syncLocker=new eM,this.loadLocker=new eM,this._concurrencyLockForVod=new e_(5),this.syncNoSignInitDone=!1,this.syncNoSignIniting=!1,this.syncNoSignInitError=!1,this.initNoSignQueue=[],this.cacheFoldersNum=10,this.initEverCloudSdkReporter=new ej}}(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",["undefined"==typeof Query?Object:Query]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getFilesListByFloder",null),(0,E.gn)([(g=10,f=0,y=[],w=(m=(0,k._)(function*(){if(y.length>0&&f<g){var e=y.shift();if(e){var{fn:t,resolve:r,reject:s}=e;f++;try{yield t().then(r).catch(s)}finally{f--,w()}}else w()}}),function(){return m.apply(this,arguments)}),function(e,t,r){var s=r.value;return r.value=(0,k._)(function*(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(f>=g)return new Promise((e,r)=>{y.push({fn:()=>s.apply(this,t),resolve:e,reject:r})});f++;try{return yield s.apply(this,t)}finally{f--,w()}}),r}),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getAsset",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",["undefined"==typeof Query?Object:Query]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getAssets",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[String]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"asset_preview",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",["undefined"==typeof StreamUploadParams?Object:StreamUploadParams]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"streamClipUploadAsset",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[String,Number,"undefined"==typeof File?Object:File,Boolean]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"appendClipToUpload",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"uploadVid",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[String,Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"syncVideoToEverCloud",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Array]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getAssetsByMd5",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[String]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getAssetByMd5",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[String,void 0]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getAssetByFileId",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",["undefined"==typeof Array?Object:Array]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getAssetsByFileId",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object,void 0]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getFileDetailWithTranscode",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getVideoAssetTranscodeStatus",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getAssetsPlayInfo",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getAssetSpirtInfo",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getAssetPreviewInfo",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"cancelAllUploadAsset",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[String]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"cancelUploadAsset",null),(0,E.gn)([ez(),ex(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"deleteAsset",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"renameAsset",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"downloadByUrlKey",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",["undefined"==typeof DonwloadAssetParams?Object:DonwloadAssetParams]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"downloadAssetStream",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[String,String,String]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"downloadAssetUrl",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",["undefined"==typeof IBrowserDownload?Object:IBrowserDownload]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getDownloadUrl",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"downloadAssetUrlV2",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getPackages",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[String]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getPackageByKey",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"savePackage",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"sharePackage",null),(0,E.gn)([ez(),ex(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[String]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"deletePackageById",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"renamePackages",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"updatePackageMeta",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"forceSyncPullUpdates",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getClusters",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[ed]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getClusterLastAsset",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getClusterById",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"createCluster",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"delCluster",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"addAssetToCluster",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"delAssetFromCluster",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"updateCluster",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getAssetsFromCluster",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"createFolder",null),(0,E.gn)([eH(),ex(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Array]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"deleteFolder",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"moveTo",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"updateFolder",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Array]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getFolders",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object,void 0===$?Object:$]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getFolderPaths",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object,void 0===$?Object:$]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getAssetsByFolder",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"copyAsset",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"copyPackage",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"updateEntry",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Array,void 0]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getEntryAssets",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[String,void 0,void 0]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getEntryAsset",null),(0,E.gn)([eH(),ex(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Array]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"deleteByEntry",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[String]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getFolderMaxDepth",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"updatePermission",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getUnencryptedPlayInfo",null),(0,E.gn)([ez(),ex(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",["undefined"==typeof IMoveFromSpaceOption?Object:IMoveFromSpaceOption]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"moveFromSpace",null),(0,E.gn)([ez(),ex(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",["undefined"==typeof IMoveFromSpaceOption?Object:IMoveFromSpaceOption]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"copyFromSpace",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Array]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getImagesTranscodeStatus",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"triggerImageResize",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Array,Boolean]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"cancelImagesTranscodeStatus",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[et,Array]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getImagePreviewInfo",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"getImagesPreviewInfo",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"throttlingGetUpdatesTrigger",null),(0,E.gn)([eH(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",[Object]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"isAssetNameDumplicate",null),(0,E.gn)([ez(),(0,E.w6)("design:type",Function),(0,E.w6)("design:paramtypes",["undefined"==typeof UploadParams?Object:UploadParams]),(0,E.w6)("design:returntype",Promise)],eX.prototype,"_uploadAssetByEverCloud",null);class e0{static get sdk(){var e=e0._getSdkKey(e0.options),t=e0.sdkList.get(e);if(t)return t.sdk;e0.initNoSignSdk();var r=e0.sdkList.get(e0._getSdkKey());return null==r?void 0:r.sdk}static get supportImageResolutions(){return M}static prefetchWasmCode(){return(0,k._)(function*(){var{evpt_sdk_init_wasm_module:e}=yield r.e("1637").then(r.bind(r,425897));yield e()})()}static getSdkInstance(e){var t=this;return(0,k._)(function*(){var r,s,i,n,{autoDestroy:o=!1,dcName:a,netconf:d,userId:l}=e,{spaceId:u}=e;!u&&(u="0");var c="".concat((null===(r=e0.options)||void 0===r?void 0:r.user_id)||"","-").concat(u),p=new ej;p.addProcessParams({method:"getSdkInstance",process:"wait-set-options",key:c}),ec("EverCloud: getSdkInstance ".concat(c," start wait setOptions")),null===(s=t.TeaReporter)||void 0===s||s.event(p.progressEvent,p.process),ec("EverCloud: getSdkInstance ".concat(c," end wait setOptions")),yield e0.init({spaceId:u,dcName:a,netconf:d,autoDestroy:o,initProcessReporter:p,userId:l});var v=e0.sdkList.get(c);if(v)return v.referenceCount+=1,ec("EverCloud: Reference instance [".concat(c,"], reference-").concat(v.referenceCount)),p.addProcessParams({process:"init-success"}),null===(n=t.TeaReporter)||void 0===n||n.event(p.progressEvent,p.process),v.autoDestroy=o,v.sdk;throw p.addProcessParams({process:"init-error",error:"EverCloud sdk init edn bug sdk=".concat(c," not found in cache")}),null===(i=t.TeaReporter)||void 0===i||i.event(p.progressEvent,p.process),Error("EverCloud: sdk init failed")})()}static setNoSignOptions(e){e0.noSignOptions=e,e0.sdkList.forEach(t=>{t.sdk.setNoSignOptions(e)})}static noSignInit(){return(0,k._)(function*(){yield e0.initNoSignSdk()})()}static initNoSignSdk(){return(0,k._)(function*(){if(!e0.sdkList.get(e0._getSdkKey())){var e=new eX;if(e0.dependencies)e.setDependencies(e0.dependencies);else throw Error("please call setDependencies before init.");e.setNoSignOptions(e0.noSignOptions),e0.sdkList.set(e0._getSdkKey(),{referenceCount:0,sdk:e,updateTime:Date.now(),createTime:Date.now(),autoDestroy:!0}),yield e.noSignInit()}})()}static changeSpace(e){return(0,k._)(function*(){e0.space=e.spaceId||"0";var t=yield e0.init(e);return e0._emitSpaceChange(),t})()}static setTeaReporter(e){e0.TeaReporter=e,e0.sdkList.forEach(t=>{var{sdk:r}=t;r.setTeaReporter(e)})}static setSlardarReporter(e){e0.slardarReporter=e,e0.sdkList.forEach(t=>{var{sdk:r}=t;r.setSlardarReporter(e)})}static setOptions(e,t){(!e0.options||t)&&(e0.options=e,e0._initLocker.startToInit(),e0._initLocker.initDone())}static init(e){var t=this;return(0,k._)(function*(){var r,s,{spaceId:i,autoDestroy:n=!0,dcName:o,netconf:a,initProcessReporter:d,userId:l}=e||{},{idbPlugin:u,options:c,sdkList:p,space:v}=e0,h=i||v||c.space||"0",_=e0._getSdkKey(c,h),g=d||new ej;g.addProcessParams({method:g.reportProcess.data.method||"init",key:g.reportProcess.data.key||_,process:"wait-init"}),null===(y=t.TeaReporter)||void 0===y||y.event(g.progressEvent,g.process);var f=p.get(_);if(f){g.addProcessParams({process:"sdk-init-existed"}),null===(w=t.TeaReporter)||void 0===w||w.event(g.progressEvent,g.process);var y,m,w,P,{sdk:D}=f;return u&&D.setCachePlugin(u),f.updateTime=Date.now(),null===(P=e0.awaitInitQueue.get(_))||void 0===P||P.forEach(e=>{var{resolve:t}=e;return t(f.sdk)}),e0.awaitInitQueue.delete(_),e0._destroySdk(),D.init()}var E=e0.awaitInitQueue.get(_);if(E&&E.length)return g.addProcessParams({process:"sdk-init-doing"}),null===(s=t.TeaReporter)||void 0===s||s.event(g.progressEvent,g.process),new Promise((e,t)=>{E.push({resolve:e,reject:t})});g.addProcessParams({process:"sdk-init-new"}),null===(m=t.TeaReporter)||void 0===m||m.event(g.progressEvent,g.process);var A=new eX;if(u&&A.setCachePlugin(u),e0.dependencies)A.setDependencies(e0.dependencies);else throw Error("please call setDependencies before init.");return A.setNoSignOptions(e0.noSignOptions),A.setTeaReporter(e0.TeaReporter),e0.slardarReporter&&A.setSlardarReporter(e0.slardarReporter),new Promise((r=(0,k._)(function*(e,r){e0.awaitInitQueue.set(_,[{resolve:e,reject:r}]);try{var s,i,d,u,v,f,y=(0,S._)((0,I._)({},c),{space:h,netconf:null!=a?a:null==c?void 0:c.netconf,dc_name:null!=o?o:c.dc_name});l&&(y.user_id=l),yield A.setOptions(y);var m=e0._getSdkKey(c,h),w=yield A.init();return g.addProcessParams({process:"sdk-init-done"}),null===(v=t.TeaReporter)||void 0===v||v.event(g.progressEvent,g.process),p.set(m,{referenceCount:0,sdk:A,updateTime:Date.now(),createTime:Date.now(),autoDestroy:n}),null===(f=e0.awaitInitQueue.get(_))||void 0===f||f.forEach(e=>{var{resolve:t}=e;return t(w)}),e0.awaitInitQueue.delete(_),e0._destroySdk(),w}catch(e){g.addProcessParams({process:"init-error",error:null==e?void 0:null===(s=e.toString)||void 0===s?void 0:s.call(e)}),null===(i=t.TeaReporter)||void 0===i||i.event(g.progressEvent,g.process),ec("EverCloud: getSdkInstance ".concat(_," \u521D\u59CB\u5316\u5931\u8D25: ").concat(null==e?void 0:null===(d=e.toString)||void 0===d?void 0:d.call(e))),null===(u=e0.awaitInitQueue.get(_))||void 0===u||u.forEach(t=>{var{reject:r}=t;return r(e)}),e0.awaitInitQueue.delete(_)}}),function(e,t){return r.apply(this,arguments)}))})()}static setCachePlugin(e){e0.idbPlugin=e}static onSpaceChange(e){return e0.eventBus.on(e0.EVENTS.SPACE_CHANGE,e)}static setDependencies(e){e0.dependencies=e,e0.sdkList.forEach(t=>{var{sdk:r}=t;r.setDependencies(e)})}static get rootFolderId(){return""}static isRootFolderId(e){return!e||-1===Number(e)}static destroySdk(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,k._)(function*(){var t=e0._getSdkKey(e0.options,e),r=e0.sdkList.get(t);if(!!(null==r?void 0:r.sdk)&&"-"!==t){if(r.referenceCount-=1,r.sdk===e0.sdk){ec("Can not destroy instance [".concat(t,"], because it is being used as default sdk. reference-").concat(r.referenceCount));return}r.referenceCount<=0?(e0.sdkList.delete(t),yield r.sdk.destroy(),ec("Destroy instance [".concat(t,"]"))):ec("Can not destroy instance [".concat(t,"], because it is being used. reference-").concat(r.referenceCount))}})()}static _emitSpaceChange(){e0.eventBus.emit(e0.EVENTS.SPACE_CHANGE)}static _getSdkKey(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e0.space;return"".concat((null==e?void 0:e.user_id)||"","-").concat(t||(null==e?void 0:e.space)||"0")}static _destroySdk(){e0.timer&&clearTimeout(e0.timer);var e=e0.sdkList,t=null,r="";if(e.forEach((s,i)=>{var{sdk:n,updateTime:o,autoDestroy:a,referenceCount:d}=s;if(n!==e0.sdk&&"-"!==i&&!!a)o<Date.now()-e0.duration&&d<=0&&(e.delete(i),n.destroy(),ec("AutoDestroy overdue instance [".concat(i,"]"))),d>0&&ec("Can not auto destroy overdue instance [".concat(i,"], because it is being used. reference-").concat(d)),(!t||t.updateTime>o)&&(t=s,r=i)}),t&&e.size>e0.maxSize){var{sdk:s,autoDestroy:i,referenceCount:n}=t;i&&n<=0&&(e.delete(r),s.destroy(),ec("AutoDestroy excess instance [".concat(r,"]")))}e0.timer=setTimeout(()=>{e0._destroySdk()},e0.duration)}}e0.eventBus=new P.Z,e0.EVENTS={SPACE_CHANGE:"space_change"},e0.sdkList=new Map,e0.maxFolderDepth=10,e0.space="",e0.TeaReporter=null,e0.slardarReporter=null,e0.duration=6e4,e0.maxSize=3,e0.timer=setTimeout(()=>{e0._destroySdk()},e0.duration),e0.dependencies=void 0,e0._initLocker=new eM,e0.awaitInitQueue=new Map;var e6=r("973115");class e1{tryGetSource(e){var t=this;return(0,k._)(function*(){return yield(0,e6.U2)(e,t._store)})()}saveSourceBlob(e){var{key:t,buffer:r}=e,s=this;return(0,k._)(function*(){return yield(0,e6.t8)(t,r,s._store)})()}delSource(e){var t=this;return(0,k._)(function*(){return yield(0,e6.IV)(e,t._store)})()}constructor(){this._store=(0,e6.MT)("lv-ever-cloud","lv-ever-cloud-url")}}var e5=new Proxy({},{get:(e,t)=>{switch(t){case"setOptions":case"options":case"space":case"init":case"setCachePlugin":case"onSpaceChange":case"changeSpace":case"setTeaReporter":case"setSlardarReporter":case"isRootFolderId":case"rootFolderId":case"maxFolderDepth":case"setDependencies":case"destroySdk":case"getSdkInstance":case"setNoSignOptions":case"noSignInit":case"initNoSignSdk":case"prefetchWasmCode":case"TeaReporter":case"slardarReporter":case"sdkList":case"supportImageResolutions":case"$$typeof":return e0[t];default:var r=e0.sdk;if(!r){console.warn("EverCloud:EverCloudBaseCore.".concat(String(t)," ever-sdk \u672A\u521D\u59CB\u5316"));return}if("function"==typeof r[t])return r[t].bind(r);return r[t]}}})},820072:function(e,t,r){r.d(t,{x:function(){return i}});var s="https://lf-capcut-web.capcut.cn/obj/capcut-web-buz-cn/",i={entryCDN:"".concat(s,"stream-md5/streaming_md5.js"),wasmCDN:"".concat(s,"stream-md5/streaming_md5.wasm")}},503582:function(e,t,r){r.d(t,{k:()=>v});var s=r("876826"),i=r("82615"),n=r("806663"),o=r("843698"),a=r("874800"),d=r("56935"),l=r("903355"),u=r("346526");class c{get hasBeenDone(){return this._hasBeenDone}get costTimes(){if(!!this._initCostTimes){var{start:e,end:t}=this._initCostTimes;return(null!=t?t:Date.now())-e}}get initResult(){if(!!this._hasBeenDone)return{resolve:this._resolveResult,reject:this._rejectResult}}get isIniting(){return this._isIniting}awaitForInit(){var e,t,{key:r,timeout:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._hasBeenDone&&this.initResult){var{resolve:i,reject:n}=this.initResult;return n?Promise.reject(n):Promise.resolve(i)}if(r&&this._waitingResolverMap.has(r))return this._waitingResolverMap.get(r);if(!s){var o=new Promise((e,t)=>{this._waitingResolvers.add([e,t])});return r&&this._waitingResolverMap.set(r,o),o}var a=Promise.race([new Promise((r,s)=>{e=[()=>{clearTimeout(t),r()},s],this._waitingResolvers.add([e,s])}),new Promise((r,i)=>{t=setTimeout(()=>{this._waitingResolvers.delete(e),i(Error("Timed out waiting for init"))},s)})]);return r&&this._waitingResolverMap.set(r,a),a}startToInit(){return!this._hasBeenDone&&!this._isIniting&&(this._isIniting=!0,this._initCostTimes={start:Date.now()},!0)}initDone(e){if(this._hasBeenDone)throw Error("Cannot release an inited locker");this._initCostTimes&&(this._initCostTimes.end=Date.now());var t=!1;for(var r of((null==e?void 0:e.reject)?(t=!0,this._rejectResult=e.reject):this._resolveResult=null==e?void 0:e.resolve,this._waitingResolvers))t?r[1](this._rejectResult):r[0](this._resolveResult);this._waitingResolverMap.clear(),this._waitingResolvers.clear(),this._hasBeenDone=!0,this._isIniting=!1}constructor(){this._hasBeenDone=!1,this._isIniting=!1,this._initCostTimes=void 0,this._waitingResolvers=new Set,this._waitingResolverMap=new Map}}var p=r("836413");class v extends a.JT{calcFileMd5(e){var t,r=this;return new Promise((t=(0,s._)(function*(t,i){try{yield r._awaitInitLocker.awaitForInit(),yield r._mutex.lock(),yield r._start();var n,o,a=0,d=new FileReader,l=!0,u=()=>{var t=a*r._chunkSize,s=t+r._chunkSize;s+r._chunkSize>=e.size&&(l=!1,s=e.size),d.readAsArrayBuffer(e.slice(t,s))};d.onload=(n=(0,s._)(function*(e){try{var s=e.target.result,n=yield r._update(s);!n.ok&&i(n),a++,l?u():t(r._end())}catch(e){t((0,p.Mx)(-1,"update chunk failure",e))}}),function(e){return n.apply(this,arguments)}),d.onerror=e=>{var s;null===(s=r._onError)||void 0===s||s.call(r,(0,p.wf)(-1,"read file failure:".concat(null==e?void 0:e.message),e)),t((0,p.wf)(-1,"read file failure:".concat(null==e?void 0:e.message)))},u()}catch(e){null===(o=r._onError)||void 0===o||o.call(r,(0,p.wf)(-1,"calc md5 worker init failure",e)),t((0,p.wf)(-1,"calc md5 worker init failure",e))}}),function(e,r){return t.apply(this,arguments)})).finally(()=>{this._mutex.unLock()})}dispose(){this._worker&&(this._worker.terminate(),this._worker=null),super.dispose()}_createNetworkClient(){this._networkClient=(0,l.e)(),(0,u.V)(this._networkClient,{retries:2})}_bootstrap(){var e=this;return(0,s._)(function*(){(0,d.Y2)(!e._worker,"thr bootstrap method has been called");try{return e._worker=yield e._initWorker(),e._awaitInitLocker.initDone(),(0,p.ly)()}catch(t){return e._awaitInitLocker.initDone({reject:t}),(0,p.wf)(-1,null==t?void 0:t.message)}})()}_start(){var e=this;return(0,s._)(function*(){yield e._sendStartToWasm()})()}_update(e){var t=this;return(0,s._)(function*(){return yield t._sendUpdateToWasm(e),(0,p.ly)()})()}_end(){var e=this;return(0,s._)(function*(){var t=yield e._sendEndToWasm();return(0,p.oW)(t)})()}_fetchWorker(){(0,d.Y2)(this._entryAddress&&this._wasmAddress,"not found cdn.");var e=this._networkClient.get(this._entryAddress,{responseType:"arraybuffer"});return{entry:e,wasm:this._networkClient.get(this._wasmAddress,{responseType:"arraybuffer"})}}_initWorker(){var e,{entry:t,wasm:r}=this._fetchWorker(),i=this;return Promise.all([t,r]).then(e=>{var t=e[0].data,r=e[1].data,s=e=>"string"==typeof e?new TextEncoder().encode(e).buffer:e;return{entry:s(t),wasm:s(r)}}).then((e=(0,s._)(function*(e){var t=new Worker(URL.createObjectURL(new Blob([new Uint8Array(e.entry)],{type:"text/javascript"})));return t.onmessage=e=>{var[t,r]=e.data;switch(String(t)){case"".concat(2001):i._wasmInitEmitter.fire();break;case"".concat(2002):i._wasmOthersEmitter.fire(r);break;default:(0,d.ss)("invalid event:".concat(t))}i._wasmOthersEmitter.fire([String(t),r])},t.postMessage([1001,i._getU8ASABFromAB(e.wasm)]),yield i._actionDone(i._wasmInitEmitter.event),t}),function(t){return e.apply(this,arguments)}))}_getU8ASABFromAB(e){var t=new Uint8Array(e),r=new Uint8Array(new SharedArrayBuffer(t.byteLength));return r=t}_actionDone(e){return new Promise(t=>{(0,n.V)(e)(e=>{t(e)})})}_sendStartToWasm(){var e=this;return(0,s._)(function*(){(0,d.Y2)(e._worker,"worker must existed, before send"),e._worker.postMessage([1002]),yield e._actionDone(e._wasmOthersEmitter.event)})()}_sendUpdateToWasm(e){var t=this;return(0,s._)(function*(){(0,d.Y2)(t._worker,"worker must existed, before send"),t._worker.postMessage([1003,t._getU8ASABFromAB(e)]),yield t._actionDone(t._wasmOthersEmitter.event)})()}_sendEndToWasm(){return(0,d.Y2)(this._worker,"worker must existed, before send"),this._worker.postMessage([1004]),this._actionDone(this._wasmOthersEmitter.event)}constructor(e){super(),this._worker=null,this._chunkSize=5242880,this._awaitInitLocker=new c,this._mutex=new i.L,this._wasmOthersEmitter=this._store.add(new o.Q),this._wasmInitEmitter=this._store.add(new o.Q),this._entryAddress=e.entryCDN,this._wasmAddress=e.wasmCDN,this._onError=e.onError,this._createNetworkClient(),this._bootstrap()}}},733730:function(e,t,r){r.d(t,{v:function(){return s}});var s=r(792316);t.Z=s},973115:function(e,t,r){let s;function i(e){return new Promise((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)})}function n(e,t){let r=indexedDB.open(e);r.onupgradeneeded=()=>r.result.createObjectStore(t);let s=i(r);return(e,r)=>s.then(s=>r(s.transaction(t,e).objectStore(t)))}function o(){return!s&&(s=n("keyval-store","keyval")),s}function a(e,t=o()){return t("readonly",t=>i(t.get(e)))}function d(e,t,r=o()){return r("readwrite",r=>(r.put(t,e),i(r.transaction)))}function l(e,t=o()){return t("readwrite",t=>(e.forEach(e=>t.put(e[1],e[0])),i(t.transaction)))}function u(e,t=o()){return t("readonly",t=>Promise.all(e.map(e=>i(t.get(e)))))}function c(e,t=o()){return t("readwrite",t=>(t.delete(e),i(t.transaction)))}function p(e=o()){return e("readwrite",e=>(e.clear(),i(e.transaction)))}r.d(t,{IV:function(){return c},MT:function(){return n},U2:function(){return a},ZH:function(){return p},t8:function(){return d},vw:function(){return l},yS:function(){return u}})}}]);